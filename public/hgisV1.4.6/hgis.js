var HGIS={VERSION_NUMBER:"v1.4",singleFile:true,_getScriptLocation:(function(){var A=new RegExp("(^|(.*?\\/))(hgis[^\\/]*?\\.js)(\\?|$)"),B=document.getElementsByTagName("script"),G,E,D="";for(var C=0,F=B.length;C<F;C++){G=B[C].getAttribute("src");if(G){E=G.match(A);if(E){D=E[1];break}}}return(function(){return D})})(),ImgPath:""};var APIAdress=HGIS._getScriptLocation();HGIS.Class=function(){var D=arguments.length;var B=arguments[0];var A=arguments[D-1];var G=typeof A.initialize=="function"?A.initialize:function(){B.prototype.initialize.apply(this,arguments)};if(D>1){var E=[G,B].concat(Array.prototype.slice.call(arguments).slice(1,D-1),A);HGIS.inherit.apply(null,E)}else{G.prototype=A}return G};HGIS.inherit=function(H,E){var A=function(){};if(E==undefined){return}A.prototype=E.prototype;H.prototype=new A;var B,G,D;for(B=2,G=arguments.length;B<G;B++){D=arguments[B];if(typeof D==="function"){D=D.prototype}HGIS.Util.extend(H.prototype,D)}};HGIS.Util=HGIS.Util||{};HGIS.Util.extend=function(A,B){A=A||{};if(B){for(var C in B){var D=B[C];if(D!==undefined){A[C]=D}}var E=typeof window.Event=="function"&&B instanceof window.Event;if(!E&&B.hasOwnProperty&&B.hasOwnProperty("toString")){A.toString=B.toString}}return A};HGIS.String={startsWith:function(B,A){return(B.indexOf(A)==0)},contains:function(B,A){return(B.indexOf(A)!=-1)},trim:function(A){return A.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(D){var C=D.split("-");var F=C[0];for(var A=1,E=C.length;A<E;A++){var B=C[A];F+=B.charAt(0).toUpperCase()+B.substring(1)}return F},format:function(C,A,D){if(!A){A=window}var B=function(H,G){var I;var E=G.split(/\.+/);for(var F=0;F<E.length;F++){if(F==0){I=A}if(I===undefined){break}I=I[E[F]]}if(typeof I=="function"){I=D?I.apply(null,D):I()}if(typeof I=="undefined"){return"undefined"}else{return I}};return C.replace(HGIS.String.tokenRegEx,B)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(A){return HGIS.String.numberRegEx.test(A)},numericIf:function(B,C){var A=B;if(C===true&&B!=null&&B.replace){B=B.replace(/^\s*|\s*$/g,"")}return HGIS.String.isNumeric(B)?parseFloat(B):A}};HGIS.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(A,B){var C=0;if(B>0){C=parseFloat(A.toPrecision(B))}return C},format:function(E,G,B,C){G=(typeof G!="undefined")?G:0;B=(typeof B!="undefined")?B:HGIS.Number.thousandsSeparator;C=(typeof C!="undefined")?C:HGIS.Number.decimalSeparator;if(G!=null){E=parseFloat(E.toFixed(G))}var F=E.toString().split(".");if(F.length==1&&G==null){G=0}var I=F[0];if(B){var A=/(-?[0-9]+)([0-9]{3})/;while(A.test(I)){I=I.replace(A,"$1"+B+"$2")}}var D;if(G==0){D=I}else{var H=F.length>1?F[1]:"0";if(G!=null){H=H+new Array(G-H.length+1).join("0")}D=I+C+H}return D},zeroPad:function(B,C,D){var A=B.toString(D||10);while(A.length<C){A="0"+A}return A}};HGIS.Function={bind:function(A,B){var C=Array.prototype.slice.apply(arguments,[2]);return function(){var D=C.concat(Array.prototype.slice.apply(arguments,[0]));return A.apply(B,D)}},bindAsEventListener:function(A,B){return function(C){return A.call(B,C||window.event)}},False:function(){return false},True:function(){return true},Void:function(){}};HGIS.Array={filter:function(B,A,F){var G=[];if(Array.prototype.filter){G=B.filter(A,F)}else{var D=B.length;if(typeof A!="function"){throw new TypeError()}for(var C=0;C<D;C++){if(C in B){var E=B[C];if(A.call(F,E,C,B)){G.push(E)}}}}return G}};HGIS.Bounds=HGIS.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(B,D,A,C){if(HGIS.Util.isArray(B)){C=B[3];A=B[2];D=B[1];B=B[0]}if(B!=null){this.left=HGIS.Util.toFloat(B)}if(D!=null){this.bottom=HGIS.Util.toFloat(D)}if(A!=null){this.right=HGIS.Util.toFloat(A)}if(C!=null){this.top=HGIS.Util.toFloat(C)}},clone:function(){return new HGIS.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(A){var B=false;if(A!=null){B=((this.left==A.left)&&(this.right==A.right)&&(this.top==A.top)&&(this.bottom==A.bottom))}return B},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(A){if(A===true){return[this.bottom,this.left,this.top,this.right]}else{return[this.left,this.bottom,this.right,this.top]}},toBBOX:function(G,D){if(G==null){G=6}var A=Math.pow(10,G);var C=Math.round(this.left*A)/A;var B=Math.round(this.bottom*A)/A;var F=Math.round(this.right*A)/A;var E=Math.round(this.top*A)/A;if(D===true){return B+","+C+","+E+","+F}else{return C+","+B+","+F+","+E}},toGeometry:function(){return new HGIS.Geometry.Polygon([new HGIS.Geometry.LinearRing([new HGIS.Geometry.Point(this.left,this.bottom),new HGIS.Geometry.Point(this.right,this.bottom),new HGIS.Geometry.Point(this.right,this.top),new HGIS.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new HGIS.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new HGIS.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new HGIS.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(A,E){if(E==null){E=this.getCenterLonLat()}var G,H;if(E.CLASS_NAME=="HGIS.LonLat"){G=E.lon;H=E.lat}else{G=E.x;H=E.y}var D=(this.left-G)*A+G;var F=(this.bottom-H)*A+H;var B=(this.right-G)*A+G;var C=(this.top-H)*A+H;return new HGIS.Bounds(D,F,B,C)},add:function(A,B){if((A==null)||(B==null)){throw new TypeError("Bounds.add cannot receive null values")}return new HGIS.Bounds(this.left+A,this.bottom+B,this.right+A,this.top+B)},extend:function(A){if(A){switch(A.CLASS_NAME){case"HGIS.LonLat":this.extendXY(A.lon,A.lat);break;case"HGIS.Geometry.Point":this.extendXY(A.x,A.y);break;case"HGIS.Bounds":this.centerLonLat=null;if((this.left==null)||(A.left<this.left)){this.left=A.left}if((this.bottom==null)||(A.bottom<this.bottom)){this.bottom=A.bottom}if((this.right==null)||(A.right>this.right)){this.right=A.right}if((this.top==null)||(A.top>this.top)){this.top=A.top}break}}},extendXY:function(A,B){this.centerLonLat=null;if((this.left==null)||(A<this.left)){this.left=A}if((this.bottom==null)||(B<this.bottom)){this.bottom=B}if((this.right==null)||(A>this.right)){this.right=A}if((this.top==null)||(B>this.top)){this.top=B}},containsLonLat:function(B,E){if(typeof E==="boolean"){E={inclusive:E}}E=E||{};var F=this.contains(B.lon,B.lat,E.inclusive),G=E.worldBounds;if(G&&!F){var A=G.getWidth();var D=(G.left+G.right)/2;var C=Math.round((B.lon-D)/A);F=this.containsLonLat({lon:B.lon-C*A,lat:B.lat},{inclusive:E.inclusive})}return F},containsPixel:function(B,A){return this.contains(B.x,B.y,A)},contains:function(B,C,A){if(A==null){A=true}if(B==null||C==null){return false}B=HGIS.Util.toFloat(B);C=HGIS.Util.toFloat(C);var D=false;if(A){D=((B>=this.left)&&(B<=this.right)&&(C>=this.bottom)&&(C<=this.top))}else{D=((B>this.left)&&(B<this.right)&&(C>this.bottom)&&(C<this.top))}return D},intersectsBounds:function(C,H){if(typeof H==="boolean"){H={inclusive:H}}H=H||{};if(H.worldBounds){var J=this.wrapDateLine(H.worldBounds);C=C.wrapDateLine(H.worldBounds)}else{J=this}if(H.inclusive==null){H.inclusive=true}var D=false;var E=(J.left==C.right||J.right==C.left||J.top==C.bottom||J.bottom==C.top);if(H.inclusive||!E){var B=(((C.bottom>=J.bottom)&&(C.bottom<=J.top))||((J.bottom>=C.bottom)&&(J.bottom<=C.top)));var M=(((C.top>=J.bottom)&&(C.top<=J.top))||((J.top>C.bottom)&&(J.top<C.top)));var K=(((C.left>=J.left)&&(C.left<=J.right))||((J.left>=C.left)&&(J.left<=C.right)));var A=(((C.right>=J.left)&&(C.right<=J.right))||((J.right>=C.left)&&(J.right<=C.right)));D=((B||M)&&(K||A))}if(H.worldBounds&&!D){var L=H.worldBounds;var I=L.getWidth();var F=!L.containsBounds(J);var G=!L.containsBounds(C);if(F&&!G){C=C.add(-I,0);D=J.intersectsBounds(C,{inclusive:H.inclusive})}else{if(G&&!F){J=J.add(-I,0);D=C.intersectsBounds(J,{inclusive:H.inclusive})}}}return D},containsBounds:function(C,F,A){if(F==null){F=false}if(A==null){A=true}var E=this.contains(C.left,C.bottom,A);var D=this.contains(C.right,C.bottom,A);var G=this.contains(C.left,C.top,A);var B=this.contains(C.right,C.top,A);return(F)?(E||D||G||B):(E&&D&&G&&B)},determineQuadrant:function(A){var C="";var B=this.getCenterLonLat();C+=(A.lat<B.lat)?"b":"t";C+=(A.lon<B.lon)?"l":"r";return C},transform:function(C,B){this.centerLonLat=null;var D=HGIS.Projection.transform({"x":this.left,"y":this.bottom},C,B);var A=HGIS.Projection.transform({"x":this.right,"y":this.bottom},C,B);var E=HGIS.Projection.transform({"x":this.left,"y":this.top},C,B);var F=HGIS.Projection.transform({"x":this.right,"y":this.top},C,B);this.left=Math.min(D.x,E.x);this.bottom=Math.min(D.y,A.y);this.right=Math.max(A.x,F.x);this.top=Math.max(E.y,F.y);return this},wrapDateLine:function(D,E){E=E||{};var C=E.leftTolerance||0;var B=E.rightTolerance||0;var A=this.clone();if(D){var F=D.getWidth();while(A.left<D.left&&A.right-B<=D.left){A=A.add(F,0)}while(A.left+C>=D.right&&A.right>D.right){A=A.add(-F,0)}var G=A.left+C;if(G<D.right&&G>D.left&&A.right-B>D.right){A=A.add(-F,0)}}return A},CLASS_NAME:"HGIS.Bounds"});HGIS.Bounds.fromString=function(C,B){var A=C.split(",");return HGIS.Bounds.fromArray(A,B)};HGIS.Bounds.fromArray=function(B,A){return A===true?new HGIS.Bounds(B[1],B[0],B[3],B[2]):new HGIS.Bounds(B[0],B[1],B[2],B[3])};HGIS.Bounds.fromSize=function(A){return new HGIS.Bounds(0,A.h,A.w,0)};HGIS.Bounds.oppositeQuadrant=function(B){var A="";A+=(B.charAt(0)=="t")?"b":"t";A+=(B.charAt(1)=="l")?"r":"l";return A};HGIS.Element={visible:function(A){return HGIS.Util.getElement(A).style.display!="none"},toggle:function(){for(var A=0,C=arguments.length;A<C;A++){var D=HGIS.Util.getElement(arguments[A]);var B=HGIS.Element.visible(D)?"none":"";D.style.display=B}},remove:function(A){A=HGIS.Util.getElement(A);A.parentNode.removeChild(A)},getHeight:function(A){A=HGIS.Util.getElement(A);return A.offsetHeight},hasClass:function(B,A){var C=B.className;return(!!C&&new RegExp("(^|\\s)"+A+"(\\s|$)").test(C))},addClass:function(B,A){if(!HGIS.Element.hasClass(B,A)){B.className+=(B.className?" ":"")+A}return B},removeClass:function(B,A){var C=B.className;if(C){B.className=HGIS.String.trim(C.replace(new RegExp("(^|\\s+)"+A+"(\\s+|$)")," "))}return B},toggleClass:function(B,A){if(HGIS.Element.hasClass(B,A)){HGIS.Element.removeClass(B,A)}else{HGIS.Element.addClass(B,A)}return B},getStyle:function(D,B){D=HGIS.Util.getElement(D);var C=null;if(D&&D.style){C=D.style[HGIS.String.camelize(B)];if(!C){if(document.defaultView&&document.defaultView.getComputedStyle){var E=document.defaultView.getComputedStyle(D,null);C=E?E.getPropertyValue(B):null}else{if(D.currentStyle){C=D.currentStyle[HGIS.String.camelize(B)]}}}var A=["left","top","right","bottom"];if(window.opera&&(HGIS.Util.indexOf(A,B)!=-1)&&(HGIS.Element.getStyle(D,"position")=="static")){C="auto"}}return C=="auto"?null:C}};HGIS.LonLat=HGIS.Class({lon:0,lat:0,initialize:function(A,B){if(HGIS.Util.isArray(A)){B=A[1];A=A[0]}this.lon=HGIS.Util.toFloat(A);this.lat=HGIS.Util.toFloat(B)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new HGIS.LonLat(this.lon,this.lat)},add:function(A,B){if((A==null)||(B==null)){throw new TypeError("LonLat.add cannot receive null values")}return new HGIS.LonLat(this.lon+HGIS.Util.toFloat(A),this.lat+HGIS.Util.toFloat(B))},equals:function(A){var B=false;if(A!=null){B=((this.lon==A.lon&&this.lat==A.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(A.lon)&&isNaN(A.lat)))}return B},transform:function(C,B){var A=HGIS.Projection.transform({"x":this.lon,"y":this.lat},C,B);this.lon=A.x;this.lat=A.y;return this},wrapDateLine:function(A){var B=this.clone();if(A){while(B.lon<A.left){B.lon+=A.getWidth()}while(B.lon>A.right){B.lon-=A.getWidth()}}return B},CLASS_NAME:"HGIS.LonLat"});HGIS.LonLat.fromString=function(B){var A=B.split(",");return new HGIS.LonLat(A[0],A[1])};HGIS.LonLat.fromArray=function(D){var B=HGIS.Util.isArray(D),A=B&&D[0],C=B&&D[1];return new HGIS.LonLat(A,C)};HGIS.Pixel=HGIS.Class({x:0,y:0,initialize:function(A,B){this.x=parseFloat(A);this.y=parseFloat(B)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new HGIS.Pixel(this.x,this.y)},equals:function(B){var A=false;if(B!=null){A=((this.x==B.x&&this.y==B.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(B.x)&&isNaN(B.y)))}return A},distanceTo:function(A){return Math.sqrt(Math.pow(this.x-A.x,2)+Math.pow(this.y-A.y,2))},add:function(A,B){if((A==null)||(B==null)){throw new TypeError("Pixel.add cannot receive null values")}return new HGIS.Pixel(this.x+A,this.y+B)},offset:function(B){var A=this.clone();if(B){A=this.add(B.x,B.y)}return A},CLASS_NAME:"HGIS.Pixel"});HGIS.Size=HGIS.Class({w:0,h:0,initialize:function(B,A){this.w=parseFloat(B);this.h=parseFloat(A)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new HGIS.Size(this.w,this.h)},equals:function(A){var B=false;if(A!=null){B=((this.w==A.w&&this.h==A.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(A.w)&&isNaN(A.h)))}return B},CLASS_NAME:"HGIS.Size"});HGIS.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(A){alert(A)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"HGIS.Console"};(function(){var B=document.getElementsByTagName("script");for(var A=0,C=B.length;A<C;++A){if(B[A].src.indexOf("firebug.js")!=-1){if(console){HGIS.Util.extend(HGIS.Console,console);break}}}})();HGIS.Lang={code:null,defaultCode:"en",getCode:function(){if(!HGIS.Lang.code){HGIS.Lang.setCode()}return HGIS.Lang.code},setCode:function(B){var D;if(!B){B=(HGIS.BROWSER_NAME=="msie")?navigator.userLanguage:navigator.language}var A=B.split("-");A[0]=A[0].toLowerCase();if(typeof HGIS.Lang[A[0]]=="object"){D=A[0]}if(A[1]){var C=A[0]+"-"+A[1].toUpperCase();if(typeof HGIS.Lang[C]=="object"){D=C}}if(!D){HGIS.Console.warn("Failed to find HGIS.Lang."+A.join("-")+" dictionary, falling back to default language");D=HGIS.Lang.defaultCode}HGIS.Lang.code=D},translate:function(B,A){var D=HGIS.Lang[HGIS.Lang.getCode()];var C=D&&D[B];if(!C){C=B}if(A){C=HGIS.String.format(C,A)}return C}};HGIS.i18n=HGIS.Lang.translate;HGIS.Util=HGIS.Util||{};HGIS.Util.getElement=function(){var B=[];for(var A=0,C=arguments.length;A<C;A++){var D=arguments[A];if(typeof D=="string"){D=document.getElementById(D)}if(arguments.length==1){return D}B.push(D)}return B};HGIS.Util.isElement=function(A){return !!(A&&A.nodeType===1)};HGIS.Util.isArray=function(A){return(Object.prototype.toString.call(A)==="[object Array]")};HGIS.Util.removeItem=function(A,C){for(var B=A.length-1;B>=0;B--){if(A[B]==C){A.splice(B,1)}}return A};HGIS.Util.indexOf=function(A,B){if(typeof A.indexOf=="function"){return A.indexOf(B)}else{for(var C=0,D=A.length;C<D;C++){if(A[C]==B){return C}}return -1}};HGIS.Util.dotless=/\./g;HGIS.Util.modifyDOMElement=function(B,F,G,A,E,H,C,D){if(F){B.id=F.replace(HGIS.Util.dotless,"_")}if(G){B.style.left=G.x+"px";B.style.top=G.y+"px"}if(A){B.style.width=A.w+"px";B.style.height=A.h+"px"}if(E){B.style.position=E}if(H){B.style.border=H}if(C){B.style.overflow=C}if(parseFloat(D)>=0&&parseFloat(D)<1){B.style.filter="alpha(opacity="+(D*100)+")";B.style.opacity=D}else{if(parseFloat(D)==1){B.style.filter="";B.style.opacity=""}}};HGIS.Util.createDiv=function(G,H,A,D,F,I,C,E){var B=document.createElement("div");if(D){B.style.backgroundImage="url("+D+")"}if(!G){G=HGIS.Util.createUniqueID("HGISDiv")}if(!F){F="absolute"}HGIS.Util.modifyDOMElement(B,G,H,A,F,I,C,E);return B};HGIS.Util.createImage=function(H,I,A,E,G,J,F,C){var B=document.createElement("img");if(!H){H=HGIS.Util.createUniqueID("HGISDiv")}if(!G){G="relative"}HGIS.Util.modifyDOMElement(B,H,I,A,G,J,null,F);if(C){B.style.display="none";function D(){B.style.display="";HGIS.Event.stopObservingElement(B)}HGIS.Event.observe(B,"load",D);HGIS.Event.observe(B,"error",D)}B.style.alt=H;B.galleryImg="no";if(E){B.src=E}return B};HGIS.IMAGE_RELOAD_ATTEMPTS=0;HGIS.Util.alphaHackNeeded=null;HGIS.Util.alphaHack=function(){if(HGIS.Util.alphaHackNeeded==null){var A=navigator.appVersion.split("MSIE");var D=parseFloat(A[1]);var C=false;try{C=!!(document.body.filters)}catch(B){}HGIS.Util.alphaHackNeeded=(C&&(D>=5.5)&&(D<7))}return HGIS.Util.alphaHackNeeded};HGIS.Util.modifyAlphaImageDiv=function(J,G,H,A,C,F,I,E,D){HGIS.Util.modifyDOMElement(J,G,H,A,F,null,null,D);var B=J.childNodes[0];if(C){B.src=C}HGIS.Util.modifyDOMElement(B,J.id+"_innerImage",null,A,"relative",I);if(HGIS.Util.alphaHack()){if(J.style.display!="none"){J.style.display="inline-block"}if(E==null){E="scale"}J.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+B.src+"', sizingMethod='"+E+"')";if(parseFloat(J.style.opacity)>=0&&parseFloat(J.style.opacity)<1){J.style.filter+=" alpha(opacity="+J.style.opacity*100+")"}B.style.filter="alpha(opacity=0)"}};HGIS.Util.createAlphaImageDiv=function(H,I,A,D,G,J,F,E,C){var K=HGIS.Util.createDiv();var B=HGIS.Util.createImage(null,null,null,null,null,null,null,C);B.className="olAlphaImg";K.appendChild(B);HGIS.Util.modifyAlphaImageDiv(K,H,I,A,D,G,J,F,E);return K};HGIS.Util.upperCaseObject=function(B){var C={};for(var A in B){C[A.toUpperCase()]=B[A]}return C};HGIS.Util.applyDefaults=function(C,B){C=C||{};var D=typeof window.Event=="function"&&B instanceof window.Event;for(var A in B){if(C[A]===undefined||(!D&&B.hasOwnProperty&&B.hasOwnProperty(A)&&!C.hasOwnProperty(A))){C[A]=B[A]}}if(!D&&B&&B.hasOwnProperty&&B.hasOwnProperty("toString")&&!C.hasOwnProperty("toString")){C.toString=B.toString}return C};HGIS.Util.getParameterString=function(D){var A=[];for(var F in D){var C=D[F];if((C!=null)&&(typeof C!="function")){var E;if(typeof C=="object"&&C.constructor==Array){var H=[];var I;for(var G=0,B=C.length;G<B;G++){I=C[G];H.push(encodeURIComponent((I===null||I===undefined)?"":I))}E=H.join(",")}else{E=encodeURIComponent(C)}A.push(encodeURIComponent(F)+"="+E)}}return A.join("&")};HGIS.Util.urlAppend=function(C,A){var D=C;if(A){var B=(C+" ").split(/[?&]/);D+=(B.pop()===" "?A:B.length?"&"+A:"?"+A)}return D};HGIS.Util.getImagesLocation=function(){return HGIS.ImgPath||(HGIS._getScriptLocation()+"gisapi/theme/img/")};HGIS.Util.getImageLocation=function(A){return HGIS.Util.getImagesLocation()+A};HGIS.Util.Try=function(){var A=null;for(var B=0,D=arguments.length;B<D;B++){var E=arguments[B];try{A=E();break}catch(C){}}return A};HGIS.Util.getXmlNodeValue=function(A){var B=null;HGIS.Util.Try(function(){B=A.text;if(!B){B=A.textContent}if(!B){B=A.firstChild.nodeValue}},function(){B=A.textContent});return B};HGIS.Util.mouseLeft=function(A,B){var C=(A.relatedTarget)?A.relatedTarget:A.toElement;while(C!=B&&C!=null){C=C.parentNode}return(C!=B)};HGIS.Util.DEFAULT_PRECISION=14;HGIS.Util.toFloat=function(B,A){if(A==null){A=HGIS.Util.DEFAULT_PRECISION}if(typeof B!=="number"){B=parseFloat(B)}return A===0?B:parseFloat(B.toPrecision(A))};HGIS.Util.rad=function(A){return A*Math.PI/180};HGIS.Util.deg=function(A){return A*180/Math.PI};HGIS.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};HGIS.Util.distVincenty=function(q,F){var G=HGIS.Util.VincentyConstants;var P=G.a,N=G.b,Q=G.f;var W=HGIS.Util.rad(F.lon-q.lon);var O=Math.atan((1-Q)*Math.tan(HGIS.Util.rad(q.lat)));var S=Math.atan((1-Q)*Math.tan(HGIS.Util.rad(F.lat)));var e=Math.sin(O),g=Math.cos(O);var Z=Math.sin(S),Y=Math.cos(S);var h=W,T=2*Math.PI;var J=20;while(Math.abs(h-T)>1e-12&&--J>0){var n=Math.sin(h),l=Math.cos(h);var K=Math.sqrt((Y*n)*(Y*n)+(g*Z-e*Y*l)*(g*Z-e*Y*l));if(K==0){return 0}var I=e*Z+g*Y*l;var H=Math.atan2(K,I);var V=Math.asin(g*Y*n/K);var M=Math.cos(V)*Math.cos(V);var o=I-2*e*Z/M;var p=Q/16*M*(4+Q*(4-3*M));T=h;h=W+(1-p)*Q*Math.sin(V)*(H+p*K*(o+p*I*(-1+2*o*o)))}if(J==0){return NaN}var E=M*(P*P-N*N)/(N*N);var U=1+E/16384*(4096+E*(-768+E*(320-175*E)));var X=E/1024*(256+E*(-128+E*(74-47*E)));var i=X*K*(o+X/4*(I*(-1+2*o*o)-X/6*o*(-3+4*K*K)*(-3+4*o*o)));var D=N*U*(H-i);var R=D.toFixed(3)/1000;return R};HGIS.Util.destinationVincenty=function(M,Q,Z){var o=HGIS.Util;var H=o.VincentyConstants;var v=H.a,t=H.b,w=H.f;var F=M.lon;var G=M.lat;var K=Z;var W=o.rad(Q);var q=Math.sin(W);var i=Math.cos(W);var N=(1-w)*Math.tan(o.rad(G));var V=1/Math.sqrt((1+N*N)),p=N*V;var U=Math.atan2(N,i);var I=V*q;var S=1-I*I;var n=S*(v*v-t*t)/(t*t);var d=1+n/16384*(4096+n*(-768+n*(320-175*n)));var Y=n/1024*(256+n*(-128+n*(74-47*n)));var g=K/(t*d),T=2*Math.PI;while(Math.abs(g-T)>1e-12){var h=Math.cos(2*U+g);var E=Math.sin(g);var R=Math.cos(g);var O=Y*E*(h+Y/4*(R*(-1+2*h*h)-Y/6*h*(-3+4*E*E)*(-3+4*h*h)));T=g;g=K/(t*d)+O}var l=p*E-V*R*i;var J=Math.atan2(p*R+V*E*i,(1-w)*Math.sqrt(I*I+l*l));var D=Math.atan2(E*q,V*R-p*E*i);var e=w/16*S*(4+w*(4-3*S));var X=D-(1-e)*w*I*(g+e*E*(h+e*R*(-1+2*h*h)));var P=Math.atan2(I,-l);return new HGIS.LonLat(F+o.deg(X),o.deg(J))};HGIS.Util.getParameters=function(A,K){K=K||{};A=(A===null||A===undefined)?window.location.href:A;var M="";if(HGIS.String.contains(A,"?")){var C=A.indexOf("?")+1;var E=HGIS.String.contains(A,"#")?A.indexOf("#"):A.length;M=A.substring(C,E)}var L={};var J=M.split(/[&;]/);for(var I=0,B=J.length;I<B;++I){var G=J[I].split("=");if(G[0]){var F=G[0];try{F=decodeURIComponent(F)}catch(H){F=unescape(F)}var D=(G[1]||"").replace(/\+/g," ");try{D=decodeURIComponent(D)}catch(H){D=unescape(D)}if(K.splitArgs!==false){D=D.split(",")}if(D.length==1){D=D[0]}L[F]=D}}return L};HGIS.Util.lastSeqID=0;HGIS.Util.createUniqueID=function(A){if(A==null){A="id_"}else{A=A.replace(HGIS.Util.dotless,"_")}HGIS.Util.lastSeqID+=1;return A+HGIS.Util.lastSeqID};HGIS.INCHES_PER_UNIT={"inches":1,"ft":12,"mi":63360,"m":39.37,"km":39370,"dd":4374754,"yd":36};HGIS.INCHES_PER_UNIT["in"]=HGIS.INCHES_PER_UNIT.inches;HGIS.INCHES_PER_UNIT["degrees"]=HGIS.INCHES_PER_UNIT.dd;HGIS.INCHES_PER_UNIT["nmi"]=1852*HGIS.INCHES_PER_UNIT.m;HGIS.METERS_PER_INCH=0.0254000508001016;HGIS.Util.extend(HGIS.INCHES_PER_UNIT,{"Inch":HGIS.INCHES_PER_UNIT.inches,"Meter":1/HGIS.METERS_PER_INCH,"Foot":0.304800609601219/HGIS.METERS_PER_INCH,"IFoot":0.3048/HGIS.METERS_PER_INCH,"ClarkeFoot":0.3047972651151/HGIS.METERS_PER_INCH,"SearsFoot":0.304799471538676/HGIS.METERS_PER_INCH,"GoldCoastFoot":0.304799710181509/HGIS.METERS_PER_INCH,"IInch":0.0254/HGIS.METERS_PER_INCH,"MicroInch":2.54e-05/HGIS.METERS_PER_INCH,"Mil":2.54e-08/HGIS.METERS_PER_INCH,"Centimeter":0.01/HGIS.METERS_PER_INCH,"Kilometer":1000/HGIS.METERS_PER_INCH,"Yard":0.914401828803658/HGIS.METERS_PER_INCH,"SearsYard":0.914398414616029/HGIS.METERS_PER_INCH,"IndianYard":0.914398530744441/HGIS.METERS_PER_INCH,"IndianYd37":0.91439523/HGIS.METERS_PER_INCH,"IndianYd62":0.9143988/HGIS.METERS_PER_INCH,"IndianYd75":0.9143985/HGIS.METERS_PER_INCH,"IndianFoot":0.30479951/HGIS.METERS_PER_INCH,"IndianFt37":0.30479841/HGIS.METERS_PER_INCH,"IndianFt62":0.3047996/HGIS.METERS_PER_INCH,"IndianFt75":0.3047995/HGIS.METERS_PER_INCH,"Mile":1609.34721869444/HGIS.METERS_PER_INCH,"IYard":0.9144/HGIS.METERS_PER_INCH,"IMile":1609.344/HGIS.METERS_PER_INCH,"NautM":1852/HGIS.METERS_PER_INCH,"Lat-66":110943.316488933/HGIS.METERS_PER_INCH,"Lat-83":110946.257368722/HGIS.METERS_PER_INCH,"Decimeter":0.1/HGIS.METERS_PER_INCH,"Millimeter":0.001/HGIS.METERS_PER_INCH,"Dekameter":10/HGIS.METERS_PER_INCH,"Decameter":10/HGIS.METERS_PER_INCH,"Hectometer":100/HGIS.METERS_PER_INCH,"GermanMeter":1.0000135965/HGIS.METERS_PER_INCH,"CaGrid":0.999738/HGIS.METERS_PER_INCH,"ClarkeChain":20.1166194976/HGIS.METERS_PER_INCH,"GunterChain":20.1168402336805/HGIS.METERS_PER_INCH,"BenoitChain":20.1167824943759/HGIS.METERS_PER_INCH,"SearsChain":20.11676512155/HGIS.METERS_PER_INCH,"ClarkeLink":0.201166194976/HGIS.METERS_PER_INCH,"GunterLink":0.201168402336805/HGIS.METERS_PER_INCH,"BenoitLink":0.201167824943759/HGIS.METERS_PER_INCH,"SearsLink":0.2011676512155/HGIS.METERS_PER_INCH,"Rod":5.02921005842012/HGIS.METERS_PER_INCH,"IntnlChain":20.1168/HGIS.METERS_PER_INCH,"IntnlLink":0.201168/HGIS.METERS_PER_INCH,"Perch":5.02921005842012/HGIS.METERS_PER_INCH,"Pole":5.02921005842012/HGIS.METERS_PER_INCH,"Furlong":201.168402336805/HGIS.METERS_PER_INCH,"Rood":3.778266898/HGIS.METERS_PER_INCH,"CapeFoot":0.3047972615/HGIS.METERS_PER_INCH,"Brealey":375/HGIS.METERS_PER_INCH,"ModAmFt":0.304812252984506/HGIS.METERS_PER_INCH,"Fathom":1.8288/HGIS.METERS_PER_INCH,"NautM-UK":1853.184/HGIS.METERS_PER_INCH,"50kilometers":50000/HGIS.METERS_PER_INCH,"150kilometers":150000/HGIS.METERS_PER_INCH});HGIS.Util.extend(HGIS.INCHES_PER_UNIT,{"mm":HGIS.INCHES_PER_UNIT["Meter"]/1000,"cm":HGIS.INCHES_PER_UNIT["Meter"]/100,"dm":HGIS.INCHES_PER_UNIT["Meter"]*100,"km":HGIS.INCHES_PER_UNIT["Meter"]*1000,"kmi":HGIS.INCHES_PER_UNIT["nmi"],"fath":HGIS.INCHES_PER_UNIT["Fathom"],"ch":HGIS.INCHES_PER_UNIT["IntnlChain"],"link":HGIS.INCHES_PER_UNIT["IntnlLink"],"us-in":HGIS.INCHES_PER_UNIT["inches"],"us-ft":HGIS.INCHES_PER_UNIT["Foot"],"us-yd":HGIS.INCHES_PER_UNIT["Yard"],"us-ch":HGIS.INCHES_PER_UNIT["GunterChain"],"us-mi":HGIS.INCHES_PER_UNIT["Mile"],"ind-yd":HGIS.INCHES_PER_UNIT["IndianYd37"],"ind-ft":HGIS.INCHES_PER_UNIT["IndianFt37"],"ind-ch":20.11669506/HGIS.METERS_PER_INCH});HGIS.DOTS_PER_INCH=72;HGIS.Util.normalizeScale=function(B){var A=(B>1)?(1/B):B;return A};HGIS.Util.getResolutionFromScale=function(D,B){var C;if(D){if(B==null){B="degrees"}var A=HGIS.Util.normalizeScale(D);C=1/(A*HGIS.INCHES_PER_UNIT[B]*HGIS.DOTS_PER_INCH)}return C};HGIS.Util.getScaleFromResolution=function(B,C){if(C==null){C="degrees"}var A=B*HGIS.INCHES_PER_UNIT[C]*HGIS.DOTS_PER_INCH;return A};HGIS.Util.pagePosition=function(A){var H=[0,0];var G=HGIS.Util.getViewportElement();if(!A||A==window||A==G){return H}var I=HGIS.IS_GECKO&&document.getBoxObjectFor&&HGIS.Element.getStyle(A,"position")=="absolute"&&(A.style.top==""||A.style.left=="");var J=null;var E;if(A.getBoundingClientRect){E=A.getBoundingClientRect();var C=window.pageYOffset||G.scrollTop;var F=window.pageXOffset||G.scrollLeft;H[0]=E.left+F;H[1]=E.top+C}else{if(document.getBoxObjectFor&&!I){E=document.getBoxObjectFor(A);var B=document.getBoxObjectFor(G);H[0]=E.screenX-B.screenX;H[1]=E.screenY-B.screenY}else{H[0]=A.offsetLeft;H[1]=A.offsetTop;J=A.offsetParent;if(J!=A){while(J){H[0]+=J.offsetLeft;H[1]+=J.offsetTop;J=J.offsetParent}}var D=HGIS.BROWSER_NAME;if(D=="opera"||(D=="safari"&&HGIS.Element.getStyle(A,"position")=="absolute")){H[1]-=document.body.offsetTop}J=A.offsetParent;while(J&&J!=document.body){H[0]-=J.scrollLeft;if(D!="opera"||J.tagName!="TR"){H[1]-=J.scrollTop}J=J.offsetParent}}}return H};HGIS.Util.getViewportElement=function(){var A=HGIS.Util.getViewportElement.prototype.viewportElement;if(A==undefined){A=(HGIS.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat")?document.body:document.documentElement;HGIS.Util.getViewportElement.prototype.viewportElement=A}return A};HGIS.Util.isEquivalentUrl=function(B,C,E){E=E||{};HGIS.Util.applyDefaults(E,{ignoreCase:true,ignorePort80:true,ignoreHash:true,splitArgs:false});var A=HGIS.Util.createUrlObject(B,E);var D=HGIS.Util.createUrlObject(C,E);for(var F in A){if(F!=="args"){if(A[F]!=D[F]){return false}}}for(var F in A.args){if(A.args[F]!=D.args[F]){return false}delete D.args[F]}for(var F in D.args){return false}return true};HGIS.Util.createUrlObject=function(I,G){G=G||{};if(!(/^\w+:\/\//).test(I)){var C=window.location;var F=C.port?":"+C.port:"";var A=C.protocol+"//"+C.host.split(":").shift()+F;if(I.indexOf("/")===0){I=A+I}else{var H=C.pathname.split("/");H.pop();I=A+H.join("/")+"/"+I}}if(G.ignoreCase){I=I.toLowerCase()}var J=document.createElement("a");J.href=I;var E={};E.host=J.host.split(":").shift();E.protocol=J.protocol;if(G.ignorePort80){E.port=(J.port=="80"||J.port=="0")?"":J.port}else{E.port=(J.port==""||J.port=="0")?"80":J.port}E.hash=(G.ignoreHash||J.hash==="#")?"":J.hash;var B=J.search;if(!B){var D=I.indexOf("?");B=(D!=-1)?I.substr(D):""}E.args=HGIS.Util.getParameters(B,{splitArgs:G.splitArgs});E.pathname=(J.pathname.charAt(0)=="/")?J.pathname:"/"+J.pathname;return E};HGIS.Util.removeTail=function(A){var C=null;var D=A.indexOf("?");var B=A.indexOf("#");if(D==-1){C=(B!=-1)?A.substr(0,B):A}else{C=(B!=-1)?A.substr(0,Math.min(D,B)):A.substr(0,D)}return C};HGIS.IS_GECKO=(function(){var A=navigator.userAgent.toLowerCase();return A.indexOf("webkit")==-1&&A.indexOf("gecko")!=-1})();HGIS.CANVAS_SUPPORTED=(function(){var A=document.createElement("canvas");return !!(A.getContext&&A.getContext("2d"))})();HGIS.BROWSER_NAME=(function(){var A="";var B=navigator.userAgent.toLowerCase();if(B.indexOf("opera")!=-1){A="opera"}else{if(B.indexOf("msie")!=-1){A="msie"}else{if(B.indexOf("safari")!=-1){A="safari"}else{if(B.indexOf("mozilla")!=-1){if(B.indexOf("firefox")!=-1){A="firefox"}else{A="mozilla"}}}}}return A})();HGIS.Util.getBrowserName=function(){return HGIS.BROWSER_NAME};HGIS.Util.getRenderedDimensions=function(F,B,G){var C,E;var I=document.createElement("div");I.style.visibility="hidden";var L=(G&&G.containerElement)?G.containerElement:document.body;var A=false;var D=null;var M=L;while(M&&M.tagName.toLowerCase()!="body"){var J=HGIS.Element.getStyle(M,"position");if(J=="absolute"){A=true;break}else{if(J&&J!="static"){break}}M=M.parentNode}if(A&&(L.clientHeight===0||L.clientWidth===0)){D=document.createElement("div");D.style.visibility="hidden";D.style.position="absolute";D.style.overflow="visible";D.style.width=document.body.clientWidth+"px";D.style.height=document.body.clientHeight+"px";D.appendChild(I)}I.style.position="absolute";if(B){if(B.w){C=B.w;I.style.width=C+"px"}else{if(B.h){E=B.h;I.style.height=E+"px"}}}if(G&&G.displayClass){I.className=G.displayClass}var N=document.createElement("div");N.innerHTML=F;N.style.overflow="visible";if(N.childNodes){for(var H=0,K=N.childNodes.length;H<K;H++){if(!N.childNodes[H].style){continue}N.childNodes[H].style.overflow="visible"}}I.appendChild(N);if(D){L.appendChild(D)}else{L.appendChild(I)}if(!C){C=parseInt(N.scrollWidth);I.style.width=C+"px"}if(!E){E=parseInt(N.scrollHeight)}I.removeChild(N);if(D){D.removeChild(I);L.removeChild(D)}else{L.removeChild(I)}return new HGIS.Size(C,E)};HGIS.Util.getScrollbarWidth=function(){var C=HGIS.Util._scrollbarWidth;if(C==null){var B=null;var E=null;var A=0;var D=0;B=document.createElement("div");B.style.position="absolute";B.style.top="-1000px";B.style.left="-1000px";B.style.width="100px";B.style.height="50px";B.style.overflow="hidden";E=document.createElement("div");E.style.width="100%";E.style.height="200px";B.appendChild(E);document.body.appendChild(B);A=E.offsetWidth;B.style.overflow="scroll";D=E.offsetWidth;document.body.removeChild(document.body.lastChild);HGIS.Util._scrollbarWidth=(A-D);C=HGIS.Util._scrollbarWidth}return C};HGIS.Util.getFormattedLonLat=function(E,B,I){if(!I){I="dms"}E=(E+540)%360-180;var C=Math.abs(E);var G=Math.floor(C);var H=(C-G)/(1/60);var A=H;H=Math.floor(H);var F=(A-H)/(1/60);F=Math.round(F*10);F/=10;if(F>=60){F-=60;H+=1;if(H>=60){H-=60;G+=1}}if(G<10){G="0"+G}var D=G+"\u00B0";if(I.indexOf("dm")>=0){if(H<10){H="0"+H}D+=H+"'";if(I.indexOf("dms")>=0){if(F<10){F="0"+F}D+=F+'"'}}if(B=="lon"){D+=E<0?HGIS.i18n("W"):HGIS.i18n("E")}else{D+=E<0?HGIS.i18n("S"):HGIS.i18n("N")}return D};HGIS.Format=HGIS.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(A){HGIS.Util.extend(this,A);this.options=A},destroy:function(){},read:function(A){throw new Error("Read not implemented.")},write:function(A){throw new Error("Write not implemented.")},CLASS_NAME:"HGIS.Format"});HGIS.Format.CSWGetRecords=function(B){B=HGIS.Util.applyDefaults(B,HGIS.Format.CSWGetRecords.DEFAULTS);var A=HGIS.Format.CSWGetRecords["v"+B.version.replace(/\./g,"_")];if(!A){throw"Unsupported CSWGetRecords version: "+B.version}return new A(B)};HGIS.Format.CSWGetRecords.DEFAULTS={"version":"2.0.2"};HGIS.Control=HGIS.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(A){this.displayClass=this.CLASS_NAME.replace("HGIS.","ol").replace(/\./g,"");HGIS.Util.extend(this,A);this.events=new HGIS.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var A in this.handlers){if(this.handlers.hasOwnProperty(A)&&typeof this.handlers[A].destroy=="function"){this.handlers[A].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(A){this.map=A;if(this.handler){this.handler.setMap(A)}},draw:function(A){if(this.div==null){this.div=HGIS.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=HGIS.Function.False}if(this.title!=""){this.div.title=this.title}}if(A!=null){this.position=A.clone()}this.moveTo(this.position);return this.div},moveTo:function(A){if((A!=null)&&(this.div!=null)){this.div.style.left=A.x+"px";this.div.style.top=A.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){HGIS.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){HGIS.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"HGIS.Control"});HGIS.Control.TYPE_BUTTON=1;HGIS.Control.TYPE_TOGGLE=2;HGIS.Control.TYPE_TOOL=3;HGIS.Event={observers:false,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(A){return A.target||A.srcElement},isSingleTouch:function(A){return A.touches&&A.touches.length==1},isMultiTouch:function(A){return A.touches&&A.touches.length>1},isLeftClick:function(A){return(((A.which)&&(A.which==1))||((A.button)&&(A.button==1)))},isRightClick:function(A){return(((A.which)&&(A.which==3))||((A.button)&&(A.button==2)))},stop:function(B,A){if(!A){HGIS.Event.preventDefault(B)}if(B.stopPropagation){B.stopPropagation()}else{B.cancelBubble=true}},preventDefault:function(A){if(A.preventDefault){A.preventDefault()}else{A.returnValue=false}},findElement:function(B,A){var C=HGIS.Event.element(B);while(C.parentNode&&(!C.tagName||(C.tagName.toUpperCase()!=A.toUpperCase()))){C=C.parentNode}return C},observe:function(B,C,G,E){var F=HGIS.Util.getElement(B);E=E||false;if(C=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||F.attachEvent)){C="keydown"}if(!this.observers){this.observers={}}if(!F._eventCacheID){var D="eventCacheID_";if(F.id){D=F.id+"_"+D}F._eventCacheID=HGIS.Util.createUniqueID(D)}var A=F._eventCacheID;if(!this.observers[A]){this.observers[A]=[]}this.observers[A].push({"element":F,"name":C,"observer":G,"useCapture":E});if(F.addEventListener){F.addEventListener(C,G,E)}else{if(F.attachEvent){F.attachEvent("on"+C,G)}}},stopObservingElement:function(B){var C=HGIS.Util.getElement(B);var A=C._eventCacheID;this._removeElementObservers(HGIS.Event.observers[A])},_removeElementObservers:function(C){if(C){for(var A=C.length-1;A>=0;A--){var B=C[A];HGIS.Event.stopObserving.apply(this,[B.element,B.name,B.observer,B.useCapture])}}},stopObserving:function(C,B,G,I){I=I||false;var A=HGIS.Util.getElement(C);var F=A._eventCacheID;if(B=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||A.detachEvent){B="keydown"}}var J=false;var D=HGIS.Event.observers[F];if(D){var E=0;while(!J&&E<D.length){var H=D[E];if((H.name==B)&&(H.observer==G)&&(H.useCapture==I)){D.splice(E,1);if(D.length==0){delete HGIS.Event.observers[F]}J=true;break}E++}}if(J){if(A.removeEventListener){A.removeEventListener(B,G,I)}else{if(A&&A.detachEvent){A.detachEvent("on"+B,G)}}}return J},unloadCache:function(){if(HGIS.Event&&HGIS.Event.observers){for(var A in HGIS.Event.observers){var B=HGIS.Event.observers[A];HGIS.Event._removeElementObservers.apply(this,[B])}HGIS.Event.observers=false}},CLASS_NAME:"HGIS.Event"};HGIS.Event.observe(window,"unload",HGIS.Event.unloadCache,false);HGIS.Events=HGIS.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:false,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(A,C,E,D,B){HGIS.Util.extend(this,B);this.object=A;this.fallThrough=D;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];if(C!=null){this.attachToElement(C)}},destroy:function(){for(var A in this.extensions){if(typeof this.extensions[A]!=="boolean"){this.extensions[A].destroy()}}this.extensions=null;if(this.element){HGIS.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){HGIS.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(A){},attachToElement:function(D){if(this.element){HGIS.Event.stopObservingElement(this.element)}else{this.eventHandler=HGIS.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=HGIS.Function.bind(this.clearMouseCache,this)}this.element=D;var E=!!window.navigator.msMaxTouchPoints;var A;for(var B=0,C=this.BROWSER_EVENTS.length;B<C;B++){A=this.BROWSER_EVENTS[B];HGIS.Event.observe(D,A,this.eventHandler);if(E&&A.indexOf("touch")===0){this.addMsTouchListener(D,A,this.eventHandler)}}HGIS.Event.observe(D,"dragstart",HGIS.Event.stop)},on:function(B){for(var A in B){if(A!="scope"&&B.hasOwnProperty(A)){this.register(A,B.scope,B[A])}}},register:function(A,B,C,E){if(A in HGIS.Events&&!this.extensions[A]){this.extensions[A]=new HGIS.Events[A](this)}if(C!=null){if(B==null){B=this.object}var F=this.listeners[A];if(!F){F=[];this.listeners[A]=F;this.extensionCount[A]=0}var D={obj:B,func:C};if(E){F.splice(this.extensionCount[A],0,D);if(typeof E==="object"&&E.extension){this.extensionCount[A]++}}else{F.push(D)}}},registerPriority:function(A,B,C){this.register(A,B,C,true)},un:function(B){for(var A in B){if(A!="scope"&&B.hasOwnProperty(A)){this.unregister(A,B.scope,B[A])}}},unregister:function(A,C,D){if(C==null){C=this.object}var F=this.listeners[A];if(F!=null){for(var B=0,E=F.length;B<E;B++){if(F[B].obj==C&&F[B].func==D){F.splice(B,1);break}}}},remove:function(A){if(this.listeners[A]!=null){this.listeners[A]=[]}},triggerEvent:function(A,C){var E=this.listeners[A];if(!E||E.length==0){return undefined}if(C==null){C={}}C.object=this.object;C.element=this.element;if(!C.type){C.type=A}E=E.slice();var G;for(var B=0,D=E.length;B<D;B++){var F=E[B];G=F.func.apply(F.obj,[C]);if((G!=undefined)&&(G==false)){break}}if(!this.fallThrough){HGIS.Event.stop(C,true)}return G},handleBrowserEvent:function(B){var C=B.type,F=this.listeners[C];if(!F||F.length==0){return}var E=B.touches;if(E&&E[0]){var G=0;var H=0;var D=E.length;var A;for(var I=0;I<D;++I){A=this.getTouchClientXY(E[I]);G+=A.clientX;H+=A.clientY}B.clientX=G/D;B.clientY=H/D}if(this.includeXY){B.xy=this.getMousePosition(B)}this.triggerEvent(C,B)},getTouchClientXY:function(C){var B=window.olMockWin||window,A=B.pageXOffset,F=B.pageYOffset,D=C.clientX,E=C.clientY;if(C.pageY===0&&Math.floor(E)>Math.floor(C.pageY)||C.pageX===0&&Math.floor(D)>Math.floor(C.pageX)){D=D-A;E=E-F}else{if(E<(C.pageY-F)||D<(C.pageX-A)){D=C.pageX-A;E=C.pageY-F}}C.olClientX=D;C.olClientY=E;return{clientX:D,clientY:E}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(B){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){HGIS.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){var A=HGIS.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||A.scrollLeft,window.pageYOffset||A.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=HGIS.Util.pagePosition(this.element)}return new HGIS.Pixel((B.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(B.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(E,A,D){var F=this.eventHandler;var C=this._msTouches;function B(G){D(HGIS.Util.applyDefaults({stopPropagation:function(){for(var H=C.length-1;H>=0;--H){C[H].stopPropagation()}},preventDefault:function(){for(var H=C.length-1;H>=0;--H){C[H].preventDefault()}},type:A},G))}switch(A){case"touchstart":return this.addMsTouchListenerStart(E,A,B);case"touchend":return this.addMsTouchListenerEnd(E,A,B);case"touchmove":return this.addMsTouchListenerMove(E,A,B);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(F,A,C){var B=this._msTouches;var D=function(H){var I=false;for(var G=0,J=B.length;G<J;++G){if(B[G].pointerId==H.pointerId){I=true;break}}if(!I){B.push(H)}H.touches=B.slice();C(H)};HGIS.Event.observe(F,"MSPointerDown",D);var E=function(H){for(var G=0,I=B.length;G<I;++G){if(B[G].pointerId==H.pointerId){B.splice(G,1);break}}};HGIS.Event.observe(F,"MSPointerUp",E)},addMsTouchListenerMove:function(E,A,C){var B=this._msTouches;var D=function(G){if(G.pointerType==G.MSPOINTER_TYPE_MOUSE&&G.buttons==0){return}if(B.length==1&&B[0].pageX==G.pageX&&B[0].pageY==G.pageY){return}for(var F=0,H=B.length;F<H;++F){if(B[F].pointerId==G.pointerId){B[F]=G;break}}G.touches=B.slice();C(G)};HGIS.Event.observe(E,"MSPointerMove",D)},addMsTouchListenerEnd:function(E,A,C){var B=this._msTouches;var D=function(G){for(var F=0,H=B.length;F<H;++F){if(B[F].pointerId==G.pointerId){B.splice(F,1);break}}G.touches=B.slice();C(G)};HGIS.Event.observe(E,"MSPointerUp",D)},CLASS_NAME:"HGIS.Events"});HGIS.Events.buttonclick=HGIS.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(B){this.target=B;for(var A=this.events.length-1;A>=0;--A){this.target.register(this.events[A],this,this.buttonClick,{extension:true})}},destroy:function(){for(var A=this.events.length-1;A>=0;--A){this.target.unregister(this.events[A],this,this.buttonClick)}delete this.target},getPressedButton:function(C){var B=3,A;do{if(HGIS.Element.hasClass(C,"olButton")){A=C;break}C=C.parentNode}while(--B>0&&C);return A},ignore:function(C){var A=3,B=false;do{if(C.nodeName.toLowerCase()==="a"){B=true;break}C=C.parentNode}while(--A>0&&C);return B},buttonClick:function(C){var H=true,A=HGIS.Event.element(C);if(A&&(HGIS.Event.isLeftClick(C)||!~C.type.indexOf("mouse"))){var D=this.getPressedButton(A);if(D){if(C.type==="keydown"){switch(C.keyCode){case HGIS.Event.KEY_RETURN:case HGIS.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:D});HGIS.Event.stop(C);H=false;break}}else{if(this.startEvt){if(this.completeRegEx.test(C.type)){var G=HGIS.Util.pagePosition(D);var F=HGIS.Util.getViewportElement();var B=window.pageYOffset||F.scrollTop;var E=window.pageXOffset||F.scrollLeft;G[0]=G[0]-E;G[1]=G[1]-B;this.target.triggerEvent("buttonclick",{buttonElement:D,buttonXY:{x:this.startEvt.clientX-G[0],y:this.startEvt.clientY-G[1]}})}if(this.cancelRegEx.test(C.type)){delete this.startEvt}HGIS.Event.stop(C);H=false}}if(this.startRegEx.test(C.type)){this.startEvt=C;HGIS.Event.stop(C);H=false}}else{H=!this.ignore(HGIS.Event.element(C));delete this.startEvt}}return H}});HGIS.Util=HGIS.Util||{};HGIS.Util.vendorPrefix=(function(){var A=["","O","ms","Moz","Webkit"],F=document.createElement("div").style,H={},C={};function B(I){if(!I){return null}return I.replace(/([A-Z])/g,function(J){return"-"+J.toLowerCase()}).replace(/^ms-/,"-ms-")}function D(J){if(H[J]===undefined){var I=J.replace(/(-[\s\S])/g,function(L){return L.charAt(1).toUpperCase()});var K=E(I);H[J]=B(K)}return H[J]}function G(K,N){if(C[N]===undefined){var J,L=0,M=A.length,O,I=(typeof K.cssText!=="undefined");C[N]=null;for(;L<M;L++){O=A[L];if(O){if(!I){O=O.toLowerCase()}J=O+N.charAt(0).toUpperCase()+N.slice(1)}else{J=N}if(K[J]!==undefined){C[N]=J;break}}}return C[N]}function E(I){return G(F,I)}return{css:D,js:G,style:E,cssCache:H,jsCache:C}}());HGIS.Animation=(function(E){var H=HGIS.Util.vendorPrefix.js(E,"requestAnimationFrame");var A=!!(H);var F=(function(){var I=E[H]||function(J,K){E.setTimeout(J,16)};return function(J,K){I.apply(E,[J,K])}})();var D=0;var G={};function C(I,J,K){J=J>0?J:Number.POSITIVE_INFINITY;var M=++D;var L=+new Date;G[M]=function(){if(G[M]&&+new Date-L<=J){I();if(G[M]){F(G[M],K)}}else{delete G[M]}};F(G[M],K);return M}function B(I){delete G[I]}return{isNative:A,requestFrame:F,start:C,stop:B}})(window);HGIS.Tween=HGIS.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:false,initialize:function(A){this.easing=(A)?A:HGIS.Easing.Expo.easeOut},start:function(A,D,C,B){this.playing=true;this.begin=A;this.finish=D;this.duration=C;this.callbacks=B.callbacks;this.minFrameRate=B.minFrameRate||30;this.time=0;this.startTime=new Date().getTime();HGIS.Animation.stop(this.animationId);this.animationId=null;if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.animationId=HGIS.Animation.start(HGIS.Function.bind(this.play,this))},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}HGIS.Animation.stop(this.animationId);this.animationId=null;this.playing=false},play:function(){var C={};for(var A in this.begin){var B=this.begin[A];var E=this.finish[A];if(B==null||E==null||isNaN(B)||isNaN(E)){throw new TypeError("invalid value for Tween")}var D=E-B;C[A]=this.easing.apply(this,[this.time,B,D,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){if((new Date().getTime()-this.startTime)/this.time<=1000/this.minFrameRate){this.callbacks.eachStep.call(this,C)}}if(this.time>this.duration){this.stop()}},CLASS_NAME:"HGIS.Tween"});HGIS.Easing={CLASS_NAME:"HGIS.Easing"};HGIS.Easing.Linear={easeIn:function(C,B,D,A){return D*C/A+B},easeOut:function(C,B,D,A){return D*C/A+B},easeInOut:function(C,B,D,A){return D*C/A+B},CLASS_NAME:"HGIS.Easing.Linear"};HGIS.Easing.Expo={easeIn:function(C,B,D,A){return(C==0)?B:D*Math.pow(2,10*(C/A-1))+B},easeOut:function(C,B,D,A){return(C==A)?B+D:D*(-Math.pow(2,-10*C/A)+1)+B},easeInOut:function(C,B,D,A){if(C==0){return B}if(C==A){return B+D}if((C/=A/2)<1){return D/2*Math.pow(2,10*(C-1))+B}return D/2*(-Math.pow(2,-10*--C)+2)+B},CLASS_NAME:"HGIS.Easing.Expo"};HGIS.Easing.Quad={easeIn:function(C,B,D,A){return D*(C/=A)*C+B},easeOut:function(C,B,D,A){return -D*(C/=A)*(C-2)+B},easeInOut:function(C,B,D,A){if((C/=A/2)<1){return D/2*C*C+B}return -D/2*((--C)*(C-2)-1)+B},CLASS_NAME:"HGIS.Easing.Quad"};HGIS.Projection=HGIS.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(A,B){HGIS.Util.extend(this,B);this.projCode=A;if(typeof Proj4js=="object"){this.proj=new Proj4js.Proj(A)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(A){var B=A,D=false;if(B){if(!(B instanceof HGIS.Projection)){B=new HGIS.Projection(B)}if((typeof Proj4js=="object")&&this.proj.defData&&B.proj.defData){D=this.proj.defData.replace(this.titleRegEx,"")==B.proj.defData.replace(this.titleRegEx,"")}else{if(B.getCode){var C=this.getCode(),E=B.getCode();D=C==E||!!HGIS.Projection.transforms[C]&&HGIS.Projection.transforms[C][E]===HGIS.Projection.nullTransform}}}return D},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"HGIS.Projection"});HGIS.Projection.transforms={};HGIS.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:true},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};HGIS.Projection.addTransform=function(A,B,C){if(C===HGIS.Projection.nullTransform){var D=HGIS.Projection.defaults[A];if(D&&!HGIS.Projection.defaults[B]){HGIS.Projection.defaults[B]=D}}if(!HGIS.Projection.transforms[A]){HGIS.Projection.transforms[A]={}}HGIS.Projection.transforms[A][B]=C};HGIS.Projection.transform=function(H,E,B){var G="",C="";if(B){if(!(B instanceof HGIS.Projection)){G=B}else{G=B.getCode()}}if(E){if(!(E instanceof HGIS.Projection)){C=E}else{C=E.getCode()}}H.oldx=H.x;H.oldy=H.y;if(C==G){return H}if(G=="EPSG:900913"&&HGIS.InitParam.factor=="1"){if(H.y>0.8293&&H.y<55.827&&H.x>72.004&&H.x<137.8347){var F=HGIS.Converter.encryToGCJ02(H);H.x=F.x;H.y=F.y}}if(E&&B){if(!(E instanceof HGIS.Projection)){E=new HGIS.Projection(E)}if(!(B instanceof HGIS.Projection)){B=new HGIS.Projection(B)}if(E.proj&&B.proj){H=Proj4js.transform(E.proj,B.proj,H)}else{var J=E.getCode();var A=B.getCode();var I=HGIS.Projection.transforms;if(I[J]&&I[J][A]){I[J][A](H)}}}if(HGIS.InitParam.factor=="1"&&G=="EPSG:4326"){var D=HGIS.Converter.getFactor(H);H.x=D.A*H.x*H.x+D.B*H.x*H.y+D.C*H.y*H.y+D.D*H.x+D.E*H.y+D.F;H.y=D.H*H.x*H.x+D.I*H.x*H.y+D.J*H.y*H.y+D.K*H.x+D.L*H.y+D.M}return H};HGIS.Projection.nullTransform=function(A){return A};(function(){var A=20037508.34;function C(H){H.x=180*H.x/A;H.y=180/Math.PI*(2*Math.atan(Math.exp((H.y/A)*Math.PI))-Math.PI/2);return H}function F(H){H.x=H.x*A/180;var I=Math.log(Math.tan((90+H.y)*Math.PI/360))/Math.PI*A;H.y=Math.max(-20037508.34,Math.min(I,20037508.34));return H}function G(H,J){var L=HGIS.Projection.addTransform;var I=HGIS.Projection.nullTransform;var M,O,K,P,N;for(M=0,O=J.length;M<O;++M){K=J[M];L(H,K,F);L(K,H,C);for(N=M+1;N<O;++N){P=J[N];L(K,P,I);L(P,K,I)}}}var D=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],E=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],B;for(B=D.length-1;B>=0;--B){G(D[B],E)}for(B=E.length-1;B>=0;--B){G(E[B],D)}})();HGIS.Map=HGIS.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:false,autoUpdateSize:true,eventListeners:null,panTween:null,panMethod:HGIS.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:HGIS.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(I,E){if(arguments.length===1&&typeof I==="object"){E=I;I=E&&E.div}this.tileSize=new HGIS.Size(HGIS.Map.TILE_WIDTH,HGIS.Map.TILE_HEIGHT);this.paddingForPopups=new HGIS.Bounds(15,15,15,15);this.options=HGIS.Util.extend({},E);HGIS.Util.extend(this,E);var B=this.projection instanceof HGIS.Projection?this.projection.projCode:this.projection;HGIS.Util.applyDefaults(this,HGIS.Projection.defaults[B]);if(this.maxExtent&&!(this.maxExtent instanceof HGIS.Bounds)){this.maxExtent=new HGIS.Bounds(this.maxExtent)}if(this.minExtent&&!(this.minExtent instanceof HGIS.Bounds)){this.minExtent=new HGIS.Bounds(this.minExtent)}if(this.restrictedExtent&&!(this.restrictedExtent instanceof HGIS.Bounds)){this.restrictedExtent=new HGIS.Bounds(this.restrictedExtent)}if(this.center&&!(this.center instanceof HGIS.LonLat)){this.center=new HGIS.LonLat(this.center)}this.layers=[];this.id=HGIS.Util.createUniqueID("HGIS.Map_");this.div=HGIS.Util.getElement(I);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}HGIS.Element.addClass(this.div,"olMap");var G=this.id+"_HGIS_ViewPort";this.viewPortDiv=HGIS.Util.createDiv(G,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new HGIS.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:true});if(HGIS.TileManager&&this.tileManager!==null){if(!(this.tileManager instanceof HGIS.TileManager)){this.tileManager=new HGIS.TileManager(this.tileManager)}this.tileManager.addMap(this)}G=this.id+"_HGIS_Container";this.layerContainerDiv=HGIS.Util.createDiv(G);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE["Popup"]-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.autoUpdateSize===true){this.updateSizeDestroy=HGIS.Function.bind(this.updateSize,this);HGIS.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var F=true;var H=document.getElementsByTagName("link");for(var D=0,A=H.length;D<A;++D){if(HGIS.Util.isEquivalentUrl(H.item(D).href,this.theme)){F=false;break}}if(F){var C=document.createElement("link");C.setAttribute("rel","stylesheet");C.setAttribute("type","text/css");C.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(C)}}if(this.controls==null){this.controls=[];if(HGIS.Control!=null){if(HGIS.Control.Navigation){this.controls.push(new HGIS.Control.Navigation())}else{if(HGIS.Control.TouchNavigation){this.controls.push(new HGIS.Control.TouchNavigation())}}if(HGIS.Control.Zoom){this.controls.push(new HGIS.Control.Zoom())}else{if(HGIS.Control.PanZoom){this.controls.push(new HGIS.Control.PanZoom())}}if(HGIS.Control.ArgParser){this.controls.push(new HGIS.Control.ArgParser())}if(HGIS.Control.Attribution){this.controls.push(new HGIS.Control.Attribution())}}}for(var D=0,A=this.controls.length;D<A;D++){this.addControlToMap(this.controls[D])}this.popups=[];this.unloadDestroy=HGIS.Function.bind(this.destroy,this);HGIS.Event.observe(window,"unload",this.unloadDestroy);if(E&&E.layers){delete this.center;delete this.zoom;this.addLayers(E.layers);if(E.center&&!this.getCenter()){this.setCenter(E.center,E.zoom)}}if(this.panMethod){this.panTween=new HGIS.Tween(this.panMethod)}if(this.zoomMethod&&this.applyTransform.transform){this.zoomTween=new HGIS.Tween(this.zoomMethod)}},getViewport:function(){return this.viewPortDiv},render:function(A){this.div=HGIS.Util.getElement(A);HGIS.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}if(this.zoomTween){this.zoomTween.stop();this.zoomTween=null}HGIS.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){HGIS.Event.stopObserving(window,"resize",this.updateSizeDestroy)}this.paddingForPopups=null;if(this.controls!=null){for(var A=this.controls.length-1;A>=0;--A){this.controls[A].destroy()}this.controls=null}if(this.layers!=null){for(var A=this.layers.length-1;A>=0;--A){this.layers[A].destroy(false)}this.layers=null}if(this.viewPortDiv&&this.viewPortDiv.parentNode){this.viewPortDiv.parentNode.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.tileManager){this.tileManager.removeMap(this);this.tileManager=null}if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null;this.options=null},setOptions:function(B){var A=this.minPx&&B.restrictedExtent!=this.restrictedExtent;HGIS.Util.extend(this,B);A&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})},getTileSize:function(){return this.tileSize},getBy:function(A,D,B){var C=(typeof B.test=="function");var E=HGIS.Array.filter(this[A],function(F){return F[D]==B||(C&&B.test(F[D]))});return E},getLayersBy:function(B,A){return this.getBy("layers",B,A)},getLayersByName:function(A){return this.getLayersBy("name",A)},getLayersByClass:function(A){return this.getLayersBy("CLASS_NAME",A)},getControlsBy:function(B,A){return this.getBy("controls",B,A)},getControlsByClass:function(A){return this.getControlsBy("CLASS_NAME",A)},getLayer:function(E){var D=null;for(var A=0,C=this.layers.length;A<C;A++){var B=this.layers[A];if(B.id==E){D=B;break}}return D},setLayerZIndex:function(A,B){A.setZIndex(this.Z_INDEX_BASE[A.isBaseLayer?"BaseLayer":"Overlay"]+B*5)},resetLayersZIndex:function(){for(var A=0,C=this.layers.length;A<C;A++){var B=this.layers[A];this.setLayerZIndex(B,A)}},addLayer:function(B){for(var A=0,C=this.layers.length;A<C;A++){if(this.layers[A]==B){return false}}if(this.events.triggerEvent("preaddlayer",{layer:B})===false){return false}if(this.allOverlays){B.isBaseLayer=false}B.div.className="olLayerDiv";B.div.style.overflow="";this.setLayerZIndex(B,this.layers.length);if(B.isFixed){this.viewPortDiv.appendChild(B.div)}else{this.layerContainerDiv.appendChild(B.div)}this.layers.push(B);B.setMap(this);if(B.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(B)}else{B.setVisibility(false)}}else{B.redraw()}this.events.triggerEvent("addlayer",{layer:B});B.events.triggerEvent("added",{map:this,layer:B});B.afterAdd();return true},addLayers:function(B){for(var A=0,C=B.length;A<C;A++){this.addLayer(B[A])}},removeLayer:function(D,C){if(this.events.triggerEvent("preremovelayer",{layer:D})===false){return}if(C==null){C=true}if(D.isFixed){this.viewPortDiv.removeChild(D.div)}else{this.layerContainerDiv.removeChild(D.div)}HGIS.Util.removeItem(this.layers,D);D.removeMap(this);D.map=null;if(this.baseLayer==D){this.baseLayer=null;if(C){for(var A=0,E=this.layers.length;A<E;A++){var B=this.layers[A];if(B.isBaseLayer||this.allOverlays){this.setBaseLayer(B);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:D});D.events.triggerEvent("removed",{map:this,layer:D})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(A){return HGIS.Util.indexOf(this.layers,A)},setLayerIndex:function(B,D){var E=this.getLayerIndex(B);if(D<0){D=0}else{if(D>this.layers.length){D=this.layers.length}}if(E!=D){this.layers.splice(E,1);this.layers.splice(D,0,B);for(var A=0,C=this.layers.length;A<C;A++){this.setLayerZIndex(this.layers[A],A)}this.events.triggerEvent("changelayer",{layer:B,property:"order"});if(this.allOverlays){if(D===0){this.setBaseLayer(B)}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}}},raiseLayer:function(B,A){var C=this.getLayerIndex(B)+A;this.setLayerIndex(B,C)},setBaseLayer:function(A){if(A!=this.baseLayer){if(HGIS.Util.indexOf(this.layers,A)!=-1){var C=this.getCachedCenter();var B=HGIS.Util.getResolutionFromScale(this.getScale(),A.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=A;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);if(this.baseLayer.inRange===false){this.baseLayer.redraw()}}if(C!=null){var D=this.getZoomForResolution(B||this.resolution,true);this.setCenter(C,D,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(B,A){this.controls.push(B);this.addControlToMap(B,A)},addControls:function(D,C){var A=(arguments.length===1)?[]:C;for(var B=0,G=D.length;B<G;B++){var F=D[B];var E=(A[B])?A[B]:null;this.addControl(F,E)}},addControlToMap:function(C,A){C.outsideViewport=(C.div!=null);if(this.displayProjection&&!C.displayProjection){C.displayProjection=this.displayProjection}C.setMap(this);var B=C.draw(A);if(B){if(!C.outsideViewport){B.style.zIndex=this.Z_INDEX_BASE["Control"]+this.controls.length;this.viewPortDiv.appendChild(B)}}if(C.autoActivate){C.activate()}},getControl:function(E){var B=null;for(var A=0,C=this.controls.length;A<C;A++){var D=this.controls[A];if(D.id==E){B=D;break}}return B},removeControl:function(A){if((A)&&(A==this.getControl(A.id))){if(A.div&&(A.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(A.div)}HGIS.Util.removeItem(this.controls,A)}},addPopup:function(D,A){if(A){for(var B=this.popups.length-1;B>=0;--B){this.removePopup(this.popups[B])}}D.map=this;this.popups.push(D);var C=D.draw();if(C){C.style.zIndex=this.Z_INDEX_BASE["Popup"]+this.popups.length;this.layerContainerDiv.appendChild(C)}},removePopup:function(B){HGIS.Util.removeItem(this.popups,B);if(B.div){try{this.layerContainerDiv.removeChild(B.div)}catch(A){}}B.map=null},getSize:function(){var A=null;if(this.size!=null){A=this.size.clone()}return A},updateSize:function(){var D=this.getCurrentSize();if(D&&!isNaN(D.h)&&!isNaN(D.w)){this.events.clearMouseCache();var A=this.getSize();if(A==null){this.size=A=D}if(!D.equals(A)){this.size=D;for(var B=0,E=this.layers.length;B<E;B++){this.layers[B].onMapResize()}var C=this.getCachedCenter();if(this.baseLayer!=null&&C!=null){var F=this.getZoom();this.zoom=null;this.setCenter(C,F)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var A=new HGIS.Size(this.div.clientWidth,this.div.clientHeight);if(A.w==0&&A.h==0||isNaN(A.w)&&isNaN(A.h)){A.w=this.div.offsetWidth;A.h=this.div.offsetHeight}if(A.w==0&&A.h==0||isNaN(A.w)&&isNaN(A.h)){A.w=parseInt(this.div.style.width);A.h=parseInt(this.div.style.height)}return A},calculateBounds:function(B,C){var E=null;if(B==null){B=this.getCachedCenter()}if(C==null){C=this.getResolution()}if((B!=null)&&(C!=null)){var A=(this.size.w*C)/2;var D=(this.size.h*C)/2;E=new HGIS.Bounds(B.lon-A,B.lat-D,B.lon+A,B.lat+D)}return E},getCenter:function(){var B=null;var A=this.getCachedCenter();if(A){B=A.clone()}return B},getCachedCenter:function(){if(!this.center&&this.size){this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})}return this.center},getZoom:function(){return this.zoom},pan:function(C,E,D){D=HGIS.Util.applyDefaults(D,{animate:true,dragging:false});if(D.dragging){if(C!=0||E!=0){this.moveByPx(C,E)}}else{var A=this.getViewPortPxFromLonLat(this.getCachedCenter());var F=A.add(C,E);if(this.dragging||!F.equals(A)){var B=this.getLonLatFromViewPortPx(F);if(D.animate){this.panTo(B)}else{this.moveTo(B);if(this.dragging){this.dragging=false;this.events.triggerEvent("moveend")}}}}},panTo:function(A){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(A)){var D=this.getCachedCenter();if(A.equals(D)){return}var B=this.getPixelFromLonLat(D);var C=this.getPixelFromLonLat(A);var F={x:C.x-B.x,y:C.y-B.y};var E={x:0,y:0};this.panTween.start({x:0,y:0},F,this.panDuration,{callbacks:{eachStep:HGIS.Function.bind(function(G){var H=G.x-E.x,I=G.y-E.y;this.moveByPx(H,I);E.x=Math.round(G.x);E.y=Math.round(G.y)},this),done:HGIS.Function.bind(function(G){this.moveTo(A);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(A)}},setCenter:function(A,D,C,B){if(this.panTween){this.panTween.stop()}if(this.zoomTween){this.zoomTween.stop()}this.moveTo(A,D,{"dragging":C,"forceZoomChange":B})},moveByPx:function(I,H){var G=this.size.w/2;var B=this.size.h/2;var J=G+I;var K=B+H;var C=this.baseLayer.wrapDateLine;var E=0;var D=0;if(this.restrictedExtent){E=G;D=B;C=false}I=C||J<=this.maxPx.x-E&&J>=this.minPx.x+E?Math.round(I):0;H=K<=this.maxPx.y-D&&K>=this.minPx.y+D?Math.round(H):0;if(I||H){if(!this.dragging){this.dragging=true;this.events.triggerEvent("movestart")}this.center=null;if(I){this.layerContainerOriginPx.x-=I;this.minPx.x-=I;this.maxPx.x-=I}if(H){this.layerContainerOriginPx.y-=H;this.minPx.y-=H;this.maxPx.y-=H}this.applyTransform();var L,F,A;for(F=0,A=this.layers.length;F<A;++F){L=this.layers[F];if(L.visibility&&(L===this.baseLayer||L.inRange)){L.moveByPx(I,H);L.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(F){if(this.baseLayer&&this.baseLayer.wrapDateLine){var D,E=this.baseLayer.resolutions,C=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(F)>C){if(this.fractionalZoom){F=this.getZoomForResolution(C)}else{for(var A=F|0,B=E.length;A<B;++A){if(E[A]<=C){F=A;break}}}}}return F},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(S,Q,R){if(S!=null&&!(S instanceof HGIS.LonLat)){S=new HGIS.LonLat(S)}if(!R){R={}}if(Q!=null){Q=parseFloat(Q);if(!this.fractionalZoom){Q=Math.round(Q)}}var G=Q;Q=this.adjustZoom(Q);if(Q!==G){S=this.getCenter()}var L=R.dragging||this.dragging;var B=R.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(S)){S=this.maxExtent.getCenterLonLat();this.center=S.clone()}if(this.restrictedExtent!=null){if(S==null){S=this.center}if(Q==null){Q=this.getZoom()}var N=this.getResolutionForZoom(Q);var O=this.calculateBounds(S,N);if(!this.restrictedExtent.containsBounds(O)){var P=this.restrictedExtent.getCenterLonLat();if(O.getWidth()>this.restrictedExtent.getWidth()){S=new HGIS.LonLat(P.lon,S.lat)}else{if(O.left<this.restrictedExtent.left){S=S.add(this.restrictedExtent.left-O.left,0)}else{if(O.right>this.restrictedExtent.right){S=S.add(this.restrictedExtent.right-O.right,0)}}}if(O.getHeight()>this.restrictedExtent.getHeight()){S=new HGIS.LonLat(S.lon,P.lat)}else{if(O.bottom<this.restrictedExtent.bottom){S=S.add(0,this.restrictedExtent.bottom-O.bottom)}else{if(O.top>this.restrictedExtent.top){S=S.add(0,this.restrictedExtent.top-O.top)}}}}}var H=B||((this.isValidZoomLevel(Q))&&(Q!=this.getZoom()));var V=(this.isValidLonLat(S))&&(!S.equals(this.center));if(H||V||L){L||this.events.triggerEvent("movestart",{zoomChanged:H});if(V){if(!H&&this.center){this.centerLayerContainer(S)}this.center=S.clone()}var U=H?this.getResolutionForZoom(Q):this.getResolution();if(H||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var M=this.getMaxExtent({restricted:true});var K=M.getCenterLonLat();var W=this.center.lon-K.lon;var C=K.lat-this.center.lat;var J=Math.round(M.getWidth()/U);var F=Math.round(M.getHeight()/U);this.minPx={x:(this.size.w-J)/2-W/U,y:(this.size.h-F)/2-C/U};this.maxPx={x:this.minPx.x+Math.round(M.getWidth()/U),y:this.minPx.y+Math.round(M.getHeight()/U)}}if(H){this.zoom=Q;this.resolution=U}var D=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(D,H,R.dragging);R.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:H})}D=this.baseLayer.getExtent();for(var T=this.layers.length-1;T>=0;--T){var I=this.layers[T];if(I!==this.baseLayer&&!I.isBaseLayer){var E=I.calculateInRange();if(I.inRange!=E){I.inRange=E;if(!E){I.display(false)}this.events.triggerEvent("changelayer",{layer:I,property:"visibility"})}if(E&&I.visibility){I.moveTo(D,H,R.dragging);R.dragging||I.events.triggerEvent("moveend",{zoomChanged:H})}}}this.events.triggerEvent("move");L||this.events.triggerEvent("moveend");if(H){for(var T=0,A=this.popups.length;T<A;T++){this.popups[T].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(G){var D=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var A=this.getViewPortPxFromLonLat(G);if((D!=null)&&(A!=null)){var C=this.layerContainerOriginPx.x;var B=this.layerContainerOriginPx.y;var H=Math.round(D.x-A.x);var I=Math.round(D.y-A.y);this.applyTransform((this.layerContainerOriginPx.x=H),(this.layerContainerOriginPx.y=I));var E=C-H;var F=B-I;this.minPx.x-=E;this.maxPx.x-=E;this.minPx.y-=F;this.maxPx.y-=F}},isValidZoomLevel:function(A){return((A!=null)&&(A>=0)&&(A<this.getNumZoomLevels()))},isValidLonLat:function(A){var C=false;if(A!=null){var B=this.getMaxExtent();var D=this.baseLayer.wrapDateLine&&B;C=B.containsLonLat(A,{worldBounds:D})}return C},getProjection:function(){var A=this.getProjectionObject();return A?A.getCode():null},getProjectionObject:function(){var A=null;if(this.baseLayer!=null){A=this.baseLayer.projection}return A},getMaxResolution:function(){var A=null;if(this.baseLayer!=null){A=this.baseLayer.maxResolution}return A},getMaxExtent:function(B){var A=null;if(B&&B.restricted&&this.restrictedExtent){A=this.restrictedExtent}else{if(this.baseLayer!=null){A=this.baseLayer.maxExtent}}return A},getNumZoomLevels:function(){var A=null;if(this.baseLayer!=null){A=this.baseLayer.numZoomLevels}return A},getExtent:function(){var A=null;if(this.baseLayer!=null){A=this.baseLayer.getExtent()}return A},getResolution:function(){var A=null;if(this.baseLayer!=null){A=this.baseLayer.getResolution()}else{if(this.allOverlays===true&&this.layers.length>0){A=this.layers[0].getResolution()}}return A},getUnits:function(){var A=null;if(this.baseLayer!=null){A=this.baseLayer.units}return A},getScale:function(){var C=null;if(this.baseLayer!=null){var B=this.getResolution();var A=this.baseLayer.units;C=HGIS.Util.getScaleFromResolution(B,A)}return C},getZoomForExtent:function(B,A){var C=null;if(this.baseLayer!=null){C=this.baseLayer.getZoomForExtent(B,A)}return C},getResolutionForZoom:function(B){var A=null;if(this.baseLayer){A=this.baseLayer.getResolutionForZoom(B)}return A},getZoomForResolution:function(B,A){var C=null;if(this.baseLayer!=null){C=this.baseLayer.getZoomForResolution(B,A)}return C},zoomTo:function(C,E){var H=this;if(H.isValidZoomLevel(C)){if(H.baseLayer.wrapDateLine){C=H.adjustZoom(C)}if(H.zoomTween){var I=H.getResolution(),G=H.getResolutionForZoom(C),B={scale:1},D={scale:I/G};if(H.zoomTween.playing&&H.zoomTween.duration<3*H.zoomDuration){H.zoomTween.finish={scale:H.zoomTween.finish.scale*D.scale}}else{if(!E){var F=H.getSize();E={x:F.w/2,y:F.h/2}}H.zoomTween.start(B,D,H.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(N){var J=H.layerContainerOriginPx,M=N.scale,K=((M-1)*(J.x-E.x))|0,L=((M-1)*(J.y-E.y))|0;H.applyTransform(J.x+K,J.y+L,M)},done:function(L){H.applyTransform();var J=H.getResolution()/L.scale,K=H.getZoomForResolution(J,true);H.moveTo(H.getZoomTargetCenter(E,J),K,true)}}})}}else{var A=E?H.getZoomTargetCenter(E,H.getResolutionForZoom(C)):null;H.setCenter(A,C)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(B,A){if(!(B instanceof HGIS.Bounds)){B=new HGIS.Bounds(B)}var D=B.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var C=this.getMaxExtent();B=B.clone();while(B.right<B.left){B.right+=C.getWidth()}D=B.getCenterLonLat().wrapDateLine(C)}this.setCenter(D,this.getZoomForExtent(B,A))},zoomToMaxExtent:function(B){var C=(B)?B.restricted:true;var A=this.getMaxExtent({"restricted":C});this.zoomToExtent(A)},zoomToScale:function(E,B){var D=HGIS.Util.getResolutionFromScale(E,this.baseLayer.units);var A=(this.size.w*D)/2;var C=(this.size.h*D)/2;var G=this.getCachedCenter();var F=new HGIS.Bounds(G.lon-A,G.lat-C,G.lon+A,G.lat+C);this.zoomToExtent(F,B)},getLonLatFromViewPortPx:function(B){var A=null;if(this.baseLayer!=null){A=this.baseLayer.getLonLatFromViewPortPx(B)}return A},getViewPortPxFromLonLat:function(A){var B=null;if(this.baseLayer!=null){B=this.baseLayer.getViewPortPxFromLonLat(A)}return B},getZoomTargetCenter:function(A,G){var B=null,D=this.getSize(),E=D.w/2-A.x,F=A.y-D.h/2,C=this.getLonLatFromPixel(A);if(C){B=new HGIS.LonLat(C.lon+E*G,C.lat+F*G)}return B},getLonLatFromPixel:function(A){return this.getLonLatFromViewPortPx(A)},getPixelFromLonLat:function(A){var B=this.getViewPortPxFromLonLat(A);B.x=Math.round(B.x);B.y=Math.round(B.y);return B},getGeodesicPixelSize:function(I){var A=I?this.getLonLatFromPixel(I):(this.getCachedCenter()||new HGIS.LonLat(0,0));var C=this.getResolution();var E=A.add(-C/2,0);var B=A.add(C/2,0);var G=A.add(0,-C/2);var D=A.add(0,C/2);var H=new HGIS.Projection("EPSG:4326");var F=this.getProjectionObject()||H;if(!F.equals(H)){E.transform(F,H);B.transform(F,H);G.transform(F,H);D.transform(F,H)}return new HGIS.Size(HGIS.Util.distVincenty(E,B),HGIS.Util.distVincenty(G,D))},getViewPortPxFromLayerPx:function(C){var A=null;if(C!=null){var D=this.layerContainerOriginPx.x;var B=this.layerContainerOriginPx.y;A=C.add(D,B)}return A},getLayerPxFromViewPortPx:function(A){var C=null;if(A!=null){var D=-this.layerContainerOriginPx.x;var B=-this.layerContainerOriginPx.y;C=A.add(D,B);if(isNaN(C.x)||isNaN(C.y)){C=null}}return C},getLonLatFromLayerPx:function(A){A=this.getViewPortPxFromLayerPx(A);return this.getLonLatFromViewPortPx(A)},getLayerPxFromLonLat:function(A){var B=this.getPixelFromLonLat(A);return this.getLayerPxFromViewPortPx(B)},applyTransform:function(G,H,B){B=B||1;var A=this.layerContainerOriginPx,E=B!==1;G=G||A.x;H=H||A.y;var D=this.layerContainerDiv.style,I=this.applyTransform.transform,C=this.applyTransform.template;if(I===undefined){I=HGIS.Util.vendorPrefix.style("transform");this.applyTransform.transform=I;if(I){var F=HGIS.Element.getStyle(this.viewPortDiv,HGIS.Util.vendorPrefix.css("transform"));if(!F||F!=="none"){C=["translate3d(",",0) ","scale3d(",",1)"];D[I]=[C[0],"0,0",C[1]].join("")}if(!C||!~D[I].indexOf(C[0])){C=["translate(",") ","scale(",")"]}this.applyTransform.template=C}}if(I!==null&&(C[0]==="translate3d("||E===true)){if(E===true&&C[0]==="translate("){G-=A.x;H-=A.y;D.left=A.x+"px";D.top=A.y+"px"}D[I]=[C[0],G,"px,",H,"px",C[1],C[2],B,",",B,C[3]].join("")}else{D.left=G+"px";D.top=H+"px";if(I!==null){D[I]=""}}},CLASS_NAME:"HGIS.Map"});HGIS.Map.TILE_WIDTH=256;HGIS.Map.TILE_HEIGHT=256;HGIS.Handler=HGIS.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,touch:false,initialize:function(C,D,B){HGIS.Util.extend(this,B);this.control=C;this.callbacks=D;var A=this.map||C.map;if(A){this.setMap(A)}this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(A){this.map=A},checkModifiers:function(A){if(this.keyMask==null){return true}var B=(A.shiftKey?HGIS.Handler.MOD_SHIFT:0)|(A.ctrlKey?HGIS.Handler.MOD_CTRL:0)|(A.altKey?HGIS.Handler.MOD_ALT:0)|(A.metaKey?HGIS.Handler.MOD_META:0);return(B==this.keyMask)},activate:function(){if(this.active){return false}var C=HGIS.Events.prototype.BROWSER_EVENTS;for(var A=0,B=C.length;A<B;A++){if(this[C[A]]){this.register(C[A],this[C[A]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var C=HGIS.Events.prototype.BROWSER_EVENTS;for(var A=0,B=C.length;A<B;A++){if(this[C[A]]){this.unregister(C[A],this[C[A]])}}this.touch=false;this.active=false;return true},startTouch:function(){if(!this.touch){this.touch=true;var C=["mousedown","mouseup","mousemove","click","dblclick","mouseout"];for(var A=0,B=C.length;A<B;A++){if(this[C[A]]){this.unregister(C[A],this[C[A]])}}}},callback:function(A,B){if(A&&this.callbacks[A]){this.callbacks[A].apply(this.control,B)}},register:function(A,B){this.map.events.registerPriority(A,this,B);this.map.events.registerPriority(A,this,this.setEvent)},unregister:function(A,B){this.map.events.unregister(A,this,B);this.map.events.unregister(A,this,this.setEvent)},setEvent:function(A){this.evt=A;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"HGIS.Handler"});HGIS.Handler.MOD_NONE=0;HGIS.Handler.MOD_SHIFT=1;HGIS.Handler.MOD_CTRL=2;HGIS.Handler.MOD_ALT=4;HGIS.Handler.MOD_META=8;HGIS.Handler.Click=HGIS.Class(HGIS.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(A){this.startTouch();this.down=this.getEventInfo(A);this.last=this.getEventInfo(A);return true},touchmove:function(A){this.last=this.getEventInfo(A);return true},touchend:function(A){if(this.down){A.xy=this.last.xy;A.lastTouches=this.last.touches;this.handleSingle(A);this.down=null}return true},mousedown:function(A){this.down=this.getEventInfo(A);this.last=this.getEventInfo(A);return true},mouseup:function(B){var A=true;if(this.checkModifiers(B)&&this.control.handleRightClicks&&HGIS.Event.isRightClick(B)){A=this.rightclick(B)}return A},rightclick:function(B){if(this.passesTolerance(B)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[B]);return !this.stopDouble}else{var A=this["double"]?HGIS.Util.extend({},B):this.callback("rightclick",[B]);var C=HGIS.Function.bind(this.delayedRightCall,this,A);this.rightclickTimerId=window.setTimeout(C,this.delay)}}return !this.stopSingle},delayedRightCall:function(A){this.rightclickTimerId=null;if(A){this.callback("rightclick",[A])}},click:function(A){if(!this.last){this.last=this.getEventInfo(A)}this.handleSingle(A);return !this.stopSingle},dblclick:function(A){this.handleDouble(A);return !this.stopDouble},handleDouble:function(A){if(this.passesDblclickTolerance(A)){if(this["double"]){this.callback("dblclick",[A])}this.clearTimer()}},handleSingle:function(B){if(this.passesTolerance(B)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){HGIS.Event.preventDefault(B)}this.handleDouble(B)}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()}}else{this.first=this.getEventInfo(B);var A=this.single?HGIS.Util.extend({},B):null;this.queuePotentialClick(A)}}},queuePotentialClick:function(A){this.timerId=window.setTimeout(HGIS.Function.bind(this.delayedCall,this,A),this.delay)},passesTolerance:function(C){var A=true;if(this.pixelTolerance!=null&&this.down&&this.down.xy){A=this.pixelTolerance>=this.down.xy.distanceTo(C.xy);if(A&&this.touch&&this.down.touches.length===this.last.touches.length){for(var B=0,D=this.down.touches.length;B<D;++B){if(this.getTouchDistance(this.down.touches[B],this.last.touches[B])>this.pixelTolerance){A=false;break}}}}return A},getTouchDistance:function(A,B){return Math.sqrt(Math.pow(A.clientX-B.clientX,2)+Math.pow(A.clientY-B.clientY,2))},passesDblclickTolerance:function(B){var A=true;if(this.down&&this.first){A=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance}return A},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(A){this.timerId=null;if(A){this.callback("click",[A])}},getEventInfo:function(C){var B;if(C.touches){var D=C.touches.length;B=new Array(D);var E;for(var A=0;A<D;A++){E=C.touches[A];B[A]={clientX:E.olClientX,clientY:E.olClientY}}}return{xy:C.xy,touches:B}},deactivate:function(){var A=false;if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;A=true}return A},CLASS_NAME:"HGIS.Handler.Click"});HGIS.Handler.Drag=HGIS.Class(HGIS.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(C,D,B){HGIS.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===true){var A=this;this._docMove=function(E){A.mousemove({xy:{x:E.clientX,y:E.clientY},element:document})};this._docUp=function(E){A.mouseup({xy:{x:E.clientX,y:E.clientY}})}}},dragstart:function(B){var A=true;this.dragging=false;if(this.checkModifiers(B)&&(HGIS.Event.isLeftClick(B)||HGIS.Event.isSingleTouch(B))){this.started=true;this.start=B.xy;this.last=B.xy;HGIS.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(B);this.callback("down",[B.xy]);HGIS.Event.preventDefault(B);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:HGIS.Function.True}document.onselectstart=HGIS.Function.False;A=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return A},dragmove:function(A){this.lastMoveEvt=A;if(this.started&&!this.timeoutId&&(A.xy.x!=this.last.x||A.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(A.element===document){this.adjustXY(A);this.setEvent(A)}else{this.removeDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(HGIS.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(A);this.callback("move",[A.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=HGIS.Function.False}this.last=A.xy}return true},dragend:function(A){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(A);this.removeDocumentEvents()}var B=(this.start!=this.last);this.started=false;this.dragging=false;HGIS.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(A);this.callback("up",[A.xy]);if(B){this.callback("done",[A.xy])}document.onselectstart=this.oldOnselectstart}return true},down:function(A){},move:function(A){},up:function(A){},out:function(A){},mousedown:function(A){return this.dragstart(A)},touchstart:function(A){this.startTouch();return this.dragstart(A)},mousemove:function(A){return this.dragmove(A)},touchmove:function(A){return this.dragmove(A)},removeTimeout:function(){this.timeoutId=null;if(this.dragging){this.mousemove(this.lastMoveEvt)}},mouseup:function(A){return this.dragend(A)},touchend:function(A){A.xy=this.last;return this.dragend(A)},mouseout:function(A){if(this.started&&HGIS.Util.mouseLeft(A,this.map.viewPortDiv)){if(this.documentDrag===true){this.addDocumentEvents()}else{var B=(this.start!=this.last);this.started=false;this.dragging=false;HGIS.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(A);this.callback("out",[]);if(B){this.callback("done",[A.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(A){return(this.start==this.last)},activate:function(){var A=false;if(HGIS.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;A=true}return A},deactivate:function(){var A=false;if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;A=true;HGIS.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return A},adjustXY:function(A){var B=HGIS.Util.pagePosition(this.map.viewPortDiv);A.xy.x-=B[0];A.xy.y-=B[1]},addDocumentEvents:function(){HGIS.Element.addClass(document.body,"olDragDown");this.documentEvents=true;HGIS.Event.observe(document,"mousemove",this._docMove);HGIS.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){HGIS.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;HGIS.Event.stopObserving(document,"mousemove",this._docMove);HGIS.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"HGIS.Handler.Drag"});HGIS.Control.OverviewMap=HGIS.Class(HGIS.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,maximized:false,maximizeTitle:"",minimizeTitle:"",initialize:function(A){this.layers=[];this.handlers={};HGIS.Control.prototype.initialize.apply(this,[A])},destroy:function(){if(!this.mapDiv){return}if(this.handlers.click){this.handlers.click.destroy()}if(this.handlers.drag){this.handlers.drag.destroy()}this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle);this.extentRectangle=null;if(this.rectEvents){this.rectEvents.destroy();this.rectEvents=null}if(this.ovmap){this.ovmap.destroy();this.ovmap=null}this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});HGIS.Control.prototype.destroy.apply(this,arguments)},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(this.layers.length===0){if(this.map.baseLayer){var A=this.map.baseLayer.clone();this.layers=[A]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=HGIS.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var B=HGIS.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=HGIS.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,B,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";if(this.maximizeTitle){this.maximizeDiv.title=this.maximizeTitle}this.div.appendChild(this.maximizeDiv);var B=HGIS.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=HGIS.Util.createAlphaImageDiv("HGIS_Control_minimizeDiv",null,null,B,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";if(this.minimizeTitle){this.minimizeDiv.title=this.minimizeTitle}this.div.appendChild(this.minimizeDiv);this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});if(this.maximized){this.maximizeControl()}return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(G){var I=this.handlers.drag.last.x-G.x;var D=this.handlers.drag.last.y-G.y;if(I!=0||D!=0){var A=this.rectPxBounds.top;var H=this.rectPxBounds.left;var B=Math.abs(this.rectPxBounds.getHeight());var C=this.rectPxBounds.getWidth();var E=Math.max(0,(A-D));E=Math.min(E,this.ovmap.size.h-this.hComp-B);var F=Math.max(0,(H-I));F=Math.min(F,this.ovmap.size.w-this.wComp-C);this.setRectPxBounds(new HGIS.Bounds(F,E+B,F+C,E))}},mapDivClick:function(B){var H=this.rectPxBounds.getCenterPixel();var J=B.xy.x-H.x;var A=B.xy.y-H.y;var D=this.rectPxBounds.top;var E=this.rectPxBounds.left;var C=Math.abs(this.rectPxBounds.getHeight());var G=this.rectPxBounds.getWidth();var F=Math.max(0,(D+A));F=Math.min(F,this.ovmap.size.h-C);var I=Math.max(0,(E+J));I=Math.min(I,this.ovmap.size.w-G);this.setRectPxBounds(new HGIS.Bounds(I,F+C,I+G,F));this.updateMapToRect()},onButtonClick:function(A){if(A.buttonElement===this.minimizeDiv){this.minimizeControl()}else{if(A.buttonElement===this.maximizeDiv){this.maximizeControl()}}},maximizeControl:function(A){this.element.style.display="";this.showToggle(false);if(A!=null){HGIS.Event.stop(A)}},minimizeControl:function(A){this.element.style.display="none";this.showToggle(true);if(A!=null){HGIS.Event.stop(A)}},showToggle:function(A){if(this.maximizeDiv){this.maximizeDiv.style.display=A?"":"none"}if(this.minimizeDiv){this.minimizeDiv.style.display=A?"none":""}},update:function(){if(this.ovmap==null){this.createMap()}if(this.autoPan||!this.isSuitableOverview()){this.updateOverview()}this.updateRectToMap()},isSuitableOverview:function(){var B=this.map.getExtent();var C=this.map.getMaxExtent();var D=new HGIS.Bounds(Math.max(B.left,C.left),Math.max(B.bottom,C.bottom),Math.min(B.right,C.right),Math.min(B.top,C.top));if(this.ovmap.getProjection()!=this.map.getProjection()){D=D.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}var A=this.ovmap.getResolution()/this.map.getResolution();return((A>this.minRatio)&&(A<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(D)))},updateOverview:function(){var B=this.map.getResolution();var A=this.ovmap.getResolution();var C=A/B;if(C>this.maxRatio){A=this.minRatio*B}else{if(C<=this.minRatio){A=this.maxRatio*B}}var D;if(this.ovmap.getProjection()!=this.map.getProjection()){D=this.map.center.clone();D.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{D=this.map.center}this.ovmap.setCenter(D,this.ovmap.getZoomForResolution(A*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var C=HGIS.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new HGIS.Map(this.mapDiv,C);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);HGIS.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(HGIS.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(HGIS.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(HGIS.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(HGIS.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;this.handlers.drag=new HGIS.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new HGIS.Handler.Click(this,{"click":this.mapDivClick},{"single":true,"double":false,"stopSingle":true,"stopDouble":true,"pixelTolerance":1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new HGIS.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(D){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(D){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}});if(this.ovmap.getProjection()!=this.map.getProjection()){var B=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var A=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=B&&A?HGIS.INCHES_PER_UNIT[B]/HGIS.INCHES_PER_UNIT[A]:1}},updateRectToMap:function(){var A;if(this.ovmap.getProjection()!=this.map.getProjection()){A=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{A=this.map.getExtent()}var B=this.getRectBoundsFromMapBounds(A);if(B){this.setRectPxBounds(B)}},updateMapToRect:function(){var A=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection()){A=A.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())}this.map.panTo(A.getCenterLonLat())},setRectPxBounds:function(F){var D=Math.max(F.top,0);var E=Math.max(F.left,0);var H=Math.min(F.top+Math.abs(F.getHeight()),this.ovmap.size.h-this.hComp);var A=Math.min(F.left+F.getWidth(),this.ovmap.size.w-this.wComp);var G=Math.max(A-E,0);var I=Math.max(H-D,0);if(G<this.minRectSize||I<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var C=E+(G/2)-(this.minRectSize/2);var B=D+(I/2)-(this.minRectSize/2);this.extentRectangle.style.top=Math.round(B)+"px";this.extentRectangle.style.left=Math.round(C)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(D)+"px";this.extentRectangle.style.left=Math.round(E)+"px";this.extentRectangle.style.height=Math.round(I)+"px";this.extentRectangle.style.width=Math.round(G)+"px"}this.rectPxBounds=new HGIS.Bounds(Math.round(E),Math.round(H),Math.round(A),Math.round(D))},getRectBoundsFromMapBounds:function(B){var A=this.getOverviewPxFromLonLat({lon:B.left,lat:B.bottom});var C=this.getOverviewPxFromLonLat({lon:B.right,lat:B.top});var D=null;if(A&&C){D=new HGIS.Bounds(A.x,A.y,C.x,C.y)}return D},getMapBoundsFromRectBounds:function(A){var B=this.getLonLatFromOverviewPx({x:A.left,y:A.bottom});var C=this.getLonLatFromOverviewPx({x:A.right,y:A.top});return new HGIS.Bounds(B.lon,B.lat,C.lon,C.lat)},getLonLatFromOverviewPx:function(E){var A=this.ovmap.size;var C=this.ovmap.getResolution();var B=this.ovmap.getExtent().getCenterLonLat();var D=E.x-(A.w/2);var F=E.y-(A.h/2);return{lon:B.lon+D*C,lat:B.lat-F*C}},getOverviewPxFromLonLat:function(A){var B=this.ovmap.getResolution();var C=this.ovmap.getExtent();if(C){return{x:Math.round(1/B*(A.lon-C.left)),y:Math.round(1/B*(C.top-A.lat))}}},CLASS_NAME:"HGIS.Control.OverviewMap"});HGIS.Layer=HGIS.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,metadata:null,initialize:function(B,A){this.metadata={};A=HGIS.Util.extend({},A);if(this.alwaysInRange!=null){A.alwaysInRange=this.alwaysInRange}this.addOptions(A);this.name=B;if(this.id==null){this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_");this.div=HGIS.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new HGIS.Events(this,this.div);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}},destroy:function(A){if(A==null){A=true}if(this.map!=null){this.map.removeLayer(this,A)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(A){if(A==null){A=new HGIS.Layer(this.name,this.getOptions())}HGIS.Util.applyDefaults(A,this);A.map=null;return A},getOptions:function(){var B={};for(var A in this.options){B[A]=this[A]}return B},setName:function(A){if(A!=this.name){this.name=A;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(E,B){if(this.options==null){this.options={}}if(E){if(typeof E.projection=="string"){E.projection=new HGIS.Projection(E.projection)}if(E.projection){HGIS.Util.applyDefaults(E,HGIS.Projection.defaults[E.projection.getCode()])}if(E.maxExtent&&!(E.maxExtent instanceof HGIS.Bounds)){E.maxExtent=new HGIS.Bounds(E.maxExtent)}if(E.minExtent&&!(E.minExtent instanceof HGIS.Bounds)){E.minExtent=new HGIS.Bounds(E.minExtent)}}HGIS.Util.extend(this.options,E);HGIS.Util.extend(this,E);if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()}if(this.map){var A=this.map.getResolution();var C=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var D in E){if(E.hasOwnProperty(D)&&HGIS.Util.indexOf(C,D)>=0){this.initResolutions();if(B&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(A),false,true);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}}},onMapResize:function(){},redraw:function(){var C=false;if(this.map){this.inRange=this.calculateInRange();var B=this.getExtent();if(B&&this.inRange&&this.visibility){var A=true;this.moveTo(B,A,false);this.events.triggerEvent("moveend",{"zoomChanged":A});C=true}}return C},moveTo:function(B,A,D){var C=this.visibility;if(!this.isBaseLayer){C=C&&this.inRange}this.display(C)},moveByPx:function(A,B){},setMap:function(A){if(this.map==null){this.map=A;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new HGIS.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var B=((this.visibility)&&(this.inRange));this.div.style.display=B?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(A){},getImageSize:function(A){return(this.imageSize||this.tileSize)},setTileSize:function(A){var B=(A)?A:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=B;if(this.gutter){this.imageSize=new HGIS.Size(B.w+(2*this.gutter),B.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(A){if(A!=this.visibility){this.visibility=A;this.display(A);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(A){if(A!=(this.div.style.display!="none")){this.div.style.display=(A&&this.calculateInRange())?"block":"none"}},calculateInRange:function(){var A=false;if(this.alwaysInRange){A=true}else{if(this.map){var B=this.map.getResolution();A=((B>=this.minResolution)&&(B<=this.maxResolution))}}return A},setIsBaseLayer:function(A){if(A!=this.isBaseLayer){this.isBaseLayer=A;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var D,F,A;var C={},H=true;for(D=0,F=this.RESOLUTION_PROPERTIES.length;D<F;D++){A=this.RESOLUTION_PROPERTIES[D];C[A]=this.options[A];if(H&&this.options[A]){H=false}}if(this.options.alwaysInRange==null){this.alwaysInRange=H}if(C.resolutions==null){C.resolutions=this.resolutionsFromScales(C.scales)}if(C.resolutions==null){C.resolutions=this.calculateResolutions(C)}if(C.resolutions==null){for(D=0,F=this.RESOLUTION_PROPERTIES.length;D<F;D++){A=this.RESOLUTION_PROPERTIES[D];C[A]=this.options[A]!=null?this.options[A]:this.map[A]}if(C.resolutions==null){C.resolutions=this.resolutionsFromScales(C.scales)}if(C.resolutions==null){C.resolutions=this.calculateResolutions(C)}}var G;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){G=this.options.maxResolution}if(this.options.minScale){G=HGIS.Util.getResolutionFromScale(this.options.minScale,this.units)}var B;if(this.options.minResolution&&this.options.minResolution!=="auto"){B=this.options.minResolution}if(this.options.maxScale){B=HGIS.Util.getResolutionFromScale(this.options.maxScale,this.units)}if(C.resolutions){C.resolutions.sort(function(J,I){return(I-J)});if(!G){G=C.resolutions[0]}if(!B){var E=C.resolutions.length-1;B=C.resolutions[E]}}this.resolutions=C.resolutions;if(this.resolutions){F=this.resolutions.length;this.scales=new Array(F);for(D=0;D<F;D++){this.scales[D]=HGIS.Util.getScaleFromResolution(this.resolutions[D],this.units)}this.numZoomLevels=F}this.minResolution=B;if(B){this.maxScale=HGIS.Util.getScaleFromResolution(B,this.units)}this.maxResolution=G;if(G){this.minScale=HGIS.Util.getScaleFromResolution(G,this.units)}},resolutionsFromScales:function(B){if(B==null){return}var D,A,C;C=B.length;D=new Array(C);for(A=0;A<C;A++){D[A]=HGIS.Util.getResolutionFromScale(B[A],this.units)}return D},calculateResolutions:function(E){var C,G,D;var L=E.maxResolution;if(E.minScale!=null){L=HGIS.Util.getResolutionFromScale(E.minScale,this.units)}else{if(L=="auto"&&this.maxExtent!=null){C=this.map.getSize();G=this.maxExtent.getWidth()/C.w;D=this.maxExtent.getHeight()/C.h;L=Math.max(G,D)}}var K=E.minResolution;if(E.maxScale!=null){K=HGIS.Util.getResolutionFromScale(E.maxScale,this.units)}else{if(E.minResolution=="auto"&&this.minExtent!=null){C=this.map.getSize();G=this.minExtent.getWidth()/C.w;D=this.minExtent.getHeight()/C.h;K=Math.max(G,D)}}if(typeof L!=="number"&&typeof K!=="number"&&this.maxExtent!=null){var A=this.map.getTileSize();L=Math.max(this.maxExtent.getWidth()/A.w,this.maxExtent.getHeight()/A.h)}var H=E.maxZoomLevel;var I=E.numZoomLevels;if(typeof K==="number"&&typeof L==="number"&&I===undefined){var B=L/K;I=Math.floor(Math.log(B)/Math.log(2))+1}else{if(I===undefined&&H!=null){I=H+1}}if(typeof I!=="number"||I<=0||(typeof L!=="number"&&typeof K!=="number")){return}var J=new Array(I);var M=2;if(typeof K=="number"&&typeof L=="number"){M=Math.pow((L/K),(1/(I-1)))}var F;if(typeof L==="number"){for(F=0;F<I;F++){J[F]=L/Math.pow(M,F)}}else{for(F=0;F<I;F++){J[I-1-F]=K*Math.pow(M,F)}}return J},getResolution:function(){var A=this.map.getZoom();return this.getResolutionForZoom(A)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(C,A){var B=this.map.getSize();var D=Math.max(C.getWidth()/B.w,C.getHeight()/B.h);return this.getZoomForResolution(D,A)},getDataExtent:function(){},getResolutionForZoom:function(D){D=Math.max(0,Math.min(D,this.resolutions.length-1));var C;if(this.map.fractionalZoom){var A=Math.floor(D);var B=Math.ceil(D);C=this.resolutions[A]-((D-A)*(this.resolutions[A]-this.resolutions[B]))}else{C=this.resolutions[Math.round(D)]}return C},getZoomForResolution:function(J,G){var C,I,B;if(this.map.fractionalZoom){var K=0;var M=this.resolutions.length-1;var H=this.resolutions[K];var A=this.resolutions[M];var L;for(I=0,B=this.resolutions.length;I<B;++I){L=this.resolutions[I];if(L>=J){H=L;K=I}if(L<=J){A=L;M=I;break}}var D=H-A;if(D>0){C=K+((H-J)/D)}else{C=K}}else{var F;var E=Number.POSITIVE_INFINITY;for(I=0,B=this.resolutions.length;I<B;I++){if(G){F=Math.abs(this.resolutions[I]-J);if(F>E){break}E=F}else{if(this.resolutions[I]<J){break}}}C=Math.max(0,I-1)}return C},getLonLatFromViewPortPx:function(C){var B=null;var A=this.map;if(C!=null&&A.minPx){var E=A.getResolution();var D=A.getMaxExtent({restricted:true});var G=(C.x-A.minPx.x)*E+D.left;var F=(A.minPx.y-C.y)*E+D.top;B=new HGIS.LonLat(G,F);if(this.wrapDateLine){B=B.wrapDateLine(this.maxExtent)}}return B},getViewPortPxFromLonLat:function(A,D){var C=null;if(A!=null){D=D||this.map.getResolution();var B=this.map.calculateBounds(null,D);C=new HGIS.Pixel((1/D*(A.lon-B.left)),(1/D*(B.top-A.lat)))}return C},setOpacity:function(C){if(C!=this.opacity){this.opacity=C;var B=this.div.childNodes;for(var A=0,D=B.length;A<D;++A){var E=B[A].firstChild||B[A];var F=B[A].lastChild;if(F&&F.nodeName.toLowerCase()==="iframe"){E=F.parentNode}HGIS.Util.modifyDOMElement(E,null,null,null,null,null,null,C)}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(A){this.div.style.zIndex=A},adjustBounds:function(B){if(this.gutter){var A=this.gutter*this.map.getResolution();B=new HGIS.Bounds(B.left-A,B.bottom-A,B.right+A,B.top+A)}if(this.wrapDateLine){var C={"rightTolerance":this.getResolution(),"leftTolerance":this.getResolution()};B=B.wrapDateLine(this.maxExtent,C)}return B},CLASS_NAME:"HGIS.Layer"});HGIS.Layer.SphericalMercator={getExtent:function(){var A=null;if(this.sphericalMercator){A=this.map.calculateBounds()}else{A=HGIS.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return A},getLonLatFromViewPortPx:function(A){return HGIS.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(A){return HGIS.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];var A=156543.03390625;for(var B=0;B<=this.MAX_ZOOM_LEVEL;++B){this.RESOLUTIONS[B]=A/Math.pow(2,B)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:(function(){var B=new HGIS.Projection("EPSG:4326");var A=new HGIS.Projection("EPSG:900913");return function(C,E){var D=HGIS.Projection.transform({x:C,y:E},B,A);return new HGIS.LonLat(D.x,D.y)}})(),inverseMercator:(function(){var B=new HGIS.Projection("EPSG:4326");var A=new HGIS.Projection("EPSG:900913");return function(D,E){var C=HGIS.Projection.transform({x:D,y:E},A,B);return new HGIS.LonLat(C.x,C.y)}})()};HGIS.Layer.EventPane=HGIS.Class(HGIS.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(B,A){HGIS.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=HGIS.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;this.pane=null;HGIS.Layer.prototype.destroy.apply(this,arguments)},setMap:function(A){HGIS.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(HGIS.BROWSER_NAME=="msie"){this.pane.style.background="url("+HGIS.Util.getImageLocation("blank.gif")+")"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(A){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)}HGIS.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var C=this.map.getSize();var G=Math.min(C.w,300);var B=Math.min(C.h,200);var A=new HGIS.Size(G,B);var E=new HGIS.Pixel(C.w/2,C.h/2);var D=E.add(-A.w/2,-A.h/2);var F=HGIS.Util.createDiv(this.name+"_warning",D,A,null,null,null,"auto");F.style.padding="7px";F.style.backgroundColor="yellow";F.innerHTML=this.getWarningHTML();this.div.appendChild(F)},getWarningHTML:function(){return""},display:function(A){HGIS.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(A){HGIS.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(A,B){HGIS.Layer.prototype.moveByPx.apply(this,arguments);if(this.dragPanMapObject){this.dragPanMapObject(A,-B)}else{this.moveTo(this.map.getCachedCenter())}},moveTo:function(C,J,H){HGIS.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var A=this.map.getCenter();var G=this.map.getZoom();if(A!=null){var E=this.getMapObjectCenter();var L=this.getOLLonLatFromMapObjectLonLat(E);var B=this.getMapObjectZoom();var I=this.getOLZoomFromMapObjectZoom(B);if(!(A.equals(L))||G!=I){if(!J&&L&&this.dragPanMapObject&&this.smoothDragPan){var M=this.map.getViewPortPxFromLonLat(L);var F=this.map.getViewPortPxFromLonLat(A);this.dragPanMapObject(F.x-M.x,M.y-F.y)}else{var K=this.getMapObjectLonLatFromOLLonLat(A);var D=this.getMapObjectZoomFromOLZoom(G);this.setMapObjectCenter(K,D,H)}}}}},getLonLatFromViewPortPx:function(B){var A=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var D=this.getMapObjectPixelFromOLPixel(B);var C=this.getMapObjectLonLatFromMapObjectPixel(D);A=this.getOLLonLatFromMapObjectLonLat(C)}return A},getViewPortPxFromLonLat:function(A){var B=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var C=this.getMapObjectLonLatFromOLLonLat(A);var D=this.getMapObjectPixelFromMapObjectLonLat(C);B=this.getOLPixelFromMapObjectPixel(D)}return B},getOLLonLatFromMapObjectLonLat:function(C){var B=null;if(C!=null){var A=this.getLongitudeFromMapObjectLonLat(C);var D=this.getLatitudeFromMapObjectLonLat(C);B=new HGIS.LonLat(A,D)}return B},getMapObjectLonLatFromOLLonLat:function(A){var B=null;if(A!=null){B=this.getMapObjectLonLatFromLonLat(A.lon,A.lat)}return B},getOLPixelFromMapObjectPixel:function(A){var B=null;if(A!=null){var C=this.getXFromMapObjectPixel(A);var D=this.getYFromMapObjectPixel(A);B=new HGIS.Pixel(C,D)}return B},getMapObjectPixelFromOLPixel:function(B){var A=null;if(B!=null){A=this.getMapObjectPixelFromXY(B.x,B.y)}return A},CLASS_NAME:"HGIS.Layer.EventPane"});HGIS.Layer.FixedZoomLevels=HGIS.Class({initialize:function(){},initResolutions:function(){var F=["minZoomLevel","maxZoomLevel","numZoomLevels"];for(var A=0,E=F.length;A<E;A++){var D=F[A];this[D]=(this.options[D]!=null)?this.options[D]:this.map[D]}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var G;var C=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){G=this.maxZoomLevel-this.minZoomLevel+1}else{G=this.numZoomLevels}if(G!=null){this.numZoomLevels=Math.min(G,C)}else{this.numZoomLevels=C}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var B=0;this.resolutions=[];for(var A=this.minZoomLevel;A<=this.maxZoomLevel;A++){this.resolutions[B++]=this.RESOLUTIONS[A]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return HGIS.Layer.prototype.getResolution.apply(this,arguments)}else{var C=null;var A=this.map.getSize();var B=this.getExtent();if((A!=null)&&(B!=null)){C=Math.max(B.getWidth()/A.w,B.getHeight()/A.h)}return C}},getExtent:function(){var A=this.map.getSize();var C=this.getLonLatFromViewPortPx({x:0,y:0});var B=this.getLonLatFromViewPortPx({x:A.w,y:A.h});if((C!=null)&&(B!=null)){return new HGIS.Bounds(C.lon,B.lat,B.lon,C.lat)}else{return null}},getZoomForResolution:function(B){if(this.resolutions!=null){return HGIS.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var A=HGIS.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(A)}},getOLZoomFromMapObjectZoom:function(A){var B=null;if(A!=null){B=A-this.minZoomLevel;if(this.map.baseLayer!==this){B=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(B))}}return B},getMapObjectZoomFromOLZoom:function(A){var B=null;if(A!=null){B=A+this.minZoomLevel;if(this.map.baseLayer!==this){B=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(B))}}return B},CLASS_NAME:"HGIS.Layer.FixedZoomLevels"});HGIS.Layer.Google=HGIS.Class(HGIS.Layer.EventPane,HGIS.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,8.58306884765625e-05,4.29153442382813e-05,2.14576721191406e-05,1.07288360595703e-05,5.36441802978515e-06,2.68220901489257e-06,1.34110450744629e-06,6.70552253723145e-07],type:null,wrapDateLine:true,sphericalMercator:false,version:null,initialize:function(B,A){A=A||{};if(!A.version){A.version=typeof GMap2==="function"?"2":"3"}var C=HGIS.Layer.Google["v"+A.version.replace(/\./g,"_")];if(C){HGIS.Util.applyDefaults(A,C)}else{throw"Unsupported Google Maps API version: "+A.version}HGIS.Util.applyDefaults(A,C.DEFAULTS);if(A.maxExtent){A.maxExtent=A.maxExtent.clone()}HGIS.Layer.EventPane.prototype.initialize.apply(this,[B,A]);HGIS.Layer.FixedZoomLevels.prototype.initialize.apply(this,[B,A]);if(this.sphericalMercator){HGIS.Util.extend(this,HGIS.Layer.SphericalMercator);this.initMercatorParameters()}},clone:function(){return new HGIS.Layer.Google(this.name,this.getOptions())},setVisibility:function(A){var B=this.opacity==null?1:this.opacity;HGIS.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(B)},display:function(A){if(!this._dragging){this.setGMapVisibility(A)}HGIS.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(B,A,C){this._dragging=C;HGIS.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(A){if(A!==this.opacity){if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}this.opacity=A}if(this.getVisibility()){var B=this.getMapContainer();HGIS.Util.modifyDOMElement(B,null,null,null,null,null,null,A)}},destroy:function(){if(this.map){this.setGMapVisibility(false);var A=HGIS.Layer.Google.cache[this.map.id];if(A&&A.count<=1){this.removeGMapElements()}}HGIS.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var A=HGIS.Layer.Google.cache[this.map.id];if(A){var D=this.mapObject&&this.getMapContainer();if(D&&D.parentNode){D.parentNode.removeChild(D)}var B=A.termsOfUse;if(B&&B.parentNode){B.parentNode.removeChild(B)}var C=A.poweredBy;if(C&&C.parentNode){C.parentNode.removeChild(C)}if(this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners){google.maps.event.clearListeners(this.mapObject,"tilesloaded")}}},removeMap:function(B){if(this.visibility&&this.mapObject){this.setGMapVisibility(false)}var A=HGIS.Layer.Google.cache[B.id];if(A){if(A.count<=1){this.removeGMapElements();delete HGIS.Layer.Google.cache[B.id]}else{--A.count}}delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;HGIS.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(D){var C=null;if(D!=null){var A=D.getSouthWest();var B=D.getNorthEast();if(this.sphericalMercator){A=this.forwardMercator(A.lng(),A.lat());B=this.forwardMercator(B.lng(),B.lat())}else{A=new HGIS.LonLat(A.lng(),A.lat());B=new HGIS.LonLat(B.lng(),B.lat())}C=new HGIS.Bounds(A.lon,A.lat,B.lon,B.lat)}return C},getWarningHTML:function(){return HGIS.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(A){return this.sphericalMercator?this.forwardMercator(A.lng(),A.lat()).lon:A.lng()},getLatitudeFromMapObjectLonLat:function(A){var B=this.sphericalMercator?this.forwardMercator(A.lng(),A.lat()).lat:A.lat();return B},getXFromMapObjectPixel:function(A){return A.x},getYFromMapObjectPixel:function(A){return A.y},CLASS_NAME:"HGIS.Layer.Google"});HGIS.Layer.Google.cache={};HGIS.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){if(!this.type){this.type=G_NORMAL_MAP}var D,B,C;var A=HGIS.Layer.Google.cache[this.map.id];if(A){D=A.mapObject;B=A.termsOfUse;C=A.poweredBy;++A.count}else{var G=this.map.viewPortDiv;var F=document.createElement("div");F.id=this.map.id+"_GMap2Container";F.style.position="absolute";F.style.width="100%";F.style.height="100%";G.appendChild(F);try{D=new GMap2(F);B=F.lastChild;G.appendChild(B);B.style.zIndex="1100";B.style.right="";B.style.bottom="";B.className="olLayerGoogleCopyright";C=F.lastChild;G.appendChild(C);C.style.zIndex="1100";C.style.right="";C.style.bottom="";C.className="olLayerGooglePoweredBy gmnoprint"}catch(E){throw (E)}HGIS.Layer.Google.cache[this.map.id]={mapObject:D,termsOfUse:B,poweredBy:C,count:1}}this.mapObject=D;this.termsOfUse=B;this.poweredBy=C;if(HGIS.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1){this.mapObject.addMapType(this.type)}if(typeof D.getDragObject=="function"){this.dragObject=D.getDragObject()}else{this.dragPanMapObject=null}if(this.isBaseLayer===false){this.setGMapVisibility(this.div.style.display!=="none")}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var B=this;var A=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(A);delete B._resized;B.mapObject.checkResize();B.moveTo(B.map.getCenter(),B.map.getZoom())})}this._resized=true}},setGMapVisibility:function(B){var A=HGIS.Layer.Google.cache[this.map.id];if(A){var C=this.mapObject.getContainer();if(B===true){this.mapObject.setMapType(this.type);C.style.display="";this.termsOfUse.style.left="";this.termsOfUse.style.display="";this.poweredBy.style.display="";A.displayed=this.id}else{if(A.displayed===this.id){delete A.displayed}if(!A.displayed){C.style.display="none";this.termsOfUse.style.display="none";this.termsOfUse.style.left="-9999px";this.poweredBy.style.display="none"}}}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(C){var D=null;if(C!=null){var A=this.sphericalMercator?this.inverseMercator(C.bottom,C.left):new HGIS.LonLat(C.bottom,C.left);var B=this.sphericalMercator?this.inverseMercator(C.top,C.right):new HGIS.LonLat(C.top,C.right);D=new GLatLngBounds(new GLatLng(A.lat,A.lon),new GLatLng(B.lat,B.lon))}return D},setMapObjectCenter:function(A,B){this.mapObject.setCenter(A,B)},dragPanMapObject:function(B,A){this.dragObject.moveBy(new GSize(-B,A))},getMapObjectLonLatFromMapObjectPixel:function(A){return this.mapObject.fromContainerPixelToLatLng(A)},getMapObjectPixelFromMapObjectLonLat:function(A){return this.mapObject.fromLatLngToContainerPixel(A)},getMapObjectZoomFromMapObjectBounds:function(A){return this.mapObject.getBoundsZoomLevel(A)},getMapObjectLonLatFromLonLat:function(B,C){var D;if(this.sphericalMercator){var A=this.inverseMercator(B,C);D=new GLatLng(A.lat,A.lon)}else{D=new GLatLng(C,B)}return D},getMapObjectPixelFromXY:function(A,B){return new GPoint(A,B)}};HGIS.Format.XML=HGIS.Class(HGIS.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(B){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}HGIS.Format.prototype.initialize.apply(this,[B]);this.namespaces=HGIS.Util.extend({},this.namespaces);this.namespaceAlias={};for(var A in this.namespaces){this.namespaceAlias[this.namespaces[A]]=A}},destroy:function(){this.xmldom=null;HGIS.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(B,A){this.namespaces[B]=A;this.namespaceAlias[A]=B},read:function(B){var C=B.indexOf("<");if(C>0){B=B.substring(C)}var A=HGIS.Util.Try(HGIS.Function.bind((function(){var D;if(window.ActiveXObject&&!this.xmldom){D=new ActiveXObject("Microsoft.XMLDOM")}else{D=this.xmldom}D.loadXML(B);return D}),this),function(){return new DOMParser().parseFromString(B,"text/xml")},function(){var D=new XMLHttpRequest();D.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(B),false);if(D.overrideMimeType){D.overrideMimeType("text/xml")}D.send(null);return D.responseXML});if(this.keepData){this.data=A}return A},write:function(A){var D;if(this.xmldom){D=A.xml}else{var C=new XMLSerializer();if(A.nodeType==1){var B=document.implementation.createDocument("","",null);if(B.importNode){A=B.importNode(A,true)}B.appendChild(A);D=C.serializeToString(B)}else{D=C.serializeToString(A)}}return D},createElementNS:function(A,B){var C;if(this.xmldom){if(typeof A=="string"){C=this.xmldom.createNode(1,B,A)}else{C=this.xmldom.createNode(1,B,"")}}else{C=document.createElementNS(A,B)}return C},createDocumentFragment:function(){var A;if(this.xmldom){A=this.xmldom.createDocumentFragment()}else{A=document.createDocumentFragment()}return A},createTextNode:function(B){var A;if(typeof B!=="string"){B=String(B)}if(this.xmldom){A=this.xmldom.createTextNode(B)}else{A=document.createTextNode(B)}return A},getElementsByTagNameNS:function(F,H,C){var A=[];if(F.getElementsByTagNameNS){A=F.getElementsByTagNameNS(H,C)}else{var I=F.getElementsByTagName("*");var B,E;for(var D=0,G=I.length;D<G;++D){B=I[D];E=(B.prefix)?(B.prefix+":"+C):C;if((C=="*")||(E==B.nodeName)){if((H=="*")||(H==B.namespaceURI)){A.push(B)}}}}return A},getAttributeNodeNS:function(G,I,B){var C=null;if(G.getAttributeNodeNS){C=G.getAttributeNodeNS(I,B)}else{var E=G.attributes;var A,F;for(var D=0,H=E.length;D<H;++D){A=E[D];if(A.namespaceURI==I){F=(A.prefix)?(A.prefix+":"+B):B;if(F==A.nodeName){C=A;break}}}}return C},getAttributeNS:function(C,D,E){var B="";if(C.getAttributeNS){B=C.getAttributeNS(D,E)||""}else{var A=this.getAttributeNodeNS(C,D,E);if(A){B=A.nodeValue}}return B},getChildValue:function(B,D){var C=D||"";if(B){for(var A=B.firstChild;A;A=A.nextSibling){switch(A.nodeType){case 3:case 4:C+=A.nodeValue}}}return C},isSimpleContent:function(C){var B=true;for(var A=C.firstChild;A;A=A.nextSibling){if(A.nodeType===1){B=false;break}}return B},contentType:function(C){var B=false,A=false;var E=HGIS.Format.XML.CONTENT_TYPE.EMPTY;for(var D=C.firstChild;D;D=D.nextSibling){switch(D.nodeType){case 1:A=true;break;case 8:break;default:B=true}if(A&&B){break}}if(A&&B){E=HGIS.Format.XML.CONTENT_TYPE.MIXED}else{if(A){return HGIS.Format.XML.CONTENT_TYPE.COMPLEX}else{if(B){return HGIS.Format.XML.CONTENT_TYPE.SIMPLE}}}return E},hasAttributeNS:function(A,B,C){var D=false;if(A.hasAttributeNS){D=A.hasAttributeNS(B,C)}else{D=!!this.getAttributeNodeNS(A,B,C)}return D},setAttributeNS:function(B,C,D,E){if(B.setAttributeNS){B.setAttributeNS(C,D,E)}else{if(this.xmldom){if(C){var A=B.ownerDocument.createNode(2,D,C);A.nodeValue=E;B.setAttributeNode(A)}else{B.setAttribute(D,E)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(D,C){C=C||{};var A=C.uri||this.namespaces[C.prefix];if(!A){var F=D.indexOf(":");A=this.namespaces[D.substring(0,F)]}if(!A){A=this.namespaces[this.defaultPrefix]}var B=this.createElementNS(A,D);if(C.attributes){this.setAttributes(B,C.attributes)}var E=C.value;if(E!=null){B.appendChild(this.createTextNode(E))}return B},setAttributes:function(B,A){var E,C;for(var D in A){if(A[D]!=null&&A[D].toString){E=A[D].toString();C=this.namespaces[D.substring(0,D.indexOf(":"))]||null;this.setAttributeNS(B,C,D,E)}}},readNode:function(C,B){if(!B){B={}}var A=this.readers[C.namespaceURI?this.namespaceAlias[C.namespaceURI]:this.defaultPrefix];if(A){var E=C.localName||C.nodeName.split(":").pop();var D=A[E]||A["*"];if(D){D.apply(this,[C,B])}}return B},readChildNodes:function(D,C){if(!C){C={}}var F=D.childNodes;var A;for(var B=0,E=F.length;B<E;++B){A=F[B];if(A.nodeType==1){this.readNode(A,C)}}return C},writeNode:function(E,B,F){var C,G;var A=E.indexOf(":");if(A>0){C=E.substring(0,A);G=E.substring(A+1)}else{if(F){C=this.namespaceAlias[F.namespaceURI]}else{C=this.defaultPrefix}G=E}var D=this.writers[C][G].apply(this,[B]);if(F){F.appendChild(D)}return D},getChildEl:function(B,C,A){return B&&this.getThisOrNextEl(B.firstChild,C,A)},getNextEl:function(B,C,A){return B&&this.getThisOrNextEl(B.nextSibling,C,A)},getThisOrNextEl:function(C,D,A){outer:for(var B=C;B;B=B.nextSibling){switch(B.nodeType){case 1:if((!D||D===(B.localName||B.nodeName.split(":").pop()))&&(!A||A===B.namespaceURI)){break outer}B=null;break outer;case 3:if(/^\s*$/.test(B.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:B=null;break outer}}return B||null},lookupNamespaceURI:function(C,B){var D=null;if(C){if(C.lookupNamespaceURI){D=C.lookupNamespaceURI(B)}else{outer:switch(C.nodeType){case 1:if(C.namespaceURI!==null&&C.prefix===B){D=C.namespaceURI;break outer}var E=C.attributes.length;if(E){var F;for(var A=0;A<E;++A){F=C.attributes[A];if(F.prefix==="xmlns"&&F.name==="xmlns:"+B){D=F.value||null;break outer}else{if(F.name==="xmlns"&&B===null){D=F.value||null;break outer}}}}D=this.lookupNamespaceURI(C.parentNode,B);break outer;case 2:D=this.lookupNamespaceURI(C.ownerElement,B);break outer;case 9:D=this.lookupNamespaceURI(C.documentElement,B);break outer;case 6:case 12:case 10:case 11:break outer;default:D=this.lookupNamespaceURI(C.parentNode,B);break outer}}}return D},getXMLDoc:function(){if(!HGIS.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){HGIS.Format.XML.document=document.implementation.createDocument("","",null)}else{if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}}}return HGIS.Format.XML.document||this.xmldom},CLASS_NAME:"HGIS.Format.XML"});HGIS.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};HGIS.Format.XML.lookupNamespaceURI=HGIS.Function.bind(HGIS.Format.XML.prototype.lookupNamespaceURI,HGIS.Format.XML.prototype);HGIS.Format.XML.document=null;HGIS.Format.WFST=function(B){B=HGIS.Util.applyDefaults(B,HGIS.Format.WFST.DEFAULTS);var A=HGIS.Format.WFST["v"+B.version.replace(/\./g,"_")];if(!A){throw"Unsupported WFST version: "+B.version}return new A(B)};HGIS.Format.WFST.DEFAULTS={"version":"1.0.0"};HGIS.Feature=HGIS.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(B,A,C){this.layer=B;this.lonlat=A;this.data=(C!=null)?C:{};this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var B=false;if((this.layer!=null)&&(this.layer.map!=null)){var A=this.layer.map.getExtent();B=A.containsLonLat(this.lonlat)}return B},createMarker:function(){if(this.lonlat!=null){this.marker=new HGIS.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(A){if(this.lonlat!=null){if(!this.popup){var B=(this.marker)?this.marker.icon:null;var C=this.popupClass?this.popupClass:HGIS.Popup.Anchored;this.popup=new C(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,B,A)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"HGIS.Feature"});HGIS.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};HGIS.Feature.Vector=HGIS.Class(HGIS.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(C,A,B){HGIS.Feature.prototype.initialize.apply(this,[null,null,A]);this.lonlat=null;this.geometry=C?C:null;this.state=null;this.attributes={};if(A){this.attributes=HGIS.Util.extend(this.attributes,A)}this.style=B?B:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;HGIS.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new HGIS.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(A){var E=false;if(this.layer&&this.layer.map){var D=this.layer.map.getExtent();if(A){var B=this.geometry.getBounds();E=D.intersectsBounds(B)}else{var C=D.toGeometry();E=C.intersects(this.geometry)}}return E},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(B,C,D){var A=false;if(this.geometry){A=this.geometry.atPoint(B,C,D)}return A},destroyPopup:function(){},move:function(B){if(!this.layer||!this.geometry.move){return undefined}var A;if(B.CLASS_NAME=="HGIS.LonLat"){A=this.layer.getViewPortPxFromLonLat(B)}else{A=B}var C=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var D=this.layer.map.getResolution();this.geometry.move(D*(A.x-C.x),D*(C.y-A.y));this.layer.drawFeature(this);return C},toState:function(A){if(A==HGIS.State.UPDATE){switch(this.state){case HGIS.State.UNKNOWN:case HGIS.State.DELETE:this.state=A;break;case HGIS.State.UPDATE:case HGIS.State.INSERT:break}}else{if(A==HGIS.State.INSERT){switch(this.state){case HGIS.State.UNKNOWN:break;default:this.state=A;break}}else{if(A==HGIS.State.DELETE){switch(this.state){case HGIS.State.INSERT:break;case HGIS.State.DELETE:break;case HGIS.State.UNKNOWN:case HGIS.State.UPDATE:this.state=A;break}}else{if(A==HGIS.State.UNKNOWN){this.state=A}}}}},CLASS_NAME:"HGIS.Feature.Vector"});HGIS.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"select":{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"temporary":{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};HGIS.Style=HGIS.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(B,A){HGIS.Util.extend(this,A);this.rules=[];if(A&&A.rules){this.addRules(A.rules)}this.setDefaultStyle(B||HGIS.Feature.Vector.style["default"]);this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var A=0,B=this.rules.length;A<B;A++){this.rules[A].destroy();this.rules[A]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(I){var E=this.defaultsPerSymbolizer?{}:this.createLiterals(HGIS.Util.extend({},this.defaultStyle),I);var B=this.rules;var H,C;var A=[];var F=false;for(var D=0,G=B.length;D<G;D++){H=B[D];var J=H.evaluate(I);if(J){if(H instanceof HGIS.Rule&&H.elseFilter){A.push(H)}else{F=true;this.applySymbolizer(H,E,I)}}}if(F==false&&A.length>0){F=true;for(var D=0,G=A.length;D<G;D++){this.applySymbolizer(A[D],E,I)}}if(B.length>0&&F==false){E.display="none"}if(E.label!=null&&typeof E.label!=="string"){E.label=String(E.label)}if(I.type==1&&E.label!==undefined&&E.label!=="undefined"){E.label=this.insertLinebreak(E.label,8)}return E},insertLinebreak:function(B,C){var A=B.length;if(A>C){return B.substr(0,A/2)+"\n"+B.substr(A/2,A-1)}return B},applySymbolizer:function(C,D,B){var E=HGIS.Style.SYMBOLIZER_PREFIXES[0];if(B.geometry&&B.geometry.CLASS_NAME){E=this.getSymbolizerPrefix(B.geometry)}else{if(B.type==2){E=HGIS.Style.SYMBOLIZER_PREFIXES[1]}else{if(B.type==3){E=HGIS.Style.SYMBOLIZER_PREFIXES[2]}}}var A=C.symbolizer[E]||C.symbolizer;if(this.defaultsPerSymbolizer===true){var F=this.defaultStyle;HGIS.Util.applyDefaults(A,{pointRadius:F.pointRadius});if(A.stroke===true||A.graphic===true){HGIS.Util.applyDefaults(A,{strokeWidth:F.strokeWidth,strokeColor:F.strokeColor,strokeOpacity:F.strokeOpacity,strokeDashstyle:F.strokeDashstyle,strokeLinecap:F.strokeLinecap})}if(A.fill===true||A.graphic===true){HGIS.Util.applyDefaults(A,{fillColor:F.fillColor,fillOpacity:F.fillOpacity})}if(A.graphic===true){HGIS.Util.applyDefaults(A,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(HGIS.Util.extend(D,A),B)},createLiterals:function(D,B){var A=HGIS.Util.extend({},B.attributes||B.data);HGIS.Util.extend(A,this.context);for(var C in this.propertyStyles){D[C]=HGIS.Style.createLiteral(D[C],A,B,C)}return D},findPropertyStyles:function(){var F={};var E=this.defaultStyle;this.addPropertyStyles(F,E);var B=this.rules;var H,C;for(var D=0,G=B.length;D<G;D++){H=B[D].symbolizer;for(var A in H){C=H[A];if(typeof C=="object"){this.addPropertyStyles(F,C)}else{this.addPropertyStyles(F,H);break}}}return F},addPropertyStyles:function(C,B){var D;for(var A in B){D=B[A];if(typeof D=="string"&&D.match(/\$\{\w+\}/)){C[A]=true}}return C},addRules:function(A){Array.prototype.push.apply(this.rules,A);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(A){this.defaultStyle=A;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(C){var B=HGIS.Style.SYMBOLIZER_PREFIXES;for(var A=0,D=B.length;A<D;A++){if(C.CLASS_NAME.indexOf(B[A])!=-1){return B[A]}}},clone:function(){var C=HGIS.Util.extend({},this);if(this.rules){C.rules=[];for(var A=0,D=this.rules.length;A<D;++A){C.rules.push(this.rules[A].clone())}}C.context=this.context&&HGIS.Util.extend({},this.context);var B=HGIS.Util.extend({},this.defaultStyle);return new HGIS.Style(B,C)},CLASS_NAME:"HGIS.Style"});HGIS.Style.createLiteral=function(C,A,D,B){if(typeof C=="string"&&C.indexOf("${")!=-1){C=HGIS.String.format(C,A,[D,B]);C=(isNaN(C)||!C)?C:parseFloat(C)}return C};HGIS.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];HGIS.Filter=HGIS.Class({initialize:function(A){HGIS.Util.extend(this,A)},destroy:function(){},evaluate:function(A){return true},clone:function(){return null},toString:function(){var A;if(HGIS.Format&&HGIS.Format.CQL){A=HGIS.Format.CQL.prototype.write(this)}else{A=Object.prototype.toString.call(this)}return A},CLASS_NAME:"HGIS.Filter"});HGIS.Filter.Spatial=HGIS.Class(HGIS.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(A){var B=false;switch(this.type){case HGIS.Filter.Spatial.BBOX:case HGIS.Filter.Spatial.INTERSECTS:if(A.geometry){var C=this.value;if(this.value.CLASS_NAME=="HGIS.Bounds"){C=this.value.toGeometry()}if(A.geometry.intersects(C)){B=true}}break;default:throw new Error("evaluate is not implemented for this filter type.")}return B},clone:function(){var A=HGIS.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new HGIS.Filter.Spatial(A)},CLASS_NAME:"HGIS.Filter.Spatial"});HGIS.Filter.Spatial.BBOX="BBOX";HGIS.Filter.Spatial.INTERSECTS="INTERSECTS";HGIS.Filter.Spatial.DWITHIN="DWITHIN";HGIS.Filter.Spatial.WITHIN="WITHIN";HGIS.Filter.Spatial.CONTAINS="CONTAINS";HGIS.Filter.FeatureId=HGIS.Class(HGIS.Filter,{fids:null,type:"FID",initialize:function(A){this.fids=[];HGIS.Filter.prototype.initialize.apply(this,[A])},evaluate:function(A){for(var B=0,C=this.fids.length;B<C;B++){var D=A.fid||A.id;if(D==this.fids[B]){return true}}return false},clone:function(){var A=new HGIS.Filter.FeatureId();HGIS.Util.extend(A,this);A.fids=this.fids.slice();return A},CLASS_NAME:"HGIS.Filter.FeatureId"});HGIS.Format.WFST.v1=HGIS.Class(HGIS.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(A){this.stateName={};this.stateName[HGIS.State.INSERT]="wfs:Insert";this.stateName[HGIS.State.UPDATE]="wfs:Update";this.stateName[HGIS.State.DELETE]="wfs:Delete";HGIS.Format.XML.prototype.initialize.apply(this,[A])},getSrsName:function(A,C){var B=C&&C.srsName;if(!B){if(A&&A.layer){B=A.layer.projection.getCode()}else{B=this.srsName}}return B},read:function(C,B){B=B||{};HGIS.Util.applyDefaults(B,{output:"features"});if(typeof C=="string"){C=HGIS.Format.XML.prototype.read.apply(this,[C])}if(C&&C.nodeType==9){C=C.documentElement}var A={};if(C){this.readNode(C,A,true)}if(A.features&&B.output==="features"){A=A.features}return A},readers:{"wfs":{"FeatureCollection":function(B,A){A.features=[];this.readChildNodes(B,A)}}},write:function(A,C){var B=this.writeNode("wfs:Transaction",{features:A,options:C});var D=this.schemaLocationAttr();if(D){this.setAttributeNS(B,this.namespaces["xsi"],"xsi:schemaLocation",D)}return HGIS.Format.XML.prototype.write.apply(this,[B])},writers:{"wfs":{"GetFeature":function(C){var B=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:C&&C.handle,outputFormat:C&&C.outputFormat,maxFeatures:C&&C.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(C)}});if(typeof this.featureType=="string"){this.writeNode("Query",C,B)}else{for(var A=0,D=this.featureType.length;A<D;A++){C.featureType=this.featureType[A];this.writeNode("Query",C,B)}}return B},"Transaction":function(F){F=F||{};var D=F.options||{};var E=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:D.handle}});var C,G;var B=F.features;if(B){if(D.multi===true){HGIS.Util.extend(this.geometryTypes,{"HGIS.Geometry.Point":"MultiPoint","HGIS.Geometry.LineString":(this.multiCurve===true)?"MultiCurve":"MultiLineString","HGIS.Geometry.Polygon":(this.multiSurface===true)?"MultiSurface":"MultiPolygon"})}var A,H;for(C=0,G=B.length;C<G;++C){H=B[C];A=this.stateName[H.state];if(A){this.writeNode(A,{feature:H,options:D},E)}}if(D.multi===true){this.setGeometryTypes()}}if(D.nativeElements){for(C=0,G=D.nativeElements.length;C<G;++C){this.writeNode("wfs:Native",D.nativeElements[C],E)}}return E},"Native":function(B){var A=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:B.vendorId,safeToIgnore:B.safeToIgnore},value:B.value});return A},"Insert":function(B){var A=B.feature;var D=B.options;var C=this.createElementNSPlus("wfs:Insert",{attributes:{handle:D&&D.handle}});this.srsName=this.getSrsName(A);this.writeNode("feature:_typeName",A,C);return C},"Update":function(C){var B=C.feature;var E=C.options;var D=this.createElementNSPlus("wfs:Update",{attributes:{handle:E&&E.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){D.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}var A=B.modified;if(this.geometryName!==null&&(!A||A.geometry!==undefined)){this.srsName=this.getSrsName(B);this.writeNode("Property",{name:this.geometryName,value:B.geometry},D)}for(var F in B.attributes){if(B.attributes[F]!==undefined&&(!A||!A.attributes||(A.attributes&&A.attributes[F]!==undefined))){this.writeNode("Property",{name:F,value:B.attributes[F]},D)}}this.writeNode("ogc:Filter",new HGIS.Filter.FeatureId({fids:[B.fid]}),D);return D},"Property":function(A){var B=this.createElementNSPlus("wfs:Property");this.writeNode("Name",A.name,B);if(A.value!==null){this.writeNode("Value",A.value,B)}return B},"Name":function(A){return this.createElementNSPlus("wfs:Name",{value:A})},"Value":function(A){var B;if(A instanceof HGIS.Geometry){B=this.createElementNSPlus("wfs:Value");var C=this.writeNode("feature:_geometry",A).firstChild;B.appendChild(C)}else{B=this.createElementNSPlus("wfs:Value",{value:A})}return B},"Delete":function(B){var A=B.feature;var D=B.options;var C=this.createElementNSPlus("wfs:Delete",{attributes:{handle:D&&D.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){C.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("ogc:Filter",new HGIS.Filter.FeatureId({fids:[A.fid]}),C);return C}}},schemaLocationAttr:function(D){D=HGIS.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},D);var E=HGIS.Util.extend({},this.schemaLocations);if(D.schema){E[D.featurePrefix]=D.schema}var A=[];var B;for(var F in E){B=this.namespaces[F];if(B){A.push(B+" "+E[F])}}var C=A.join(" ")||undefined;return C},setFilterProperty:function(B){if(B.filters){for(var A=0,C=B.filters.length;A<C;++A){HGIS.Format.WFST.v1.prototype.setFilterProperty.call(this,B.filters[A])}}else{if(B instanceof HGIS.Filter.Spatial&&!B.property){B.property=this.geometryName}}},CLASS_NAME:"HGIS.Format.WFST.v1"});HGIS.Format.OGCExceptionReport=HGIS.Class(HGIS.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},defaultPrefix:"ogc",read:function(D){var C;if(typeof D=="string"){D=HGIS.Format.XML.prototype.read.apply(this,[D])}var B=D.documentElement;var A={exceptionReport:null};if(B){this.readChildNodes(D,A);if(A.exceptionReport===null){A=new HGIS.Format.OWSCommon().read(D)}}return A},readers:{"ogc":{"ServiceExceptionReport":function(B,A){A.exceptionReport={exceptions:[]};this.readChildNodes(B,A.exceptionReport)},"ServiceException":function(B,C){var A={code:B.getAttribute("code"),locator:B.getAttribute("locator"),text:this.getChildValue(B)};C.exceptions.push(A)}}},CLASS_NAME:"HGIS.Format.OGCExceptionReport"});HGIS.Format.XML.VersionedOGC=HGIS.Class(HGIS.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:false,name:null,stringifyOutput:false,parser:null,initialize:function(B){HGIS.Format.XML.prototype.initialize.apply(this,[B]);var A=this.CLASS_NAME;this.name=A.substring(A.lastIndexOf(".")+1)},getVersion:function(A,B){var C;if(A){C=this.version;if(!C){C=A.getAttribute("version");if(!C){C=this.defaultVersion}}}else{C=(B&&B.version)||this.version||this.defaultVersion}return C},getParser:function(C){C=C||this.defaultVersion;var B=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=C){var A=HGIS.Format[this.name]["v"+C.replace(/\./g,"_")+B];if(!A){if(B!==""&&this.allowFallback){B="";A=HGIS.Format[this.name]["v"+C.replace(/\./g,"_")]}if(!A){throw"Can't find a "+this.name+" parser for version "+C+B}}this.parser=new A(this.options)}return this.parser},write:function(A,B){var D=this.getVersion(null,B);this.parser=this.getParser(D);var C=this.parser.write(A,B);if(this.stringifyOutput===false){return C}else{return HGIS.Format.XML.prototype.write.apply(this,[C])}},read:function(G,E){if(typeof G=="string"){G=HGIS.Format.XML.prototype.read.apply(this,[G])}var C=G.documentElement;var F=this.getVersion(C);this.parser=this.getParser(F);var D=this.parser.read(G,E);var B=this.parser.errorProperty||null;if(B!==null&&D[B]===undefined){var A=new HGIS.Format.OGCExceptionReport();D.error=A.read(G)}D.version=F;return D},CLASS_NAME:"HGIS.Format.XML.VersionedOGC"});HGIS.Filter.Logical=HGIS.Class(HGIS.Filter,{filters:null,type:null,initialize:function(A){this.filters=[];HGIS.Filter.prototype.initialize.apply(this,[A])},destroy:function(){this.filters=null;HGIS.Filter.prototype.destroy.apply(this)},evaluate:function(A){var B,C;switch(this.type){case HGIS.Filter.Logical.AND:for(B=0,C=this.filters.length;B<C;B++){if(this.filters[B].evaluate(A)==false){return false}}return true;case HGIS.Filter.Logical.OR:for(B=0,C=this.filters.length;B<C;B++){if(this.filters[B].evaluate(A)==true){return true}}return false;case HGIS.Filter.Logical.NOT:return(!this.filters[0].evaluate(A))}return undefined},clone:function(){var B=[];for(var A=0,C=this.filters.length;A<C;++A){B.push(this.filters[A].clone())}return new HGIS.Filter.Logical({type:this.type,filters:B})},CLASS_NAME:"HGIS.Filter.Logical"});HGIS.Filter.Logical.AND="&&";HGIS.Filter.Logical.OR="||";HGIS.Filter.Logical.NOT="!";HGIS.Filter.Comparison=HGIS.Class(HGIS.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(A){HGIS.Filter.prototype.initialize.apply(this,[A]);if(this.type===HGIS.Filter.Comparison.LIKE&&A.matchCase===undefined){this.matchCase=null}},evaluate:function(B){if(B instanceof HGIS.Feature.Vector){B=B.attributes}var C=false;var E=B[this.property];var D;switch(this.type){case HGIS.Filter.Comparison.EQUAL_TO:D=this.value;if(!this.matchCase&&typeof E=="string"&&typeof D=="string"){C=(E.toUpperCase()==D.toUpperCase())}else{C=(E==D)}break;case HGIS.Filter.Comparison.NOT_EQUAL_TO:D=this.value;if(!this.matchCase&&typeof E=="string"&&typeof D=="string"){C=(E.toUpperCase()!=D.toUpperCase())}else{C=(E!=D)}break;case HGIS.Filter.Comparison.LESS_THAN:C=E<this.value;break;case HGIS.Filter.Comparison.GREATER_THAN:C=E>this.value;break;case HGIS.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:C=E<=this.value;break;case HGIS.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:C=E>=this.value;break;case HGIS.Filter.Comparison.BETWEEN:C=(E>=this.lowerBoundary)&&(E<=this.upperBoundary);break;case HGIS.Filter.Comparison.LIKE:var A=new RegExp(this.value,"gi");C=A.test(E);break;case HGIS.Filter.Comparison.IS_NULL:C=(E===null);break}return C},value2regex:function(B,C,A){if(B=="."){throw new Error("'.' is an unsupported wildCard character for HGIS.Filter.Comparison")}B=B?B:"*";C=C?C:".";A=A?A:"!";this.value=this.value.replace(new RegExp("\\"+A+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+C,"g"),".");this.value=this.value.replace(new RegExp("\\"+B,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+B);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+C);return this.value},regex2value:function(){var A=this.value;A=A.replace(/!/g,"!!");A=A.replace(/(\\)?\\\./g,function(C,B){return B?C:"!."});A=A.replace(/(\\)?\\\*/g,function(C,B){return B?C:"!*"});A=A.replace(/\\\\/g,"\\");A=A.replace(/\.\*/g,"*");return A},clone:function(){return HGIS.Util.extend(new HGIS.Filter.Comparison(),this)},CLASS_NAME:"HGIS.Filter.Comparison"});HGIS.Filter.Comparison.EQUAL_TO="==";HGIS.Filter.Comparison.NOT_EQUAL_TO="!=";HGIS.Filter.Comparison.LESS_THAN="<";HGIS.Filter.Comparison.GREATER_THAN=">";HGIS.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";HGIS.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";HGIS.Filter.Comparison.BETWEEN="..";HGIS.Filter.Comparison.LIKE="~";HGIS.Filter.Comparison.IS_NULL="NULL";HGIS.Format.Filter=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"HGIS.Format.Filter"});HGIS.Filter.Function=HGIS.Class(HGIS.Filter,{name:null,params:null,CLASS_NAME:"HGIS.Filter.Function"});HGIS.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:(function(){if("toISOString" in Date.prototype){return function(A){return A.toISOString()}}else{return function(B){var A;if(isNaN(B.getTime())){A="Invalid Date"}else{A=B.getUTCFullYear()+"-"+HGIS.Number.zeroPad(B.getUTCMonth()+1,2)+"-"+HGIS.Number.zeroPad(B.getUTCDate(),2)+"T"+HGIS.Number.zeroPad(B.getUTCHours(),2)+":"+HGIS.Number.zeroPad(B.getUTCMinutes(),2)+":"+HGIS.Number.zeroPad(B.getUTCSeconds(),2)+"."+HGIS.Number.zeroPad(B.getUTCMilliseconds(),3)+"Z"}return A}}})(),parse:function(G){var O;var D=G.match(this.dateRegEx);if(D&&(D[1]||D[7])){var J=parseInt(D[1],10)||0;var C=(parseInt(D[2],10)-1)||0;var H=parseInt(D[3],10)||1;O=new Date(Date.UTC(J,C,H));var L=D[7];if(L){var N=parseInt(D[4],10);var M=parseInt(D[5],10);var B=parseFloat(D[6]);var E=B|0;var A=Math.round(1000*(B-E));O.setUTCHours(N,M,E,A);if(L!=="Z"){var F=parseInt(L,10);var I=parseInt(D[8],10)||0;var K=-1000*(60*(F*60)+I*60);O=new Date(O.getTime()+K)}}}else{O=new Date("invalid")}return O}};HGIS.Format.Filter.v1=HGIS.Class(HGIS.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(B){var A={};this.readers.ogc["Filter"].apply(this,[B,A]);return A.filter},readers:{"ogc":{"_expression":function(C){var B,D="";for(var A=C.firstChild;A;A=A.nextSibling){switch(A.nodeType){case 1:B=this.readNode(A);if(B.property){D+="${"+B.property+"}"}else{if(B.value!==undefined){D+=B.value}}break;case 3:case 4:D+=A.nodeValue}}return D},"Filter":function(B,C){var A={fids:[],filters:[]};this.readChildNodes(B,A);if(A.fids.length>0){C.filter=new HGIS.Filter.FeatureId({fids:A.fids})}else{if(A.filters.length>0){C.filter=A.filters[0]}}},"FeatureId":function(B,A){var C=B.getAttribute("fid");if(C){A.fids.push(C)}},"And":function(B,A){var C=new HGIS.Filter.Logical({type:HGIS.Filter.Logical.AND});this.readChildNodes(B,C);A.filters.push(C)},"Or":function(B,A){var C=new HGIS.Filter.Logical({type:HGIS.Filter.Logical.OR});this.readChildNodes(B,C);A.filters.push(C)},"Not":function(B,A){var C=new HGIS.Filter.Logical({type:HGIS.Filter.Logical.NOT});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsLessThan":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.LESS_THAN});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsGreaterThan":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.GREATER_THAN});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsLessThanOrEqualTo":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsGreaterThanOrEqualTo":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsBetween":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.BETWEEN});this.readChildNodes(B,C);A.filters.push(C)},"Literal":function(B,A){A.value=HGIS.String.numericIf(this.getChildValue(B),true)},"PropertyName":function(A,B){B.property=this.getChildValue(A)},"LowerBoundary":function(A,B){B.lowerBoundary=HGIS.String.numericIf(this.readers.ogc._expression.call(this,A),true)},"UpperBoundary":function(A,B){B.upperBoundary=HGIS.String.numericIf(this.readers.ogc._expression.call(this,A),true)},"Intersects":function(B,A){this.readSpatial(B,A,HGIS.Filter.Spatial.INTERSECTS)},"Within":function(B,A){this.readSpatial(B,A,HGIS.Filter.Spatial.WITHIN)},"Contains":function(B,A){this.readSpatial(B,A,HGIS.Filter.Spatial.CONTAINS)},"DWithin":function(B,A){this.readSpatial(B,A,HGIS.Filter.Spatial.DWITHIN)},"Distance":function(B,A){A.distance=parseInt(this.getChildValue(B));A.distanceUnits=B.getAttribute("units")},"Function":function(B,A){return},"PropertyIsNull":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.IS_NULL});this.readChildNodes(B,C);A.filters.push(C)}}},readSpatial:function(C,B,A){var D=new HGIS.Filter.Spatial({type:A});this.readChildNodes(C,D);D.value=D.components[0];delete D.components;B.filters.push(D)},encodeLiteral:function(A){if(A instanceof Date){A=HGIS.Date.toISOString(A)}return A},writeOgcExpression:function(B,A){if(B instanceof HGIS.Filter.Function){this.writeNode("Function",B,A)}else{this.writeNode("Literal",B,A)}return A},write:function(A){return this.writers.ogc["Filter"].apply(this,[A])},writers:{"ogc":{"Filter":function(B){var A=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(B),B,A);return A},"_featureIds":function(C){var B=this.createDocumentFragment();for(var A=0,D=C.fids.length;A<D;++A){this.writeNode("ogc:FeatureId",C.fids[A],B)}return B},"FeatureId":function(A){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:A}})},"And":function(D){var C=this.createElementNSPlus("ogc:And");var A;for(var B=0,E=D.filters.length;B<E;++B){A=D.filters[B];this.writeNode(this.getFilterType(A),A,C)}return C},"Or":function(D){var C=this.createElementNSPlus("ogc:Or");var A;for(var B=0,E=D.filters.length;B<E;++B){A=D.filters[B];this.writeNode(this.getFilterType(A),A,C)}return C},"Not":function(C){var B=this.createElementNSPlus("ogc:Not");var A=C.filters[0];this.writeNode(this.getFilterType(A),A,B);return B},"PropertyIsLessThan":function(B){var A=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsGreaterThan":function(B){var A=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsLessThanOrEqualTo":function(B){var A=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsGreaterThanOrEqualTo":function(B){var A=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsBetween":function(B){var A=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",B,A);this.writeNode("LowerBoundary",B,A);this.writeNode("UpperBoundary",B,A);return A},"PropertyName":function(A){return this.createElementNSPlus("ogc:PropertyName",{value:A.property})},"Literal":function(B){var A=this.encodeLiteral||HGIS.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:A(B)})},"LowerBoundary":function(B){var A=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(B.lowerBoundary,A);return A},"UpperBoundary":function(B){var A=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",B.upperBoundary,A);return A},"INTERSECTS":function(A){return this.writeSpatial(A,"Intersects")},"WITHIN":function(A){return this.writeSpatial(A,"Within")},"CONTAINS":function(A){return this.writeSpatial(A,"Contains")},"DWITHIN":function(B){var A=this.writeSpatial(B,"DWithin");this.writeNode("Distance",B,A);return A},"Distance":function(A){return this.createElementNSPlus("ogc:Distance",{attributes:{units:A.distanceUnits},value:A.distance})},"Function":function(C){var B=this.createElementNSPlus("ogc:Function",{attributes:{name:C.name}});var E=C.params;for(var A=0,D=E.length;A<D;A++){this.writeOgcExpression(E[A],B)}return B},"PropertyIsNull":function(B){var A=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",B,A);return A}}},getFilterType:function(B){var A=this.filterMap[B.type];if(!A){throw"Filter writing not supported for rule type: "+B.type}return A},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike","NULL":"PropertyIsNull","BBOX":"BBOX","DWITHIN":"DWITHIN","WITHIN":"WITHIN","CONTAINS":"CONTAINS","INTERSECTS":"INTERSECTS","FID":"_featureIds"},CLASS_NAME:"HGIS.Format.Filter.v1"});HGIS.Geometry=HGIS.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new HGIS.Geometry()},setBounds:function(A){if(A){this.bounds=A.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(B){var A=this.getBounds();if(!A){this.setBounds(B)}else{this.bounds.extend(B)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(B,A){},getVertices:function(A){},atPoint:function(G,E,A){var H=false;var C=this.getBounds();if((C!=null)&&(G!=null)){var D=(E!=null)?E:0;var F=(A!=null)?A:0;var B=new HGIS.Bounds(this.bounds.left-D,this.bounds.bottom-F,this.bounds.right+D,this.bounds.top+F);H=B.containsLonLat(G)}return H},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var A;if(HGIS.Format&&HGIS.Format.WKT){A=HGIS.Format.WKT.prototype.write(new HGIS.Feature.Vector(this))}else{A=Object.prototype.toString.call(this)}return A},CLASS_NAME:"HGIS.Geometry"});HGIS.Geometry.fromWKT=function(F){var G;if(HGIS.Format&&HGIS.Format.WKT){var B=HGIS.Geometry.fromWKT.format;if(!B){B=new HGIS.Format.WKT();HGIS.Geometry.fromWKT.format=B}var C=B.read(F);if(C instanceof HGIS.Feature.Vector){G=C.geometry}else{if(HGIS.Util.isArray(C)){var D=C.length;var E=new Array(D);for(var A=0;A<D;++A){E[A]=C[A].geometry}G=new HGIS.Geometry.Collection(E)}}}return G};HGIS.Geometry.segmentsIntersect=function(D,F,U){var C=U&&U.point;var Y=U&&U.tolerance;var V=false;var T=D.x1-F.x1;var O=D.y1-F.y1;var B=D.x2-D.x1;var G=D.y2-D.y1;var J=F.y2-F.y1;var E=F.x2-F.x1;var L=(J*B)-(E*G);var N=(E*O)-(J*T);var I=(B*O)-(G*T);if(L==0){if(N==0&&I==0){V=true}}else{var b=N/L;var K=I/L;if(b>=0&&b<=1&&K>=0&&K<=1){if(!C){V=true}else{var M=D.x1+(b*B);var Z=D.y1+(b*G);V=new HGIS.Geometry.Point(M,Z)}}}if(Y){var R;if(V){if(C){var H=[D,F];var a,M,Z;outer:for(var X=0;X<2;++X){a=H[X];for(var A=1;A<3;++A){M=a["x"+A];Z=a["y"+A];R=Math.sqrt(Math.pow(M-V.x,2)+Math.pow(Z-V.y,2));if(R<Y){V.x=M;V.y=Z;break outer}}}}}else{var H=[D,F];var P,W,M,Z,S,Q;outer:for(var X=0;X<2;++X){P=H[X];W=H[(X+1)%2];for(var A=1;A<3;++A){S={x:P["x"+A],y:P["y"+A]};Q=HGIS.Geometry.distanceToSegment(S,W);if(Q.distance<Y){if(C){V=new HGIS.Geometry.Point(S.x,S.y)}else{V=true}break outer}}}}}return V};HGIS.Geometry.distanceToSegment=function(A,B){var C=HGIS.Geometry.distanceSquaredToSegment(A,B);C.distance=Math.sqrt(C.distance);return C};HGIS.Geometry.distanceSquaredToSegment=function(K,J){var G=K.x;var D=K.y;var A=J.x1;var B=J.y1;var C=J.x2;var E=J.y2;var H=C-A;var F=E-B;var I=((H*(G-A))+(F*(D-B)))/(Math.pow(H,2)+Math.pow(F,2));var L,M;if(I<=0){L=A;M=B}else{if(I>=1){L=C;M=E}else{L=A+I*H;M=B+I*F}}return{distance:Math.pow(L-G,2)+Math.pow(M-D,2),x:L,y:M,along:I}};HGIS.Geometry.Point=HGIS.Class(HGIS.Geometry,{x:null,y:null,initialize:function(A,B){HGIS.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(A);this.y=parseFloat(B)},clone:function(A){if(A==null){A=new HGIS.Geometry.Point(this.x,this.y)}HGIS.Util.applyDefaults(A,this);return A},calculateBounds:function(){this.bounds=new HGIS.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(F,I){var J=!(I&&I.edge===false);var G=J&&I&&I.details;var H,D,E,B,C,A;if(F instanceof HGIS.Geometry.Point){D=this.x;E=this.y;B=F.x;C=F.y;H=Math.sqrt(Math.pow(D-B,2)+Math.pow(E-C,2));A=!G?H:{x0:D,y0:E,x1:B,y1:C,distance:H}}else{A=F.distanceTo(this,I);if(G){A={x0:A.x1,y0:A.y1,x1:A.x0,y1:A.y0,distance:A.distance}}}return A},equals:function(B){var A=false;if(B!=null){A=((this.x==B.x&&this.y==B.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(B.x)&&isNaN(B.y)))}return A},toShortString:function(){return(this.x+", "+this.y)},move:function(A,B){this.x=this.x+A;this.y=this.y+B;this.clearBounds()},rotate:function(D,B){D*=Math.PI/180;var A=this.distanceTo(B);var C=D+Math.atan2(this.y-B.y,this.x-B.x);this.x=B.x+(A*Math.cos(C));this.y=B.y+(A*Math.sin(C));this.clearBounds()},getCentroid:function(){return new HGIS.Geometry.Point(this.x,this.y)},resize:function(C,A,B){B=(B==undefined)?1:B;this.x=A.x+(C*B*(this.x-A.x));this.y=A.y+(C*(this.y-A.y));this.clearBounds();return this},intersects:function(B){var A=false;if(B.CLASS_NAME=="HGIS.Geometry.Point"){A=this.equals(B)}else{A=B.intersects(this)}return A},transform:function(B,A){if((B&&A)){HGIS.Projection.transform(this,B,A);this.bounds=null}return this},getVertices:function(A){return[this]},CLASS_NAME:"HGIS.Geometry.Point"});HGIS.Geometry.Collection=HGIS.Class(HGIS.Geometry,{components:null,componentTypes:null,initialize:function(A){HGIS.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(A!=null){this.addComponents(A)}},destroy:function(){this.components.length=0;this.components=null;HGIS.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}HGIS.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){var B=[];for(var A=0,C=this.components.length;A<C;A++){B.push(this.components[A].toShortString())}return B.join(",")},calculateBounds:function(){this.bounds=null;var B=new HGIS.Bounds();var C=this.components;if(C){for(var A=0,D=C.length;A<D;A++){B.extend(C[A].getBounds())}}if(B.left!=null&&B.bottom!=null&&B.right!=null&&B.top!=null){this.setBounds(B)}},addComponents:function(B){if(!(HGIS.Util.isArray(B))){B=[B]}for(var A=0,C=B.length;A<C;A++){this.addComponent(B[A])}},addComponent:function(C,D){var E=false;if(C){if(this.componentTypes==null||(HGIS.Util.indexOf(this.componentTypes,C.CLASS_NAME)>-1)){if(D!=null&&(D<this.components.length)){var A=this.components.slice(0,D);var B=this.components.slice(D,this.components.length);A.push(C);this.components=A.concat(B)}else{this.components.push(C)}C.parent=this;this.clearBounds();E=true}}return E},removeComponents:function(C){var A=false;if(!(HGIS.Util.isArray(C))){C=[C]}for(var B=C.length-1;B>=0;--B){A=this.removeComponent(C[B])||A}return A},removeComponent:function(A){HGIS.Util.removeItem(this.components,A);this.clearBounds();return true},getLength:function(){var A=0;for(var B=0,C=this.components.length;B<C;B++){A+=this.components[B].getLength()}return A},getArea:function(){var C=0;for(var A=0,B=this.components.length;A<B;A++){C+=this.components[A].getArea()}return C},getGeodesicArea:function(B){var D=0;for(var A=0,C=this.components.length;A<C;A++){D+=this.components[A].getGeodesicArea(B)}return D},getCentroid:function(B){if(!B){return this.components.length&&this.components[0].getCentroid()}var K=this.components.length;if(!K){return false}var F=[];var H=[];var D=0;var A=Number.MAX_VALUE;var I;for(var G=0;G<K;++G){I=this.components[G];var C=I.getArea();var L=I.getCentroid(true);if(isNaN(C)||isNaN(L.x)||isNaN(L.y)){continue}F.push(C);D+=C;A=(C<A&&C>0)?C:A;H.push(L)}K=F.length;if(D===0){for(var G=0;G<K;++G){F[G]=1}D=F.length}else{for(var G=0;G<K;++G){F[G]/=A}D/=A}var E=0,J=0,L,C;for(var G=0;G<K;++G){L=H[G];C=F[G];E+=L.x*C;J+=L.y*C}return new HGIS.Geometry.Point(E/D,J/D)},getGeodesicLength:function(C){var A=0;for(var B=0,D=this.components.length;B<D;B++){A+=this.components[B].getGeodesicLength(C)}return A},move:function(B,C){for(var A=0,D=this.components.length;A<D;A++){this.components[A].move(B,C)}},rotate:function(D,C){for(var A=0,B=this.components.length;A<B;++A){this.components[A].rotate(D,C)}},resize:function(D,A,C){for(var B=0;B<this.components.length;++B){this.components[B].resize(D,A,C)}return this},distanceTo:function(J,F){var H=!(F&&F.edge===false);var D=H&&F&&F.details;var A,C,E;var B=Number.POSITIVE_INFINITY;for(var G=0,I=this.components.length;G<I;++G){A=this.components[G].distanceTo(J,F);E=D?A.distance:A;if(E<B){B=E;C=A;if(B==0){break}}}return C},equals:function(C){var A=true;if(!C||!C.CLASS_NAME||(this.CLASS_NAME!=C.CLASS_NAME)){A=false}else{if(!(HGIS.Util.isArray(C.components))||(C.components.length!=this.components.length)){A=false}else{for(var B=0,D=this.components.length;B<D;++B){if(!this.components[B].equals(C.components[B])){A=false;break}}}}return A},transform:function(C,B){if(C&&B){for(var A=0,E=this.components.length;A<E;A++){var D=this.components[A];D.transform(C,B)}this.bounds=null}return this},intersects:function(C){var B=false;for(var A=0,D=this.components.length;A<D;++A){B=C.intersects(this.components[A]);if(B){break}}return B},getVertices:function(C){var B=[];for(var A=0,D=this.components.length;A<D;++A){Array.prototype.push.apply(B,this.components[A].getVertices(C))}return B},CLASS_NAME:"HGIS.Geometry.Collection"});HGIS.Geometry.MultiPoint=HGIS.Class(HGIS.Geometry.Collection,{componentTypes:["HGIS.Geometry.Point"],addPoint:function(A,B){this.addComponent(A,B)},removePoint:function(A){this.removeComponent(A)},CLASS_NAME:"HGIS.Geometry.MultiPoint"});HGIS.Geometry.Curve=HGIS.Class(HGIS.Geometry.MultiPoint,{componentTypes:["HGIS.Geometry.Point"],getLength:function(){var A=0;if(this.components&&(this.components.length>1)){for(var B=1,C=this.components.length;B<C;B++){A+=this.components[B-1].distanceTo(this.components[B])}}return A},getGeodesicLength:function(B){var E=this;if(B){var H=new HGIS.Projection("EPSG:4326");if(!H.equals(B)){E=this.clone().transform(B,H)}}var C=0;if(E.components&&(E.components.length>1)){var A,F;for(var D=1,G=E.components.length;D<G;D++){A=E.components[D-1];F=E.components[D];C+=HGIS.Util.distVincenty({lon:A.x,lat:A.y},{lon:F.x,lat:F.y})}}return C*1000},CLASS_NAME:"HGIS.Geometry.Curve"});HGIS.Geometry.LineString=HGIS.Class(HGIS.Geometry.Curve,{removeComponent:function(B){var A=this.components&&(this.components.length>2);if(A){HGIS.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}return A},intersects:function(N){var H=false;var P=N.CLASS_NAME;if(P=="HGIS.Geometry.LineString"||P=="HGIS.Geometry.LinearRing"||P=="HGIS.Geometry.Point"){var M=this.getSortedSegments();var L;if(P=="HGIS.Geometry.Point"){L=[{x1:N.x,y1:N.y,x2:N.x,y2:N.y}]}else{L=N.getSortedSegments()}var B,F,I,Q,K,D,J,G;outer:for(var E=0,A=M.length;E<A;++E){B=M[E];F=B.x1;I=B.x2;Q=B.y1;K=B.y2;inner:for(var C=0,O=L.length;C<O;++C){D=L[C];if(D.x1>I){break}if(D.x2<F){continue}J=D.y1;G=D.y2;if(Math.min(J,G)>Math.max(Q,K)){continue}if(Math.max(J,G)<Math.min(Q,K)){continue}if(HGIS.Geometry.segmentsIntersect(B,D)){H=true;break outer}}}}else{H=N.intersects(this)}return H},getSortedSegments:function(){var D=this.components.length-1;var B=new Array(D),E,F;for(var A=0;A<D;++A){E=this.components[A];F=this.components[A+1];if(E.x<F.x){B[A]={x1:E.x,y1:E.y,x2:F.x,y2:F.y}}else{B[A]={x1:F.x,y1:F.y,x2:E.x,y2:E.y}}}function C(H,G){return H.x1-G.x1}return B.sort(C)},splitWithSegment:function(T,P){var A=!(P&&P.edge===false);var R=P&&P.tolerance;var J=[];var S=this.getVertices();var K=[];var G=[];var U=false;var F,I,B;var O,H,Q;var N={point:true,tolerance:R};var C=null;for(var D=0,L=S.length-2;D<=L;++D){F=S[D];K.push(F.clone());I=S[D+1];Q={x1:F.x,y1:F.y,x2:I.x,y2:I.y};B=HGIS.Geometry.segmentsIntersect(T,Q,N);if(B instanceof HGIS.Geometry.Point){if((B.x===T.x1&&B.y===T.y1)||(B.x===T.x2&&B.y===T.y2)||B.equals(F)||B.equals(I)){H=true}else{H=false}if(H||A){if(!B.equals(G[G.length-1])){G.push(B.clone())}if(D===0){if(B.equals(F)){continue}}if(B.equals(I)){continue}U=true;if(!B.equals(F)){K.push(B)}J.push(new HGIS.Geometry.LineString(K));K=[B.clone()]}}}if(U){K.push(I.clone());J.push(new HGIS.Geometry.LineString(K))}if(G.length>0){var E=T.x1<T.x2?1:-1;var M=T.y1<T.y2?1:-1;C={lines:J,points:G.sort(function(V,W){return(E*V.x-E*W.x)||(M*V.y-M*W.y)})}}return C},split:function(P,N){var T=null;var E=N&&N.mutual;var L,K,M,F;if(P instanceof HGIS.Geometry.LineString){var R=this.getVertices();var I,G,S,U,B,C;var J=[];M=[];for(var Q=0,A=R.length-2;Q<=A;++Q){I=R[Q];G=R[Q+1];S={x1:I.x,y1:I.y,x2:G.x,y2:G.y};F=F||[P];if(E){J.push(I.clone())}for(var D=0;D<F.length;++D){U=F[D].splitWithSegment(S,N);if(U){B=U.lines;if(B.length>0){B.unshift(D,1);Array.prototype.splice.apply(F,B);D+=B.length-2}if(E){for(var O=0,H=U.points.length;O<H;++O){C=U.points[O];if(!C.equals(I)){J.push(C);M.push(new HGIS.Geometry.LineString(J));if(C.equals(G)){J=[]}else{J=[C.clone()]}}}}}}}if(E&&M.length>0&&J.length>0){J.push(G.clone());M.push(new HGIS.Geometry.LineString(J))}}else{T=P.splitWith(this,N)}if(F&&F.length>1){K=true}else{F=[]}if(M&&M.length>1){L=true}else{M=[]}if(K||L){if(E){T=[M,F]}else{T=F}}return T},splitWith:function(B,A){return B.split(this,A)},getVertices:function(B){var A;if(B===true){A=[this.components[0],this.components[this.components.length-1]]}else{if(B===false){A=this.components.slice(1,this.components.length-1)}else{A=this.components.slice()}}return A},distanceTo:function(U,R){var A=!(R&&R.edge===false);var M=A&&R&&R.details;var E,J={};var N=Number.POSITIVE_INFINITY;if(U instanceof HGIS.Geometry.Point){var I=this.getSortedSegments();var V=U.x;var W=U.y;var X;for(var G=0,C=I.length;G<C;++G){X=I[G];E=HGIS.Geometry.distanceToSegment(U,X);if(E.distance<N){N=E.distance;J=E;if(N===0){break}}else{if(X.x2>V&&((W>X.y1&&W<X.y2)||(W<X.y1&&W>X.y2))){break}}}if(M){J={distance:J.distance,x0:J.x,y0:J.y,x1:V,y1:W}}else{J=J.distance}}else{if(U instanceof HGIS.Geometry.LineString){var S=this.getSortedSegments();var T=U.getSortedSegments();var O,D,K,H,F;var Q=T.length;var B={point:true};outer:for(var G=0,C=S.length;G<C;++G){O=S[G];H=O.x1;F=O.y1;for(var L=0;L<Q;++L){D=T[L];K=HGIS.Geometry.segmentsIntersect(O,D,B);if(K){N=0;J={distance:0,x0:K.x,y0:K.y,x1:K.x,y1:K.y};break outer}else{E=HGIS.Geometry.distanceToSegment({x:H,y:F},D);if(E.distance<N){N=E.distance;J={distance:N,x0:H,y0:F,x1:E.x,y1:E.y}}}}}if(!M){J=J.distance}if(N!==0){if(O){E=U.distanceTo(new HGIS.Geometry.Point(O.x2,O.y2),R);var P=M?E.distance:E;if(P<N){if(M){J={distance:N,x0:E.x1,y0:E.y1,x1:E.x0,y1:E.y0}}else{J=P}}}}}else{J=U.distanceTo(this,R);if(M){J={distance:J.distance,x0:J.x1,y0:J.y1,x1:J.x0,y1:J.y0}}}}return J},simplify:function(C){if(this&&this!==null){var H=this.getVertices();if(H.length<3){return this}var F=function(L,K){return(L-K)};var E=function(M,R,P,L){var Q=0;var K=0;for(var N=R,O;N<P;N++){O=A(M[R],M[P],M[N]);if(O>Q){Q=O;K=N}}if(Q>L&&K!=R){I.push(K);E(M,R,K,L);E(M,K,P,L)}};var A=function(M,P,K){var L=Math.abs(0.5*(M.x*P.y+P.x*K.y+K.x*M.y-P.x*M.y-K.x*P.y-M.x*K.y));var N=Math.sqrt(Math.pow(M.x-P.x,2)+Math.pow(M.y-P.y,2));var O=L/N*2;return O};var J=0;var G=H.length-1;var I=[];I.push(J);I.push(G);while(H[J].equals(H[G])){G--;I.push(G)}E(H,J,G,C);var B=[];I.sort(F);for(var D=0;D<I.length;D++){B.push(H[I[D]])}return new HGIS.Geometry.LineString(B)}else{return this}},CLASS_NAME:"HGIS.Geometry.LineString"});HGIS.Geometry.MultiLineString=HGIS.Class(HGIS.Geometry.Collection,{componentTypes:["HGIS.Geometry.LineString"],split:function(N,I){var H=null;var B=I&&I.mutual;var F,C,E,M,A;var G=[];var O=[N];for(var J=0,L=this.components.length;J<L;++J){C=this.components[J];M=false;for(var D=0;D<O.length;++D){F=C.split(O[D],I);if(F){if(B){E=F[0];for(var K=0,P=E.length;K<P;++K){if(K===0&&G.length){G[G.length-1].addComponent(E[K])}else{G.push(new HGIS.Geometry.MultiLineString([E[K]]))}}M=true;F=F[1]}if(F.length){F.unshift(D,1);Array.prototype.splice.apply(O,F);break}}}if(!M){if(G.length){G[G.length-1].addComponent(C.clone())}else{G=[new HGIS.Geometry.MultiLineString(C.clone())]}}}if(G&&G.length>1){M=true}else{G=[]}if(O&&O.length>1){A=true}else{O=[]}if(M||A){if(B){H=[G,O]}else{H=O}}return H},splitWith:function(N,I){var H=null;var B=I&&I.mutual;var F,C,E,M,A,G,O;if(N instanceof HGIS.Geometry.LineString){O=[];G=[N];for(var J=0,L=this.components.length;J<L;++J){A=false;C=this.components[J];for(var D=0;D<G.length;++D){F=G[D].split(C,I);if(F){if(B){E=F[0];if(E.length){E.unshift(D,1);Array.prototype.splice.apply(G,E);D+=E.length-2}F=F[1];if(F.length===0){F=[C.clone()]}}for(var K=0,P=F.length;K<P;++K){if(K===0&&O.length){O[O.length-1].addComponent(F[K])}else{O.push(new HGIS.Geometry.MultiLineString([F[K]]))}}A=true}}if(!A){if(O.length){O[O.length-1].addComponent(C.clone())}else{O=[new HGIS.Geometry.MultiLineString([C.clone()])]}}}}else{H=N.split(this)}if(G&&G.length>1){M=true}else{G=[]}if(O&&O.length>1){A=true}else{O=[]}if(M||A){if(B){H=[G,O]}else{H=O}}return H},CLASS_NAME:"HGIS.Geometry.MultiLineString"});HGIS.Geometry.LinearRing=HGIS.Class(HGIS.Geometry.LineString,{componentTypes:["HGIS.Geometry.Point"],addComponent:function(B,D){var E=false;var A=this.components.pop();if(D!=null||!B.equals(A)){E=HGIS.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var C=this.components[0];HGIS.Geometry.Collection.prototype.addComponent.apply(this,[C]);return E},removeComponent:function(B){var A=this.components&&(this.components.length>3);if(A){this.components.pop();HGIS.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var C=this.components[0];HGIS.Geometry.Collection.prototype.addComponent.apply(this,[C])}return A},move:function(B,C){for(var A=0,D=this.components.length;A<D-1;A++){this.components[A].move(B,C)}},rotate:function(D,C){for(var A=0,B=this.components.length;A<B-1;++A){this.components[A].rotate(D,C)}},resize:function(E,A,C){for(var B=0,D=this.components.length;B<D-1;++B){this.components[B].resize(E,A,C)}return this},transform:function(C,B){if(C&&B){for(var A=0,E=this.components.length;A<E-1;A++){var D=this.components[A];D.transform(C,B)}this.bounds=null}return this},getCentroid:function(){if(this.components){var H=this.components.length;if(H>0&&H<=2){return this.components[0].clone()}else{if(H>2){var D=0;var F=0;var B=this.components[0].x;var C=this.components[0].y;var A=-1*this.getArea();if(A!=0){for(var E=0;E<H-1;E++){var G=this.components[E];var K=this.components[E+1];D+=(G.x+K.x-2*B)*((G.x-B)*(K.y-C)-(K.x-B)*(G.y-C));F+=(G.y+K.y-2*C)*((G.x-B)*(K.y-C)-(K.x-B)*(G.y-C))}var J=B+D/(6*A);var I=C+F/(6*A)}else{for(var E=0;E<H-1;E++){D+=this.components[E].x;F+=this.components[E].y}var J=D/(H-1);var I=F/(H-1)}return new HGIS.Geometry.Point(J,I)}else{return null}}}},getArea:function(){var F=0;if(this.components&&(this.components.length>2)){var E=0;for(var B=0,C=this.components.length;B<C-1;B++){var D=this.components[B];var A=this.components[B+1];E+=(D.x+A.x)*(A.y-D.y)}F=-E/2}return F},getGeodesicArea:function(C){var E=this;if(C){var H=new HGIS.Projection("EPSG:4326");if(!H.equals(C)){E=this.clone().transform(C,H)}}var B=0;var G=E.components&&E.components.length;if(G>2){var A,F;for(var D=0;D<G-1;D++){A=E.components[D];F=E.components[D+1];B+=HGIS.Util.rad(F.x-A.x)*(2+Math.sin(HGIS.Util.rad(A.y))+Math.sin(HGIS.Util.rad(F.y)))}B=B*6378137*6378137/2}return B},containsPoint:function(O){var L=HGIS.Number.limitSigDigs;var K=14;var P=L(O.x,K);var E=L(O.y,K);function A(U,V,W,S,T){return(U-T)*((S-V)/(T-W))+S}var G=this.components.length-1;var I,F,M,N,Q,R,C,J;var B=0;for(var D=0;D<G;++D){I=this.components[D];M=L(I.x,K);N=L(I.y,K);F=this.components[D+1];Q=L(F.x,K);R=L(F.y,K);if(N==R){if(E==N){if(M<=Q&&(P>=M&&P<=Q)||M>=Q&&(P<=M&&P>=Q)){B=-1;break}}continue}C=L(A(E,M,N,Q,R),K);if(C==P){if(N<R&&(E>=N&&E<=R)||N>R&&(E<=N&&E>=R)){B=-1;break}}if(C<=P){continue}if(M!=Q&&(C<Math.min(M,Q)||C>Math.max(M,Q))){continue}if(N<R&&(E>=N&&E<R)||N>R&&(E<N&&E>=R)){++B}}var H=(B==-1)?1:!!(B&1);return H},intersects:function(C){var B=false;if(C.CLASS_NAME=="HGIS.Geometry.Point"){B=this.containsPoint(C)}else{if(C.CLASS_NAME=="HGIS.Geometry.LineString"){B=C.intersects(this)}else{if(C.CLASS_NAME=="HGIS.Geometry.LinearRing"){B=HGIS.Geometry.LineString.prototype.intersects.apply(this,[C])}else{for(var A=0,D=C.components.length;A<D;++A){B=C.components[A].intersects(this);if(B){break}}}}}return B},getVertices:function(A){return(A===true)?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"HGIS.Geometry.LinearRing"});HGIS.Geometry.Polygon=HGIS.Class(HGIS.Geometry.Collection,{componentTypes:["HGIS.Geometry.LinearRing"],getArea:function(){var C=0;if(this.components&&(this.components.length>0)){C+=Math.abs(this.components[0].getArea());for(var A=1,B=this.components.length;A<B;A++){C-=Math.abs(this.components[A].getArea())}}return C},getGeodesicArea:function(B){var D=0;if(this.components&&(this.components.length>0)){D+=Math.abs(this.components[0].getGeodesicArea(B));for(var A=1,C=this.components.length;A<C;A++){D-=Math.abs(this.components[A].getGeodesicArea(B))}}return D},containsPoint:function(C){var E=this.components.length;var A=false;if(E>0){A=this.components[0].containsPoint(C);if(A!==1){if(A&&E>1){var D;for(var B=1;B<E;++B){D=this.components[B].containsPoint(C);if(D){if(D===1){A=1}else{A=false}break}}}}}return A},intersects:function(D){var C=false;var A,E;if(D.CLASS_NAME=="HGIS.Geometry.Point"){C=this.containsPoint(D)}else{if(D.CLASS_NAME=="HGIS.Geometry.LineString"||D.CLASS_NAME=="HGIS.Geometry.LinearRing"){for(A=0,E=this.components.length;A<E;++A){C=D.intersects(this.components[A]);if(C){break}}if(!C){for(A=0,E=D.components.length;A<E;++A){C=this.containsPoint(D.components[A]);if(C){break}}}}else{for(A=0,E=D.components.length;A<E;++A){C=this.intersects(D.components[A]);if(C){break}}}}if(!C&&D.CLASS_NAME=="HGIS.Geometry.Polygon"){var B=this.components[0];for(A=0,E=B.components.length;A<E;++A){C=D.containsPoint(B.components[A]);if(C){break}}}return C},distanceTo:function(D,C){var B=!(C&&C.edge===false);var A;if(!B&&this.intersects(D)){A=0}else{A=HGIS.Geometry.Collection.prototype.distanceTo.apply(this,[D,C])}return A},CLASS_NAME:"HGIS.Geometry.Polygon"});HGIS.Geometry.Polygon.createRegularPolygon=function(D,E,J,I){var F=Math.PI*((1/J)-(1/2));if(I){F+=(I/180)*Math.PI}var K,G,H;var B=[];for(var C=0;C<J;++C){K=F+(C*2*Math.PI/J);G=D.x+(E*Math.cos(K));H=D.y+(E*Math.sin(K));B.push(new HGIS.Geometry.Point(G,H))}var A=new HGIS.Geometry.LinearRing(B);return new HGIS.Geometry.Polygon([A])};HGIS.Geometry.MultiPolygon=HGIS.Class(HGIS.Geometry.Collection,{componentTypes:["HGIS.Geometry.Polygon"],CLASS_NAME:"HGIS.Geometry.MultiPolygon"});HGIS.Format.GML=HGIS.Class(HGIS.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(A){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(E){if(typeof E=="string"){E=HGIS.Format.XML.prototype.read.apply(this,[E])}var C=this.getElementsByTagNameNS(E.documentElement,this.gmlns,this.featureName);var A=[];for(var B=0;B<C.length;B++){var D=this.parseFeature(C[B]);if(D){A.push(D)}}return A},parseFeature:function(N){var F=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var Q,K,P,B;for(var E=0;E<F.length;++E){Q=F[E];K=this.getElementsByTagNameNS(N,this.gmlns,Q);if(K.length>0){B=this.parseGeometry[Q.toLowerCase()];if(B){P=B.apply(this,[K[0]]);if(this.internalProjection&&this.externalProjection){P.transform(this.externalProjection,this.internalProjection)}}else{throw new TypeError("Unsupported geometry type: "+Q)}break}}var M;var A=this.getElementsByTagNameNS(N,this.gmlns,"Box");for(E=0;E<A.length;++E){var C=A[E];var D=this.parseGeometry["box"].apply(this,[C]);var L=C.parentNode;var G=L.localName||L.nodeName.split(":").pop();if(G==="boundedBy"){M=D}else{P=D.toGeometry()}}var O;if(this.extractAttributes){O=this.parseAttributes(N)}var I=new HGIS.Feature.Vector(P,O);I.bounds=M;I.gml={featureType:N.firstChild.nodeName.split(":")[1],featureNS:N.firstChild.namespaceURI,featureNSPrefix:N.firstChild.prefix};var J=N.firstChild;var H;while(J){if(J.nodeType==1){H=J.getAttribute("fid")||J.getAttribute("id");if(H){break}}J=J.nextSibling}I.fid=H;return I},parseGeometry:{point:function(D){var A,F;var B=[];var A=this.getElementsByTagNameNS(D,this.gmlns,"pos");if(A.length>0){F=A[0].firstChild.nodeValue;F=F.replace(this.regExes.trimSpace,"");B=F.split(this.regExes.splitSpace)}if(B.length==0){A=this.getElementsByTagNameNS(D,this.gmlns,"coordinates");if(A.length>0){F=A[0].firstChild.nodeValue;F=F.replace(this.regExes.removeSpace,"");B=F.split(",")}}if(B.length==0){A=this.getElementsByTagNameNS(D,this.gmlns,"coord");if(A.length>0){var E=this.getElementsByTagNameNS(A[0],this.gmlns,"X");var C=this.getElementsByTagNameNS(A[0],this.gmlns,"Y");if(E.length>0&&C.length>0){B=[E[0].firstChild.nodeValue,C[0].firstChild.nodeValue]}}}if(B.length==2){B[2]=null}if(this.xy){return new HGIS.Geometry.Point(B[0],B[1],B[2])}else{return new HGIS.Geometry.Point(B[1],B[0],B[2])}},multipoint:function(D){var A=this.getElementsByTagNameNS(D,this.gmlns,"Point");var E=[];if(A.length>0){var C;for(var B=0;B<A.length;++B){C=this.parseGeometry.point.apply(this,[A[B]]);if(C){E.push(C)}}}return new HGIS.Geometry.MultiPoint(E)},linestring:function(I,H){var B,D;var N=[];var K=[];B=this.getElementsByTagNameNS(I,this.gmlns,"posList");if(B.length>0){D=this.getChildValue(B[0]);D=D.replace(this.regExes.trimSpace,"");N=D.split(this.regExes.splitSpace);var F=parseInt(B[0].getAttribute("dimension"));var E,A,L,J;for(var G=0;G<N.length/F;++G){E=G*F;A=N[E];L=N[E+1];J=(F==2)?null:N[E+2];if(this.xy){K.push(new HGIS.Geometry.Point(A,L,J))}else{K.push(new HGIS.Geometry.Point(L,A,J))}}}if(N.length==0){B=this.getElementsByTagNameNS(I,this.gmlns,"coordinates");if(B.length>0){D=this.getChildValue(B[0]);D=D.replace(this.regExes.trimSpace,"");D=D.replace(this.regExes.trimComma,",");var M=D.split(this.regExes.splitSpace);for(var G=0;G<M.length;++G){N=M[G].split(",");if(N.length==2){N[2]=null}if(this.xy){K.push(new HGIS.Geometry.Point(N[0],N[1],N[2]))}else{K.push(new HGIS.Geometry.Point(N[1],N[0],N[2]))}}}}var C=null;if(K.length!=0){if(H){C=new HGIS.Geometry.LinearRing(K)}else{C=new HGIS.Geometry.LineString(K)}}return C},multilinestring:function(C){var A=this.getElementsByTagNameNS(C,this.gmlns,"LineString");var D=[];if(A.length>0){var E;for(var B=0;B<A.length;++B){E=this.parseGeometry.linestring.apply(this,[A[B]]);if(E){D.push(E)}}}return new HGIS.Geometry.MultiLineString(D)},polygon:function(C){var A=this.getElementsByTagNameNS(C,this.gmlns,"LinearRing");var D=[];if(A.length>0){var E;for(var B=0;B<A.length;++B){E=this.parseGeometry.linestring.apply(this,[A[B],true]);if(E){D.push(E)}}}return new HGIS.Geometry.Polygon(D)},multipolygon:function(C){var A=this.getElementsByTagNameNS(C,this.gmlns,"Polygon");var D=[];if(A.length>0){var E;for(var B=0;B<A.length;++B){E=this.parseGeometry.polygon.apply(this,[A[B]]);if(E){D.push(E)}}}return new HGIS.Geometry.MultiPolygon(D)},envelope:function(F){var D=[];var A;var G;var B=this.getElementsByTagNameNS(F,this.gmlns,"lowerCorner");if(B.length>0){var I=[];if(B.length>0){A=B[0].firstChild.nodeValue;A=A.replace(this.regExes.trimSpace,"");I=A.split(this.regExes.splitSpace)}if(I.length==2){I[2]=null}if(this.xy){var J=new HGIS.Geometry.Point(I[0],I[1],I[2])}else{var J=new HGIS.Geometry.Point(I[1],I[0],I[2])}}var C=this.getElementsByTagNameNS(F,this.gmlns,"upperCorner");if(C.length>0){var I=[];if(C.length>0){A=C[0].firstChild.nodeValue;A=A.replace(this.regExes.trimSpace,"");I=A.split(this.regExes.splitSpace)}if(I.length==2){I[2]=null}if(this.xy){var H=new HGIS.Geometry.Point(I[0],I[1],I[2])}else{var H=new HGIS.Geometry.Point(I[1],I[0],I[2])}}if(J&&H){D.push(new HGIS.Geometry.Point(J.x,J.y));D.push(new HGIS.Geometry.Point(H.x,J.y));D.push(new HGIS.Geometry.Point(H.x,H.y));D.push(new HGIS.Geometry.Point(J.x,H.y));D.push(new HGIS.Geometry.Point(J.x,J.y));var E=new HGIS.Geometry.LinearRing(D);G=new HGIS.Geometry.Polygon([E])}return G},box:function(D){var A=this.getElementsByTagNameNS(D,this.gmlns,"coordinates");var F;var C,E=null,B=null;if(A.length>0){F=A[0].firstChild.nodeValue;C=F.split(" ");if(C.length==2){E=C[0].split(",");B=C[1].split(",")}}if(E!==null&&B!==null){return new HGIS.Bounds(parseFloat(E[0]),parseFloat(E[1]),parseFloat(B[0]),parseFloat(B[1]))}}},parseAttributes:function(H){var G={};var J=H.firstChild;var D,F,I,A,E,B,C;while(J){if(J.nodeType==1){D=J.childNodes;for(F=0;F<D.length;++F){I=D[F];if(I.nodeType==1){A=I.childNodes;if(A.length==1){E=A[0];if(E.nodeType==3||E.nodeType==4){B=(I.prefix)?I.nodeName.split(":")[1]:I.nodeName;C=E.nodeValue.replace(this.regExes.trimSpace,"");G[B]=C}}else{G[I.nodeName.split(":").pop()]=null}}}break}J=J.nextSibling}return G},write:function(A){if(!(HGIS.Util.isArray(A))){A=[A]}var B=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var C=0;C<A.length;C++){B.appendChild(this.createFeatureXML(A[C]))}return HGIS.Format.XML.prototype.write.apply(this,[B])},createFeatureXML:function(K){var F=K.geometry;var A=this.buildGeometryNode(F);var H=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);H.appendChild(A);var I=this.createElementNS(this.gmlns,"gml:"+this.featureName);var B=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var D=K.fid||K.id;B.setAttribute("fid",D);B.appendChild(H);for(var E in K.attributes){var J=this.createTextNode(K.attributes[E]);var G=E.substring(E.lastIndexOf(":")+1);var C=this.createElementNS(this.featureNS,this.featurePrefix+":"+G);C.appendChild(J);B.appendChild(C)}I.appendChild(B);return I},buildGeometryNode:function(D){if(this.externalProjection&&this.internalProjection){D=D.clone();D.transform(this.internalProjection,this.externalProjection)}var B=D.CLASS_NAME;var A=B.substring(B.lastIndexOf(".")+1);var C=this.buildGeometry[A.toLowerCase()];return C.apply(this,[D])},buildGeometry:{point:function(B){var A=this.createElementNS(this.gmlns,"gml:Point");A.appendChild(this.buildCoordinatesNode(B));return A},multipoint:function(E){var A=this.createElementNS(this.gmlns,"gml:MultiPoint");var D=E.components;var C,F;for(var B=0;B<D.length;B++){C=this.createElementNS(this.gmlns,"gml:pointMember");F=this.buildGeometry.point.apply(this,[D[B]]);C.appendChild(F);A.appendChild(C)}return A},linestring:function(B){var A=this.createElementNS(this.gmlns,"gml:LineString");A.appendChild(this.buildCoordinatesNode(B));return A},multilinestring:function(E){var A=this.createElementNS(this.gmlns,"gml:MultiLineString");var D=E.components;var F,B;for(var C=0;C<D.length;++C){F=this.createElementNS(this.gmlns,"gml:lineStringMember");B=this.buildGeometry.linestring.apply(this,[D[C]]);F.appendChild(B);A.appendChild(F)}return A},linearring:function(B){var A=this.createElementNS(this.gmlns,"gml:LinearRing");A.appendChild(this.buildCoordinatesNode(B));return A},polygon:function(D){var A=this.createElementNS(this.gmlns,"gml:Polygon");var C=D.components;var G,E,F;for(var B=0;B<C.length;++B){F=(B==0)?"outerBoundaryIs":"innerBoundaryIs";G=this.createElementNS(this.gmlns,"gml:"+F);E=this.buildGeometry.linearring.apply(this,[C[B]]);G.appendChild(E);A.appendChild(G)}return A},multipolygon:function(D){var A=this.createElementNS(this.gmlns,"gml:MultiPolygon");var C=D.components;var E,F;for(var B=0;B<C.length;++B){E=this.createElementNS(this.gmlns,"gml:polygonMember");F=this.buildGeometry.polygon.apply(this,[C[B]]);E.appendChild(F);A.appendChild(E)}return A},bounds:function(B){var A=this.createElementNS(this.gmlns,"gml:Box");A.appendChild(this.buildCoordinatesNode(B));return A}},buildCoordinatesNode:function(D){var E=this.createElementNS(this.gmlns,"gml:coordinates");E.setAttribute("decimal",".");E.setAttribute("cs",",");E.setAttribute("ts"," ");var A=[];if(D instanceof HGIS.Bounds){A.push(D.left+","+D.bottom);A.push(D.right+","+D.top)}else{var C=(D.components)?D.components:[D];for(var B=0;B<C.length;B++){A.push(C[B].x+","+C[B].y)}}var F=this.createTextNode(A.join(" "));E.appendChild(F);return E},CLASS_NAME:"HGIS.Format.GML"});if(!HGIS.Format.GML){HGIS.Format.GML={}}HGIS.Format.GML.Base=HGIS.Class(HGIS.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),featureMember:(/^(.*:)?featureMembers?$/)},initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A]);this.setGeometryTypes();if(A&&A.featureNS){this.setNamespace("feature",A.featureNS)}this.singleFeatureType=!A||(typeof A.featureType==="string")},read:function(E){if(typeof E=="string"){E=HGIS.Format.XML.prototype.read.apply(this,[E])}if(E&&E.nodeType==9){E=E.documentElement}var A=[];this.readNode(E,{features:A},true);if(A.length==0){var C=this.getElementsByTagNameNS(E,this.namespaces.gml,"featureMember");if(C.length){for(var B=0,D=C.length;B<D;++B){this.readNode(C[B],{features:A},true)}}else{var C=this.getElementsByTagNameNS(E,this.namespaces.gml,"featureMembers");if(C.length){this.readNode(C[0],{features:A},true)}}}return A},readNode:function(B,A,C){if(C===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces["feature"];this.featureNS=null}if(!this.featureNS&&(!(B.prefix in this.namespaces)&&B.parentNode.namespaceURI==this.namespaces["gml"]&&this.regExes.featureMember.test(B.parentNode.nodeName))){this.featureType=B.nodeName.split(":").pop();this.setNamespace("feature",B.namespaceURI);this.featureNS=B.namespaceURI;this.autoConfig=true}return HGIS.Format.XML.prototype.readNode.apply(this,[B,A])},readers:{"gml":{"_inherit":function(B,A,C){},"featureMember":function(B,A){this.readChildNodes(B,A)},"featureMembers":function(B,A){this.readChildNodes(B,A)},"name":function(B,A){A.name=this.getChildValue(B)},"boundedBy":function(B,A){var C={};this.readChildNodes(B,C);if(C.components&&C.components.length>0){A.bounds=C.components[0]}},"Point":function(B,C){var A={points:[]};this.readChildNodes(B,A);if(!C.components){C.components=[]}C.components.push(A.points[0])},"coordinates":function(D,F){var A=this.getChildValue(D).replace(this.regExes.trimSpace,"");A=A.replace(this.regExes.trimComma,",");var E=A.split(this.regExes.splitSpace);var H;var C=E.length;var G=new Array(C);for(var B=0;B<C;++B){H=E[B].split(",");if(this.xy){G[B]=new HGIS.Geometry.Point(H[0],H[1],H[2])}else{G[B]=new HGIS.Geometry.Point(H[1],H[0],H[2])}}F.points=G},"coord":function(B,A){var C={};this.readChildNodes(B,C);if(!A.points){A.points=[]}A.points.push(new HGIS.Geometry.Point(C.x,C.y,C.z))},"X":function(A,B){B.x=this.getChildValue(A)},"Y":function(A,B){B.y=this.getChildValue(A)},"Z":function(A,B){B.z=this.getChildValue(A)},"MultiPoint":function(B,C){var A={components:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);C.components=[new HGIS.Geometry.MultiPoint(A.components)]},"pointMember":function(B,A){this.readChildNodes(B,A)},"LineString":function(B,C){var A={};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);if(!C.components){C.components=[]}C.components.push(new HGIS.Geometry.LineString(A.points))},"MultiLineString":function(B,C){var A={components:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);C.components=[new HGIS.Geometry.MultiLineString(A.components)]},"lineStringMember":function(B,A){this.readChildNodes(B,A)},"Polygon":function(B,C){var A={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);A.inner.unshift(A.outer);if(!C.components){C.components=[]}C.components.push(new HGIS.Geometry.Polygon(A.inner))},"LinearRing":function(B,A){var C={};this.readers.gml._inherit.apply(this,[B,C]);this.readChildNodes(B,C);A.components=[new HGIS.Geometry.LinearRing(C.points)]},"MultiPolygon":function(B,C){var A={components:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);C.components=[new HGIS.Geometry.MultiPolygon(A.components)]},"polygonMember":function(B,A){this.readChildNodes(B,A)},"GeometryCollection":function(B,C){var A={components:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);C.components=[new HGIS.Geometry.Collection(A.components)]},"geometryMember":function(B,A){this.readChildNodes(B,A)}},"feature":{"*":function(B,A){var C;var D=B.localName||B.nodeName.split(":").pop();if(A.features){if(!this.singleFeatureType&&(HGIS.Util.indexOf(this.featureType,D)!==-1)){C="_typeName"}else{if(D===this.featureType){C="_typeName"}}}else{if(B.childNodes.length==0||(B.childNodes.length==1&&B.firstChild.nodeType==3)){if(this.extractAttributes){C="_attribute"}}else{C="_geometry"}}if(C){this.readers.feature[C].apply(this,[B,A])}},"_typeName":function(C,B){var D={components:[],attributes:{}};this.readChildNodes(C,D);if(D.name){D.attributes.name=D.name}var A=new HGIS.Feature.Vector(D.components[0],D.attributes);if(!this.singleFeatureType){A.type=C.nodeName.split(":").pop();A.namespace=C.namespaceURI}var E=C.getAttribute("fid")||this.getAttributeNS(C,this.namespaces["gml"],"id");if(E){A.fid=E}if(this.internalProjection&&this.externalProjection&&A.geometry){A.geometry.transform(this.externalProjection,this.internalProjection)}if(D.bounds){A.bounds=D.bounds}B.features.push(A)},"_geometry":function(B,A){if(!this.geometryName){this.geometryName=B.nodeName.split(":").pop()}this.readChildNodes(B,A)},"_attribute":function(B,A){var D=B.localName||B.nodeName.split(":").pop();var C=this.getChildValue(B);A.attributes[D]=C}},"wfs":{"FeatureCollection":function(B,A){this.readChildNodes(B,A)}}},write:function(A){var C;if(HGIS.Util.isArray(A)){C="featureMembers"}else{C="featureMember"}var B=this.writeNode("gml:"+C,A);this.setAttributeNS(B,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[B])},writers:{"gml":{"featureMember":function(A){var B=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",A,B);return B},"MultiPoint":function(C){var B=this.createElementNSPlus("gml:MultiPoint");var E=C.components||[C];for(var A=0,D=E.length;A<D;++A){this.writeNode("pointMember",E[A],B)}return B},"pointMember":function(B){var A=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",B,A);return A},"MultiLineString":function(C){var B=this.createElementNSPlus("gml:MultiLineString");var E=C.components||[C];for(var A=0,D=E.length;A<D;++A){this.writeNode("lineStringMember",E[A],B)}return B},"lineStringMember":function(B){var A=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",B,A);return A},"MultiPolygon":function(C){var B=this.createElementNSPlus("gml:MultiPolygon");var E=C.components||[C];for(var A=0,D=E.length;A<D;++A){this.writeNode("polygonMember",E[A],B)}return B},"polygonMember":function(B){var A=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",B,A);return A},"GeometryCollection":function(C){var B=this.createElementNSPlus("gml:GeometryCollection");for(var A=0,D=C.components.length;A<D;++A){this.writeNode("geometryMember",C.components[A],B)}return B},"geometryMember":function(C){var B=this.createElementNSPlus("gml:geometryMember");var A=this.writeNode("feature:_geometry",C);B.appendChild(A.firstChild);return B}},"feature":{"_typeName":function(A){var B=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:A.fid}});if(A.geometry){this.writeNode("feature:_geometry",A.geometry,B)}for(var C in A.attributes){var D=A.attributes[C];if(D!=null){this.writeNode("feature:_attribute",{name:C,value:D},B)}}return B},"_geometry":function(C){if(this.externalProjection&&this.internalProjection){C=C.clone().transform(this.internalProjection,this.externalProjection)}var B=this.createElementNSPlus("feature:"+this.geometryName);var A=this.geometryTypes[C.CLASS_NAME];var D=this.writeNode("gml:"+A,C,B);if(this.srsName){D.setAttribute("srsName",this.srsName)}return B},"_attribute":function(A){return this.createElementNSPlus("feature:"+A.name,{value:A.value})}},"wfs":{"FeatureCollection":function(A){var C=this.createElementNSPlus("wfs:FeatureCollection");for(var B=0,D=A.length;B<D;++B){this.writeNode("gml:featureMember",A[B],C)}return C}}},setGeometryTypes:function(){this.geometryTypes={"HGIS.Geometry.Point":"Point","HGIS.Geometry.MultiPoint":"MultiPoint","HGIS.Geometry.LineString":"LineString","HGIS.Geometry.MultiLineString":"MultiLineString","HGIS.Geometry.Polygon":"Polygon","HGIS.Geometry.MultiPolygon":"MultiPolygon","HGIS.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"HGIS.Format.GML.Base"});HGIS.Format.GML.v3=HGIS.Class(HGIS.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(A){HGIS.Format.GML.Base.prototype.initialize.apply(this,[A])},readers:{"gml":HGIS.Util.applyDefaults({"_inherit":function(B,A,C){var D=parseInt(B.getAttribute("srsDimension"),10)||(C&&C.srsDimension);if(D){A.srsDimension=D}},"featureMembers":function(B,A){this.readChildNodes(B,A)},"Curve":function(B,C){var A={points:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);if(!C.components){C.components=[]}C.components.push(new HGIS.Geometry.LineString(A.points))},"segments":function(B,A){this.readChildNodes(B,A)},"LineStringSegment":function(B,C){var A={};this.readChildNodes(B,A);if(A.points){Array.prototype.push.apply(C.points,A.points)}},"pos":function(C,A){var E=this.getChildValue(C).replace(this.regExes.trimSpace,"");var D=E.split(this.regExes.splitSpace);var B;if(this.xy){B=new HGIS.Geometry.Point(D[0],D[1],D[2])}else{B=new HGIS.Geometry.Point(D[1],D[0],D[2])}A.points=[B]},"posList":function(F,H){var K=this.getChildValue(F).replace(this.regExes.trimSpace,"");var L=K.split(this.regExes.splitSpace);var D=H.srsDimension||parseInt(F.getAttribute("srsDimension")||F.getAttribute("dimension"),10)||2;var C,I,J,G;var M=L.length/D;var B=new Array(M);for(var E=0,A=L.length;E<A;E+=D){I=L[E];J=L[E+1];G=(D==2)?undefined:L[E+2];if(this.xy){B[E/D]=new HGIS.Geometry.Point(I,J,G)}else{B[E/D]=new HGIS.Geometry.Point(J,I,G)}}H.points=B},"Surface":function(B,A){this.readChildNodes(B,A)},"patches":function(B,A){this.readChildNodes(B,A)},"PolygonPatch":function(B,A){this.readers.gml.Polygon.apply(this,[B,A])},"exterior":function(B,C){var A={};this.readChildNodes(B,A);C.outer=A.components[0]},"interior":function(B,C){var A={};this.readChildNodes(B,A);C.inner.push(A.components[0])},"MultiCurve":function(B,C){var A={components:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);if(A.components.length>0){C.components=[new HGIS.Geometry.MultiLineString(A.components)]}},"curveMember":function(B,A){this.readChildNodes(B,A)},"MultiSurface":function(B,C){var A={components:[]};this.readers.gml._inherit.apply(this,[B,A,C]);this.readChildNodes(B,A);if(A.components.length>0){C.components=[new HGIS.Geometry.MultiPolygon(A.components)]}},"surfaceMember":function(B,A){this.readChildNodes(B,A)},"surfaceMembers":function(B,A){this.readChildNodes(B,A)},"pointMembers":function(B,A){this.readChildNodes(B,A)},"lineStringMembers":function(B,A){this.readChildNodes(B,A)},"polygonMembers":function(B,A){this.readChildNodes(B,A)},"geometryMembers":function(B,A){this.readChildNodes(B,A)},"Envelope":function(C,D){var B={points:new Array(2)};this.readChildNodes(C,B);if(!D.components){D.components=[]}var A=B.points[0];var E=B.points[1];D.components.push(new HGIS.Bounds(A.x,A.y,E.x,E.y))},"lowerCorner":function(B,C){var A={};this.readers.gml.pos.apply(this,[B,A]);C.points[0]=A.points[0]},"upperCorner":function(B,C){var A={};this.readers.gml.pos.apply(this,[B,A]);C.points[1]=A.points[0]}},HGIS.Format.GML.Base.prototype.readers["gml"]),"feature":HGIS.Format.GML.Base.prototype.readers["feature"],"wfs":HGIS.Format.GML.Base.prototype.readers["wfs"]},write:function(A){var C;if(HGIS.Util.isArray(A)){C="featureMembers"}else{C="featureMember"}var B=this.writeNode("gml:"+C,A);this.setAttributeNS(B,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[B])},writers:{"gml":HGIS.Util.applyDefaults({"featureMembers":function(A){var C=this.createElementNSPlus("gml:featureMembers");for(var B=0,D=A.length;B<D;++B){this.writeNode("feature:_typeName",A[B],C)}return C},"Point":function(B){var A=this.createElementNSPlus("gml:Point");this.writeNode("pos",B,A);return A},"pos":function(A){var B=(this.xy)?(A.x+" "+A.y):(A.y+" "+A.x);return this.createElementNSPlus("gml:pos",{value:B})},"LineString":function(B){var A=this.createElementNSPlus("gml:LineString");this.writeNode("posList",B.components,A);return A},"Curve":function(B){var A=this.createElementNSPlus("gml:Curve");this.writeNode("segments",B,A);return A},"segments":function(B){var A=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",B,A);return A},"LineStringSegment":function(B){var A=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",B.components,A);return A},"posList":function(D){var E=D.length;var A=new Array(E);var C;for(var B=0;B<E;++B){C=D[B];if(this.xy){A[B]=C.x+" "+C.y}else{A[B]=C.y+" "+C.x}}return this.createElementNSPlus("gml:posList",{value:A.join(" ")})},"Surface":function(B){var A=this.createElementNSPlus("gml:Surface");this.writeNode("patches",B,A);return A},"patches":function(B){var A=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",B,A);return A},"PolygonPatch":function(C){var B=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",C.components[0],B);for(var A=1,D=C.components.length;A<D;++A){this.writeNode("interior",C.components[A],B)}return B},"Polygon":function(C){var B=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",C.components[0],B);for(var A=1,D=C.components.length;A<D;++A){this.writeNode("interior",C.components[A],B)}return B},"exterior":function(B){var A=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",B,A);return A},"interior":function(B){var A=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",B,A);return A},"LinearRing":function(B){var A=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",B.components,A);return A},"MultiCurve":function(C){var B=this.createElementNSPlus("gml:MultiCurve");var E=C.components||[C];for(var A=0,D=E.length;A<D;++A){this.writeNode("curveMember",E[A],B)}return B},"curveMember":function(B){var A=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",B,A)}else{this.writeNode("LineString",B,A)}return A},"MultiSurface":function(C){var B=this.createElementNSPlus("gml:MultiSurface");var E=C.components||[C];for(var A=0,D=E.length;A<D;++A){this.writeNode("surfaceMember",E[A],B)}return B},"surfaceMember":function(B){var A=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",B,A)}else{this.writeNode("Polygon",B,A)}return A},"Envelope":function(A){var B=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",A,B);this.writeNode("upperCorner",A,B);if(this.srsName){B.setAttribute("srsName",this.srsName)}return B},"lowerCorner":function(A){var B=(this.xy)?(A.left+" "+A.bottom):(A.bottom+" "+A.left);return this.createElementNSPlus("gml:lowerCorner",{value:B})},"upperCorner":function(A){var B=(this.xy)?(A.right+" "+A.top):(A.top+" "+A.right);return this.createElementNSPlus("gml:upperCorner",{value:B})}},HGIS.Format.GML.Base.prototype.writers["gml"]),"feature":HGIS.Format.GML.Base.prototype.writers["feature"],"wfs":HGIS.Format.GML.Base.prototype.writers["wfs"]},setGeometryTypes:function(){this.geometryTypes={"HGIS.Geometry.Point":"Point","HGIS.Geometry.MultiPoint":"MultiPoint","HGIS.Geometry.LineString":(this.curve===true)?"Curve":"LineString","HGIS.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","HGIS.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","HGIS.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","HGIS.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"HGIS.Format.GML.v3"});HGIS.Format.Filter.v1_1_0=HGIS.Class(HGIS.Format.GML.v3,HGIS.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(A){HGIS.Format.GML.v3.prototype.initialize.apply(this,[A])},readers:{"ogc":HGIS.Util.applyDefaults({"PropertyIsEqualTo":function(B,A){var C=B.getAttribute("matchCase");var D=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.EQUAL_TO,matchCase:!(C==="false"||C==="0")});this.readChildNodes(B,D);A.filters.push(D)},"PropertyIsNotEqualTo":function(B,A){var C=B.getAttribute("matchCase");var D=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(C==="false"||C==="0")});this.readChildNodes(B,D);A.filters.push(D)},"PropertyIsLike":function(B,A){var D=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.LIKE});this.readChildNodes(B,D);var C=B.getAttribute("wildCard");var E=B.getAttribute("singleChar");var F=B.getAttribute("escapeChar");D.value2regex(C,E,F);A.filters.push(D)}},HGIS.Format.Filter.v1.prototype.readers["ogc"]),"gml":HGIS.Format.GML.v3.prototype.readers["gml"],"feature":HGIS.Format.GML.v3.prototype.readers["feature"]},writers:{"ogc":HGIS.Util.applyDefaults({"PropertyIsEqualTo":function(B){var A=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:B.matchCase}});this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsNotEqualTo":function(B){var A=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:B.matchCase}});this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsLike":function(B){var A=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:B.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",B,A);this.writeNode("Literal",B.regex2value(),A);return A},"BBOX":function(C){var B=this.createElementNSPlus("ogc:BBOX");C.property&&this.writeNode("PropertyName",C,B);var A=this.writeNode("gml:Envelope",C.value);if(C.projection){A.setAttribute("srsName",C.projection)}B.appendChild(A);return B},"SortBy":function(A){var C=this.createElementNSPlus("ogc:SortBy");for(var B=0,D=A.length;B<D;B++){this.writeNode("ogc:SortProperty",A[B],C)}return C},"SortProperty":function(B){var A=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",B,A);this.writeNode("ogc:SortOrder",(B.order=="DESC")?"DESC":"ASC",A);return A},"SortOrder":function(B){var A=this.createElementNSPlus("ogc:SortOrder",{value:B});return A}},HGIS.Format.Filter.v1.prototype.writers["ogc"]),"gml":HGIS.Format.GML.v3.prototype.writers["gml"],"feature":HGIS.Format.GML.v3.prototype.writers["feature"]},writeSpatial:function(D,C){var B=this.createElementNSPlus("ogc:"+C);this.writeNode("PropertyName",D,B);if(D.value instanceof HGIS.Filter.Function){this.writeNode("Function",D.value,B)}else{var A;if(D.value instanceof HGIS.Geometry){A=this.writeNode("feature:_geometry",D.value).firstChild}else{A=this.writeNode("gml:Envelope",D.value)}if(D.projection){A.setAttribute("srsName",D.projection)}B.appendChild(A)}return B},CLASS_NAME:"HGIS.Format.Filter.v1_1_0"});HGIS.Format.OWSCommon=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(B,C){var D=this.version;if(!D){var A=B.getAttribute("xmlns:ows");if(A&&A.substring(A.lastIndexOf("/")+1)==="1.1"){D="1.1.0"}if(!D){D=this.defaultVersion}}return D},CLASS_NAME:"HGIS.Format.OWSCommon"});HGIS.Format.OWSCommon.v1=HGIS.Class(HGIS.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(C,B){B=HGIS.Util.applyDefaults(B,this.options);var A={};this.readChildNodes(C,A);return A},readers:{"ows":{"Exception":function(B,C){var A={code:B.getAttribute("exceptionCode"),locator:B.getAttribute("locator"),texts:[]};C.exceptions.push(A);this.readChildNodes(B,A)},"ExceptionText":function(B,A){var C=this.getChildValue(B);A.texts.push(C)},"ServiceIdentification":function(B,A){A.serviceIdentification={};this.readChildNodes(B,A.serviceIdentification)},"Title":function(B,A){A.title=this.getChildValue(B)},"Abstract":function(A,B){B["abstract"]=this.getChildValue(A)},"Keywords":function(A,B){B.keywords={};this.readChildNodes(A,B.keywords)},"Keyword":function(A,B){B[this.getChildValue(A)]=true},"ServiceType":function(A,B){B.serviceType={codeSpace:A.getAttribute("codeSpace"),value:this.getChildValue(A)}},"ServiceTypeVersion":function(A,B){B.serviceTypeVersion=this.getChildValue(A)},"Fees":function(A,B){B.fees=this.getChildValue(A)},"AccessConstraints":function(A,B){B.accessConstraints=this.getChildValue(A)},"ServiceProvider":function(B,A){A.serviceProvider={};this.readChildNodes(B,A.serviceProvider)},"ProviderName":function(A,B){B.providerName=this.getChildValue(A)},"ProviderSite":function(A,B){B.providerSite=this.getAttributeNS(A,this.namespaces.xlink,"href")},"ServiceContact":function(A,B){B.serviceContact={};this.readChildNodes(A,B.serviceContact)},"IndividualName":function(A,B){B.individualName=this.getChildValue(A)},"PositionName":function(A,B){B.positionName=this.getChildValue(A)},"ContactInfo":function(A,B){B.contactInfo={};this.readChildNodes(A,B.contactInfo)},"Phone":function(A,B){B.phone={};this.readChildNodes(A,B.phone)},"Voice":function(B,A){A.voice=this.getChildValue(B)},"Address":function(A,B){B.address={};this.readChildNodes(A,B.address)},"DeliveryPoint":function(B,A){A.deliveryPoint=this.getChildValue(B)},"City":function(B,A){A.city=this.getChildValue(B)},"AdministrativeArea":function(B,A){A.administrativeArea=this.getChildValue(B)},"PostalCode":function(B,A){A.postalCode=this.getChildValue(B)},"Country":function(B,A){A.country=this.getChildValue(B)},"ElectronicMailAddress":function(B,A){A.electronicMailAddress=this.getChildValue(B)},"Role":function(A,B){B.role=this.getChildValue(A)},"OperationsMetadata":function(B,A){A.operationsMetadata={};this.readChildNodes(B,A.operationsMetadata)},"Operation":function(A,C){var B=A.getAttribute("name");C[B]={};this.readChildNodes(A,C[B])},"DCP":function(A,B){B.dcp={};this.readChildNodes(A,B.dcp)},"HTTP":function(A,B){B.http={};this.readChildNodes(A,B.http)},"Get":function(C,A){if(!A.get){A.get=[]}var B={url:this.getAttributeNS(C,this.namespaces.xlink,"href")};this.readChildNodes(C,B);A.get.push(B)},"Post":function(C,A){if(!A.post){A.post=[]}var B={url:this.getAttributeNS(C,this.namespaces.xlink,"href")};this.readChildNodes(C,B);A.post.push(B)},"Parameter":function(A,C){if(!C.parameters){C.parameters={}}var B=A.getAttribute("name");C.parameters[B]={};this.readChildNodes(A,C.parameters[B])},"Constraint":function(B,A){if(!A.constraints){A.constraints={}}var C=B.getAttribute("name");A.constraints[C]={};this.readChildNodes(B,A.constraints[C])},"Value":function(B,A){A[this.getChildValue(B)]=true},"OutputFormat":function(B,A){A.formats.push({value:this.getChildValue(B)});this.readChildNodes(B,A)},"WGS84BoundingBox":function(C,B){var A={};A.crs=C.getAttribute("crs");if(B.BoundingBox){B.BoundingBox.push(A)}else{B.projection=A.crs;A=B}this.readChildNodes(C,A)},"BoundingBox":function(B,A){this.readers["ows"]["WGS84BoundingBox"].apply(this,[B,A])},"LowerCorner":function(C,B){var D=this.getChildValue(C).replace(this.regExes.trimSpace,"");D=D.replace(this.regExes.trimComma,",");var A=D.split(this.regExes.splitSpace);B.left=A[0];B.bottom=A[1]},"UpperCorner":function(C,B){var D=this.getChildValue(C).replace(this.regExes.trimSpace,"");D=D.replace(this.regExes.trimComma,",");var A=D.split(this.regExes.splitSpace);B.right=A[0];B.top=A[1];B.bounds=new HGIS.Bounds(B.left,B.bottom,B.right,B.top);delete B.left;delete B.bottom;delete B.right;delete B.top},"Language":function(B,A){A.language=this.getChildValue(B)}}},writers:{"ows":{"BoundingBox":function(B,C){var A=this.createElementNSPlus(C||"ows:BoundingBox",{attributes:{crs:B.projection}});this.writeNode("ows:LowerCorner",B,A);this.writeNode("ows:UpperCorner",B,A);return A},"LowerCorner":function(B){var A=this.createElementNSPlus("ows:LowerCorner",{value:B.bounds.left+" "+B.bounds.bottom});return A},"UpperCorner":function(B){var A=this.createElementNSPlus("ows:UpperCorner",{value:B.bounds.right+" "+B.bounds.top});return A},"Identifier":function(A){var B=this.createElementNSPlus("ows:Identifier",{value:A});return B},"Title":function(B){var A=this.createElementNSPlus("ows:Title",{value:B});return A},"Abstract":function(B){var A=this.createElementNSPlus("ows:Abstract",{value:B});return A},"OutputFormat":function(A){var B=this.createElementNSPlus("ows:OutputFormat",{value:A});return B}}},CLASS_NAME:"HGIS.Format.OWSCommon.v1"});HGIS.Format.OWSCommon.v1_0_0=HGIS.Class(HGIS.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{"ows":HGIS.Util.applyDefaults({"ExceptionReport":function(B,A){A.success=false;A.exceptionReport={version:B.getAttribute("version"),language:B.getAttribute("language"),exceptions:[]};this.readChildNodes(B,A.exceptionReport)}},HGIS.Format.OWSCommon.v1.prototype.readers.ows)},writers:{"ows":HGIS.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"HGIS.Format.OWSCommon.v1_0_0"});HGIS.Format.WFST.v1_1_0=HGIS.Class(HGIS.Format.Filter.v1_1_0,HGIS.Format.WFST.v1,{version:"1.1.0",schemaLocations:{"wfs":"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(A){HGIS.Format.Filter.v1_1_0.prototype.initialize.apply(this,[A]);HGIS.Format.WFST.v1.prototype.initialize.apply(this,[A])},readNode:function(B,A,C){return HGIS.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{"wfs":HGIS.Util.applyDefaults({"FeatureCollection":function(B,A){A.numberOfFeatures=parseInt(B.getAttribute("numberOfFeatures"));HGIS.Format.WFST.v1.prototype.readers["wfs"]["FeatureCollection"].apply(this,arguments)},"TransactionResponse":function(B,A){A.insertIds=[];A.success=false;this.readChildNodes(B,A)},"TransactionSummary":function(B,A){A.success=true},"InsertResults":function(B,A){this.readChildNodes(B,A)},"Feature":function(B,C){var A={fids:[]};this.readChildNodes(B,A);C.insertIds.push(A.fids[0])}},HGIS.Format.WFST.v1.prototype.readers["wfs"]),"gml":HGIS.Format.GML.v3.prototype.readers["gml"],"feature":HGIS.Format.GML.v3.prototype.readers["feature"],"ogc":HGIS.Format.Filter.v1_1_0.prototype.readers["ogc"],"ows":HGIS.Format.OWSCommon.v1_0_0.prototype.readers["ows"]},writers:{"wfs":HGIS.Util.applyDefaults({"GetFeature":function(B){var A=HGIS.Format.WFST.v1.prototype.writers["wfs"]["GetFeature"].apply(this,arguments);B&&this.setAttributes(A,{resultType:B.resultType,startIndex:B.startIndex,count:B.count});return A},"Query":function(D){D=HGIS.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},D);var B=D.featurePrefix;var C=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(B?B+":":"")+D.featureType,srsName:D.srsName}});if(D.featureNS){C.setAttribute("xmlns:"+B,D.featureNS)}if(D.propertyNames){for(var A=0,E=D.propertyNames.length;A<E;A++){this.writeNode("wfs:PropertyName",{property:D.propertyNames[A]},C)}}if(D.filter){HGIS.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,D.filter);this.writeNode("ogc:Filter",D.filter,C)}return C},"PropertyName":function(A){return this.createElementNSPlus("wfs:PropertyName",{value:A.property})}},HGIS.Format.WFST.v1.prototype.writers["wfs"]),"gml":HGIS.Format.GML.v3.prototype.writers["gml"],"feature":HGIS.Format.GML.v3.prototype.writers["feature"],"ogc":HGIS.Format.Filter.v1_1_0.prototype.writers["ogc"]},CLASS_NAME:"HGIS.Format.WFST.v1_1_0"});HGIS.Protocol=HGIS.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(A){A=A||{};HGIS.Util.extend(this,A);this.options=A},mergeWithDefaultFilter:function(B){var A;if(B&&this.defaultFilter){A=new HGIS.Filter.Logical({type:HGIS.Filter.Logical.AND,filters:[this.defaultFilter,B]})}else{A=B||this.defaultFilter||undefined}return A},destroy:function(){this.options=null;this.format=null},read:function(A){A=A||{};A.filter=this.mergeWithDefaultFilter(A.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(A){},createCallback:function(B,C,A){return HGIS.Function.bind(function(){B.apply(this,[C,A])},this)},CLASS_NAME:"HGIS.Protocol"});HGIS.Protocol.Response=HGIS.Class({code:null,requestType:null,last:true,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(A){HGIS.Util.extend(this,A)},success:function(){return this.code>0},CLASS_NAME:"HGIS.Protocol.Response"});HGIS.Protocol.Response.SUCCESS=1;HGIS.Protocol.Response.FAILURE=0;HGIS.Format.JSON=HGIS.Class(HGIS.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,nativeJSON:(function(){return !!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")})(),read:function(json,filter){var object;if(this.nativeJSON){object=JSON.parse(json,filter)}else{try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}object=walk("",object)}}}catch(e){}}if(this.keepData){this.data=object}return object},write:function(D,B){this.pretty=!!B;var C=null;var A=typeof D;if(this.serialize[A]){try{C=(!this.pretty&&this.nativeJSON)?JSON.stringify(D):this.serialize[A].apply(this,[D])}catch(E){HGIS.Console.error("Trouble serializing: "+E)}}return C},writeIndent:function(){var B=[];if(this.pretty){for(var A=0;A<this.level;++A){B.push(this.indent)}}return B.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""},serialize:{"object":function(C){if(C==null){return"null"}if(C.constructor==Date){return this.serialize.date.apply(this,[C])}if(C.constructor==Array){return this.serialize.array.apply(this,[C])}var D=["{"];this.level+=1;var A,E,B;var F=false;for(A in C){if(C.hasOwnProperty(A)){E=HGIS.Format.JSON.prototype.write.apply(this,[A,this.pretty]);B=HGIS.Format.JSON.prototype.write.apply(this,[C[A],this.pretty]);if(E!=null&&B!=null){if(F){D.push(",")}D.push(this.writeNewline(),this.writeIndent(),E,":",this.writeSpace(),B);F=true}}}this.level-=1;D.push(this.writeNewline(),this.writeIndent(),"}");return D.join("")},"array":function(A){var C;var D=["["];this.level+=1;for(var B=0,E=A.length;B<E;++B){C=HGIS.Format.JSON.prototype.write.apply(this,[A[B],this.pretty]);if(C!=null){if(B>0){D.push(",")}D.push(this.writeNewline(),this.writeIndent(),C)}}this.level-=1;D.push(this.writeNewline(),this.writeIndent(),"]");return D.join("")},"string":function(B){var A={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(B)){return'"'+B.replace(/([\x00-\x1f\\"])/g,function(E,C){var D=A[C];if(D){return D}D=C.charCodeAt();return"\\u00"+Math.floor(D/16).toString(16)+(D%16).toString(16)})+'"'}return'"'+B+'"'},"number":function(A){return isFinite(A)?String(A):"null"},"boolean":function(A){return String(A)},"date":function(B){function A(C){return(C<10)?"0"+C:C}return'"'+B.getFullYear()+"-"+A(B.getMonth()+1)+"-"+A(B.getDate())+"T"+A(B.getHours())+":"+A(B.getMinutes())+":"+A(B.getSeconds())+'"'}},CLASS_NAME:"HGIS.Format.JSON"});HGIS.Format.GeoJSON=HGIS.Class(HGIS.Format.JSON,{ignoreExtraDims:false,read:function(B,I,C){I=(I)?I:"FeatureCollection";var F=null;var G=null;if(typeof B=="string"){G=HGIS.Format.JSON.prototype.read.apply(this,[B,C])}else{G=B}if(!G){HGIS.Console.error("Bad JSON: "+B)}else{if(typeof(G.type)!="string"){HGIS.Console.error("Bad GeoJSON - no type: "+B)}else{if(this.isValidType(G,I)){switch(I){case"Geometry":try{F=this.parseGeometry(G)}catch(D){HGIS.Console.error(D)}break;case"Feature":try{F=this.parseFeature(G);F.type="Feature"}catch(D){HGIS.Console.error(D)}break;case"FeatureCollection":F=[];switch(G.type){case"Feature":try{F.push(this.parseFeature(G))}catch(D){F=null;HGIS.Console.error(D)}break;case"FeatureCollection":for(var E=0,H=G.features.length;E<H;++E){try{F.push(this.parseFeature(G.features[E]))}catch(D){F=null;HGIS.Console.error(D)}}break;default:try{var A=this.parseGeometry(G);F.push(new HGIS.Feature.Vector(A))}catch(D){F=null;HGIS.Console.error(D)}}break}}}}return F},isValidType:function(B,A){var C=false;switch(A){case"Geometry":if(HGIS.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],B.type)==-1){HGIS.Console.error("Unsupported geometry type: "+B.type)}else{C=true}break;case"FeatureCollection":C=true;break;default:if(B.type==A){C=true}else{HGIS.Console.error("Cannot convert types from "+B.type+" to "+A)}}return C},parseFeature:function(B){var A,D,C,F;C=(B.properties)?B.properties:{};F=(B.geometry&&B.geometry.bbox)||B.bbox;try{D=this.parseGeometry(B.geometry)}catch(E){throw E}A=new HGIS.Feature.Vector(D,C);if(F){A.bounds=HGIS.Bounds.fromArray(F)}if(B.id){A.fid=B.id}return A},parseGeometry:function(B){if(B==null){return null}var E,D=false;if(B.type=="GeometryCollection"){if(!(HGIS.Util.isArray(B.geometries))){throw"GeometryCollection must have geometries array: "+B}var A=B.geometries.length;var G=new Array(A);for(var C=0;C<A;++C){G[C]=this.parseGeometry.apply(this,[B.geometries[C]])}E=new HGIS.Geometry.Collection(G);D=true}else{if(!(HGIS.Util.isArray(B.coordinates))){throw"Geometry must have coordinates array: "+B}if(!this.parseCoords[B.type.toLowerCase()]){throw"Unsupported geometry type: "+B.type}try{E=this.parseCoords[B.type.toLowerCase()].apply(this,[B.coordinates])}catch(F){throw F}}if(this.internalProjection&&this.externalProjection&&!D){E.transform(this.externalProjection,this.internalProjection)}return E},parseCoords:{"point":function(A){if(this.ignoreExtraDims==false&&A.length!=2){throw"Only 2D points are supported: "+A}return new HGIS.Geometry.Point(A[0],A[1])},"multipoint":function(A){var D=[];var C=null;for(var B=0,E=A.length;B<E;++B){try{C=this.parseCoords["point"].apply(this,[A[B]])}catch(F){throw F}D.push(C)}return new HGIS.Geometry.MultiPoint(D)},"linestring":function(A){var D=[];var C=null;for(var B=0,E=A.length;B<E;++B){try{C=this.parseCoords["point"].apply(this,[A[B]])}catch(F){throw F}D.push(C)}return new HGIS.Geometry.LineString(D)},"multilinestring":function(A){var C=[];var D=null;for(var B=0,E=A.length;B<E;++B){try{D=this.parseCoords["linestring"].apply(this,[A[B]])}catch(F){throw F}C.push(D)}return new HGIS.Geometry.MultiLineString(C)},"polygon":function(A){var E=[];var B,D;for(var C=0,F=A.length;C<F;++C){try{D=this.parseCoords["linestring"].apply(this,[A[C]])}catch(G){throw G}B=new HGIS.Geometry.LinearRing(D.components);E.push(B)}return new HGIS.Geometry.Polygon(E)},"multipolygon":function(A){var B=[];var C=null;for(var D=0,E=A.length;D<E;++D){try{C=this.parseCoords["polygon"].apply(this,[A[D]])}catch(F){throw F}B.push(C)}return new HGIS.Geometry.MultiPolygon(B)},"box":function(A){if(A.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new HGIS.Geometry.Polygon([new HGIS.Geometry.LinearRing([new HGIS.Geometry.Point(A[0][0],A[0][1]),new HGIS.Geometry.Point(A[1][0],A[0][1]),new HGIS.Geometry.Point(A[1][0],A[1][1]),new HGIS.Geometry.Point(A[0][0],A[1][1]),new HGIS.Geometry.Point(A[0][0],A[0][1])])])}},write:function(B,A){var G={"type":null};if(HGIS.Util.isArray(B)){G.type="FeatureCollection";var E=B.length;G.features=new Array(E);for(var C=0;C<E;++C){var F=B[C];if(!F instanceof HGIS.Feature.Vector){var D="FeatureCollection only supports collections of features: "+F;throw D}G.features[C]=this.extract.feature.apply(this,[F])}}else{if(B.CLASS_NAME.indexOf("HGIS.Geometry")==0){G=this.extract.geometry.apply(this,[B])}else{if(B instanceof HGIS.Feature.Vector){G=this.extract.feature.apply(this,[B]);if(B.layer&&B.layer.projection){G.crs=this.createCRSObject(B)}}}}return HGIS.Format.JSON.prototype.write.apply(this,[G,A])},createCRSObject:function(B){var D=B.layer.projection.toString();var A={};if(D.match(/epsg:/i)){var C=parseInt(D.substring(D.indexOf(":")+1));if(C==4326){A={"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{A={"type":"name","properties":{"name":"EPSG:"+C}}}}return A},extract:{"feature":function(A){var C=this.extract.geometry.apply(this,[A.geometry]);var B={"type":"Feature","properties":A.attributes,"geometry":C};if(A.fid!=null){B.id=A.fid}return B},"geometry":function(B){if(B==null){return null}if(this.internalProjection&&this.externalProjection){B=B.clone();B.transform(this.internalProjection,this.externalProjection)}var C=B.CLASS_NAME.split(".")[2];var D=this.extract[C.toLowerCase()].apply(this,[B]);var A;if(C=="Collection"){A={"type":"GeometryCollection","geometries":D}}else{A={"type":C,"coordinates":D}}return A},"point":function(A){return[A.x,A.y]},"multipoint":function(A){var B=[];for(var C=0,D=A.components.length;C<D;++C){B.push(this.extract.point.apply(this,[A.components[C]]))}return B},"linestring":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push(this.extract.point.apply(this,[C.components[B]]))}return A},"multilinestring":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push(this.extract.linestring.apply(this,[C.components[B]]))}return A},"polygon":function(D){var A=[];for(var B=0,C=D.components.length;B<C;++B){A.push(this.extract.linestring.apply(this,[D.components[B]]))}return A},"multipolygon":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push(this.extract.polygon.apply(this,[C.components[B]]))}return A},"collection":function(C){var D=C.components.length;var A=new Array(D);for(var B=0;B<D;++B){A[B]=this.extract.geometry.apply(this,[C.components[B]])}return A}},CLASS_NAME:"HGIS.Format.GeoJSON"});HGIS.Protocol.Script=HGIS.Class(HGIS.Protocol,{url:null,params:null,callback:null,callbackTemplate:"HGIS.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:false,initialize:function(B){B=B||{};this.params={};this.pendingRequests={};HGIS.Protocol.prototype.initialize.apply(this,arguments);if(!this.format){this.format=new HGIS.Format.GeoJSON()}if(!this.filterToParams&&HGIS.Format.QueryStringFilter){var A=new HGIS.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(C,D){return A.write(C,D)}}},read:function(B){HGIS.Protocol.prototype.read.apply(this,arguments);B=HGIS.Util.applyDefaults(B,this.options);B.params=HGIS.Util.applyDefaults(B.params,this.options.params);if(B.filter&&this.filterToParams){B.params=this.filterToParams(B.filter,B.params)}var C=new HGIS.Protocol.Response({requestType:"read"});var A=this.createRequest(B.url,B.params,HGIS.Function.bind(function(D){C.data=D;this.handleRead(C,B)},this));C.priv=A;return C},createRequest:function(B,F,A){var G=HGIS.Protocol.Script.register(A);var D=HGIS.String.format(this.callbackTemplate,{id:G});F=HGIS.Util.extend({},F);F[this.callbackKey]=this.callbackPrefix+D;B=HGIS.Util.urlAppend(B,HGIS.Util.getParameterString(F));var E=document.createElement("script");E.type="text/javascript";E.src=B;E.id="HGIS_Protocol_Script_"+G;this.pendingRequests[E.id]=E;var C=document.getElementsByTagName("head")[0];C.appendChild(E);return E},destroyRequest:function(A){HGIS.Protocol.Script.unregister(A.id.split("_").pop());delete this.pendingRequests[A.id];if(A.parentNode){A.parentNode.removeChild(A)}},handleRead:function(B,A){this.handleResponse(B,A)},handleResponse:function(B,A){if(A.callback){if(B.data){B.features=this.parseFeatures(B.data);B.code=HGIS.Protocol.Response.SUCCESS}else{B.code=HGIS.Protocol.Response.FAILURE}this.destroyRequest(B.priv);A.callback.call(A.scope,B)}},parseFeatures:function(A){return this.format.read(A)},abort:function(B){if(B){this.destroyRequest(B.priv)}else{for(var A in this.pendingRequests){this.destroyRequest(this.pendingRequests[A])}}},destroy:function(){this.abort();delete this.params;delete this.format;HGIS.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"HGIS.Protocol.Script"});(function(){var B=HGIS.Protocol.Script;var A=0;B.registry={};B.register=function(C){var D="c"+(++A);B.registry[D]=function(){C.apply(this,arguments)};return D};B.unregister=function(C){delete B.registry[C]}})();HGIS.Format.EncodedPolyline=HGIS.Class(HGIS.Format,{geometryType:"linestring",initialize:function(A){HGIS.Format.prototype.initialize.apply(this,[A])},read:function(H){var E;if(this.geometryType=="linestring"){E=HGIS.Geometry.LineString}else{if(this.geometryType=="linearring"){E=HGIS.Geometry.LinearRing}else{if(this.geometryType=="multipoint"){E=HGIS.Geometry.MultiPoint}else{if(this.geometryType!="point"&&this.geometryType!="polygon"){return null}}}}var B=this.decodeDeltas(H,2);var D=B.length;var A=[];for(var C=0;C+1<D;){var G=B[C++],F=B[C++];A.push(new HGIS.Geometry.Point(F,G))}if(this.geometryType=="point"){return new HGIS.Feature.Vector(A[0])}if(this.geometryType=="polygon"){return new HGIS.Feature.Vector(new HGIS.Geometry.Polygon([new HGIS.Geometry.LinearRing(A)]))}return new HGIS.Feature.Vector(new E(A))},decode:function(J,G,B){var E=B||100000;var A=this.decodeDeltas(J,G,E);var F=A.length;var H=[];for(var D=0;D+(G-1)<F;){var I=[];for(var C=0;C<G;++C){I.push(A[D++])}H.push(I)}return H},write:function(H){var G;if(H.constructor==Array){G=H[0]}else{G=H}var D=G.geometry;var F=D.CLASS_NAME.split(".")[2].toLowerCase();var A;if(F=="point"){A=new Array(D)}else{if(F=="linestring"||F=="linearring"||F=="multipoint"){A=D.components}else{if(F=="polygon"){A=D.components[0].components}else{return null}}}var C=[];var B=A.length;for(var E=0;E<B;++E){var I=A[E];C.push(I.y);C.push(I.x)}return this.encodeDeltas(C,2)},encode:function(G,A,B){var E=B||100000;var I=[];var D=G.length;for(var F=0;F<D;++F){var H=G[F];for(var C=0;C<A;++C){I.push(H[C])}}return this.encodeDeltas(I,A,E)},encodeDeltas:function(G,B,C){var E=C||100000;var A;var J=new Array(B);for(A=0;A<B;++A){J[A]=0}var H=G.length;for(var D=0;D<H;){for(A=0;A<B;++A,++D){var F=G[D];var I=F-J[A];J[A]=F;G[D]=I}}return this.encodeFloats(G,E)},decodeDeltas:function(H,B,C){var E=C||100000;var A;var I=new Array(B);for(A=0;A<B;++A){I[A]=0}var F=this.decodeFloats(H,E);var G=F.length;for(var D=0;D<G;){for(A=0;A<B;++A,++D){I[A]+=F[D];F[D]=I[A]}}return F},encodeFloats:function(C,E){var B=E||100000;var D=C.length;for(var A=0;A<D;++A){C[A]=Math.round(C[A]*B)}return this.encodeSignedIntegers(C)},decodeFloats:function(D,F){var B=F||100000;var C=this.decodeSignedIntegers(D);var E=C.length;for(var A=0;A<E;++A){C[A]/=B}return C},encodeSignedIntegers:function(C){var E=C.length;for(var B=0;B<E;++B){var D=C[B];var A=D<<1;if(D<0){A=~(A)}C[B]=A}return this.encodeUnsignedIntegers(C)},decodeSignedIntegers:function(D){var C=this.decodeUnsignedIntegers(D);var E=C.length;for(var A=0;A<E;++A){var B=C[A];C[A]=(B&1)?~(B>>1):(B>>1)}return C},encodeUnsignedIntegers:function(B){var C="";var D=B.length;for(var A=0;A<D;++A){C+=this.encodeUnsignedInteger(B[A])}return C},decodeUnsignedIntegers:function(E){var D=[];var C=0;var B=0;var G=E.length;for(var A=0;A<G;++A){var F=E.charCodeAt(A)-63;C|=(F&31)<<B;if(F<32){D.push(C);C=0;B=0}else{B+=5}}return D},encodeFloat:function(A,B){A=Math.round(A*(B||100000));return this.encodeSignedInteger(A)},decodeFloat:function(B,C){var A=this.decodeSignedInteger(B);return A/(C||100000)},encodeSignedInteger:function(B){var A=B<<1;if(B<0){A=~(A)}return this.encodeUnsignedInteger(A)},decodeSignedInteger:function(B){var A=this.decodeUnsignedInteger(B);return((A&1)?~(A>>1):(A>>1))},encodeUnsignedInteger:function(A){var B,C="";while(A>=32){B=(32|(A&31))+63;C+=(String.fromCharCode(B));A>>=5}B=A+63;C+=(String.fromCharCode(B));return C},decodeUnsignedInteger:function(D){var B=0;var C=0;var F=D.length;for(var A=0;A<F;++A){var E=D.charCodeAt(A)-63;B|=(E&31)<<C;if(E<32){break}C+=5}return B},CLASS_NAME:"HGIS.Format.EncodedPolyline"});HGIS.Control.Panel=HGIS.Class(HGIS.Control,{controls:null,autoActivate:true,defaultControl:null,saveState:false,allowDepress:false,activeState:null,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,[A]);this.controls=[];this.activeState={}},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onButtonClick)}HGIS.Control.prototype.destroy.apply(this,arguments);for(var B,A=this.controls.length-1;A>=0;A--){B=this.controls[A];if(B.events){B.events.un({activate:this.iconOn,deactivate:this.iconOff})}B.panel_div=null}this.activeState=null},activate:function(){if(HGIS.Control.prototype.activate.apply(this,arguments)){var C;for(var A=0,B=this.controls.length;A<B;A++){C=this.controls[A];if(C===this.defaultControl||(this.saveState&&this.activeState[C.id])){C.activate()}}if(this.saveState===true){this.defaultControl=null}this.redraw();return true}else{return false}},deactivate:function(){if(HGIS.Control.prototype.deactivate.apply(this,arguments)){var C;for(var A=0,B=this.controls.length;A<B;A++){C=this.controls[A];this.activeState[C.id]=C.deactivate()}this.redraw();return true}else{return false}},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(this.outsideViewport){this.events.attachToElement(this.div);this.events.register("buttonclick",this,this.onButtonClick)}else{this.map.events.register("buttonclick",this,this.onButtonClick)}this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var B=this.div.childNodes.length,A=B-1;A>=0;A--){this.div.removeChild(this.div.childNodes[A])}this.div.innerHTML="";if(this.active){for(var A=0,C=this.controls.length;A<C;A++){this.div.appendChild(this.controls[A].panel_div)}}},activateControl:function(D){if(!this.active){return false}if(D.type==HGIS.Control.TYPE_BUTTON){D.trigger();return}if(D.type==HGIS.Control.TYPE_TOGGLE){if(D.active){D.deactivate()}else{D.activate()}return}if(this.allowDepress&&D.active){D.deactivate()}else{var C;for(var A=0,B=this.controls.length;A<B;A++){C=this.controls[A];if(C!=D&&(C.type===HGIS.Control.TYPE_TOOL||C.type==null)){C.deactivate()}}D.activate()}},addControls:function(B){if(!(HGIS.Util.isArray(B))){B=[B]}this.controls=this.controls.concat(B);for(var A=0,C=B.length;A<C;A++){var E=B[A],D=this.createControlMarkup(E);HGIS.Element.addClass(D,E.displayClass+"ItemInactive");HGIS.Element.addClass(D,"olButton");if(E.title!=""&&!D.title){D.title=E.title}E.panel_div=D}if(this.map){this.addControlsToMap(B);this.redraw()}},createControlMarkup:function(A){return document.createElement("div")},addControlsToMap:function(B){var D;for(var A=0,C=B.length;A<C;A++){D=B[A];if(D.autoActivate===true){D.autoActivate=false;this.map.addControl(D);D.autoActivate=true}else{this.map.addControl(D);D.deactivate()}D.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var A=this.panel_div;var B=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");A.className=A.className.replace(B,"$1Active")},iconOff:function(){var A=this.panel_div;var B=new RegExp("\\b("+this.displayClass+"Item)Active\\b");A.className=A.className.replace(B,"$1Inactive")},onButtonClick:function(D){var C=this.controls,A=D.buttonElement;for(var B=C.length-1;B>=0;--B){if(C[B].panel_div===A){this.activateControl(C[B]);break}}},getControlsBy:function(C,B){var A=(typeof B.test=="function");var D=HGIS.Array.filter(this.controls,function(E){return E[C]==B||(A&&B.test(E[C]))});return D},getControlsByName:function(A){return this.getControlsBy("name",A)},getControlsByClass:function(A){return this.getControlsBy("CLASS_NAME",A)},CLASS_NAME:"HGIS.Control.Panel"});HGIS.Control.Button=HGIS.Class(HGIS.Control,{type:HGIS.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"HGIS.Control.Button"});HGIS.Control.ZoomIn=HGIS.Class(HGIS.Control.Button,{trigger:function(){if(this.map){this.map.zoomIn()}},CLASS_NAME:"HGIS.Control.ZoomIn"});HGIS.Control.ZoomOut=HGIS.Class(HGIS.Control.Button,{trigger:function(){if(this.map){this.map.zoomOut()}},CLASS_NAME:"HGIS.Control.ZoomOut"});HGIS.Control.ZoomToMaxExtent=HGIS.Class(HGIS.Control.Button,{trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"HGIS.Control.ZoomToMaxExtent"});HGIS.Control.ZoomPanel=HGIS.Class(HGIS.Control.Panel,{initialize:function(A){HGIS.Control.Panel.prototype.initialize.apply(this,[A]);this.addControls([new HGIS.Control.ZoomIn(),new HGIS.Control.ZoomToMaxExtent(),new HGIS.Control.ZoomOut()])},CLASS_NAME:"HGIS.Control.ZoomPanel"});HGIS.Layer.HTTPRequest=HGIS.Class(HGIS.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(C,A,D,B){HGIS.Layer.prototype.initialize.apply(this,[C,B]);this.url=A;if(!this.params){this.params=HGIS.Util.extend({},D)}},destroy:function(){this.url=null;this.params=null;HGIS.Layer.prototype.destroy.apply(this,arguments)},clone:function(A){if(A==null){A=new HGIS.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.prototype.clone.apply(this,[A]);return A},setUrl:function(A){this.url=A},mergeNewParams:function(A){this.params=HGIS.Util.extend(this.params,A);var B=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})}return B},redraw:function(A){if(A){return this.mergeNewParams({"_olSalt":Math.random()})}else{return HGIS.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(E,D){var B=1;for(var A=0,C=E.length;A<C;A++){B*=E.charCodeAt(A)*this.URL_HASH_FACTOR;B-=Math.floor(B)}return D[Math.floor(B*D.length)]},getFullRequestString:function(C,D){var B=D||this.url;var G=HGIS.Util.extend({},this.params);G=HGIS.Util.extend(G,C);var E=HGIS.Util.getParameterString(G);if(HGIS.Util.isArray(B)){B=this.selectUrl(E,B)}var F=HGIS.Util.upperCaseObject(HGIS.Util.getParameters(B));for(var A in G){if(A.toUpperCase() in F){delete G[A]}}E=HGIS.Util.getParameterString(G);return HGIS.Util.urlAppend(B,E)},CLASS_NAME:"HGIS.Layer.HTTPRequest"});HGIS.Tile=HGIS.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(E,A,C,B,F,D){this.layer=E;this.position=A.clone();this.setBounds(C);this.url=B;if(F){this.size=F.clone()}this.id=HGIS.Util.createUniqueID("Tile_");HGIS.Util.extend(this,D);this.events=new HGIS.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.eventListeners=null;this.events=null},draw:function(A){if(!A){this.clear()}var B=this.shouldDraw();if(B&&!A&&this.events.triggerEvent("beforedraw")===false){B=null}return B},shouldDraw:function(){var A=false,C=this.layer.maxExtent;if(C){var B=this.layer.map;var D=B.baseLayer.wrapDateLine&&B.getMaxExtent();if(this.bounds.intersectsBounds(C,{inclusive:false,worldBounds:D})){A=true}}return A||this.layer.displayOutsideMaxExtent},setBounds:function(B){B=B.clone();if(this.layer.map.baseLayer.wrapDateLine){var C=this.layer.map.getMaxExtent(),A=this.layer.map.getResolution();B=B.wrapDateLine(C,{leftTolerance:A,rightTolerance:A})}this.bounds=B},moveTo:function(A,B,C){if(C==null){C=true}this.setBounds(A);this.position=B.clone();if(C){this.draw()}},clear:function(A){},CLASS_NAME:"HGIS.Tile"});HGIS.Tile.Image=HGIS.Class(HGIS.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(E,A,C,B,F,D){HGIS.Tile.prototype.initialize.apply(this,arguments);this.url=B;this.layerAlphaHack=this.layer.alpha&&HGIS.Util.alphaHack();if(this.maxGetUrlLength!=null||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");this.frame.style.position="absolute";this.frame.style.overflow="hidden"}if(this.maxGetUrlLength!=null){HGIS.Util.extend(this,HGIS.Tile.Image.IFrame)}},destroy:function(){if(this.imgDiv){this.clear();this.imgDiv=null;this.frame=null}this.asyncRequestId=null;HGIS.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var A=HGIS.Tile.prototype.draw.apply(this,arguments);if(A){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}if(this.isLoading){this._loadEvent="reload"}else{this.isLoading=true;this._loadEvent="loadstart"}this.renderTile();this.positionTile()}else{if(A===false){this.unload()}}return A},renderTile:function(){if(this.layer.async){var A=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(B){if(A==this.asyncRequestId){this.url=B;this.initImage()}},this)}else{this.url=this.layer.getURL(this.bounds);this.initImage()}},positionTile:function(){var C=this.getTile().style,A=this.frame?this.size:this.layer.getImageSize(this.bounds),B=1;if(this.layer instanceof HGIS.Layer.Grid){B=this.layer.getServerResolution()/this.layer.map.getResolution()}C.left=this.position.x+"px";C.top=this.position.y+"px";C.width=Math.round(B*A.w)+"px";C.height=Math.round(B*A.h)+"px"},clear:function(){HGIS.Tile.prototype.clear.apply(this,arguments);var B=this.imgDiv;if(B){var A=this.getTile();if(A.parentNode===this.layer.div){this.layer.div.removeChild(A)}this.setImgSrc();if(this.layerAlphaHack===true){B.style.filter=""}HGIS.Element.removeClass(B,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=HGIS.Tile.Image.IMAGE.cloneNode(false);var C=this.imgDiv.style;if(this.frame){var A=0,B=0;if(this.layer.gutter){A=this.layer.gutter/this.layer.tileSize.w*100;B=this.layer.gutter/this.layer.tileSize.h*100}C.left=-A+"%";C.top=-B+"%";C.width=(2*A+100)+"%";C.height=(2*B+100)+"%"}C.visibility="hidden";C.opacity=0;if(this.layer.opacity<1){C.filter="alpha(opacity="+(this.layer.opacity*100)+")"}C.position="absolute";if(this.layerAlphaHack){C.paddingTop=C.height;C.height="0";C.width="100%"}if(this.frame){this.frame.appendChild(this.imgDiv)}}return this.imgDiv},setImage:function(A){this.imgDiv=A},initImage:function(){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var A=this.getImage();if((typeof(this.url))=="string"){if(this.url&&HGIS.Util.isEquivalentUrl(A.src,this.url)){this._loadTimeout=window.setTimeout(HGIS.Function.bind(this.onImageLoad,this),0)}else{this.stopLoading();if(this.crossOriginKeyword){A.removeAttribute("crossorigin")}HGIS.Event.observe(A,"load",HGIS.Function.bind(this.onImageLoad,this));HGIS.Event.observe(A,"error",HGIS.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)}}else{var A=this.imgDiv;if(A.src){this._loadTimeout=window.setTimeout(HGIS.Function.bind(this.onImageLoad,this),0)}else{if(this.crossOriginKeyword){A.removeAttribute("crossorigin")}HGIS.Event.observe(A,"load",HGIS.Function.bind(this.onImageLoad,this));HGIS.Event.observe(A,"error",HGIS.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgAsyn(this.url)}}},setImgAsyn:function(A){var B=this.imgDiv;this.url.then(function(C){B.src=C})},setImgSrc:function(A){var B=this.imgDiv;if(A){B.style.visibility="hidden";B.style.opacity=0;if(this.crossOriginKeyword){if(A.substr(0,5)!=="data:"){B.setAttribute("crossorigin",this.crossOriginKeyword)}else{B.removeAttribute("crossorigin")}}B.src=A}else{this.stopLoading();this.imgDiv=null;if(B.parentNode){B.parentNode.removeChild(B)}}},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(!this.imgDiv||this.isLoading){return}var A;if(this.frame){A=this.frame.cloneNode(false);A.appendChild(this.imgDiv)}else{A=this.imgDiv}this.imgDiv=null;return A},onImageLoad:function(){var A=this.imgDiv;this.stopLoading();A.style.visibility="inherit";A.style.opacity=this.layer.opacity;this.isLoading=false;this.canvasContext=null;this.events.triggerEvent("loadend");if(this.layerAlphaHack===true){A.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+A.src+"', sizingMethod='scale')"}},onImageError:function(){var A=this.imgDiv;if(A.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{HGIS.Element.addClass(A,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad()}}},stopLoading:function(){HGIS.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(HGIS.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var A=document.createElement("canvas");A.width=this.size.w;A.height=this.size.h;this.canvasContext=A.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"HGIS.Tile.Image"});HGIS.Tile.Image.IMAGE=(function(){var A=new Image();A.className="olTileImage";A.galleryImg="no";return A}());HGIS.Layer.Grid=HGIS.Class(HGIS.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:HGIS.Tile.Image,grid:null,singleTile:false,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:false,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(C,A,D,B){HGIS.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=HGIS.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign=this.tileOriginCorner.substr(0,1)==="t"?1:-1},initProperties:function(){if(this.options.removeBackBufferDelay===undefined){this.removeBackBufferDelay=this.singleTile?0:2500}if(this.options.className===undefined){this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"}},setMap:function(A){HGIS.Layer.HTTPRequest.prototype.setMap.call(this,A);HGIS.Element.addClass(this.div,this.className)},removeMap:function(A){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;HGIS.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var B=0,D=this.grid.length;B<D;B++){var C=this.grid[B];for(var A=0,F=C.length;A<F;A++){var E=C[A];this.destroyTile(E)}}this.grid=[];this.gridResolution=null;this.gridLayout=null}},addOptions:function(C,A){var B=C.singleTile!==undefined&&C.singleTile!==this.singleTile;HGIS.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);if(this.map&&B){this.initProperties();this.clearGrid();this.tileSize=this.options.tileSize;this.setTileSize();this.moveTo(null,true)}},clone:function(A){if(A==null){A=new HGIS.Layer.Grid(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.HTTPRequest.prototype.clone.apply(this,[A]);if(this.tileSize!=null){A.tileSize=this.tileSize.clone()}A.grid=[];A.gridResolution=null;A.backBuffer=null;A.backBufferTimerId=null;A.loading=false;A.numLoadingTiles=0;return A},moveTo:function(D,C,F){HGIS.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);D=D||this.map.getExtent();if(D!=null){var E=!this.grid.length||C;var B=this.getTilesBounds();var A=this.map.getResolution();var G=this.getServerResolution(A);if(this.singleTile){if(E||(!F&&!B.containsBounds(D))){if(C&&this.transitionEffect!=="resize"){this.removeBackBuffer()}if(!C||this.transitionEffect==="resize"){this.applyBackBuffer(A)}this.initSingleTile(D)}}else{E=E||!B.intersectsBounds(D,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()});if(E){if(C&&(this.transitionEffect==="resize"||this.gridResolution===A)){this.applyBackBuffer(A)}this.initGriddedTiles(D)}else{this.moveGriddedTiles()}}}},getTileData:function(R){var K=null,E=R.lon,O=R.lat,D=this.grid.length;if(this.map&&D){var N=this.map.getResolution(),L=this.tileSize.w,I=this.tileSize.h,G=this.grid[0][0].bounds,J=G.left,H=G.top;if(E<J){if(this.map.baseLayer.wrapDateLine){var A=this.map.getMaxExtent().getWidth();var C=Math.ceil((J-E)/A);E+=A*C}}var P=(E-J)/(N*L);var Q=(H-O)/(N*I);var M=Math.floor(P);var F=Math.floor(Q);if(F>=0&&F<D){var B=this.grid[F][M];if(B){K={tile:B,i:Math.floor((P-M)*L),j:Math.floor((Q-F)*I)}}}}return K},destroyTile:function(A){this.removeTileMonitoringHooks(A);A.destroy()},getServerResolution:function(D){var E=Number.POSITIVE_INFINITY;D=D||this.map.getResolution();if(this.serverResolutions&&HGIS.Util.indexOf(this.serverResolutions,D)===-1){var A,B,C,F;for(A=this.serverResolutions.length-1;A>=0;A--){C=this.serverResolutions[A];B=Math.abs(C-D);if(B>E){break}E=B;F=C}D=F}return D},getServerZoom:function(){var A=this.getServerResolution();return this.serverResolutions?HGIS.Util.indexOf(this.serverResolutions,A):this.map.getZoomForResolution(A)+(this.zoomOffset||0)},applyBackBuffer:function(H){if(this.backBufferTimerId!==null){this.removeBackBuffer()}var D=this.backBuffer;if(!D){D=this.createBackBuffer();if(!D){return}if(H===this.gridResolution){this.div.insertBefore(D,this.div.firstChild)}else{this.map.baseLayer.div.parentNode.insertBefore(D,this.map.baseLayer.div)}this.backBuffer=D;var C=this.grid[0][0].bounds;this.backBufferLonLat={lon:C.left,lat:C.top};this.backBufferResolution=this.gridResolution}var I=this.backBufferResolution/H;var B=D.childNodes,A;for(var E=B.length-1;E>=0;--E){A=B[E];A.style.top=((I*A._i*A._h)|0)+"px";A.style.left=((I*A._j*A._w)|0)+"px";A.style.width=Math.round(I*A._w)+"px";A.style.height=Math.round(I*A._h)+"px"}var G=this.getViewPortPxFromLonLat(this.backBufferLonLat,H);var F=this.map.layerContainerOriginPx.x;var J=this.map.layerContainerOriginPx.y;D.style.left=Math.round(G.x-F)+"px";D.style.top=Math.round(G.y-J)+"px"},createBackBuffer:function(){var B;if(this.grid.length>0){B=document.createElement("div");B.id=this.div.id+"_bb";B.className="olBackBuffer";B.style.position="absolute";var H=this.map;B.style.zIndex=this.transitionEffect==="resize"?this.getZIndex()-1:H.Z_INDEX_BASE.BaseLayer-(H.getNumLayers()-H.getLayerIndex(this));for(var F=0,D=this.grid.length;F<D;F++){for(var E=0,C=this.grid[F].length;E<C;E++){var A=this.grid[F][E],G=this.grid[F][E].createBackBuffer();if(G){G._i=F;G._j=E;G._w=A.size.w;G._h=A.size.h;G.id=A.id+"_bb";B.appendChild(G)}}}}return B},removeBackBuffer:function(){if(this._transitionElement){for(var A=this.transitionendEvents.length-1;A>=0;--A){HGIS.Event.stopObserving(this._transitionElement,this.transitionendEvents[A],this._removeBackBuffer)}delete this._transitionElement}if(this.backBuffer){if(this.backBuffer.parentNode){this.backBuffer.parentNode.removeChild(this.backBuffer)}this.backBuffer=null;this.backBufferResolution=null;if(this.backBufferTimerId!==null){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}}},moveByPx:function(A,B){if(!this.singleTile){this.moveGriddedTiles()}},setTileSize:function(A){if(this.singleTile){A=this.map.getSize();A.h=parseInt(A.h*this.ratio,10);A.w=parseInt(A.w*this.ratio,10)}HGIS.Layer.HTTPRequest.prototype.setTileSize.apply(this,[A])},getTilesBounds:function(){var B=null;var A=this.grid.length;if(A){var D=this.grid[A-1][0].bounds,E=this.grid[0].length*D.getWidth(),C=this.grid.length*D.getHeight();B=new HGIS.Bounds(D.left,D.bottom,D.left+E,D.bottom+C)}return B},initSingleTile:function(B){this.events.triggerEvent("retile");var D=B.getCenterLonLat();var A=B.getWidth()*this.ratio;var C=B.getHeight()*this.ratio;var G=new HGIS.Bounds(D.lon-(A/2),D.lat-(C/2),D.lon+(A/2),D.lat+(C/2));var E=this.map.getLayerPxFromLonLat({lon:G.left,lat:G.top});if(!this.grid.length){this.grid[0]=[]}var F=this.grid[0][0];if(!F){F=this.addTile(G,E);this.addTileMonitoringHooks(F);F.draw();this.grid[0][0]=F}else{F.moveTo(G,E)}this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(C,F,I){var D=I*this.tileSize.w;var G=I*this.tileSize.h;var H=C.left-F.lon;var E=Math.floor(H/D)-this.buffer;var A=this.rowSign;var J=A*(F.lat-C.top+G);var B=Math[~A?"floor":"ceil"](J/G)-this.buffer*A;return{tilelon:D,tilelat:G,startcol:E,startrow:B}},getTileOrigin:function(){var C=this.tileOrigin;if(!C){var B=this.getMaxExtent();var A=({"tl":["left","top"],"tr":["right","top"],"bl":["left","bottom"],"br":["right","bottom"]})[this.tileOriginCorner];C=new HGIS.LonLat(B[A[0]],B[A[1]])}return C},getTileBoundsForGridIndex:function(H,I){var F=this.getTileOrigin();var B=this.gridLayout;var C=B.tilelon;var E=B.tilelat;var G=B.startcol;var D=B.startrow;var A=this.rowSign;return new HGIS.Bounds(F.lon+(G+I)*C,F.lat-(D+H*A)*E*A,F.lon+(G+I+1)*C,F.lat-(D+(H-1)*A)*E*A)},initGriddedTiles:function(U){this.events.triggerEvent("retile");var Y=this.map.getSize();var E=this.getTileOrigin();var S=this.map.getResolution(),L=this.getServerResolution(),T=S/L,G={w:this.tileSize.w/T,h:this.tileSize.h/T};var C=Math.ceil(Y.h/G.h)+2*this.buffer+1;var D=Math.ceil(Y.w/G.w)+2*this.buffer+1;var X=this.calculateGridLayout(U,E,L);this.gridLayout=X;var A=X.tilelon;var I=X.tilelat;var N=this.map.layerContainerOriginPx.x;var Q=this.map.layerContainerOriginPx.y;var B=this.getTileBoundsForGridIndex(0,0);var Z=this.map.getViewPortPxFromLonLat(new HGIS.LonLat(B.left,B.top));Z.x=Math.round(Z.x)-N;Z.y=Math.round(Z.y)-Q;var P=[],H=this.map.getCenter();var R=0;do{var O=this.grid[R];if(!O){O=[];this.grid.push(O)}var K=0;do{B=this.getTileBoundsForGridIndex(R,K);var W=Z.clone();W.x=W.x+K*Math.round(G.w);W.y=W.y+R*Math.round(G.h);var J=O[K];if(!J){J=this.addTile(B,W);this.addTileMonitoringHooks(J);O.push(J)}else{J.moveTo(B,W,false)}var F=B.getCenterLonLat();P.push({tile:J,distance:Math.pow(F.lon-H.lon,2)+Math.pow(F.lat-H.lat,2)});K+=1}while((B.right<=U.right+A*this.buffer)||K<D);R+=1}while((B.bottom>=U.bottom-I*this.buffer)||R<C);this.removeExcessTiles(R,K);var S=this.getServerResolution();this.gridResolution=S;P.sort(function(e,d){return e.distance-d.distance});for(var V=0,M=P.length;V<M;++V){P[V].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(A,B){var C=new this.tileClass(this,B,A,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:C});return C},addTileMonitoringHooks:function(A){var B="olTileReplacing";A.onLoadStart=function(){if(this.loading===false){this.loading=true;this.events.triggerEvent("loadstart")}this.events.triggerEvent("tileloadstart",{tile:A});this.numLoadingTiles++;if(!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution){HGIS.Element.addClass(A.getTile(),B)}};A.onLoadEnd=function(F){this.numLoadingTiles--;var C=F.type==="unload";this.events.triggerEvent("tileloaded",{tile:A,aborted:C});if(!this.singleTile&&!C&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var G=A.getTile();if(HGIS.Element.getStyle(G,"display")==="none"){var E=document.getElementById(A.id+"_bb");if(E){E.parentNode.removeChild(E)}}HGIS.Element.removeClass(G,B)}if(this.numLoadingTiles===0){if(this.backBuffer){if(this.backBuffer.childNodes.length===0){this.removeBackBuffer()}else{this._transitionElement=C?this.div.lastChild:A.imgDiv;var H=this.transitionendEvents;for(var D=H.length-1;D>=0;--D){HGIS.Event.observe(this._transitionElement,H[D],this._removeBackBuffer)}this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}}this.loading=false;this.events.triggerEvent("loadend")}};A.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:A})};A.events.on({"loadstart":A.onLoadStart,"loadend":A.onLoadEnd,"unload":A.onLoadEnd,"loaderror":A.onLoadError,scope:this})},removeTileMonitoringHooks:function(A){A.unload();A.events.un({"loadstart":A.onLoadStart,"loadend":A.onLoadEnd,"unload":A.onLoadEnd,"loaderror":A.onLoadError,scope:this})},moveGriddedTiles:function(){var B=this.buffer+1;while(true){var A=this.grid[0][0];var E={x:A.position.x+this.map.layerContainerOriginPx.x,y:A.position.y+this.map.layerContainerOriginPx.y};var C=this.getServerResolution()/this.map.getResolution();var D={w:Math.round(this.tileSize.w*C),h:Math.round(this.tileSize.h*C)};if(E.x>-D.w*(B-1)){this.shiftColumn(true,D)}else{if(E.x<-D.w*B){this.shiftColumn(false,D)}else{if(E.y>-D.h*(B-1)){this.shiftRow(true,D)}else{if(E.y<-D.h*B){this.shiftRow(false,D)}else{break}}}}}},shiftRow:function(D,K){var M=this.grid;var B=D?0:(M.length-1);var L=D?-1:1;var A=this.rowSign;var C=this.gridLayout;C.startrow+=L*A;var I=M[B];var G=M[D?"pop":"shift"]();for(var F=0,J=G.length;F<J;F++){var E=G[F];var H=I[F].position.clone();H.y+=K.h*L;E.moveTo(this.getTileBoundsForGridIndex(B,F),H)}M[D?"unshift":"push"](G)},shiftColumn:function(C,I){var K=this.grid;var G=C?0:(K[0].length-1);var J=C?-1:1;var B=this.gridLayout;B.startcol+=J;for(var D=0,H=K.length;D<H;D++){var E=K[D];var F=E[G].position.clone();var A=E[C?"pop":"shift"]();F.x+=I.w*J;A.moveTo(this.getTileBoundsForGridIndex(D,G),F);E[C?"unshift":"push"](A)}},removeExcessTiles:function(D,F){var A,C;while(this.grid.length>D){var B=this.grid.pop();for(A=0,C=B.length;A<C;A++){var E=B[A];this.destroyTile(E)}}for(A=0,C=this.grid.length;A<C;A++){while(this.grid[A].length>F){var B=this.grid[A];var E=B.pop();this.destroyTile(E)}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(E){var A=this.maxExtent;var F=this.getResolution();var C=F*this.tileSize.w;var B=F*this.tileSize.h;var D=this.getLonLatFromViewPortPx(E);var H=A.left+(C*Math.floor((D.lon-A.left)/C));var G=A.bottom+(B*Math.floor((D.lat-A.bottom)/B));return new HGIS.Bounds(H,G,H+C,G+B)},CLASS_NAME:"HGIS.Layer.Grid"});HGIS.Format.ArcXML=HGIS.Class(HGIS.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(A){this.request=new HGIS.Format.ArcXML.Request();this.response=new HGIS.Format.ArcXML.Response();if(A){if(A.requesttype=="feature"){this.request.get_image=null;var C=this.request.get_feature.query;this.addCoordSys(C.featurecoordsys,A.featureCoordSys);this.addCoordSys(C.filtercoordsys,A.filterCoordSys);if(A.polygon){C.isspatial=true;C.spatialfilter.polygon=A.polygon}else{if(A.envelope){C.isspatial=true;C.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0};this.parseEnvelope(C.spatialfilter.envelope,A.envelope)}}}else{if(A.requesttype=="image"){this.request.get_feature=null;var B=this.request.get_image.properties;this.parseEnvelope(B.envelope,A.envelope);this.addLayers(B.layerlist,A.layers);this.addImageSize(B.imagesize,A.tileSize);this.addCoordSys(B.featurecoordsys,A.featureCoordSys);this.addCoordSys(B.filtercoordsys,A.filterCoordSys)}else{this.request=null}}}HGIS.Format.XML.prototype.initialize.apply(this,[A])},parseEnvelope:function(A,B){if(B&&B.length==4){A.minx=B[0];A.miny=B[1];A.maxx=B[2];A.maxy=B[3]}},addLayers:function(A,B){for(var D=0,C=B.length;D<C;D++){A.push(B[D])}},addImageSize:function(A,B){if(B!==null){A.width=B.w;A.height=B.h;A.printwidth=B.w;A.printheight=B.h}},addCoordSys:function(B,A){if(typeof A=="string"){B.id=parseInt(A);B.string=A}else{if(typeof A=="object"&&A.proj!==null){B.id=A.proj.srsProjNumber;B.string=A.proj.srsCode}else{B=A}}},iserror:function(C){var B=null;if(!C){B=(this.response.error!=="")}else{C=HGIS.Format.XML.prototype.read.apply(this,[C]);var A=C.documentElement.getElementsByTagName("ERROR");B=(A!==null&&A.length>0)}return B},read:function(F){if(typeof F=="string"){F=HGIS.Format.XML.prototype.read.apply(this,[F])}var B=null;if(F&&F.documentElement){if(F.documentElement.nodeName=="ARCXML"){B=F.documentElement}else{B=F.documentElement.getElementsByTagName("ARCXML")[0]}}if(!B||B.firstChild.nodeName==="parsererror"){var D,A;try{D=F.firstChild.nodeValue;A=F.firstChild.childNodes[1].firstChild.nodeValue}catch(C){}throw {message:"Error parsing the ArcXML request",error:D,source:A}}var E=this.parseResponse(B);return E},write:function(E){if(!E){E=this.request}var N=this.createElementNS("","ARCXML");N.setAttribute("version","1.1");var X=this.createElementNS("","REQUEST");if(E.get_image!=null){var I=this.createElementNS("","GET_IMAGE");X.appendChild(I);var S=this.createElementNS("","PROPERTIES");I.appendChild(S);var C=E.get_image.properties;if(C.featurecoordsys!=null){var L=this.createElementNS("","FEATURECOORDSYS");S.appendChild(L);if(C.featurecoordsys.id===0){L.setAttribute("string",C.featurecoordsys["string"])}else{L.setAttribute("id",C.featurecoordsys.id)}}if(C.filtercoordsys!=null){var P=this.createElementNS("","FILTERCOORDSYS");S.appendChild(P);if(C.filtercoordsys.id===0){P.setAttribute("string",C.filtercoordsys.string)}else{P.setAttribute("id",C.filtercoordsys.id)}}if(C.envelope!=null){var A=this.createElementNS("","ENVELOPE");S.appendChild(A);A.setAttribute("minx",C.envelope.minx);A.setAttribute("miny",C.envelope.miny);A.setAttribute("maxx",C.envelope.maxx);A.setAttribute("maxy",C.envelope.maxy)}var H=this.createElementNS("","IMAGESIZE");S.appendChild(H);H.setAttribute("height",C.imagesize.height);H.setAttribute("width",C.imagesize.width);if(C.imagesize.height!=C.imagesize.printheight||C.imagesize.width!=C.imagesize.printwidth){H.setAttribute("printheight",C.imagesize.printheight);H.setArrtibute("printwidth",C.imagesize.printwidth)}if(C.background!=null){var D=this.createElementNS("","BACKGROUND");S.appendChild(D);D.setAttribute("color",C.background.color.r+","+C.background.color.g+","+C.background.color.b);if(C.background.transcolor!==null){D.setAttribute("transcolor",C.background.transcolor.r+","+C.background.transcolor.g+","+C.background.transcolor.b)}}if(C.layerlist!=null&&C.layerlist.length>0){var B=this.createElementNS("","LAYERLIST");S.appendChild(B);for(var U=0;U<C.layerlist.length;U++){var W=this.createElementNS("","LAYERDEF");B.appendChild(W);W.setAttribute("id",C.layerlist[U].id);W.setAttribute("visible",C.layerlist[U].visible);if(typeof C.layerlist[U].query=="object"){var F=C.layerlist[U].query;if(F.where.length<0){continue}var M=null;if(typeof F.spatialfilter=="boolean"&&F.spatialfilter){M=this.createElementNS("","SPATIALQUERY")}else{M=this.createElementNS("","QUERY")}M.setAttribute("where",F.where);if(typeof F.accuracy=="number"&&F.accuracy>0){M.setAttribute("accuracy",F.accuracy)}if(typeof F.featurelimit=="number"&&F.featurelimit<2000){M.setAttribute("featurelimit",F.featurelimit)}if(typeof F.subfields=="string"&&F.subfields!="#ALL#"){M.setAttribute("subfields",F.subfields)}if(typeof F.joinexpression=="string"&&F.joinexpression.length>0){M.setAttribute("joinexpression",F.joinexpression)}if(typeof F.jointables=="string"&&F.jointables.length>0){M.setAttribute("jointables",F.jointables)}W.appendChild(M)}if(typeof C.layerlist[U].renderer=="object"){this.addRenderer(W,C.layerlist[U].renderer)}}}}else{if(E.get_feature!=null){var I=this.createElementNS("","GET_FEATURES");I.setAttribute("outputmode","newxml");I.setAttribute("checkesc","true");if(E.get_feature.geometry){I.setAttribute("geometry",E.get_feature.geometry)}else{I.setAttribute("geometry","false")}if(E.get_feature.compact){I.setAttribute("compact",E.get_feature.compact)}if(E.get_feature.featurelimit=="number"){I.setAttribute("featurelimit",E.get_feature.featurelimit)}I.setAttribute("globalenvelope","true");X.appendChild(I);if(E.get_feature.layer!=null&&E.get_feature.layer.length>0){var V=this.createElementNS("","LAYER");V.setAttribute("id",E.get_feature.layer);I.appendChild(V)}var O=E.get_feature.query;if(O!=null){var Q=null;if(O.isspatial){Q=this.createElementNS("","SPATIALQUERY")}else{Q=this.createElementNS("","QUERY")}I.appendChild(Q);if(typeof O.accuracy=="number"){Q.setAttribute("accuracy",O.accuracy)}if(O.featurecoordsys!=null){var G=this.createElementNS("","FEATURECOORDSYS");if(O.featurecoordsys.id==0){G.setAttribute("string",O.featurecoordsys.string)}else{G.setAttribute("id",O.featurecoordsys.id)}Q.appendChild(G)}if(O.filtercoordsys!=null){var R=this.createElementNS("","FILTERCOORDSYS");if(O.filtercoordsys.id===0){R.setAttribute("string",O.filtercoordsys.string)}else{R.setAttribute("id",O.filtercoordsys.id)}Q.appendChild(R)}if(O.buffer>0){var K=this.createElementNS("","BUFFER");K.setAttribute("distance",O.buffer);Q.appendChild(K)}if(O.isspatial){var J=this.createElementNS("","SPATIALFILTER");J.setAttribute("relation",O.spatialfilter.relation);Q.appendChild(J);if(O.spatialfilter.envelope){var T=this.createElementNS("","ENVELOPE");T.setAttribute("minx",O.spatialfilter.envelope.minx);T.setAttribute("miny",O.spatialfilter.envelope.miny);T.setAttribute("maxx",O.spatialfilter.envelope.maxx);T.setAttribute("maxy",O.spatialfilter.envelope.maxy);J.appendChild(T)}else{if(typeof O.spatialfilter.polygon=="object"){J.appendChild(this.writePolygonGeometry(O.spatialfilter.polygon))}}}if(O.where!=null&&O.where.length>0){Q.setAttribute("where",O.where)}}}}N.appendChild(X);return HGIS.Format.XML.prototype.write.apply(this,[N])},addGroupRenderer:function(D,B){var A=this.createElementNS("","GROUPRENDERER");D.appendChild(A);for(var E=0;E<B.length;E++){var C=B[E];this.addRenderer(A,C)}},addRenderer:function(A,B){if(HGIS.Util.isArray(B)){this.addGroupRenderer(A,B)}else{var C=this.createElementNS("",B.type.toUpperCase()+"RENDERER");A.appendChild(C);if(C.tagName=="VALUEMAPRENDERER"){this.addValueMapRenderer(C,B)}else{if(C.tagName=="VALUEMAPLABELRENDERER"){this.addValueMapLabelRenderer(C,B)}else{if(C.tagName=="SIMPLELABELRENDERER"){this.addSimpleLabelRenderer(C,B)}else{if(C.tagName=="SCALEDEPENDENTRENDERER"){this.addScaleDependentRenderer(C,B)}}}}}},addScaleDependentRenderer:function(B,A){if(typeof A.lower=="string"||typeof A.lower=="number"){B.setAttribute("lower",A.lower)}if(typeof A.upper=="string"||typeof A.upper=="number"){B.setAttribute("upper",A.upper)}this.addRenderer(B,A.renderer)},addValueMapLabelRenderer:function(G,A){G.setAttribute("lookupfield",A.lookupfield);G.setAttribute("labelfield",A.labelfield);if(typeof A.exacts=="object"){for(var K=0,J=A.exacts.length;K<J;K++){var B=A.exacts[K];var I=this.createElementNS("","EXACT");if(typeof B.value=="string"){I.setAttribute("value",B.value)}if(typeof B.label=="string"){I.setAttribute("label",B.label)}if(typeof B.method=="string"){I.setAttribute("method",B.method)}G.appendChild(I);if(typeof B.symbol=="object"){var E=null;if(B.symbol.type=="text"){E=this.createElementNS("","TEXTSYMBOL")}if(E!=null){var F=this.fontStyleKeys;for(var C=0,H=F.length;C<H;C++){var D=F[C];if(B.symbol[D]){E.setAttribute(D,B.symbol[D])}}I.appendChild(E)}}}}},addValueMapRenderer:function(H,C){H.setAttribute("lookupfield",C.lookupfield);if(typeof C.ranges=="object"){for(var K=0,D=C.ranges.length;K<D;K++){var J=C.ranges[K];var B=this.createElementNS("","RANGE");B.setAttribute("lower",J.lower);B.setAttribute("upper",J.upper);H.appendChild(B);if(typeof J.symbol=="object"){var G=null;if(J.symbol.type=="simplepolygon"){G=this.createElementNS("","SIMPLEPOLYGONSYMBOL")}if(G!=null){if(typeof J.symbol.boundarycolor=="string"){G.setAttribute("boundarycolor",J.symbol.boundarycolor)}if(typeof J.symbol.fillcolor=="string"){G.setAttribute("fillcolor",J.symbol.fillcolor)}if(typeof J.symbol.filltransparency=="number"){G.setAttribute("filltransparency",J.symbol.filltransparency)}B.appendChild(G)}}}}else{if(typeof C.exacts=="object"){for(var I=0,A=C.exacts.length;I<A;I++){var F=C.exacts[I];var E=this.createElementNS("","EXACT");if(typeof F.value=="string"){E.setAttribute("value",F.value)}if(typeof F.label=="string"){E.setAttribute("label",F.label)}if(typeof F.method=="string"){E.setAttribute("method",F.method)}H.appendChild(E);if(typeof F.symbol=="object"){var G=null;if(F.symbol.type=="simplemarker"){G=this.createElementNS("","SIMPLEMARKERSYMBOL")}if(G!=null){if(typeof F.symbol.antialiasing=="string"){G.setAttribute("antialiasing",F.symbol.antialiasing)}if(typeof F.symbol.color=="string"){G.setAttribute("color",F.symbol.color)}if(typeof F.symbol.outline=="string"){G.setAttribute("outline",F.symbol.outline)}if(typeof F.symbol.overlap=="string"){G.setAttribute("overlap",F.symbol.overlap)}if(typeof F.symbol.shadow=="string"){G.setAttribute("shadow",F.symbol.shadow)}if(typeof F.symbol.transparency=="number"){G.setAttribute("transparency",F.symbol.transparency)}if(typeof F.symbol.usecentroid=="string"){G.setAttribute("usecentroid",F.symbol.usecentroid)}if(typeof F.symbol.width=="number"){G.setAttribute("width",F.symbol.width)}E.appendChild(G)}}}}}},addSimpleLabelRenderer:function(G,A){G.setAttribute("field",A.field);var F=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"];for(var B=0,H=F.length;B<H;B++){var C=F[B];if(A[C]){G.setAttribute(C,A[C])}}if(A.symbol.type=="text"){var D=A.symbol;var E=this.createElementNS("","TEXTSYMBOL");G.appendChild(E);var F=this.fontStyleKeys;for(var B=0,H=F.length;B<H;B++){var C=F[B];if(D[C]){E.setAttribute(C,A[C])}}}},writePolygonGeometry:function(E){if(!(E instanceof HGIS.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+E.CLASS_NAME+" object.",geometry:E}}var I=this.createElementNS("","POLYGON");for(var C=0,B=E.components.length;C<B;C++){var A=E.components[C];var J=this.createElementNS("","RING");for(var G=0,F=A.components.length;G<F;G++){var H=A.components[G];var D=this.createElementNS("","POINT");D.setAttribute("x",H.x);D.setAttribute("y",H.y);J.appendChild(D)}I.appendChild(J)}return I},parseResponse:function(V){if(typeof V=="string"){var M=new HGIS.Format.XML();V=M.read(V)}var I=new HGIS.Format.ArcXML.Response();var T=V.getElementsByTagName("ERROR");if(T!=null&&T.length>0){I.error=this.getChildValue(T,"Unknown error.")}else{var X=V.getElementsByTagName("RESPONSE");if(X==null||X.length==0){I.error="No RESPONSE tag found in ArcXML response.";return I}var S=X[0].firstChild.nodeName;if(S=="#text"){S=X[0].firstChild.nextSibling.nodeName}if(S=="IMAGE"){var E=V.getElementsByTagName("ENVELOPE");var H=V.getElementsByTagName("OUTPUT");if(E==null||E.length==0){I.error="No ENVELOPE tag found in ArcXML response."}else{if(H==null||H.length==0){I.error="No OUTPUT tag found in ArcXML response."}else{var K=this.parseAttributes(E[0]);var R=this.parseAttributes(H[0]);if(typeof R.type=="string"){I.image={envelope:K,output:{type:R.type,data:this.getChildValue(H[0])}}}else{I.image={envelope:K,output:R}}}}}else{if(S=="FEATURES"){var Z=X[0].getElementsByTagName("FEATURES");var D=Z[0].getElementsByTagName("FEATURECOUNT");I.features.featurecount=D[0].getAttribute("count");if(I.features.featurecount>0){var L=Z[0].getElementsByTagName("ENVELOPE");I.features.envelope=this.parseAttributes(L[0],typeof(0));var B=Z[0].getElementsByTagName("FEATURE");for(var Y=0;Y<B.length;Y++){var J=new HGIS.Feature.Vector();var P=B[Y].getElementsByTagName("FIELD");for(var W=0;W<P.length;W++){var C=P[W].getAttribute("name");var G=P[W].getAttribute("value");J.attributes[C]=G}var Q=B[Y].getElementsByTagName("POLYGON");if(Q.length>0){var a=Q[0].getElementsByTagName("RING");var O=[];for(var A=0;A<a.length;A++){var N=[];N.push(this.parsePointGeometry(a[A]));var U=a[A].getElementsByTagName("HOLE");for(var F=0;F<U.length;F++){N.push(this.parsePointGeometry(U[F]))}U=null;O.push(new HGIS.Geometry.Polygon(N));N=null}a=null;if(O.length==1){J.geometry=O[0]}else{J.geometry=new HGIS.Geometry.MultiPolygon(O)}}I.features.feature.push(J)}}}else{I.error="Unidentified response type."}}}return I},parseAttributes:function(C,A){var B={};for(var D=0;D<C.attributes.length;D++){if(A=="number"){B[C.attributes[D].nodeName]=parseFloat(C.attributes[D].nodeValue)}else{B[C.attributes[D].nodeName]=C.attributes[D].nodeValue}}return B},parsePointGeometry:function(D){var B=[];var E=D.getElementsByTagName("COORDS");if(E.length>0){var A=this.getChildValue(E[0]);A=A.split(/;/);for(var C=0;C<A.length;C++){var H=A[C].split(/ /);B.push(new HGIS.Geometry.Point(H[0],H[1]))}E=null}else{var G=D.getElementsByTagName("POINT");if(G.length>0){for(var F=0;F<G.length;F++){B.push(new HGIS.Geometry.Point(parseFloat(G[F].getAttribute("x")),parseFloat(G[F].getAttribute("y"))))}}G=null}return new HGIS.Geometry.LinearRing(B)},CLASS_NAME:"HGIS.Format.ArcXML"});HGIS.Format.ArcXML.Request=HGIS.Class({initialize:function(A){var B={get_image:{properties:{background:null,draw:true,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:false},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:false,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return HGIS.Util.extend(this,B)},CLASS_NAME:"HGIS.Format.ArcXML.Request"});HGIS.Format.ArcXML.Response=HGIS.Class({initialize:function(A){var B={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return HGIS.Util.extend(this,B)},CLASS_NAME:"HGIS.Format.ArcXML.Response"});(function(){var E=window.XMLHttpRequest;var D=!!window.controllers,C=window.document.all&&!window.opera,A=C&&window.navigator.userAgent.match(/MSIE 7.0/);function J(){this._object=E&&!A?new E:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function B(){return new J}B.prototype=J.prototype;if(D&&E.wrapped){B.wrapped=E.wrapped}B.UNSENT=0;B.OPENED=1;B.HEADERS_RECEIVED=2;B.LOADING=3;B.DONE=4;B.prototype.readyState=B.UNSENT;B.prototype.responseText="";B.prototype.responseXML=null;B.prototype.status=0;B.prototype.statusText="";B.prototype.priority="NORMAL";B.prototype.onreadystatechange=null;B.onreadystatechange=null;B.onopen=null;B.onsend=null;B.onabort=null;B.prototype.open=function(R,L,N,M,Q){delete this._headers;if(arguments.length<3){N=true}this._async=N;var S=this,O=this.readyState,P;if(C&&N){P=function(){if(O!=B.DONE){K(S);S.abort()}};window.attachEvent("onunload",P)}if(B.onopen){B.onopen.apply(this,arguments)}if(arguments.length>4){this._object.open(R,L,N,M,Q)}else{if(arguments.length>3){this._object.open(R,L,N,M)}else{this._object.open(R,L,N)}}this.readyState=B.OPENED;I(this);this._object.onreadystatechange=function(){if(D&&!N){return}S.readyState=S._object.readyState;H(S);if(S._aborted){S.readyState=B.UNSENT;return}if(S.readyState==B.DONE){delete S._data;K(S);if(C&&N){window.detachEvent("onunload",P)}}if(O!=S.readyState){I(S)}O=S.readyState}};function G(L){L._object.send(L._data);if(D&&!L._async){L.readyState=B.OPENED;H(L);while(L.readyState<B.DONE){L.readyState++;I(L);if(L._aborted){return}}}}B.prototype.send=function(L){if(B.onsend){B.onsend.apply(this,arguments)}if(!arguments.length){L=null}if(L&&L.nodeType){L=window.XMLSerializer?new window.XMLSerializer().serializeToString(L):L.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")}}this._data=L;G(this)};B.prototype.abort=function(){if(B.onabort){B.onabort.apply(this,arguments)}if(this.readyState>B.UNSENT){this._aborted=true}this._object.abort();K(this);this.readyState=B.UNSENT;delete this._data};B.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};B.prototype.getResponseHeader=function(L){return this._object.getResponseHeader(L)};B.prototype.setRequestHeader=function(M,L){if(!this._headers){this._headers={}}this._headers[M]=L;return this._object.setRequestHeader(M,L)};B.prototype.addEventListener=function(M,L,N){for(var P=0,O;O=this._listeners[P];P++){if(O[0]==M&&O[1]==L&&O[2]==N){return}}this._listeners.push([M,L,N])};B.prototype.removeEventListener=function(M,L,N){for(var P=0,O;O=this._listeners[P];P++){if(O[0]==M&&O[1]==L&&O[2]==N){break}}if(O){this._listeners.splice(P,1)}};B.prototype.dispatchEvent=function(M){var L={"type":M.type,"target":this,"currentTarget":this,"eventPhase":2,"bubbles":M.bubbles,"cancelable":M.cancelable,"timeStamp":M.timeStamp,"stopPropagation":function(){},"preventDefault":function(){},"initEvent":function(){}};if(L.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[L])}for(var O=0,N;N=this._listeners[O];O++){if(N[0]==L.type&&!N[2]){(N[1].handleEvent||N[1]).apply(this,[L])}}};B.prototype.toString=function(){return"[object XMLHttpRequest]"};B.toString=function(){return"[XMLHttpRequest]"};function I(L){if(B.onreadystatechange){B.onreadystatechange.apply(L)}L.dispatchEvent({"type":"readystatechange","bubbles":false,"cancelable":false,"timeStamp":new Date+0})}function F(N){var L=N.responseXML,M=N.responseText;if(C&&M&&L&&!L.documentElement&&N.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){L=new window.ActiveXObject("Microsoft.XMLDOM");L.async=false;L.validateOnParse=false;L.loadXML(M)}if(L){if((C&&L.parseError!=0)||!L.documentElement||(L.documentElement&&L.documentElement.tagName=="parsererror")){return null}}return L}function H(M){try{M.responseText=M._object.responseText}catch(L){}try{M.responseXML=F(M._object)}catch(L){}try{M.status=M._object.status}catch(L){}try{M.statusText=M._object.statusText}catch(L){}}function K(L){L._object.onreadystatechange=new window.Function}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(L,M){if(!M){M=[]}L.__func=this;L.__func(M[0],M[1],M[2],M[3],M[4]);delete L.__func}}if(!HGIS.Request){HGIS.Request={}}HGIS.Request.XMLHttpRequest=B})();HGIS.ProxyHost="";if(!HGIS.Request){HGIS.Request={}}HGIS.Util.extend(HGIS.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:HGIS.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new HGIS.Events(this),makeSameOrigin:function(C,E){var F=C.indexOf("http")!==0;var G=!F&&C.match(this.URL_SPLIT_REGEX);if(G){var B=window.location;F=G[1]==B.protocol&&G[3]==B.hostname;var D=G[4],A=B.port;if(D!=80&&D!=""||A!="80"&&A!=""){F=F&&D==A}}if(!F){if(E){if(typeof E=="function"){C=E(C)}else{C=E+encodeURIComponent(C)}}}return C},issue:function(B){var F=HGIS.Util.extend(this.DEFAULT_CONFIG,{proxy:HGIS.ProxyHost});B=B||{};B.headers=B.headers||{};B=HGIS.Util.applyDefaults(B,F);B.headers=HGIS.Util.applyDefaults(B.headers,F.headers);var D=false,A;for(A in B.headers){if(B.headers.hasOwnProperty(A)){if(A.toLowerCase()==="x-requested-with"){D=true}}}if(D===false){B.headers["X-Requested-With"]="XMLHttpRequest"}var C=new HGIS.Request.XMLHttpRequest();var G=HGIS.Util.urlAppend(B.url,HGIS.Util.getParameterString(B.params||{}));G=HGIS.Request.makeSameOrigin(G,B.proxy);C.open(B.method,G,B.async,B.user,B.password);for(var I in B.headers){C.setRequestHeader(I,B.headers[I])}var H=this.events;var E=this;C.onreadystatechange=function(){if(C.readyState==HGIS.Request.XMLHttpRequest.DONE){var J=H.triggerEvent("complete",{request:C,config:B,requestUrl:G});if(J!==false){E.runCallbacks({request:C,config:B,requestUrl:G})}}};if(B.async===false){C.send(B.data)}else{window.setTimeout(function(){if(C.readyState!==0){C.send(B.data)}},0)}return C},runCallbacks:function(D){var B=D.request;var C=D.config;var A=(C.scope)?HGIS.Function.bind(C.callback,C.scope):C.callback;var E;if(C.success){E=(C.scope)?HGIS.Function.bind(C.success,C.scope):C.success}var F;if(C.failure){F=(C.scope)?HGIS.Function.bind(C.failure,C.scope):C.failure}if(HGIS.Util.createUrlObject(C.url).protocol=="file:"&&B.responseText){B.status=200}A(B);if(!B.status||(B.status>=200&&B.status<300)){this.events.triggerEvent("success",D);if(E){E(B)}}if(B.status&&(B.status<200||B.status>=300)){this.events.triggerEvent("failure",D);if(F){F(B)}}},GET:function(A){A=HGIS.Util.extend(A,{method:"GET"});return HGIS.Request.issue(A)},POST:function(A){A=HGIS.Util.extend(A,{method:"POST"});A.headers=A.headers?A.headers:{};if(!("CONTENT-TYPE" in HGIS.Util.upperCaseObject(A.headers))){A.headers["Content-Type"]="application/xml"}return HGIS.Request.issue(A)},PUT:function(A){A=HGIS.Util.extend(A,{method:"PUT"});A.headers=A.headers?A.headers:{};if(!("CONTENT-TYPE" in HGIS.Util.upperCaseObject(A.headers))){A.headers["Content-Type"]="application/xml"}return HGIS.Request.issue(A)},DELETE:function(A){A=HGIS.Util.extend(A,{method:"DELETE"});return HGIS.Request.issue(A)},HEAD:function(A){A=HGIS.Util.extend(A,{method:"HEAD"});return HGIS.Request.issue(A)},OPTIONS:function(A){A=HGIS.Util.extend(A,{method:"OPTIONS"});return HGIS.Request.issue(A)}});HGIS.Layer.ArcIMS=HGIS.Class(HGIS.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:true,name:"ArcIMS",isBaseLayer:true,DEFAULT_OPTIONS:{tileSize:new HGIS.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:true,async:true,name:"ArcIMS"},initialize:function(C,A,B){this.tileSize=new HGIS.Size(512,512);this.params=HGIS.Util.applyDefaults({ServiceName:B.serviceName},this.DEFAULT_PARAMS);this.options=HGIS.Util.applyDefaults(B,this.DEFAULT_OPTIONS);HGIS.Layer.Grid.prototype.initialize.apply(this,[C,A,this.params,B]);if(this.transparent){if(!this.isBaseLayer){this.isBaseLayer=false}if(this.format=="image/jpeg"){this.format=HGIS.Util.alphaHack()?"image/gif":"image/png"}}if(this.options.layers===null){this.options.layers=[]}},getURL:function(C){var B="";C=this.adjustBounds(C);var A=new HGIS.Format.ArcXML(HGIS.Util.extend(this.options,{requesttype:"image",envelope:C.toArray(),tileSize:this.tileSize}));var E=new HGIS.Request.POST({url:this.getFullRequestString(),data:A.write(),async:false});if(E!=null){var G=E.responseXML;if(!G||!G.documentElement){G=E.responseText}var F=new HGIS.Format.ArcXML();var D=F.read(G);B=this.getUrlOrImage(D.image.output)}return B},getURLasync:function(C,A,D){C=this.adjustBounds(C);var B=new HGIS.Format.ArcXML(HGIS.Util.extend(this.options,{requesttype:"image",envelope:C.toArray(),tileSize:this.tileSize}));HGIS.Request.POST({url:this.getFullRequestString(),async:true,data:B.write(),callback:function(E){var H=E.responseXML;if(!H||!H.documentElement){H=E.responseText}var G=new HGIS.Format.ArcXML();var F=G.read(H);A.call(D,this.getUrlOrImage(F.image.output))},scope:this})},getUrlOrImage:function(B){var A="";if(B.url){A=B.url}else{if(B.data){A="data:image/"+B.type+";base64,"+B.data}}return A},setLayerQuery:function(C,B){for(var A=0;A<this.options.layers.length;A++){if(C==this.options.layers[A].id){this.options.layers[A].query=B;return}}this.options.layers.push({id:C,visible:true,query:B})},getFeatureInfo:function(E,G,C){var H=C.buffer||1;var A=C.callback||function(){};var B=C.scope||window;var I={};HGIS.Util.extend(I,this.options);I.requesttype="feature";if(E instanceof HGIS.LonLat){I.polygon=null;I.envelope=[E.lon-H,E.lat-H,E.lon+H,E.lat+H]}else{if(E instanceof HGIS.Geometry.Polygon){I.envelope=null;I.polygon=E}}var K=new HGIS.Format.ArcXML(I);HGIS.Util.extend(K.request.get_feature,C);K.request.get_feature.layer=G.id;if(typeof G.query.accuracy=="number"){K.request.get_feature.query.accuracy=G.query.accuracy}else{var J=this.map.getCenter();var D=this.map.getViewPortPxFromLonLat(J);D.x++;var F=this.map.getLonLatFromPixel(D);K.request.get_feature.query.accuracy=F.lon-J.lon}K.request.get_feature.query.where=G.query.where;K.request.get_feature.query.spatialfilter.relation="area_intersection";HGIS.Request.POST({url:this.getFullRequestString({"CustomService":"Query"}),data:K.write(),callback:function(L){var M=K.parseResponse(L.responseText);if(!K.iserror()){A.call(B,M.features)}else{A.call(B,null)}}})},clone:function(A){if(A==null){A=new HGIS.Layer.ArcIMS(this.name,this.url,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},CLASS_NAME:"HGIS.Layer.ArcIMS"});HGIS.Control.PanZoom=HGIS.Class(HGIS.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(A){this.position=new HGIS.Pixel(HGIS.Control.PanZoom.X,HGIS.Control.PanZoom.Y);HGIS.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onButtonClick)}this.removeButtons();this.buttons=null;this.position=null;HGIS.Control.prototype.destroy.apply(this,arguments)},setMap:function(A){HGIS.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(C){HGIS.Control.prototype.draw.apply(this,arguments);C=this.position;this.buttons=[];var A={w:18,h:18};var B=new HGIS.Pixel(C.x+A.w/2,C.y);this._addButton("panup","north-mini.png",B,A);C.y=B.y+A.h;this._addButton("panleft","west-mini.png",C,A);this._addButton("panright","east-mini.png",C.add(A.w,0),A);this._addButton("pandown","south-mini.png",B.add(0,A.h*2),A);this._addButton("zoomin","zoom-plus-mini.png",B.add(0,A.h*3+5),A);this._addButton("zoomworld","zoom-world-mini.png",B.add(0,A.h*4+5),A);this._addButton("zoomout","zoom-minus-mini.png",B.add(0,A.h*5+5),A);return this.div},_addButton:function(F,E,A,B){var D=HGIS.Util.getImageLocation(E);var C=HGIS.Util.createAlphaImageDiv(this.id+"_"+F,A,B,D,"absolute");C.style.cursor="pointer";this.div.appendChild(C);C.action=F;C.className="olButton";this.buttons.push(C);return C},_removeButton:function(A){this.div.removeChild(A);HGIS.Util.removeItem(this.buttons,A)},removeButtons:function(){for(var A=this.buttons.length-1;A>=0;--A){this._removeButton(this.buttons[A])}},onButtonClick:function(A){var B=A.buttonElement;switch(B.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break}},getSlideFactor:function(A){return this.slideRatio?this.map.getSize()[A]*this.slideRatio:this.slideFactor},CLASS_NAME:"HGIS.Control.PanZoom"});HGIS.Control.PanZoom.X=4;HGIS.Control.PanZoom.Y=4;HGIS.Control.PanZoomBar=HGIS.Class(HGIS.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:false,panIcons:true,forceFixedZoomLevel:false,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({"changebaselayer":this.redraw,"updatesize":this.redraw,scope:this});HGIS.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(A){HGIS.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({"changebaselayer":this.redraw,"updatesize":this.redraw,scope:this})},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(D){HGIS.Control.prototype.draw.apply(this,arguments);D=this.position.clone();this.buttons=[];var A={w:18,h:18};if(this.panIcons){var C=new HGIS.Pixel(D.x+A.w/2,D.y);var B=A.w;if(this.zoomWorldIcon){C=new HGIS.Pixel(D.x+A.w,D.y)}this._addButton("panup","north-mini.png",C,A);D.y=C.y+A.h;this._addButton("panleft","west-mini.png",D,A);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",D.add(A.w,0),A);B*=2}this._addButton("panright","east-mini.png",D.add(B,0),A);this._addButton("pandown","south-mini.png",C.add(0,A.h*2),A);this._addButton("zoomin","zoom-plus-mini.png",C.add(0,A.h*3+5),A);C=this._addZoomBar(C.add(0,A.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",C,A)}else{this._addButton("zoomin","zoom-plus-mini.png",D,A);C=this._addZoomBar(D.add(0,A.h));this._addButton("zoomout","zoom-minus-mini.png",C,A);if(this.zoomWorldIcon){C=C.add(0,A.h+3);this._addButton("zoomworld","zoom-world-mini.png",C,A)}}return this.div},_addZoomBar:function(H){var G=HGIS.Util.getImageLocation("slider.png");var E=this.id+"_"+this.map.id;var D=this.map.getMinZoom();var F=this.map.getNumZoomLevels()-1-this.map.getZoom();var C=HGIS.Util.createAlphaImageDiv(E,H.add(-1,F*this.zoomStopHeight),{w:20,h:9},G,"absolute");C.style.cursor="move";this.slider=C;this.sliderEvents=new HGIS.Events(this,C,null,true,{includeXY:true});this.sliderEvents.on({"touchstart":this.zoomBarDown,"touchmove":this.zoomBarDrag,"touchend":this.zoomBarUp,"mousedown":this.zoomBarDown,"mousemove":this.zoomBarDrag,"mouseup":this.zoomBarUp});var A={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-D)};var G=HGIS.Util.getImageLocation("zoombar.png");var B=null;if(HGIS.Util.alphaHack()){var E=this.id+"_"+this.map.id;B=HGIS.Util.createAlphaImageDiv(E,H,{w:A.w,h:this.zoomStopHeight},G,"absolute",null,"crop");B.style.height=A.h+"px"}else{B=HGIS.Util.createDiv("HGIS_Control_PanZoomBar_Zoombar"+this.map.id,H,A,G)}B.style.cursor="pointer";B.className="olButton";this.zoombarDiv=B;this.div.appendChild(B);this.startTop=parseInt(B.style.top);this.div.appendChild(C);this.map.events.register("zoomend",this,this.moveZoomBar);H=H.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-D));return H},_removeZoomBar:function(){this.sliderEvents.un({"touchstart":this.zoomBarDown,"touchmove":this.zoomBarDrag,"touchend":this.zoomBarUp,"mousedown":this.zoomBarDown,"mousemove":this.zoomBarDrag,"mouseup":this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(B){HGIS.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(B.buttonElement===this.zoombarDiv){var A=B.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){A=Math.floor(A)}var C=(this.map.getNumZoomLevels()-1)-A;C=Math.min(Math.max(C,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(C)}},passEventToSlider:function(A){this.sliderEvents.handleBrowserEvent(A)},zoomBarDown:function(A){if(!HGIS.Event.isLeftClick(A)&&!HGIS.Event.isSingleTouch(A)){return}this.map.events.on({"touchmove":this.passEventToSlider,"mousemove":this.passEventToSlider,"mouseup":this.passEventToSlider,scope:this});this.mouseDragStart=A.xy.clone();this.zoomStart=A.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;HGIS.Event.stop(A)},zoomBarDrag:function(B){if(this.mouseDragStart!=null){var C=this.mouseDragStart.y-B.xy.y;var A=HGIS.Util.pagePosition(this.zoombarDiv);if((B.clientY-A[1])>0&&(B.clientY-A[1])<parseInt(this.zoombarDiv.style.height)-2){var D=parseInt(this.slider.style.top)-C;this.slider.style.top=D+"px";this.mouseDragStart=B.xy.clone()}this.deltaY=this.zoomStart.y-B.xy.y;HGIS.Event.stop(B)}},zoomBarUp:function(B){if(!HGIS.Event.isLeftClick(B)&&B.type!=="touchend"){return}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({"touchmove":this.passEventToSlider,"mouseup":this.passEventToSlider,"mousemove":this.passEventToSlider,scope:this});var A=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){A+=this.deltaY/this.zoomStopHeight;A=Math.min(Math.max(A,0),this.map.getNumZoomLevels()-1)}else{A+=this.deltaY/this.zoomStopHeight;A=Math.max(Math.round(A),0)}this.map.zoomTo(A);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;HGIS.Event.stop(B)}},moveZoomBar:function(){var A=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=A+"px"},CLASS_NAME:"HGIS.Control.PanZoomBar"});HGIS.Format.WFSCapabilities=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"HGIS.Format.WFSCapabilities"});HGIS.Format.WFSCapabilities.v1=HGIS.Class(HGIS.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(C){if(typeof C=="string"){C=HGIS.Format.XML.prototype.read.apply(this,[C])}var A=C;if(C&&C.nodeType==9){C=C.documentElement}var B={};this.readNode(C,B);return B},readers:{"wfs":{"WFS_Capabilities":function(B,A){this.readChildNodes(B,A)},"FeatureTypeList":function(B,A){A.featureTypeList={featureTypes:[]};this.readChildNodes(B,A.featureTypeList)},"FeatureType":function(C,A){var B={};this.readChildNodes(C,B);A.featureTypes.push(B)},"Name":function(C,B){var D=this.getChildValue(C);if(D){var A=D.split(":");B.name=A.pop();if(A.length>0){B.featureNS=this.lookupNamespaceURI(C,A[0])}}},"Title":function(B,A){var C=this.getChildValue(B);if(C){A.title=C}},"Abstract":function(B,A){var C=this.getChildValue(B);if(C){A["abstract"]=C}}}},CLASS_NAME:"HGIS.Format.WFSCapabilities.v1"});HGIS.Format.WFSCapabilities.v1_1_0=HGIS.Class(HGIS.Format.WFSCapabilities.v1,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{"wfs":HGIS.Util.applyDefaults({"DefaultSRS":function(B,A){var C=this.getChildValue(B);if(C){A.srs=C}}},HGIS.Format.WFSCapabilities.v1.prototype.readers["wfs"]),"ows":HGIS.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"HGIS.Format.WFSCapabilities.v1_1_0"});HGIS.Layer.Image=HGIS.Class(HGIS.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(D,B,E,A,C){this.url=B;this.extent=E;this.maxExtent=E;this.size=A;HGIS.Layer.prototype.initialize.apply(this,[D,C]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}HGIS.Layer.prototype.destroy.apply(this,arguments)},clone:function(A){if(A==null){A=new HGIS.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())}A=HGIS.Layer.prototype.clone.apply(this,[A]);return A},setMap:function(A){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}HGIS.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(C,B,E){HGIS.Layer.prototype.moveTo.apply(this,arguments);var D=(this.tile==null);if(B||D){this.setTileSize();var A=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});if(D){this.tile=new HGIS.Tile.Image(this,A,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=A.clone()}this.tile.draw()}},setTileSize:function(){var B=this.extent.getWidth()/this.map.getResolution();var A=this.extent.getHeight()/this.map.getResolution();this.tileSize=new HGIS.Size(B,A)},addTileMonitoringHooks:function(A){A.onLoadStart=function(){this.events.triggerEvent("loadstart")};A.events.register("loadstart",this,A.onLoadStart);A.onLoadEnd=function(){this.events.triggerEvent("loadend")};A.events.register("loadend",this,A.onLoadEnd);A.events.register("unload",this,A.onLoadEnd)},removeTileMonitoringHooks:function(A){A.unload();A.events.un({"loadstart":A.onLoadStart,"loadend":A.onLoadEnd,"unload":A.onLoadEnd,scope:this})},setUrl:function(A){this.url=A;this.tile.draw()},getURL:function(A){return this.url},CLASS_NAME:"HGIS.Layer.Image"});HGIS.Strategy=HGIS.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(A){HGIS.Util.extend(this,A);this.options=A;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(A){this.layer=A},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"HGIS.Strategy"});HGIS.Strategy.Save=HGIS.Class(HGIS.Strategy,{events:null,auto:false,timer:null,initialize:function(A){HGIS.Strategy.prototype.initialize.apply(this,[A]);this.events=new HGIS.Events(this)},activate:function(){var A=HGIS.Strategy.prototype.activate.call(this);if(A){if(this.auto){if(typeof this.auto==="number"){this.timer=window.setInterval(HGIS.Function.bind(this.save,this),this.auto*1000)}else{this.layer.events.on({"featureadded":this.triggerSave,"afterfeaturemodified":this.triggerSave,scope:this})}}}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){if(this.auto){if(typeof this.auto==="number"){window.clearInterval(this.timer)}else{this.layer.events.un({"featureadded":this.triggerSave,"afterfeaturemodified":this.triggerSave,scope:this})}}}return A},triggerSave:function(B){var A=B.feature;if(A.state===HGIS.State.INSERT||A.state===HGIS.State.UPDATE||A.state===HGIS.State.DELETE){this.save([B.feature])}},save:function(B){if(!B){B=this.layer.features}this.events.triggerEvent("start",{features:B});var C=this.layer.projection;var G=this.layer.map.getProjectionObject();if(!G.equals(C)){var F=B.length;var E=new Array(F);var H,A;for(var D=0;D<F;++D){H=B[D];A=H.clone();A.fid=H.fid;A.state=H.state;if(H.url){A.url=H.url}A._original=H;A.geometry.transform(G,C);E[D]=A}B=E}this.layer.protocol.commit(B,{callback:this.onCommit,scope:this})},onCommit:function(J){var A={"response":J};if(J.success()){var B=J.reqFeatures;var D,I;var E=[];var G=J.insertIds||[];var C=0;for(var F=0,H=B.length;F<H;++F){I=B[F];I=I._original||I;D=I.state;if(D){if(D==HGIS.State.DELETE){E.push(I)}else{if(D==HGIS.State.INSERT){I.fid=G[C];++C}}I.state=null}}if(E.length>0){this.layer.destroyFeatures(E)}this.events.triggerEvent("success",A)}else{this.events.triggerEvent("fail",A)}},CLASS_NAME:"HGIS.Strategy.Save"});HGIS.Events.featureclick=HGIS.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(B){this.target=B;if(B.object instanceof HGIS.Map){this.setMap(B.object)}else{if(B.object instanceof HGIS.Layer.Vector){if(B.object.map){this.setMap(B.object.map)}else{B.object.events.register("added",this,function(C){this.setMap(B.object.map)})}}else{throw ("Listeners for '"+this.provides.join("', '")+"' events can only be registered for HGIS.Layer.Vector or HGIS.Map instances")}}for(var A=this.provides.length-1;A>=0;--A){B.extensions[this.provides[A]]=true}},setMap:function(A){this.map=A;this.cache={};A.events.register("mousedown",this,this.start,{extension:true});A.events.register("mouseup",this,this.onClick,{extension:true});A.events.register("touchstart",this,this.start,{extension:true});A.events.register("touchmove",this,this.cancel,{extension:true});A.events.register("touchend",this,this.onClick,{extension:true});A.events.register("mousemove",this,this.onMousemove,{extension:true})},start:function(A){this.startEvt=A},cancel:function(A){delete this.startEvt},onClick:function(C){if(!this.startEvt||C.type!=="touchend"&&!HGIS.Event.isLeftClick(C)){return}var D=this.getFeatures(this.startEvt);delete this.startEvt;var H,F,B,A={};for(var E=0,G=D.length;E<G;++E){H=D[E];F=H.layer;A[F.id]=true;B=this.triggerEvent("featureclick",{feature:H});if(B===false){break}}for(E=0,G=this.map.layers.length;E<G;++E){F=this.map.layers[E];if(F instanceof HGIS.Layer.Vector&&!A[F.id]){this.triggerEvent("nofeatureclick",{layer:F})}}},onMousemove:function(C){delete this.startEvt;var D=this.getFeatures(C);var H={},G=[],J;for(var F=0,I=D.length;F<I;++F){J=D[F];H[J.id]=J;if(!this.cache[J.id]){G.push(J)}}var B=[];for(var A in this.cache){J=this.cache[A];if(J.layer&&J.layer.map){if(!H[J.id]){B.push(J)}}else{delete this.cache[A]}}var E;for(F=0,I=G.length;F<I;++F){J=G[F];this.cache[J.id]=J;E=this.triggerEvent("featureover",{feature:J});if(E===false){break}}for(F=0,I=B.length;F<I;++F){J=B[F];delete this.cache[J.id];E=this.triggerEvent("featureout",{feature:J});if(E===false){break}}},triggerEvent:function(A,C){var D=C.feature?C.feature.layer:C.layer,B=this.target.object;if(B instanceof HGIS.Map||B===D){return this.target.triggerEvent(A,C)}},getFeatures:function(B){var H=B.clientX,I=B.clientY,C=[],F=[],K=[],E,G,J,D,A;for(D=this.map.layers.length-1;D>=0;--D){E=this.map.layers[D];if(E.div.style.display!=="none"){if(E.renderer instanceof HGIS.Renderer.Elements){if(E instanceof HGIS.Layer.Vector){G=document.elementFromPoint(H,I);while(G&&G._featureId){J=E.getFeatureById(G._featureId);if(J){C.push(J);G.style.display="none";F.push(G);G=document.elementFromPoint(H,I)}else{G=false}}}K.push(E);E.div.style.display="none"}else{if(E.renderer instanceof HGIS.Renderer.Canvas){J=E.renderer.getFeatureIdFromEvent(B);if(J){C.push(J);K.push(E)}}}}}for(D=0,A=F.length;D<A;++D){F[D].style.display=""}for(D=K.length-1;D>=0;--D){K[D].div.style.display="block"}return C},destroy:function(){for(var A=this.provides.length-1;A>=0;--A){delete this.target.extensions[this.provides[A]]}this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});HGIS.Events.nofeatureclick=HGIS.Events.featureclick;HGIS.Events.featureover=HGIS.Events.featureclick;HGIS.Events.featureout=HGIS.Events.featureclick;HGIS.Format.GPX=HGIS.Class(HGIS.Format.XML,{defaultDesc:"No description available",extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"HGIS",initialize:function(A){this.externalProjection=new HGIS.Projection("EPSG:4326");HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(M){if(typeof M=="string"){M=HGIS.Format.XML.prototype.read.apply(this,[M])}var S=[];if(this.extractTracks){var N=M.getElementsByTagName("trk");for(var Q=0,B=N.length;Q<B;Q++){var O={};if(this.extractAttributes){O=this.parseAttributes(N[Q])}var G=this.getElementsByTagNameNS(N[Q],N[Q].namespaceURI,"trkseg");for(var D=0,L=G.length;D<L;D++){var F=this.extractSegment(G[D],"trkpt");S.push(new HGIS.Feature.Vector(F,O))}}}if(this.extractRoutes){var R=M.getElementsByTagName("rte");for(var E=0,C=R.length;E<C;E++){var O={};if(this.extractAttributes){O=this.parseAttributes(R[E])}var P=this.extractSegment(R[E],"rtept");S.push(new HGIS.Feature.Vector(P,O))}}if(this.extractWaypoints){var J=M.getElementsByTagName("wpt");for(var H=0,B=J.length;H<B;H++){var O={};if(this.extractAttributes){O=this.parseAttributes(J[H])}var I=new HGIS.Geometry.Point(J[H].getAttribute("lon"),J[H].getAttribute("lat"));S.push(new HGIS.Feature.Vector(I,O))}}if(this.internalProjection&&this.externalProjection){for(var K=0,A=S.length;K<A;K++){S[K].geometry.transform(this.externalProjection,this.internalProjection)}}return S},extractSegment:function(D,F){var C=this.getElementsByTagNameNS(D,D.namespaceURI,F);var A=[];for(var B=0,E=C.length;B<E;B++){A.push(new HGIS.Geometry.Point(C[B].getAttribute("lon"),C[B].getAttribute("lat")))}return new HGIS.Geometry.LineString(A)},parseAttributes:function(B){var A={};var C=B.firstChild,E,D;while(C){if(C.nodeType==1&&C.firstChild){E=C.firstChild;if(E.nodeType==3||E.nodeType==4){D=(C.prefix)?C.nodeName.split(":")[1]:C.nodeName;if(D!="trkseg"&&D!="rtept"){A[D]=E.nodeValue}}}C=C.nextSibling}return A},write:function(A,E){A=HGIS.Util.isArray(A)?A:[A];var D=this.createElementNS(this.namespaces.gpx,"gpx");D.setAttribute("version","1.1");D.setAttribute("creator",this.creator);this.setAttributes(D,{"xsi:schemaLocation":this.schemaLocation});if(E&&typeof E=="object"){D.appendChild(this.buildMetadataNode(E))}for(var B=0,C=A.length;B<C;B++){D.appendChild(this.buildFeatureNode(A[B]))}return HGIS.Format.XML.prototype.write.apply(this,[D])},buildMetadataNode:function(F){var E=["name","desc","author"],C=this.createElementNS(this.namespaces.gpx,"metadata");for(var B=0;B<E.length;B++){var A=E[B];if(F[A]){var D=this.createElementNS(this.namespaces.gpx,A);D.appendChild(this.createTextNode(F[A]));C.appendChild(D)}}return C},buildFeatureNode:function(B){var F=B.geometry;F=F.clone();if(this.internalProjection&&this.externalProjection){F.transform(this.internalProjection,this.externalProjection)}if(F.CLASS_NAME=="HGIS.Geometry.Point"){var A=this.buildWptNode(F);this.appendAttributesNode(A,B);return A}else{var E=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(E,B);var C=this.buildTrkSegNode(F);C=HGIS.Util.isArray(C)?C:[C];for(var D=0,G=C.length;D<G;D++){E.appendChild(C[D])}return E}},buildTrkSegNode:function(E){var D,B,F,C,A;if(E.CLASS_NAME=="HGIS.Geometry.LineString"||E.CLASS_NAME=="HGIS.Geometry.LinearRing"){D=this.createElementNS(this.namespaces.gpx,"trkseg");for(B=0,F=E.components.length;B<F;B++){C=E.components[B];D.appendChild(this.buildTrkPtNode(C))}return D}else{A=[];for(B=0,F=E.components.length;B<F;B++){A.push(this.buildTrkSegNode(E.components[B]))}return A}},buildTrkPtNode:function(A){var B=this.createElementNS(this.namespaces.gpx,"trkpt");B.setAttribute("lon",A.x);B.setAttribute("lat",A.y);return B},buildWptNode:function(B){var A=this.createElementNS(this.namespaces.gpx,"wpt");A.setAttribute("lon",B.x);A.setAttribute("lat",B.y);return A},appendAttributesNode:function(C,A){var D=this.createElementNS(this.namespaces.gpx,"name");D.appendChild(this.createTextNode(A.attributes.name||A.id));C.appendChild(D);var B=this.createElementNS(this.namespaces.gpx,"desc");B.appendChild(this.createTextNode(A.attributes.description||this.defaultDesc));C.appendChild(B)},CLASS_NAME:"HGIS.Format.GPX"});HGIS.Format.WMSDescribeLayer=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"HGIS.Format.WMSDescribeLayer"});HGIS.Format.WMSDescribeLayer.v1_1_1=HGIS.Class(HGIS.Format.WMSDescribeLayer,{initialize:function(A){HGIS.Format.WMSDescribeLayer.prototype.initialize.apply(this,[A])},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}var F=B.documentElement;var D=F.childNodes;var A={layerDescriptions:[]};var M,C;for(var H=0;H<D.length;++H){M=D[H];C=M.nodeName;if(C=="LayerDescription"){var G=M.getAttribute("name");var E="";var I="";var J="";if(M.getAttribute("owsType")){E=M.getAttribute("owsType");I=M.getAttribute("owsURL")}else{if(M.getAttribute("wfs")!=""){E="WFS";I=M.getAttribute("wfs")}else{if(M.getAttribute("wcs")!=""){E="WCS";I=M.getAttribute("wcs")}}}var L=M.getElementsByTagName("Query");if(L.length>0){J=L[0].getAttribute("typeName");if(!J){J=L[0].getAttribute("typename")}}var K={layerName:G,owsType:E,owsURL:I,typeName:J};A.layerDescriptions.push(K);A.length=A.layerDescriptions.length;A[A.length-1]=K}else{if(C=="ServiceException"){var N=new HGIS.Format.OGCExceptionReport();return{error:N.read(B)}}}}return A},CLASS_NAME:"HGIS.Format.WMSDescribeLayer.v1_1_1"});HGIS.Format.WMSDescribeLayer.v1_1_0=HGIS.Format.WMSDescribeLayer.v1_1_1;HGIS.Layer.XYZ=HGIS.Class(HGIS.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,serverResolutions:null,initialize:function(C,A,B){if(B&&B.sphericalMercator||this.sphericalMercator){B=HGIS.Util.extend({projection:"EPSG:900913",numZoomLevels:19},B)}HGIS.Layer.Grid.prototype.initialize.apply(this,[C||this.name,A||this.url,{},B])},clone:function(A){if(A==null){A=new HGIS.Layer.XYZ(this.name,this.url,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(B){var D=this.getXYZ(B);var A=this.url;if(HGIS.Util.isArray(A)){var C=""+D.x+D.y+D.z;A=this.selectUrl(C,A)}return HGIS.String.format(A,D)},getXYZ:function(A){var C=this.getServerResolution();var D=Math.round((A.left-this.maxExtent.left)/(C*this.tileSize.w));var E=Math.round((this.maxExtent.top-A.top)/(C*this.tileSize.h));var B=this.getServerZoom();if(this.wrapDateLine){var F=Math.pow(2,B);D=((D%F)+F)%F}return{"x":D,"y":E,"z":B}},setMap:function(A){HGIS.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new HGIS.LonLat(this.maxExtent.left,this.maxExtent.bottom)}},CLASS_NAME:"HGIS.Layer.XYZ"});HGIS.Layer.OSM=HGIS.Class(HGIS.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:true,wrapDateLine:true,tileOptions:null,initialize:function(C,A,B){HGIS.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=HGIS.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(A){if(A==null){A=new HGIS.Layer.OSM(this.name,this.url,this.getOptions())}A=HGIS.Layer.XYZ.prototype.clone.apply(this,[A]);return A},CLASS_NAME:"HGIS.Layer.OSM"});HGIS.Renderer=HGIS.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,featureDx:0,initialize:function(A,B){this.container=HGIS.Util.getElement(A);HGIS.Util.extend(this,B)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(C,B){this.extent=C.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var A=C.getWidth()/this.map.getExtent().getWidth(),C=C.scale(1/A);this.extent=C.wrapDateLine(this.map.getMaxExtent()).scale(A)}if(B){this.resolution=null}return true},setSize:function(A){this.size=A.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(H,E){if(E==null){E=H.style}if(H.geometry){var B=H.geometry.getBounds();if(B){var D;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){D=this.map.getMaxExtent()}if(!B.intersectsBounds(this.extent,{worldBounds:D})){E={display:"none"}}else{this.calculateFeatureDx(B,D)}var A=this.drawGeometry(H.geometry,E,H.id);if(E.display!="none"&&E.label&&A!==false){var G=H.geometry.getCentroid();if(E.labelXOffset||E.labelYOffset){var F=isNaN(E.labelXOffset)?0:E.labelXOffset;var I=isNaN(E.labelYOffset)?0:E.labelYOffset;var C=this.getResolution();G.move(F*C,I*C)}this.drawText(H.id,E,G)}else{this.removeText(H.id)}return A}}},calculateFeatureDx:function(C,F){this.featureDx=0;if(F){var A=F.getWidth(),B=(this.extent.left+this.extent.right)/2,D=(C.left+C.right)/2,E=Math.round((D-B)/A);this.featureDx=E*A}},drawGeometry:function(C,B,A){},drawText:function(A,C,B){},removeText:function(A){},clear:function(){},getFeatureIdFromEvent:function(A){},eraseFeatures:function(A){if(!(HGIS.Util.isArray(A))){A=[A]}for(var B=0,C=A.length;B<C;++B){var D=A[B];this.eraseGeometry(D.geometry,D.id);this.removeText(D.id)}},eraseGeometry:function(B,A){},moveRoot:function(A){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(A){var B=HGIS.Util.extend({},HGIS.Renderer.defaultSymbolizer);if(A.stroke===false){delete B.strokeWidth;delete B.strokeColor}if(A.fill===false){delete B.fillColor}HGIS.Util.extend(B,A);return B},CLASS_NAME:"HGIS.Renderer"});HGIS.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};HGIS.Renderer.symbol={"star":[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],"cross":[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],"x":[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],"square":[0,0,0,1,1,1,1,0,0,0],"triangle":[0,10,10,10,5,0,0,10],"arrow":[0,0,5,-10,10,0,5,-2,0,0]};HGIS.Renderer.Canvas=HGIS.Class(HGIS.Renderer,{hitDetection:true,hitOverflow:0,canvas:null,features:null,pendingRedraw:false,cachedSymbolBounds:{},initialize:function(A,B){HGIS.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},setExtent:function(){HGIS.Renderer.prototype.setExtent.apply(this,arguments);return false},eraseGeometry:function(B,A){this.eraseFeatures(this.features[A][0])},supported:function(){return HGIS.CANVAS_SUPPORTED},setSize:function(A){this.size=A.clone();var B=this.root;B.style.width=A.w+"px";B.style.height=A.h+"px";B.width=A.w;B.height=A.h;this.resolution=null;if(this.hitDetection){var C=this.hitCanvas;C.style.width=A.w+"px";C.style.height=A.h+"px";C.width=A.w;C.height=A.h}},drawFeature:function(A,D){var B;if(A.geometry){D=this.applyDefaultSymbolizer(D||A.style);var C=A.geometry.getBounds();var E;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){E=this.map.getMaxExtent()}var F=C&&C.intersectsBounds(this.extent,{worldBounds:E});B=(D.display!=="none")&&!!C&&F;if(B){this.features[A.id]=[A,D]}else{delete (this.features[A.id])}this.pendingRedraw=true}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=false}return B},drawGeometry:function(E,D,A){var B=E.CLASS_NAME;if((B=="HGIS.Geometry.Collection")||(B=="HGIS.Geometry.MultiPoint")||(B=="HGIS.Geometry.MultiLineString")||(B=="HGIS.Geometry.MultiPolygon")){for(var C=0;C<E.components.length;C++){this.drawGeometry(E.components[C],D,A)}return}switch(E.CLASS_NAME){case"HGIS.Geometry.Point":this.drawPoint(E,D,A);break;case"HGIS.Geometry.LineString":this.drawLineString(E,D,A);break;case"HGIS.Geometry.LinearRing":this.drawLinearRing(E,D,A);break;case"HGIS.Geometry.Polygon":this.drawPolygon(E,D,A);break;default:break}},drawExternalGraphic:function(E,F,B){var A=new Image();var H=F.title||F.graphicTitle;if(H){A.title=H}var G=F.graphicWidth||F.graphicHeight;var K=F.graphicHeight||F.graphicWidth;G=G?G:F.pointRadius*2;K=K?K:F.pointRadius*2;var I=(F.graphicXOffset!=undefined)?F.graphicXOffset:-(0.5*G);var J=(F.graphicYOffset!=undefined)?F.graphicYOffset:-(0.5*K);var D=F.graphicOpacity||F.fillOpacity;var C=function(){if(!this.features[B]){return}var O=this.getLocalXY(E);var M=O[0];var P=O[1];if(!isNaN(M)&&!isNaN(P)){var Q=(M+I)|0;var R=(P+J)|0;var L=this.canvas;L.globalAlpha=D;var N=HGIS.Renderer.Canvas.drawImageScaleFactor||(HGIS.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);L.drawImage(A,Q*N,R*N,G*N,K*N);if(this.hitDetection){this.setHitContextStyle("fill",B);this.hitContext.fillRect(Q,R,G,K)}}};A.onload=HGIS.Function.bind(C,this);A.src=F.externalGraphic},drawNamedSymbol:function(M,Q,I){var O,P,A,J,C,B,L,F;var D;var N=Math.PI/180;var K=HGIS.Renderer.symbol[Q.graphicName];if(!K){throw new Error(Q.graphicName+" is not a valid symbol name")}if(!K.length||K.length<2){return}var G=this.getLocalXY(M);var H=G[0];var E=G[1];if(isNaN(H)||isNaN(E)){return}this.canvas.lineCap="round";this.canvas.lineJoin="round";if(this.hitDetection){this.hitContext.lineCap="round";this.hitContext.lineJoin="round"}if(Q.graphicName in this.cachedSymbolBounds){B=this.cachedSymbolBounds[Q.graphicName]}else{B=new HGIS.Bounds();for(C=0;C<K.length;C+=2){B.extend(new HGIS.LonLat(K[C],K[C+1]))}this.cachedSymbolBounds[Q.graphicName]=B}this.canvas.save();if(this.hitDetection){this.hitContext.save()}this.canvas.translate(H,E);if(this.hitDetection){this.hitContext.translate(H,E)}F=N*Q.rotation;if(!isNaN(F)){this.canvas.rotate(F);if(this.hitDetection){this.hitContext.rotate(F)}}L=2*Q.pointRadius/Math.max(B.getWidth(),B.getHeight());this.canvas.scale(L,L);if(this.hitDetection){this.hitContext.scale(L,L)}A=B.getCenterLonLat().lon;J=B.getCenterLonLat().lat;this.canvas.translate(-A,-J);if(this.hitDetection){this.hitContext.translate(-A,-J)}D=Q.strokeWidth;Q.strokeWidth=D/L;if(Q.fill!==false){this.setCanvasStyle("fill",Q);this.canvas.beginPath();for(C=0;C<K.length;C=C+2){O=K[C];P=K[C+1];if(C==0){this.canvas.moveTo(O,P)}this.canvas.lineTo(O,P)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",I,Q);this.hitContext.beginPath();for(C=0;C<K.length;C=C+2){O=K[C];P=K[C+1];if(C==0){this.canvas.moveTo(O,P)}this.hitContext.lineTo(O,P)}this.hitContext.closePath();this.hitContext.fill()}}if(Q.stroke!==false){this.setCanvasStyle("stroke",Q);this.canvas.beginPath();for(C=0;C<K.length;C=C+2){O=K[C];P=K[C+1];if(C==0){this.canvas.moveTo(O,P)}this.canvas.lineTo(O,P)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",I,Q,L);this.hitContext.beginPath();for(C=0;C<K.length;C=C+2){O=K[C];P=K[C+1];if(C==0){this.hitContext.moveTo(O,P)}this.hitContext.lineTo(O,P)}this.hitContext.closePath();this.hitContext.stroke()}}Q.strokeWidth=D;this.canvas.restore();if(this.hitDetection){this.hitContext.restore()}this.setCanvasStyle("reset")},setCanvasStyle:function(A,B){if(A==="fill"){this.canvas.globalAlpha=B["fillOpacity"];this.canvas.fillStyle=B["fillColor"]}else{if(A==="stroke"){this.canvas.globalAlpha=B["strokeOpacity"];this.canvas.strokeStyle=B["strokeColor"];this.canvas.lineWidth=B["strokeWidth"]}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},featureIdToHex:function(A){var D=Number(A.split("_").pop())+1;if(D>=16777216){this.hitOverflow=D-16777215;D=D%16777216+1}var C="000000"+D.toString(16);var B=C.length;C="#"+C.substring(B-6,B);return C},setHitContextStyle:function(A,D,B,C){var E=this.featureIdToHex(D);if(A=="fill"){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=E}else{if(A=="stroke"){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=E;if(typeof C==="undefined"){this.hitContext.lineWidth=B.strokeWidth+2}else{if(!isNaN(C)){this.hitContext.lineWidth=B.strokeWidth+2/C}}}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}}},drawPoint:function(C,D,B){if(D.graphic!==false){if(D.externalGraphic){this.drawExternalGraphic(C,D,B)}else{if(D.graphicName&&(D.graphicName!="circle")){this.drawNamedSymbol(C,D,B)}else{var A=this.getLocalXY(C);var G=A[0];var E=A[1];if(!isNaN(G)&&!isNaN(E)){var H=Math.PI*2;var F=D.pointRadius;if(D.fill!==false){this.setCanvasStyle("fill",D);this.canvas.beginPath();this.canvas.arc(G,E,F,0,H,true);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",B,D);this.hitContext.beginPath();this.hitContext.arc(G,E,F,0,H,true);this.hitContext.fill()}}if(D.stroke!==false){this.setCanvasStyle("stroke",D);this.canvas.beginPath();this.canvas.arc(G,E,F,0,H,true);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",B,D);this.hitContext.beginPath();this.hitContext.arc(G,E,F,0,H,true);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}}}},drawLineString:function(C,B,A){B=HGIS.Util.applyDefaults({fill:false},B);this.drawLinearRing(C,B,A)},drawLinearRing:function(C,B,A){if(B.fill!==false){this.setCanvasStyle("fill",B);this.renderPath(this.canvas,C,B,A,"fill");if(this.hitDetection){this.setHitContextStyle("fill",A,B);this.renderPath(this.hitContext,C,B,A,"fill")}}if(B.stroke!==false){this.setCanvasStyle("stroke",B);this.renderPath(this.canvas,C,B,A,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",A,B);this.renderPath(this.hitContext,C,B,A,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(D,E,G,C,J){var F=E.components;var I=F.length;D.beginPath();var B=this.getLocalXY(F[0]);var K=B[0];var L=B[1];if(!isNaN(K)&&!isNaN(L)){D.moveTo(B[0],B[1]);for(var H=1;H<I;++H){var A=this.getLocalXY(F[H]);D.lineTo(A[0],A[1])}if(J==="fill"){D.fill()}else{D.stroke()}}},drawPolygon:function(D,C,A){var F=D.components;var E=F.length;this.drawLinearRing(F[0],C,A);for(var B=1;B<E;++B){this.canvas.globalCompositeOperation="destination-out";if(this.hitDetection){this.hitContext.globalCompositeOperation="destination-out"}this.drawLinearRing(F[B],HGIS.Util.applyDefaults({stroke:false,fillOpacity:1},C),A);this.canvas.globalCompositeOperation="source-over";if(this.hitDetection){this.hitContext.globalCompositeOperation="source-over"}this.drawLinearRing(F[B],HGIS.Util.applyDefaults({fill:false},C),A)}},drawText:function(I,F){var A=this.getLocalXY(I);this.setCanvasStyle("reset");this.canvas.fillStyle=F.fontColor;this.canvas.globalAlpha=F.fontOpacity||1;var D=[F.fontStyle?F.fontStyle:"normal","normal",F.fontWeight?F.fontWeight:"normal",F.fontSize?F.fontSize:"1em",F.fontFamily?F.fontFamily:"sans-serif"].join(" ");var K=F.label.split("\n");var H=K.length;if(this.canvas.fillText){this.canvas.font=D;this.canvas.textAlign=HGIS.Renderer.Canvas.LABEL_ALIGN[F.labelAlign[0]]||"center";this.canvas.textBaseline=HGIS.Renderer.Canvas.LABEL_ALIGN[F.labelAlign[1]]||"middle";var C=HGIS.Renderer.Canvas.LABEL_FACTOR[F.labelAlign[1]];if(C==null){C=-0.5}var G=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;A[1]+=G*C*(H-1);for(var E=0;E<H;E++){if(F.labelOutlineWidth){this.canvas.save();this.canvas.globalAlpha=F.labelOutlineOpacity||F.fontOpacity||1;this.canvas.strokeStyle=F.labelOutlineColor;this.canvas.lineWidth=F.labelOutlineWidth;this.canvas.strokeText(K[E],A[0],A[1]+(G*E)+1);this.canvas.restore()}this.canvas.fillText(K[E],A[0],A[1]+(G*E))}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=D;var L=HGIS.Renderer.Canvas.LABEL_FACTOR[F.labelAlign[0]];if(L==null){L=-0.5}var C=HGIS.Renderer.Canvas.LABEL_FACTOR[F.labelAlign[1]];if(C==null){C=-0.5}var G=this.canvas.mozMeasureText("xx");A[1]+=G*(1+(C*H));for(var E=0;E<H;E++){var J=A[0]+(L*this.canvas.mozMeasureText(K[E]));var B=A[1]+(E*G);this.canvas.translate(J,B);this.canvas.mozDrawText(K[E]);this.canvas.translate(-J,-B)}}}this.setCanvasStyle("reset")},getLocalXY:function(A){var D=this.getResolution();var B=this.extent;var C=((A.x-this.featureDx)/D+(-B.left/D));var E=((B.top/D)-A.y/D);return[C,E]},clear:function(){var A=this.root.height;var B=this.root.width;this.canvas.clearRect(0,0,B,A);this.features={};if(this.hitDetection){this.hitContext.clearRect(0,0,B,A)}},getFeatureIdFromEvent:function(A){var B,I;if(this.hitDetection&&this.root.style.display!=="none"){if(!this.map.dragging){var D=A.xy;var G=D.x|0;var H=D.y|0;var C=this.hitContext.getImageData(G,H,1,1).data;if(C[3]===255){var F=C[2]+(256*(C[1]+(256*C[0])));if(F){B="HGIS_Feature_Vector_"+(F-1+this.hitOverflow);try{I=this.features[B][0]}catch(E){}}}}}return I},eraseFeatures:function(A){if(!(HGIS.Util.isArray(A))){A=[A]}for(var B=0;B<A.length;++B){delete this.features[A[B].id]}this.redraw()},redraw:function(){if(!this.locked){var A=this.root.height;var F=this.root.width;this.canvas.clearRect(0,0,F,A);if(this.hitDetection){this.hitContext.clearRect(0,0,F,A)}var G,D,C;var B=(this.map.baseLayer&&this.map.baseLayer.wrapDateLine)&&this.map.getMaxExtent();for(var E in this.features){if(!this.features.hasOwnProperty(E)){continue}G=this.features[E][0];D=G.geometry;this.calculateFeatureDx(D.getBounds(),B);C=this.features[E][1];this.drawGeometry(D,C,G.id);if(C.label){this.drawText(D.getCentroid(),C)}}}},CLASS_NAME:"HGIS.Renderer.Canvas"});HGIS.Renderer.Canvas.LABEL_ALIGN={"l":"left","r":"right","t":"top","b":"bottom"};HGIS.Renderer.Canvas.LABEL_FACTOR={"l":0,"r":-1,"t":0,"b":-1};HGIS.Renderer.Canvas.drawImageScaleFactor=null;HGIS.Format.OSM=HGIS.Class(HGIS.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(C){var D={"interestingTagsExclude":["source","source_ref","source:ref","history","attribution","created_by"],"areaTags":["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};D=HGIS.Util.extend(D,C);var B={};for(var A=0;A<D.interestingTagsExclude.length;A++){B[D.interestingTagsExclude[A]]=true}D.interestingTagsExclude=B;var E={};for(var A=0;A<D.areaTags.length;A++){E[D.areaTags[A]]=true}D.areaTags=E;this.externalProjection=new HGIS.Projection("EPSG:4326");HGIS.Format.XML.prototype.initialize.apply(this,[D])},read:function(H){if(typeof H=="string"){H=HGIS.Format.XML.prototype.read.apply(this,[H])}var O=this.getNodes(H);var I=this.getWays(H);var N=new Array(I.length);for(var F=0;F<I.length;F++){var D=new Array(I[F].nodes.length);var A=this.isWayArea(I[F])?1:0;for(var J=0;J<I[F].nodes.length;J++){var G=O[I[F].nodes[J]];var L=new HGIS.Geometry.Point(G.lon,G.lat);L.osm_id=parseInt(I[F].nodes[J]);D[J]=L;G.used=true}var E=null;if(A){E=new HGIS.Geometry.Polygon(new HGIS.Geometry.LinearRing(D))}else{E=new HGIS.Geometry.LineString(D)}if(this.internalProjection&&this.externalProjection){E.transform(this.externalProjection,this.internalProjection)}var K=new HGIS.Feature.Vector(E,I[F].tags);K.osm_id=parseInt(I[F].id);K.fid="way."+K.osm_id;N[F]=K}for(var B in O){var G=O[B];if(!G.used||this.checkTags){var M=null;if(this.checkTags){var C=this.getTags(G.node,true);if(G.used&&!C[1]){continue}M=C[0]}else{M=this.getTags(G.node)}var K=new HGIS.Feature.Vector(new HGIS.Geometry.Point(G["lon"],G["lat"]),M);if(this.internalProjection&&this.externalProjection){K.geometry.transform(this.externalProjection,this.internalProjection)}K.osm_id=parseInt(B);K.fid="node."+K.osm_id;N.push(K)}G.node=null}return N},getNodes:function(F){var D=F.getElementsByTagName("node");var C={};for(var A=0;A<D.length;A++){var B=D[A];var E=B.getAttribute("id");C[E]={"lat":B.getAttribute("lat"),"lon":B.getAttribute("lon"),"node":B}}return C},getWays:function(F){var D=F.getElementsByTagName("way");var A=[];for(var E=0;E<D.length;E++){var H=D[E];var G={id:H.getAttribute("id")};G.tags=this.getTags(H);var B=H.getElementsByTagName("nd");G.nodes=new Array(B.length);for(var C=0;C<B.length;C++){G.nodes[C]=B[C].getAttribute("ref")}A.push(G)}return A},getTags:function(F,E){var B=F.getElementsByTagName("tag");var D={};var C=false;for(var G=0;G<B.length;G++){var A=B[G].getAttribute("k");D[A]=B[G].getAttribute("v");if(E){if(!this.interestingTagsExclude[A]){C=true}}}return E?[D,C]:D},isWayArea:function(C){var D=false;var B=false;if(C.nodes[0]==C.nodes[C.nodes.length-1]){D=true}if(this.checkTags){for(var A in C.tags){if(this.areaTags[A]){B=true;break}}}return D&&(this.checkTags?B:true)},write:function(A){if(!(HGIS.Util.isArray(A))){A=[A]}this.osm_id=1;this.created_nodes={};var C=this.createElementNS(null,"osm");C.setAttribute("version","0.5");C.setAttribute("generator","HGIS "+HGIS.VERSION_NUMBER);for(var B=A.length-1;B>=0;B--){var D=this.createFeatureNodes(A[B]);for(var E=0;E<D.length;E++){C.appendChild(D[E])}}return HGIS.Format.XML.prototype.write.apply(this,[C])},createFeatureNodes:function(B){var E=[];var D=B.geometry.CLASS_NAME;var A=D.substring(D.lastIndexOf(".")+1);A=A.toLowerCase();var C=this.createXML[A];if(C){E=C.apply(this,[B])}return E},createXML:{"point":function(A){var E=null;var D=A.geometry?A.geometry:A;if(this.internalProjection&&this.externalProjection){D=D.clone();D.transform(this.internalProjection,this.externalProjection)}var C=false;if(A.osm_id){E=A.osm_id;if(this.created_nodes[E]){C=true}}else{E=-this.osm_id;this.osm_id++}if(C){B=this.created_nodes[E]}else{var B=this.createElementNS(null,"node")}this.created_nodes[E]=B;B.setAttribute("id",E);B.setAttribute("lon",D.x);B.setAttribute("lat",D.y);if(A.attributes){this.serializeTags(A,B)}this.setState(A,B);return C?[]:[B]},linestring:function(H){var F;var G=[];var C=H.geometry;if(H.osm_id){F=H.osm_id}else{F=-this.osm_id;this.osm_id++}var I=this.createElementNS(null,"way");I.setAttribute("id",F);for(var D=0;D<C.components.length;D++){var E=this.createXML["point"].apply(this,[C.components[D]]);if(E.length){E=E[0];var A=E.getAttribute("id");G.push(E)}else{A=C.components[D].osm_id;E=this.created_nodes[A]}this.setState(H,E);var B=this.createElementNS(null,"nd");B.setAttribute("ref",A);I.appendChild(B)}this.serializeTags(H,I);G.push(I);return G},polygon:function(A){var C=HGIS.Util.extend({"area":"yes"},A.attributes);var B=new HGIS.Feature.Vector(A.geometry.components[0],C);B.osm_id=A.osm_id;return this.createXML["linestring"].apply(this,[B])}},serializeTags:function(B,D){for(var A in B.attributes){var C=this.createElementNS(null,"tag");C.setAttribute("k",A);C.setAttribute("v",B.attributes[A]);D.appendChild(C)}},setState:function(A,B){if(A.state){var C=null;switch(A.state){case HGIS.State.UPDATE:C="modify";case HGIS.State.DELETE:C="delete"}if(C){B.setAttribute("action",C)}}},CLASS_NAME:"HGIS.Format.OSM"});HGIS.Handler.Keyboard=HGIS.Class(HGIS.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(B,C,A){HGIS.Handler.prototype.initialize.apply(this,arguments);this.eventListener=HGIS.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;HGIS.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(HGIS.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var A=0,B=this.KEY_EVENTS.length;A<B;A++){HGIS.Event.observe(this.observeElement,this.KEY_EVENTS[A],this.eventListener)}return true}else{return false}},deactivate:function(){var B=false;if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){for(var A=0,C=this.KEY_EVENTS.length;A<C;A++){HGIS.Event.stopObserving(this.observeElement,this.KEY_EVENTS[A],this.eventListener)}B=true}return B},handleKeyEvent:function(A){if(this.checkModifiers(A)){this.callback(A.type,[A])}},CLASS_NAME:"HGIS.Handler.Keyboard"});HGIS.Control.ModifyFeature=HGIS.Class(HGIS.Control,{documentDrag:false,geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:true,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(D,C){C=C||{};this.layer=D;this.vertices=[];this.virtualVertices=[];this.virtualStyle=HGIS.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,C.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=HGIS.Control.ModifyFeature.RESHAPE;HGIS.Control.prototype.initialize.apply(this,[C]);if(!(HGIS.Util.isArray(this.deleteCodes))){this.deleteCodes=[this.deleteCodes]}var B={down:function(F){this.vertex=null;var G=this.layer.getFeatureFromEvent(this.handlers.drag.evt);if(G){this.dragStart(G)}else{if(this.clickout){this._unselect=this.feature}}},move:function(F){delete this._unselect;if(this.vertex){this.dragVertex(this.vertex,F)}},up:function(){this.handlers.drag.stopDown=false;if(this._unselect){this.unselectFeature(this._unselect);delete this._unselect}},done:function(F){if(this.vertex){this.dragComplete(this.vertex)}}};var A={documentDrag:this.documentDrag,stopDown:false};var E={keydown:this.handleKeypress};this.handlers={keyboard:new HGIS.Handler.Keyboard(this,E),drag:new HGIS.Handler.Drag(this,B,A)}},destroy:function(){if(this.map){this.map.events.un({"removelayer":this.handleMapEvents,"changelayer":this.handleMapEvents,scope:this})}this.layer=null;HGIS.Control.prototype.destroy.apply(this,[])},activate:function(){this.moveLayerToTop();this.map.events.on({"removelayer":this.handleMapEvents,"changelayer":this.handleMapEvents,scope:this});return(this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&HGIS.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var B=false;if(HGIS.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.map.events.un({"removelayer":this.handleMapEvents,"changelayer":this.handleMapEvents,scope:this});this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.handlers.drag.deactivate();this.handlers.keyboard.deactivate();var A=this.feature;if(A&&A.geometry&&A.layer){this.unselectFeature(A)}B=true}return B},beforeSelectFeature:function(A){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:A})},selectFeature:function(A){if(this.feature===A||(this.geometryTypes&&HGIS.Util.indexOf(this.geometryTypes,A.geometry.CLASS_NAME)==-1)){return}if(this.beforeSelectFeature(A)!==false){if(this.feature){this.unselectFeature(this.feature)}this.feature=A;this.layer.selectedFeatures.push(A);this.layer.drawFeature(A,"select");this.modified=false;this.resetVertices();this.onModificationStart(this.feature)}var B=A.modified;if(A.geometry&&!(B&&B.geometry)){this._originalGeometry=A.geometry.clone()}},unselectFeature:function(A){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.layer.drawFeature(this.feature,"default");this.feature=null;HGIS.Util.removeItem(this.layer.selectedFeatures,A);this.onModificationEnd(A);this.layer.events.triggerEvent("afterfeaturemodified",{feature:A,modified:this.modified});this.modified=false},dragStart:function(A){var B=A.geometry.CLASS_NAME=="HGIS.Geometry.Point";if(!this.standalone&&((!A._sketch&&B)||!A._sketch)){if(this.toggle&&this.feature===A){this._unselect=A}this.selectFeature(A)}if(A._sketch||B){this.vertex=A;this.handlers.drag.stopDown=true}},dragVertex:function(C,A){var D=this.map.getLonLatFromViewPortPx(A);var B=C.geometry;B.move(D.lon-B.x,D.lat-B.y);this.modified=true;if(this.feature.geometry.CLASS_NAME=="HGIS.Geometry.Point"){this.layer.events.triggerEvent("vertexmodified",{vertex:C.geometry,feature:this.feature,pixel:A})}else{if(C._index){C.geometry.parent.addComponent(C.geometry,C._index);delete C._index;HGIS.Util.removeItem(this.virtualVertices,C);this.vertices.push(C)}else{if(C==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else{if(C!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:C.geometry,feature:this.feature,pixel:A})}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.standalone?undefined:"select")}this.layer.drawFeature(C)},dragComplete:function(A){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=HGIS.State.INSERT&&this.feature.state!=HGIS.State.DELETE){this.feature.state=HGIS.State.UPDATE;if(this.modified&&this._originalGeometry){var A=this.feature;A.modified=HGIS.Util.extend(A.modified,{geometry:this._originalGeometry});delete this._originalGeometry}}},resetVertices:function(){if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="HGIS.Geometry.Point"){if((this.mode&HGIS.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(HGIS.Control.ModifyFeature.ROTATE|HGIS.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if(this.mode&HGIS.Control.ModifyFeature.RESHAPE){if(!(this.mode&HGIS.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(B){var A=B.keyCode;if(this.feature&&HGIS.Util.indexOf(this.deleteCodes,A)!=-1){var C=this.layer.getFeatureFromEvent(this.handlers.drag.evt);if(C&&HGIS.Util.indexOf(this.vertices,C)!=-1&&!this.handlers.drag.dragging&&C.geometry.parent){C.geometry.parent.removeComponent(C.geometry);this.layer.events.triggerEvent("vertexremoved",{vertex:C.geometry,feature:this.feature,pixel:B.xy});this.layer.drawFeature(this.feature,this.standalone?undefined:"select");this.modified=true;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var B=this;function A(E){var F,H,G,J;if(E.CLASS_NAME=="HGIS.Geometry.Point"){H=new HGIS.Feature.Vector(E);H._sketch=true;H.renderIntent=B.vertexRenderIntent;B.vertices.push(H)}else{var C=E.components.length;if(E.CLASS_NAME=="HGIS.Geometry.LinearRing"){C-=1}for(F=0;F<C;++F){G=E.components[F];if(G.CLASS_NAME=="HGIS.Geometry.Point"){H=new HGIS.Feature.Vector(G);H._sketch=true;H.renderIntent=B.vertexRenderIntent;B.vertices.push(H)}else{A(G)}}if(B.createVertices&&E.CLASS_NAME!="HGIS.Geometry.MultiPoint"){for(F=0,J=E.components.length;F<J-1;++F){var L=E.components[F];var I=E.components[F+1];if(L.CLASS_NAME=="HGIS.Geometry.Point"&&I.CLASS_NAME=="HGIS.Geometry.Point"){var M=(L.x+I.x)/2;var K=(L.y+I.y)/2;var D=new HGIS.Feature.Vector(new HGIS.Geometry.Point(M,K),null,B.virtualStyle);D.geometry.parent=E;D._index=F+1;D._sketch=true;B.virtualVertices.push(D)}}}}}A.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var C=this.feature.geometry;var B=C.getBounds().getCenterLonLat();var A=new HGIS.Geometry.Point(B.lon,B.lat);var D=new HGIS.Feature.Vector(A);A.move=function(E,F){HGIS.Geometry.Point.prototype.move.call(this,E,F);C.move(E,F)};D._sketch=true;this.dragHandle=D;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var E=this.feature.geometry;var B=E.getBounds();var A=B.getCenterLonLat();var C=new HGIS.Geometry.Point(A.lon,A.lat);var D=new HGIS.Geometry.Point(B.right,B.bottom);var F=new HGIS.Feature.Vector(D);var G=(this.mode&HGIS.Control.ModifyFeature.RESIZE);var I=(this.mode&HGIS.Control.ModifyFeature.RESHAPE);var H=(this.mode&HGIS.Control.ModifyFeature.ROTATE);D.move=function(U,V){HGIS.Geometry.Point.prototype.move.call(this,U,V);var R=this.x-C.x;var N=this.y-C.y;var P=R-U;var M=N-V;if(H){var Q=Math.atan2(M,P);var O=Math.atan2(N,R);var T=O-Q;T*=180/Math.PI;E.rotate(T,C)}if(G){var J,K;if(I){J=N/M;K=(R/P)/J}else{var L=Math.sqrt((P*P)+(M*M));var S=Math.sqrt((R*R)+(N*N));J=S/L}E.resize(J,C,K)}};F._sketch=true;this.radiusHandle=F;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(A){this.handlers.drag.setMap(A);HGIS.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(A){if(A.type=="removelayer"||A.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var A=Math.max(this.map.Z_INDEX_BASE["Feature"]-1,this.layer.getZIndex())+1;this.layer.setZIndex(A)},moveLayerBack:function(){var A=this.layer.getZIndex()-1;if(A>=this.map.Z_INDEX_BASE["Feature"]){this.layer.setZIndex(A)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"HGIS.Control.ModifyFeature"});HGIS.Control.ModifyFeature.RESHAPE=1;HGIS.Control.ModifyFeature.RESIZE=2;HGIS.Control.ModifyFeature.ROTATE=4;HGIS.Control.ModifyFeature.DRAG=8;HGIS.Layer.Bing=HGIS.Class(HGIS.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.8792382813,9783.93961914062,4891.96980957031,2445.98490478516,1222.99245239258,611.496226196289,305.748113098145,152.874056549072,76.4370282745361,38.2185141372681,19.109257068634,9.55462853431702,4.77731426715851,2.38865713357925,1.19432856678963,0.597164283394814,0.298582141697407,0.149291070848703,0.0746455354243517],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(A){A=HGIS.Util.applyDefaults({sphericalMercator:true},A);var B=A.name||"Bing "+(A.type||this.type);var C=[B,null,A];HGIS.Layer.XYZ.prototype.initialize.apply(this,C);this.tileOptions=HGIS.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=HGIS.Function.bind(HGIS.Layer.Bing.processMetadata,this);var C=HGIS.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams);var A=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+HGIS.Util.getParameterString(C);var B=document.createElement("script");B.type="text/javascript";B.src=A;B.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(B)},initLayer:function(){var C=this.metadata.resourceSets[0].resources[0];var B=C.imageUrl.replace("{quadkey}","${quadkey}");B=B.replace("{culture}",this.culture);B=B.replace(this.protocolRegex,this.protocol);this.url=[];for(var A=0;A<C.imageUrlSubdomains.length;++A){this.url.push(B.replace("{subdomain}",C.imageUrlSubdomains[A]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[C.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(C.zoomMax+1-C.zoomMin,this.numZoomLevels)},true);if(!this.isBaseLayer){this.redraw()}this.updateAttribution()},getURL:function(C){if(!this.url){return}var E=this.getXYZ(C),H=E.x,I=E.y,G=E.z;var D=[];for(var F=G;F>0;--F){var A="0";var K=1<<(F-1);if((H&K)!=0){A++}if((I&K)!=0){A++;A++}D.push(A)}var B=D.join("");var J=this.selectUrl(""+H+I+G,this.url);return HGIS.String.format(J,{"quadkey":B})},updateAttribution:function(){var L=this.metadata;if(!L.resourceSets||!this.map||!this.map.center){return}var D=L.resourceSets[0].resources[0];var E=this.map.getExtent().transform(this.map.getProjectionObject(),new HGIS.Projection("EPSG:4326"));var K=D.imageryProviders||[],C=HGIS.Util.indexOf(this.serverResolutions,this.getServerResolution()),A="",G,H,B,J,M,F,I;for(H=0,B=K.length;H<B;++H){G=K[H];for(J=0,M=G.coverageAreas.length;J<M;++J){I=G.coverageAreas[J];F=HGIS.Bounds.fromArray(I.bbox,true);if(E.intersectsBounds(F)&&C<=I.zoomMax&&C>=I.zoomMin){A+=G.attribution+" "}}}var N=L.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=HGIS.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:N,copyrights:A});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})},setMap:function(){HGIS.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.updateAttribution)},clone:function(A){if(A==null){A=new HGIS.Layer.Bing(this.options)}A=HGIS.Layer.XYZ.prototype.clone.apply(this,[A]);return A},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);HGIS.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"HGIS.Layer.Bing"});HGIS.Layer.Bing.processMetadata=function(B){this.metadata=B;this.initLayer();var A=document.getElementById(this._callbackId);A.parentNode.removeChild(A);window[this._callbackId]=undefined;delete this._callbackId};HGIS.StyleMap=HGIS.Class({styles:null,extendDefault:true,initialize:function(C,B){this.styles={"default":new HGIS.Style(HGIS.Feature.Vector.style["default"]),"select":new HGIS.Style(HGIS.Feature.Vector.style["select"]),"temporary":new HGIS.Style(HGIS.Feature.Vector.style["temporary"]),"delete":new HGIS.Style(HGIS.Feature.Vector.style["delete"])};if(C instanceof HGIS.Style){this.styles["default"]=C;this.styles["select"]=C;this.styles["temporary"]=C;this.styles["delete"]=C}else{if(typeof C=="object"){for(var A in C){if(C[A] instanceof HGIS.Style){this.styles[A]=C[A]}else{if(typeof C[A]=="object"){this.styles[A]=new HGIS.Style(C[A])}else{this.styles["default"]=new HGIS.Style(C);this.styles["select"]=new HGIS.Style(C);this.styles["temporary"]=new HGIS.Style(C);this.styles["delete"]=new HGIS.Style(C);break}}}}}HGIS.Util.extend(this,B)},destroy:function(){for(var A in this.styles){this.styles[A].destroy()}this.styles=null},createSymbolizer:function(A,C){if(!A){A=new HGIS.Feature.Vector()}if(!this.styles[C]){C="default"}A.renderIntent=C;var B={};if(this.extendDefault&&C!="default"){B=this.styles["default"].createSymbolizer(A)}return HGIS.Util.extend(B,this.styles[C].createSymbolizer(A))},addUniqueValueRules:function(A,E,C,B){var D=[];for(var F in C){D.push(new HGIS.Rule({symbolizer:C[F],context:B,filter:new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.EQUAL_TO,property:E,value:F})}))}this.styles[A].addRules(D)},CLASS_NAME:"HGIS.StyleMap"});HGIS.Layer.Vector=HGIS.Class(HGIS.Layer,{isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,ratio:1,initialize:function(C,B){HGIS.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new HGIS.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var A=0,D=this.strategies.length;A<D;A++){this.strategies[A].setLayer(this)}}},destroy:function(){if(this.strategies){var C,A,B;for(A=0,B=this.strategies.length;A<B;A++){C=this.strategies[A];if(C.autoDestroy){C.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;HGIS.Layer.prototype.destroy.apply(this,arguments)},clone:function(C){if(C==null){C=new HGIS.Layer.Vector(this.name,this.getOptions())}C=HGIS.Layer.prototype.clone.apply(this,[C]);var A=this.features;var E=A.length;var D=new Array(E);for(var B=0;B<E;++B){D[B]=A[B].clone()}C.features=D;return C},refresh:function(A){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",A)}},assignRenderer:function(){for(var A=0,C=this.renderers.length;A<C;A++){var D=this.renderers[A];var B=(typeof D=="function")?D:HGIS.Renderer[D];if(B&&B.prototype.supported()){this.renderer=new B(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){HGIS.Console.userError(HGIS.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(A){HGIS.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;var B=this.map.getSize();B.w=B.w*this.ratio;B.h=B.h*this.ratio;this.renderer.setSize(B)}},afterAdd:function(){if(this.strategies){var C,A,B;for(A=0,B=this.strategies.length;A<B;A++){C=this.strategies[A];if(C.autoActivate){C.activate()}}}},removeMap:function(B){this.drawn=false;if(this.strategies){var D,A,C;for(A=0,C=this.strategies.length;A<C;A++){D=this.strategies[A];if(D.autoActivate){D.deactivate()}}}},onMapResize:function(){HGIS.Layer.prototype.onMapResize.apply(this,arguments);var A=this.map.getSize();A.w=A.w*this.ratio;A.h=A.h*this.ratio;this.renderer.setSize(A)},moveTo:function(B,I,G){HGIS.Layer.prototype.moveTo.apply(this,arguments);var H=true;if(!G){this.renderer.root.style.visibility="hidden";var A=this.map.getSize(),D=A.w,M=A.h,C=(D/2*this.ratio)-D/2,L=(M/2*this.ratio)-M/2;C+=this.map.layerContainerOriginPx.x;C=-Math.round(C);L+=this.map.layerContainerOriginPx.y;L=-Math.round(L);this.div.style.left=C+"px";this.div.style.top=L+"px";var E=this.map.getExtent().scale(this.ratio);H=this.renderer.setExtent(E,I);this.renderer.root.style.visibility="visible";if(HGIS.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft}if(!I&&H){for(var F in this.unrenderedFeatures){var K=this.unrenderedFeatures[F];this.drawFeature(K)}}}if(!this.drawn||I||!H){this.drawn=true;var K;for(var F=0,J=this.features.length;F<J;F++){this.renderer.locked=(F!==(J-1));K=this.features[F];this.drawFeature(K)}}},display:function(B){HGIS.Layer.prototype.display.apply(this,arguments);var A=this.div.style.display;if(A!=this.renderer.root.style.display){this.renderer.root.style.display=A}},addFeatures:function(A,F){if(!(HGIS.Util.isArray(A))){A=[A]}var B=!F||!F.silent;if(B){var C={features:A};var I=this.events.triggerEvent("beforefeaturesadded",C);if(I===false){return}A=C.features}var D=[];for(var E=0,G=A.length;E<G;E++){if(E!=(A.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var H=A[E];if(this.geometryType&&!(H.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}H.layer=this;if(!H.style&&this.style){H.style=HGIS.Util.extend({},this.style)}if(B){if(this.events.triggerEvent("beforefeatureadded",{feature:H})===false){continue}this.preFeatureInsert(H)}D.push(H);this.features.push(H);this.drawFeature(H);if(B){this.events.triggerEvent("featureadded",{feature:H});this.onFeatureInsert(H)}}if(B){this.events.triggerEvent("featuresadded",{features:D})}},removeFeatures:function(A,C){if(!A||A.length===0){return}if(A===this.features){return this.removeAllFeatures(C)}if(!(HGIS.Util.isArray(A))){A=[A]}if(A===this.selectedFeatures){A=A.slice()}var D=!C||!C.silent;if(D){this.events.triggerEvent("beforefeaturesremoved",{features:A})}for(var B=A.length-1;B>=0;B--){if(B!=0&&A[B-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var E=A[B];delete this.unrenderedFeatures[E.id];if(D){this.events.triggerEvent("beforefeatureremoved",{feature:E})}this.features=HGIS.Util.removeItem(this.features,E);E.layer=null;if(E.geometry){this.renderer.eraseFeatures(E)}if(HGIS.Util.indexOf(this.selectedFeatures,E)!=-1){HGIS.Util.removeItem(this.selectedFeatures,E)}if(D){this.events.triggerEvent("featureremoved",{feature:E})}}if(D){this.events.triggerEvent("featuresremoved",{features:A})}},removeAllFeatures:function(D){var A=!D||!D.silent;var B=this.features;if(A){this.events.triggerEvent("beforefeaturesremoved",{features:B})}var E;for(var C=B.length-1;C>=0;C--){E=B[C];if(A){this.events.triggerEvent("beforefeatureremoved",{feature:E})}E.layer=null;if(A){this.events.triggerEvent("featureremoved",{feature:E})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(A){this.events.triggerEvent("featuresremoved",{features:B})}},destroyFeatures:function(A,C){var D=(A==undefined);if(D){A=this.features}if(A){this.removeFeatures(A,C);for(var B=A.length-1;B>=0;B--){A[B].destroy()}}},drawFeature:function(B,C){if(!this.drawn){return}if(typeof C!="object"){if(!C&&B.state===HGIS.State.DELETE){C="delete"}var A=C||B.renderIntent;C=B.style||this.style;if(!C){C=this.styleMap.createSymbolizer(B,A)}}var D=this.renderer.drawFeature(B,C);if(D===false||D===null){this.unrenderedFeatures[B.id]=B}else{delete this.unrenderedFeatures[B.id]}},eraseFeatures:function(A){this.renderer.eraseFeatures(A)},getFeatureFromEvent:function(C){if(!this.renderer){throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var B=null;var A=this.renderer.getFeatureIdFromEvent(C);if(A){if(typeof A==="string"){B=this.getFeatureById(A)}else{B=A}}return B},getFeatureBy:function(C,E){var A=null;for(var B=0,D=this.features.length;B<D;++B){if(this.features[B][C]==E){A=this.features[B];break}}return A},getFeatureById:function(A){return this.getFeatureBy("id",A)},getFeatureByFid:function(A){return this.getFeatureBy("fid",A)},getFeaturesByAttribute:function(A,D){var B,F,E=this.features.length,C=[];for(B=0;B<E;B++){F=this.features[B];if(F&&F.attributes){if(F.attributes[A]===D){C.push(F)}}}return C},onFeatureInsert:function(A){},preFeatureInsert:function(A){},getDataExtent:function(){var C=null;var A=this.features;if(A&&(A.length>0)){var D=null;for(var B=0,E=A.length;B<E;B++){D=A[B].geometry;if(D){if(C===null){C=new HGIS.Bounds()}C.extend(D.getBounds())}}}return C},CLASS_NAME:"HGIS.Layer.Vector"});HGIS.Layer.PointGrid=HGIS.Class(HGIS.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(A){A=A||{};HGIS.Layer.Vector.prototype.initialize.apply(this,[A.name,A])},setMap:function(A){HGIS.Layer.Vector.prototype.setMap.apply(this,arguments);A.events.register("moveend",this,this.onMoveEnd)},removeMap:function(A){A.events.unregister("moveend",this,this.onMoveEnd);HGIS.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(A){this.ratio=A;this.updateGrid(true)},setMaxFeatures:function(A){this.maxFeatures=A;this.updateGrid(true)},setSpacing:function(A,B){this.dx=A;this.dy=B||A;this.updateGrid(true)},setOrigin:function(A){this.origin=A;this.updateGrid(true)},getOrigin:function(){if(!this.origin){this.origin=this.map.getExtent().getCenterLonLat()}return this.origin},setRotation:function(A){this.rotation=A;this.updateGrid(true)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var A=this.map.getExtent();if(this.rotation){var C=this.getOrigin();var D=new HGIS.Geometry.Point(C.lon,C.lat);var B=A.toGeometry();B.rotate(-this.rotation,D);A=B.getBounds()}return A},updateGrid:function(D){if(D||this.invalidBounds()){var O=this.getViewBounds();var C=this.getOrigin();var K=new HGIS.Geometry.Point(C.lon,C.lat);var N=O.getWidth();var R=O.getHeight();var I=N/R;var H=Math.sqrt(this.dx*this.dy*this.maxFeatures/I);var G=H*I;var Q=Math.min(N*this.ratio,G);var E=Math.min(R*this.ratio,H);var V=O.getCenterLonLat();this.gridBounds=new HGIS.Bounds(V.lon-(Q/2),V.lat-(E/2),V.lon+(Q/2),V.lat+(E/2));var A=Math.floor(E/this.dy);var S=Math.floor(Q/this.dx);var U=C.lon+(this.dx*Math.ceil((this.gridBounds.left-C.lon)/this.dx));var B=C.lat+(this.dy*Math.ceil((this.gridBounds.bottom-C.lat)/this.dy));var L=new Array(A*S);var T,J,M;for(var F=0;F<S;++F){T=U+(F*this.dx);for(var P=0;P<A;++P){J=B+(P*this.dy);M=new HGIS.Geometry.Point(T,J);if(this.rotation){M.rotate(this.rotation,K)}L[(F*A)+P]=new HGIS.Feature.Vector(M)}}this.destroyFeatures(this.features,{silent:true});this.addFeatures(L,{silent:true})}},invalidBounds:function(){return !this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"HGIS.Layer.PointGrid"});HGIS.Handler.MouseWheel=HGIS.Class(HGIS.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:true,initialize:function(B,C,A){HGIS.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=HGIS.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){HGIS.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(A){if(!this.map||!this.checkModifiers(A)){return}var E=false;var M=false;var J=false;var C=HGIS.Event.element(A);while((C!=null)&&!J&&!E){if(!E){try{var D;if(C.currentStyle){D=C.currentStyle["overflow"]}else{var H=document.defaultView.getComputedStyle(C,null);D=H.getPropertyValue("overflow")}E=(D&&(D=="auto")||(D=="scroll"))}catch(F){}}if(!M){M=HGIS.Element.hasClass(C,"olScrollable");if(!M){for(var G=0,K=this.map.layers.length;G<K;G++){var I=this.map.layers[G];if(C==I.div||C==I.pane){M=true;break}}}}J=(C==this.map.div);C=C.parentNode}if(!E&&J){if(M){var L=0;if(A.wheelDelta){L=A.wheelDelta;if(L%160===0){L=L*0.75}L=L/120}else{if(A.detail){L=-(A.detail/Math.abs(A.detail))}}this.delta+=L;window.clearTimeout(this._timeoutId);if(this.interval&&Math.abs(this.delta)<this.maxDelta){var B=HGIS.Util.extend({},A);this._timeoutId=window.setTimeout(HGIS.Function.bind(function(){this.wheelZoom(B)},this),this.interval)}else{this.wheelZoom(A)}}HGIS.Event.stop(A)}},wheelZoom:function(B){var A=this.delta;this.delta=0;if(A){B.xy=this.map.events.getMousePosition(B);if(A<0){this.callback("down",[B,this.cumulative?Math.max(-this.maxDelta,A):-1])}else{this.callback("up",[B,this.cumulative?Math.min(this.maxDelta,A):1])}}},activate:function(B){if(HGIS.Handler.prototype.activate.apply(this,arguments)){var A=this.wheelListener;HGIS.Event.observe(window,"DOMMouseScroll",A);HGIS.Event.observe(window,"mousewheel",A);HGIS.Event.observe(document,"mousewheel",A);return true}else{return false}},deactivate:function(B){if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){var A=this.wheelListener;HGIS.Event.stopObserving(window,"DOMMouseScroll",A);HGIS.Event.stopObserving(window,"mousewheel",A);HGIS.Event.stopObserving(document,"mousewheel",A);return true}else{return false}},CLASS_NAME:"HGIS.Handler.MouseWheel"});HGIS.Symbolizer=HGIS.Class({zIndex:0,initialize:function(A){HGIS.Util.extend(this,A)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(HGIS.Util.extend({},this))},CLASS_NAME:"HGIS.Symbolizer"});HGIS.Symbolizer.Raster=HGIS.Class(HGIS.Symbolizer,{initialize:function(A){HGIS.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"HGIS.Symbolizer.Raster"});HGIS.Rule=HGIS.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(A){this.symbolizer={};HGIS.Util.extend(this,A);if(this.symbolizers){delete this.symbolizer}this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var A in this.symbolizer){this.symbolizer[A]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(B){var A=this.getContext(B);var C=true;if(this.minScaleDenominator||this.maxScaleDenominator){var D=B.layer.map.getScale()}if(this.minScaleDenominator){C=D>=HGIS.Style.createLiteral(this.minScaleDenominator,A)}if(C&&this.maxScaleDenominator){C=D<HGIS.Style.createLiteral(this.maxScaleDenominator,A)}if(C&&this.filter){if(this.filter.CLASS_NAME=="HGIS.Filter.FeatureId"){C=this.filter.evaluate(B)}else{C=this.filter.evaluate(A)}}return C},getContext:function(B){var A=this.context;if(!A){A=B.attributes||B.data}if(typeof this.context=="function"){A=this.context(B)}return A},clone:function(){var C=HGIS.Util.extend({},this);if(this.symbolizers){var D=this.symbolizers.length;C.symbolizers=new Array(D);for(var B=0;B<D;++B){C.symbolizers[B]=this.symbolizers[B].clone()}}else{C.symbolizer={};var E,A;for(var F in this.symbolizer){E=this.symbolizer[F];A=typeof E;if(A==="object"){C.symbolizer[F]=HGIS.Util.extend({},E)}else{if(A==="string"){C.symbolizer[F]=E}}}}C.filter=this.filter&&this.filter.clone();C.context=this.context&&HGIS.Util.extend({},this.context);return new HGIS.Rule(C)},CLASS_NAME:"HGIS.Rule"});HGIS.Format.SLD=HGIS.Class(HGIS.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:true,namedLayersAsArray:false,CLASS_NAME:"HGIS.Format.SLD"});HGIS.Symbolizer.Polygon=HGIS.Class(HGIS.Symbolizer,{initialize:function(A){HGIS.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"HGIS.Symbolizer.Polygon"});HGIS.Format.GML.v2=HGIS.Class(HGIS.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(A){HGIS.Format.GML.Base.prototype.initialize.apply(this,[A])},readers:{"gml":HGIS.Util.applyDefaults({"outerBoundaryIs":function(B,C){var A={};this.readChildNodes(B,A);C.outer=A.components[0]},"innerBoundaryIs":function(B,C){var A={};this.readChildNodes(B,A);C.inner.push(A.components[0])},"Box":function(C,D){var B={};this.readChildNodes(C,B);if(!D.components){D.components=[]}var A=B.points[0];var E=B.points[1];D.components.push(new HGIS.Bounds(A.x,A.y,E.x,E.y))}},HGIS.Format.GML.Base.prototype.readers["gml"]),"feature":HGIS.Format.GML.Base.prototype.readers["feature"],"wfs":HGIS.Format.GML.Base.prototype.readers["wfs"]},write:function(A){var C;if(HGIS.Util.isArray(A)){C="wfs:FeatureCollection"}else{C="gml:featureMember"}var B=this.writeNode(C,A);this.setAttributeNS(B,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[B])},writers:{"gml":HGIS.Util.applyDefaults({"Point":function(B){var A=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[B],A);return A},"coordinates":function(D){var E=D.length;var A=new Array(E);var C;for(var B=0;B<E;++B){C=D[B];if(this.xy){A[B]=C.x+","+C.y}else{A[B]=C.y+","+C.x}if(C.z!=undefined){A[B]+=","+C.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(E==1)?A[0]:A.join(" ")})},"LineString":function(B){var A=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",B.components,A);return A},"Polygon":function(C){var B=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",C.components[0],B);for(var A=1;A<C.components.length;++A){this.writeNode("innerBoundaryIs",C.components[A],B)}return B},"outerBoundaryIs":function(B){var A=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",B,A);return A},"innerBoundaryIs":function(B){var A=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",B,A);return A},"LinearRing":function(B){var A=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",B.components,A);return A},"Box":function(A){var B=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:A.left,y:A.bottom},{x:A.right,y:A.top}],B);if(this.srsName){B.setAttribute("srsName",this.srsName)}return B}},HGIS.Format.GML.Base.prototype.writers["gml"]),"feature":HGIS.Format.GML.Base.prototype.writers["feature"],"wfs":HGIS.Format.GML.Base.prototype.writers["wfs"]},CLASS_NAME:"HGIS.Format.GML.v2"});HGIS.Format.Filter.v1_0_0=HGIS.Class(HGIS.Format.GML.v2,HGIS.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(A){HGIS.Format.GML.v2.prototype.initialize.apply(this,[A])},readers:{"ogc":HGIS.Util.applyDefaults({"PropertyIsEqualTo":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.EQUAL_TO});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsNotEqualTo":function(B,A){var C=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(B,C);A.filters.push(C)},"PropertyIsLike":function(B,A){var D=new HGIS.Filter.Comparison({type:HGIS.Filter.Comparison.LIKE});this.readChildNodes(B,D);var C=B.getAttribute("wildCard");var E=B.getAttribute("singleChar");var F=B.getAttribute("escape");D.value2regex(C,E,F);A.filters.push(D)}},HGIS.Format.Filter.v1.prototype.readers["ogc"]),"gml":HGIS.Format.GML.v2.prototype.readers["gml"],"feature":HGIS.Format.GML.v2.prototype.readers["feature"]},writers:{"ogc":HGIS.Util.applyDefaults({"PropertyIsEqualTo":function(B){var A=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsNotEqualTo":function(B){var A=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",B,A);this.writeOgcExpression(B.value,A);return A},"PropertyIsLike":function(B){var A=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",B,A);this.writeNode("Literal",B.regex2value(),A);return A},"BBOX":function(C){var B=this.createElementNSPlus("ogc:BBOX");C.property&&this.writeNode("PropertyName",C,B);var A=this.writeNode("gml:Box",C.value,B);if(C.projection){A.setAttribute("srsName",C.projection)}return B}},HGIS.Format.Filter.v1.prototype.writers["ogc"]),"gml":HGIS.Format.GML.v2.prototype.writers["gml"],"feature":HGIS.Format.GML.v2.prototype.writers["feature"]},writeSpatial:function(D,C){var B=this.createElementNSPlus("ogc:"+C);this.writeNode("PropertyName",D,B);if(D.value instanceof HGIS.Filter.Function){this.writeNode("Function",D.value,B)}else{var A;if(D.value instanceof HGIS.Geometry){A=this.writeNode("feature:_geometry",D.value).firstChild}else{A=this.writeNode("gml:Box",D.value)}if(D.projection){A.setAttribute("srsName",D.projection)}B.appendChild(A)}return B},CLASS_NAME:"HGIS.Format.Filter.v1_0_0"});HGIS.Format.WFST.v1_0_0=HGIS.Class(HGIS.Format.Filter.v1_0_0,HGIS.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:false,schemaLocations:{"wfs":"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(A){HGIS.Format.Filter.v1_0_0.prototype.initialize.apply(this,[A]);HGIS.Format.WFST.v1.prototype.initialize.apply(this,[A])},readNode:function(B,A,C){return HGIS.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{"wfs":HGIS.Util.applyDefaults({"WFS_TransactionResponse":function(B,A){A.insertIds=[];A.success=false;this.readChildNodes(B,A)},"InsertResult":function(B,C){var A={fids:[]};this.readChildNodes(B,A);C.insertIds=C.insertIds.concat(A.fids)},"TransactionResult":function(B,A){this.readChildNodes(B,A)},"Status":function(B,A){this.readChildNodes(B,A)},"SUCCESS":function(B,A){A.success=true}},HGIS.Format.WFST.v1.prototype.readers["wfs"]),"gml":HGIS.Format.GML.v2.prototype.readers["gml"],"feature":HGIS.Format.GML.v2.prototype.readers["feature"],"ogc":HGIS.Format.Filter.v1_0_0.prototype.readers["ogc"]},writers:{"wfs":HGIS.Util.applyDefaults({"Query":function(D){D=HGIS.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},D);var B=D.featurePrefix;var C=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(B?B+":":"")+D.featureType}});if(D.srsNameInQuery&&D.srsName){C.setAttribute("srsName",D.srsName)}if(D.featureNS){C.setAttribute("xmlns:"+B,D.featureNS)}if(D.propertyNames){for(var A=0,E=D.propertyNames.length;A<E;A++){this.writeNode("ogc:PropertyName",{property:D.propertyNames[A]},C)}}if(D.filter){this.setFilterProperty(D.filter);this.writeNode("ogc:Filter",D.filter,C)}return C}},HGIS.Format.WFST.v1.prototype.writers["wfs"]),"gml":HGIS.Format.GML.v2.prototype.writers["gml"],"feature":HGIS.Format.GML.v2.prototype.writers["feature"],"ogc":HGIS.Format.Filter.v1_0_0.prototype.writers["ogc"]},CLASS_NAME:"HGIS.Format.WFST.v1_0_0"});HGIS.ElementsIndexer=HGIS.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(A){this.compare=A?HGIS.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:HGIS.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(F){if(this.exists(F)){this.remove(F)}var A=F.id;this.determineZIndex(F);var D=-1;var C=this.order.length;var E;while(C-D>1){E=parseInt((D+C)/2);var B=this.compare(this,F,HGIS.Util.getElement(this.order[E]));if(B>0){D=E}else{C=E}}this.order.splice(C,0,A);this.indices[A]=this.getZIndex(F);return this.getNextElement(C)},remove:function(C){var A=C.id;var D=HGIS.Util.indexOf(this.order,A);if(D>=0){this.order.splice(D,1);delete this.indices[A];if(this.order.length>0){var B=this.order[this.order.length-1];this.maxZIndex=this.indices[B]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(A){return(this.indices[A.id]!=null)},getZIndex:function(A){return A._style.graphicZIndex},determineZIndex:function(B){var A=B._style.graphicZIndex;if(A==null){A=this.maxZIndex;B._style.graphicZIndex=A}else{if(A>this.maxZIndex){this.maxZIndex=A}}},getNextElement:function(B){var A=B+1;if(A<this.order.length){var C=HGIS.Util.getElement(this.order[A]);if(C==undefined){C=this.getNextElement(A)}return C}else{return null}},CLASS_NAME:"HGIS.ElementsIndexer"});HGIS.ElementsIndexer.IndexingMethods={Z_ORDER:function(D,F,E){var A=D.getZIndex(F);var C=0;if(E){var B=D.getZIndex(E);C=A-B}return C},Z_ORDER_DRAWING_ORDER:function(B,D,C){var A=HGIS.ElementsIndexer.IndexingMethods.Z_ORDER(B,D,C);if(C&&A==0){A=1}return A},Z_ORDER_Y_ORDER:function(C,E,D){var B=HGIS.ElementsIndexer.IndexingMethods.Z_ORDER(C,E,D);if(D&&B===0){var A=D._boundsBottom-E._boundsBottom;B=(A===0)?1:A}return B}};HGIS.Renderer.Elements=HGIS.Class(HGIS.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(A,B){HGIS.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(B&&(B.zIndexing||B.yOrdering)){this.indexer=new HGIS.ElementsIndexer(B.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;HGIS.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var B;var A=this.vectorRoot;if(A){while(B=A.firstChild){A.removeChild(B)}}A=this.textRoot;if(A){while(B=A.firstChild){A.removeChild(B)}}if(this.indexer){this.indexer.clear()}},setExtent:function(E,D){var G=HGIS.Renderer.prototype.setExtent.apply(this,arguments);var F=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var A,C=E.getWidth()/this.map.getExtent().getWidth(),E=E.scale(1/C),B=this.map.getMaxExtent();if(B.right>E.left&&B.right<E.right){A=true}else{if(B.left>E.left&&B.left<E.right){A=false}}if(A!==this.rightOfDateLine||D){G=false;this.xOffset=A===true?B.getWidth()/F:0}this.rightOfDateLine=A}return G},getNodeType:function(B,A){},drawGeometry:function(C,E,B){var I=C.CLASS_NAME;var A=true;if((I=="HGIS.Geometry.Collection")||(I=="HGIS.Geometry.MultiPoint")||(I=="HGIS.Geometry.MultiLineString")||(I=="HGIS.Geometry.MultiPolygon")){for(var D=0,H=C.components.length;D<H;D++){A=this.drawGeometry(C.components[D],E,B)&&A}return A}A=false;var F=false;if(E.display!="none"){if(E.backgroundGraphic){this.redrawBackgroundNode(C.id,C,E,B)}else{F=true}A=this.redrawNode(C.id,C,E,B)}if(A==false){var G=document.getElementById(C.id);if(G){if(G._style.backgroundGraphic){F=true}G.parentNode.removeChild(G)}}if(F){var G=document.getElementById(C.id+this.BACKGROUND_ID_SUFFIX);if(G){G.parentNode.removeChild(G)}}return A},redrawNode:function(G,E,D,A){D=this.applyDefaultSymbolizer(D);var C=this.nodeFactory(G,this.getNodeType(E,D));C._featureId=A;C._boundsBottom=E.getBounds().bottom;C._geometryClass=E.CLASS_NAME;C._style=D;var B=this.drawGeometryNode(C,E,D);if(B===false){return false}C=B.node;if(this.indexer){var F=this.indexer.insert(C);if(F){this.vectorRoot.insertBefore(C,F)}else{this.vectorRoot.appendChild(C)}}else{if(C.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(C)}}this.postDraw(C);return B.complete},redrawBackgroundNode:function(E,D,C,A){var B=HGIS.Util.extend({},C);B.externalGraphic=B.backgroundGraphic;B.graphicXOffset=B.backgroundXOffset;B.graphicYOffset=B.backgroundYOffset;B.graphicZIndex=B.backgroundGraphicZIndex;B.graphicWidth=B.backgroundWidth||B.graphicWidth;B.graphicHeight=B.backgroundHeight||B.graphicHeight;B.backgroundGraphic=null;B.backgroundXOffset=null;B.backgroundYOffset=null;B.backgroundGraphicZIndex=null;return this.redrawNode(E+this.BACKGROUND_ID_SUFFIX,D,B,null)},drawGeometryNode:function(B,D,C){C=C||B._style;var A={"isFilled":C.fill===undefined?true:C.fill,"isStroked":C.stroke===undefined?!!C.strokeWidth:C.stroke};var E;switch(D.CLASS_NAME){case"HGIS.Geometry.Point":if(C.graphic===false){A.isFilled=false;A.isStroked=false}E=this.drawPoint(B,D);break;case"HGIS.Geometry.LineString":A.isFilled=false;E=this.drawLineString(B,D);break;case"HGIS.Geometry.LinearRing":E=this.drawLinearRing(B,D);break;case"HGIS.Geometry.Polygon":E=this.drawPolygon(B,D);break;case"HGIS.Geometry.Rectangle":E=this.drawRectangle(B,D);break;default:break}B._options=A;if(E!=false){return{node:this.setStyle(B,C,A,D),complete:E}}else{return false}},postDraw:function(A){},drawPoint:function(A,B){},drawLineString:function(A,B){},drawLinearRing:function(A,B){},drawPolygon:function(A,B){},drawRectangle:function(A,B){},drawCircle:function(A,B){},removeText:function(A){var E=A+this.LABEL_ID_SUFFIX;var C=document.getElementById(E);if(C){if(this.textRoot&&this.textRoot.children&&this.textRoot.children.length>0){this.textRoot.removeChild(C)}else{if(this.vectorRoot.children&&this.vectorRoot.children.length>0){this.vectorRoot.removeChild(C)}else{this.vectorRoot.removeChild(C)}}}var B=document.getElementById(A+this.LABEL_ID_SUFFIX+"_bg");if(B){this.vectorRoot.removeChild(B)}var D=document.getElementById(A+this.LABEL_OUTLINE_SUFFIX);if(D){this.vectorRoot.removeChild(D)}},getFeatureIdFromEvent:function(C){var D=C.target;var A=D&&D.correspondingUseElement;var B=A?A:(D||C.srcElement);return B._featureId},eraseGeometry:function(D,A){if((D.CLASS_NAME=="HGIS.Geometry.MultiPoint")||(D.CLASS_NAME=="HGIS.Geometry.MultiLineString")||(D.CLASS_NAME=="HGIS.Geometry.MultiPolygon")||(D.CLASS_NAME=="HGIS.Geometry.Collection")){for(var B=0,E=D.components.length;B<E;B++){this.eraseGeometry(D.components[B],A)}}else{var F=HGIS.Util.getElement(D.id);if(F&&F.parentNode){if(F.geometry){F.geometry.destroy();F.geometry=null}F.parentNode.removeChild(F);if(this.indexer){this.indexer.remove(F)}if(F._style.backgroundGraphic){var C=D.id+this.BACKGROUND_ID_SUFFIX;var G=HGIS.Util.getElement(C);if(G&&G.parentNode){G.parentNode.removeChild(G)}}}}},nodeFactory:function(C,A){var B=HGIS.Util.getElement(C);if(B){if(!this.nodeTypeCompare(B,A)){B.parentNode.removeChild(B);B=this.nodeFactory(C,A)}}else{B=this.createNode(A,C)}return B},nodeTypeCompare:function(B,A){},createNode:function(A,B){},moveRoot:function(B){var A=this.root;if(B.root.parentNode==this.rendererRoot){A=B.root}A.parentNode.removeChild(A);B.rendererRoot.appendChild(A)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(A){return(A!="circle")&&!!A},CLASS_NAME:"HGIS.Renderer.Elements"});HGIS.Control.ArgParser=HGIS.Class(HGIS.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(A){A=A||window.location.href;var C=HGIS.Util.getParameters(A);var B=A.indexOf("#");if(B>0){A="?"+A.substring(B+1,A.length);HGIS.Util.extend(C,HGIS.Util.getParameters(A))}return C},setMap:function(B){HGIS.Control.prototype.setMap.apply(this,arguments);for(var A=0,C=this.map.controls.length;A<C;A++){var D=this.map.controls[A];if((D!=this)&&(D.CLASS_NAME=="HGIS.Control.ArgParser")){if(D.displayProjection!=this.displayProjection){this.displayProjection=D.displayProjection}break}}if(A==this.map.controls.length){var E=this.getParameters();if(E.layers){this.layers=E.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(E.lat&&E.lon){this.center=new HGIS.LonLat(parseFloat(E.lon),parseFloat(E.lat));if(E.zoom){this.zoom=parseFloat(E.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var A=0,C=this.layers.length;A<C;A++){var B=this.map.layers[A];var D=this.layers.charAt(A);if(D=="B"){this.map.setBaseLayer(B)}else{if((D=="T")||(D=="F")){B.setVisibility(D=="T")}}}}},CLASS_NAME:"HGIS.Control.ArgParser"});HGIS.Control.Permalink=HGIS.Class(HGIS.Control,{argParserClass:HGIS.Control.ArgParser,element:null,anchor:false,base:"",displayProjection:null,initialize:function(B,C,A){if(B!==null&&typeof B=="object"&&!HGIS.Util.isElement(B)){A=B;this.base=document.location.href;HGIS.Control.prototype.initialize.apply(this,[A]);if(this.element!=null){this.element=HGIS.Util.getElement(this.element)}}else{HGIS.Control.prototype.initialize.apply(this,[A]);this.element=HGIS.Util.getElement(B);this.base=C||document.location.href}},destroy:function(){if(this.element&&this.element.parentNode==this.div){this.div.removeChild(this.element);this.element=null}if(this.map){this.map.events.unregister("moveend",this,this.updateLink)}HGIS.Control.prototype.destroy.apply(this,arguments)},setMap:function(B){HGIS.Control.prototype.setMap.apply(this,arguments);for(var A=0,C=this.map.controls.length;A<C;A++){var D=this.map.controls[A];if(D.CLASS_NAME==this.argParserClass.CLASS_NAME){if(D.displayProjection!=this.displayProjection){this.displayProjection=D.displayProjection}break}}if(A==this.map.controls.length){this.map.addControl(new this.argParserClass({"displayProjection":this.displayProjection}))}},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!this.element&&!this.anchor){this.element=document.createElement("a");this.element.innerHTML=HGIS.i18n("Permalink");this.element.href="";this.div.appendChild(this.element)}this.map.events.on({"moveend":this.updateLink,"changelayer":this.updateLink,"changebaselayer":this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var B=this.anchor?"#":"?";var A=this.base;var D=null;if(A.indexOf("#")!=-1&&this.anchor==false){D=A.substring(A.indexOf("#"),A.length)}if(A.indexOf(B)!=-1){A=A.substring(0,A.indexOf(B))}var C=A.split("#");A=C[0]+B+HGIS.Util.getParameterString(this.createParams());if(D){A+=D}if(this.anchor&&!this.element){window.location.href=A}else{this.element.href=A}},createParams:function(A,C,J){A=A||this.map.getCenter();var F=HGIS.Util.getParameters(this.base);if(A){F.zoom=C||this.map.getZoom();var B=A.lat;var D=A.lon;if(this.displayProjection){var I=HGIS.Projection.transform({x:D,y:B},this.map.getProjectionObject(),this.displayProjection);D=I.x;B=I.y}F.lat=Math.round(B*100000)/100000;F.lon=Math.round(D*100000)/100000;J=J||this.map.layers;F.layers="";for(var E=0,H=J.length;E<H;E++){var G=J[E];if(G.isBaseLayer){F.layers+=(G==this.map.baseLayer)?"B":"0"}else{F.layers+=(G.getVisibility())?"T":"F"}}}return F},CLASS_NAME:"HGIS.Control.Permalink"});HGIS.Layer.TMS=HGIS.Class(HGIS.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:true,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(C,A,B){var D=[];D.push(C,A,{},B);HGIS.Layer.Grid.prototype.initialize.apply(this,D)},clone:function(A){if(A==null){A=new HGIS.Layer.TMS(this.name,this.url,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(B){B=this.adjustBounds(B);var D=this.getServerResolution();var E=Math.round((B.left-this.tileOrigin.lon)/(D*this.tileSize.w));var F=Math.round((B.bottom-this.tileOrigin.lat)/(D*this.tileSize.h));var C=this.getServerZoom();var G=this.serviceVersion+"/"+this.layername+"/"+C+"/"+E+"/"+F+"."+this.type;var A=this.url;if(HGIS.Util.isArray(A)){A=this.selectUrl(G,A)}return A+G},setMap:function(A){HGIS.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new HGIS.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"HGIS.Layer.TMS"});HGIS.Format.WCSCapabilities=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"HGIS.Format.WCSCapabilities"});HGIS.Format.WCSCapabilities.v1=HGIS.Class(HGIS.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),splitSpace:(/\s+/)},defaultPrefix:"wcs",read:function(C){if(typeof C=="string"){C=HGIS.Format.XML.prototype.read.apply(this,[C])}var A=C;if(C&&C.nodeType==9){C=C.documentElement}var B={};this.readNode(C,B);return B},CLASS_NAME:"HGIS.Format.WCSCapabilities.v1"});HGIS.Format.WCSCapabilities.v1_0_0=HGIS.Class(HGIS.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"service",readers:{"wcs":{"WCS_Capabilities":function(B,A){this.readChildNodes(B,A)},"Service":function(B,A){A.service={};this.readChildNodes(B,A.service)},"name":function(A,B){B.name=this.getChildValue(A)},"label":function(A,B){B.label=this.getChildValue(A)},"keywords":function(A,B){B.keywords=[];this.readChildNodes(A,B.keywords)},"keyword":function(A,B){B.push(this.getChildValue(A))},"responsibleParty":function(A,B){B.responsibleParty={};this.readChildNodes(A,B.responsibleParty)},"individualName":function(A,B){B.individualName=this.getChildValue(A)},"organisationName":function(A,B){B.organisationName=this.getChildValue(A)},"positionName":function(A,B){B.positionName=this.getChildValue(A)},"contactInfo":function(A,B){B.contactInfo={};this.readChildNodes(A,B.contactInfo)},"phone":function(A,B){B.phone={};this.readChildNodes(A,B.phone)},"voice":function(B,A){A.voice=this.getChildValue(B)},"facsimile":function(B,A){A.facsimile=this.getChildValue(B)},"address":function(A,B){B.address={};this.readChildNodes(A,B.address)},"deliveryPoint":function(B,A){A.deliveryPoint=this.getChildValue(B)},"city":function(B,A){A.city=this.getChildValue(B)},"postalCode":function(B,A){A.postalCode=this.getChildValue(B)},"country":function(B,A){A.country=this.getChildValue(B)},"electronicMailAddress":function(B,A){A.electronicMailAddress=this.getChildValue(B)},"fees":function(A,B){B.fees=this.getChildValue(A)},"accessConstraints":function(A,B){B.accessConstraints=this.getChildValue(A)},"ContentMetadata":function(B,A){A.contentMetadata=[];this.readChildNodes(B,A.contentMetadata)},"CoverageOfferingBrief":function(C,B){var A={};this.readChildNodes(C,A);B.push(A)},"name":function(B,A){A.name=this.getChildValue(B)},"label":function(B,A){A.label=this.getChildValue(B)},"lonLatEnvelope":function(C,B){var A=this.getElementsByTagNameNS(C,"http://www.opengis.net/gml","pos");if(A.length==2){var D={};var E={};HGIS.Format.GML.v3.prototype.readers["gml"].pos.apply(this,[A[0],D]);HGIS.Format.GML.v3.prototype.readers["gml"].pos.apply(this,[A[1],E]);B.lonLatEnvelope={};B.lonLatEnvelope.srsName=C.getAttribute("srsName");B.lonLatEnvelope.min=D.points[0];B.lonLatEnvelope.max=E.points[0]}}}},CLASS_NAME:"HGIS.Format.WCSCapabilities.v1_0_0"});HGIS.Strategy.Fixed=HGIS.Class(HGIS.Strategy,{preload:false,activate:function(){var A=HGIS.Strategy.prototype.activate.apply(this,arguments);if(A){this.layer.events.on({"refresh":this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({"visibilitychanged":this.load,scope:this})}}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){this.layer.events.un({"refresh":this.load,"visibilitychanged":this.load,scope:this})}return A},load:function(B){var A=this.layer;A.events.triggerEvent("loadstart",{filter:A.filter});A.protocol.read(HGIS.Util.applyDefaults({callback:this.merge,filter:A.filter,scope:this},B));A.events.un({"visibilitychanged":this.load,scope:this})},merge:function(F){var E=this.layer;E.destroyFeatures();var A=F.features;if(A&&A.length>0){var B=E.projection;var H=E.map.getProjectionObject();if(!H.equals(B)){var D;for(var C=0,G=A.length;C<G;++C){D=A[C].geometry;if(D){D.transform(B,H)}}}E.addFeatures(A)}E.events.triggerEvent("loadend",{response:F})},CLASS_NAME:"HGIS.Strategy.Fixed"});HGIS.Control.Zoom=HGIS.Class(HGIS.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"\u2212",zoomOutId:"olZoomOutLink",draw:function(){var C=HGIS.Control.prototype.draw.apply(this),E=this.getOrCreateLinks(C),D=E.zoomIn,B=E.zoomOut,A=this.map.events;if(B.parentNode!==C){A=this.events;A.attachToElement(B.parentNode)}A.register("buttonclick",this,this.onZoomClick);this.zoomInLink=D;this.zoomOutLink=B;return C},getOrCreateLinks:function(A){var C=document.getElementById(this.zoomInId),B=document.getElementById(this.zoomOutId);if(!C){C=document.createElement("a");C.href="#zoomIn";C.appendChild(document.createTextNode(this.zoomInText));C.className="olControlZoomIn";A.appendChild(C)}HGIS.Element.addClass(C,"olButton");if(!B){B=document.createElement("a");B.href="#zoomOut";B.appendChild(document.createTextNode(this.zoomOutText));B.className="olControlZoomOut";A.appendChild(B)}HGIS.Element.addClass(B,"olButton");return{zoomIn:C,zoomOut:B}},onZoomClick:function(B){var A=B.buttonElement;if(A===this.zoomInLink){this.map.zoomIn()}else{if(A===this.zoomOutLink){this.map.zoomOut()}}},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onZoomClick)}delete this.zoomInLink;delete this.zoomOutLink;HGIS.Control.prototype.destroy.apply(this)},CLASS_NAME:"HGIS.Control.Zoom"});HGIS.Layer.PointTrack=HGIS.Class(HGIS.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(K,H){if(K.length<2){throw new Error("At least two point features have to be added to create a line from")}var B=new Array(K.length-1);var L,D,C;for(var F=0,J=K.length;F<J;F++){L=K[F];C=L.geometry;if(!C){var I=L.lonlat;C=new HGIS.Geometry.Point(I.lon,I.lat)}else{if(C.CLASS_NAME!="HGIS.Geometry.Point"){throw new TypeError("Only features with point geometries are supported.")}}if(F>0){var G=(this.dataFrom!=null)?(K[F+this.dataFrom].data||K[F+this.dataFrom].attributes):null;var E=(this.styleFrom!=null)?(K[F+this.styleFrom].style):null;var A=new HGIS.Geometry.LineString([D,C]);B[F-1]=new HGIS.Feature.Vector(A,G,E)}D=C}this.addFeatures(B,H)},CLASS_NAME:"HGIS.Layer.PointTrack"});HGIS.Layer.PointTrack.SOURCE_NODE=-1;HGIS.Layer.PointTrack.TARGET_NODE=0;HGIS.Layer.PointTrack.dataFrom={"SOURCE_NODE":-1,"TARGET_NODE":0};HGIS.Protocol.WFS=function(B){B=HGIS.Util.applyDefaults(B,HGIS.Protocol.WFS.DEFAULTS);var A=HGIS.Protocol.WFS["v"+B.version.replace(/\./g,"_")];if(!A){throw"Unsupported WFS version: "+B.version}return new A(B)};HGIS.Protocol.WFS.fromWMSLayer=function(E,D){var A,F;var G=E.params["LAYERS"];var B=(HGIS.Util.isArray(G)?G[0]:G).split(":");if(B.length>1){F=B[0]}A=B.pop();var C={url:E.url,featureType:A,featurePrefix:F,srsName:E.projection&&E.projection.getCode()||E.map&&E.map.getProjectionObject().getCode(),version:"1.1.0"};return new HGIS.Protocol.WFS(HGIS.Util.applyDefaults(D,C))};HGIS.Protocol.WFS.DEFAULTS={"version":"1.0.0"};HGIS.Layer.Markers=HGIS.Class(HGIS.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(B,A){HGIS.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;HGIS.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(B){if(B!=this.opacity){this.opacity=B;for(var A=0,C=this.markers.length;A<C;A++){this.markers[A].setOpacity(this.opacity)}}},moveTo:function(C,B,E){HGIS.Layer.prototype.moveTo.apply(this,arguments);if(B||!this.drawn){for(var A=0,D=this.markers.length;A<D;A++){this.drawMarker(this.markers[A])}this.drawn=true}},addMarker:function(A){this.markers.push(A);if(this.opacity<1){A.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){A.map=this.map;this.drawMarker(A)}},removeMarker:function(A){if(this.markers&&this.markers.length){HGIS.Util.removeItem(this.markers,A);A.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(A){var B=this.map.getLayerPxFromLonLat(A.lonlat);if(B==null){A.display(false)}else{if(!A.isDrawn()){var C=A.draw(B);this.div.appendChild(C)}else{if(A.icon){A.icon.moveTo(B)}}}},getDataExtent:function(){var B=null;if(this.markers&&(this.markers.length>0)){var B=new HGIS.Bounds();for(var A=0,C=this.markers.length;A<C;A++){var D=this.markers[A];B.extend(D.lonlat)}}return B},CLASS_NAME:"HGIS.Layer.Markers"});HGIS.Control.Pan=HGIS.Class(HGIS.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(B,A){this.direction=B;this.CLASS_NAME+=this.direction;HGIS.Control.prototype.initialize.apply(this,[A])},trigger:function(){if(this.map){var A=HGIS.Function.bind(function(B){return this.slideRatio?this.map.getSize()[B]*this.slideRatio:this.slideFactor},this);switch(this.direction){case HGIS.Control.Pan.NORTH:this.map.pan(0,-A("h"));break;case HGIS.Control.Pan.SOUTH:this.map.pan(0,A("h"));break;case HGIS.Control.Pan.WEST:this.map.pan(-A("w"),0);break;case HGIS.Control.Pan.EAST:this.map.pan(A("w"),0);break}}},CLASS_NAME:"HGIS.Control.Pan"});HGIS.Control.Pan.NORTH="North";HGIS.Control.Pan.SOUTH="South";HGIS.Control.Pan.EAST="East";HGIS.Control.Pan.WEST="West";HGIS.Format.CSWGetDomain=function(B){B=HGIS.Util.applyDefaults(B,HGIS.Format.CSWGetDomain.DEFAULTS);var A=HGIS.Format.CSWGetDomain["v"+B.version.replace(/\./g,"_")];if(!A){throw"Unsupported CSWGetDomain version: "+B.version}return new A(B)};HGIS.Format.CSWGetDomain.DEFAULTS={"version":"2.0.2"};HGIS.Format.CSWGetDomain.v2_0_2=HGIS.Class(HGIS.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);return A},readers:{"csw":{"GetDomainResponse":function(B,A){this.readChildNodes(B,A)},"DomainValues":function(D,B){if(!(HGIS.Util.isArray(B.DomainValues))){B.DomainValues=[]}var E=D.attributes;var A={};for(var C=0,F=E.length;C<F;++C){A[E[C].name]=E[C].nodeValue}this.readChildNodes(D,A);B.DomainValues.push(A)},"PropertyName":function(B,A){A.PropertyName=this.getChildValue(B)},"ParameterName":function(B,A){A.ParameterName=this.getChildValue(B)},"ListOfValues":function(B,A){if(!(HGIS.Util.isArray(A.ListOfValues))){A.ListOfValues=[]}this.readChildNodes(B,A.ListOfValues)},"Value":function(C,B){var D=C.attributes;var E={};for(var A=0,F=D.length;A<F;++A){E[D[A].name]=D[A].nodeValue}E.value=this.getChildValue(C);B.push({Value:E})},"ConceptualScheme":function(B,A){A.ConceptualScheme={};this.readChildNodes(B,A.ConceptualScheme)},"Name":function(B,A){A.Name=this.getChildValue(B)},"Document":function(B,A){A.Document=this.getChildValue(B)},"Authority":function(B,A){A.Authority=this.getChildValue(B)},"RangeOfValues":function(B,A){A.RangeOfValues={};this.readChildNodes(B,A.RangeOfValues)},"MinValue":function(C,B){var D=C.attributes;var E={};for(var A=0,F=D.length;A<F;++A){E[D[A].name]=D[A].nodeValue}E.value=this.getChildValue(C);B.MinValue=E},"MaxValue":function(C,B){var D=C.attributes;var E={};for(var A=0,F=D.length;A<F;++A){E[D[A].name]=D[A].nodeValue}E.value=this.getChildValue(C);B.MaxValue=E}}},write:function(B){var A=this.writeNode("csw:GetDomain",B);return HGIS.Format.XML.prototype.write.apply(this,[A])},writers:{"csw":{"GetDomain":function(B){var A=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});if(B.PropertyName||this.PropertyName){this.writeNode("csw:PropertyName",B.PropertyName||this.PropertyName,A)}else{if(B.ParameterName||this.ParameterName){this.writeNode("csw:ParameterName",B.ParameterName||this.ParameterName,A)}}this.readChildNodes(A,B);return A},"PropertyName":function(B){var A=this.createElementNSPlus("csw:PropertyName",{value:B});return A},"ParameterName":function(B){var A=this.createElementNSPlus("csw:ParameterName",{value:B});return A}}},CLASS_NAME:"HGIS.Format.CSWGetDomain.v2_0_2"});HGIS.Format.ArcXML.Features=HGIS.Class(HGIS.Format.XML,{read:function(C){var A=new HGIS.Format.ArcXML();var B=A.read(C);return B.features.feature}});HGIS.Control.Snapping=HGIS.Class(HGIS.Control,{DEFAULTS:{tolerance:10,node:true,edge:true,vertex:true},greedy:true,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,[A]);this.options=A||{};if(this.options.layer){this.setLayer(this.options.layer)}var B=HGIS.Util.extend({},this.options.defaults);this.defaults=HGIS.Util.applyDefaults(B,this.DEFAULTS);this.setTargets(this.options.targets);if(this.targets.length===0&&this.layer){this.addTargetLayer(this.layer)}this.geoToleranceCache={}},setLayer:function(A){if(this.active){this.deactivate();this.layer=A;this.activate()}else{this.layer=A}},setTargets:function(B){this.targets=[];if(B&&B.length){var D;for(var A=0,C=B.length;A<C;++A){D=B[A];if(D instanceof HGIS.Layer.Vector){this.addTargetLayer(D)}else{this.addTarget(D)}}}},addTargetLayer:function(A){this.addTarget({layer:A})},addTarget:function(A){A=HGIS.Util.applyDefaults(A,this.defaults);A.nodeTolerance=A.nodeTolerance||A.tolerance;A.vertexTolerance=A.vertexTolerance||A.tolerance;A.edgeTolerance=A.edgeTolerance||A.tolerance;this.targets.push(A)},removeTargetLayer:function(B){var C;for(var A=this.targets.length-1;A>=0;--A){C=this.targets[A];if(C.layer===B){this.removeTarget(C)}}},removeTarget:function(A){return HGIS.Util.removeItem(this.targets,A)},activate:function(){var A=HGIS.Control.prototype.activate.call(this);if(A){if(this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}return A},deactivate:function(){var A=HGIS.Control.prototype.deactivate.call(this);if(A){if(this.layer&&this.layer.events){this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}this.feature=null;this.point=null;return A},onSketchModified:function(A){this.feature=A.feature;this.considerSnapping(A.vertex,A.vertex)},onVertexModified:function(A){this.feature=A.feature;var B=this.layer.map.getLonLatFromViewPortPx(A.pixel);this.considerSnapping(A.vertex,new HGIS.Geometry.Point(B.lon,B.lat))},considerSnapping:function(I,C){var D={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null};var H=false;var B,G;for(var E=0,A=this.targets.length;E<A;++E){G=this.targets[E];B=this.testTarget(G,C);if(B){if(this.greedy){D=B;D.target=G;H=true;break}else{if((B.rank<D.rank)||(B.rank===D.rank&&B.dist<D.dist)){D=B;D.target=G;H=true}}}}if(H){var F=this.events.triggerEvent("beforesnap",{point:I,x:D.x,y:D.y,distance:D.dist,layer:D.target.layer,snapType:this.precedence[D.rank]});if(F!==false){I.x=D.x;I.y=D.y;this.point=I;this.events.triggerEvent("snap",{point:I,snapType:this.precedence[D.rank],layer:D.target.layer,distance:D.dist})}else{H=false}}if(this.point&&!H){I.x=C.x;I.y=C.y;this.point=null;this.events.triggerEvent("unsnap",{point:I})}},testTarget:function(S,W){var O=this.layer.map.getResolution();if("minResolution" in S){if(O<S.minResolution){return null}}if("maxResolution" in S){if(O>=S.maxResolution){return null}}var T={node:this.getGeoTolerance(S.nodeTolerance,O),vertex:this.getGeoTolerance(S.vertexTolerance,O),edge:this.getGeoTolerance(S.edgeTolerance,O)};var P=Math.max(T.node,T.vertex,T.edge);var F={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY};var K=false;var V=S.layer.features;var L,U,N,J,E,I,M;var B=this.precedence.length;var C=new HGIS.LonLat(W.x,W.y);for(var H=0,R=V.length;H<R;++H){L=V[H];if(L!==this.feature&&!L._sketch&&L.state!==HGIS.State.DELETE&&(!S.filter||S.filter.evaluate(L))){if(L.atPoint(C,P,P)){for(var Q=0,A=Math.min(F.rank+1,B);Q<A;++Q){U=this.precedence[Q];if(S[U]){if(U==="edge"){E=L.geometry.distanceTo(W,{details:true});I=E.distance;if(I<=T[U]&&I<F.dist){F={rank:Q,dist:I,x:E.x0,y:E.y0};K=true;break}}else{N=L.geometry.getVertices(U==="node");M=false;for(var G=0,D=N.length;G<D;++G){J=N[G];I=J.distanceTo(W);if(I<=T[U]&&(Q<F.rank||(Q===F.rank&&I<F.dist))){F={rank:Q,dist:I,x:J.x,y:J.y};K=true;M=true}}if(M){break}}}}}}}return K?F:null},getGeoTolerance:function(A,C){if(C!==this.resolution){this.resolution=C;this.geoToleranceCache={}}var B=this.geoToleranceCache[A];if(B===undefined){B=A*C;this.geoToleranceCache[A]=B}return B},destroy:function(){if(this.active){this.deactivate()}delete this.layer;delete this.targets;HGIS.Control.prototype.destroy.call(this)},CLASS_NAME:"HGIS.Control.Snapping"});HGIS.Format.OWSCommon.v1_1_0=HGIS.Class(HGIS.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{"ows":HGIS.Util.applyDefaults({"ExceptionReport":function(B,A){A.exceptionReport={version:B.getAttribute("version"),language:B.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(B,A.exceptionReport)},"AllowedValues":function(B,A){A.allowedValues={};this.readChildNodes(B,A.allowedValues)},"AnyValue":function(B,A){A.anyValue=true},"DataType":function(B,A){A.dataType=this.getChildValue(B)},"Range":function(B,A){A.range={};this.readChildNodes(B,A.range)},"MinimumValue":function(A,B){B.minValue=this.getChildValue(A)},"MaximumValue":function(A,B){B.maxValue=this.getChildValue(A)},"Identifier":function(B,A){A.identifier=this.getChildValue(B)},"SupportedCRS":function(B,A){A.supportedCRS=this.getChildValue(B)}},HGIS.Format.OWSCommon.v1.prototype.readers["ows"])},writers:{"ows":HGIS.Util.applyDefaults({"Range":function(B){var A=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":B.closure}});this.writeNode("ows:MinimumValue",B.minValue,A);this.writeNode("ows:MaximumValue",B.maxValue,A);return A},"MinimumValue":function(B){var A=this.createElementNSPlus("ows:MinimumValue",{value:B});return A},"MaximumValue":function(B){var A=this.createElementNSPlus("ows:MaximumValue",{value:B});return A},"Value":function(B){var A=this.createElementNSPlus("ows:Value",{value:B});return A}},HGIS.Format.OWSCommon.v1.prototype.writers["ows"])},CLASS_NAME:"HGIS.Format.OWSCommon.v1_1_0"});HGIS.Format.WCSGetCoverage=HGIS.Class(HGIS.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(B){var A=this.writeNode("wcs:GetCoverage",B);this.setAttributeNS(A,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[A])},writers:{"wcs":{"GetCoverage":function(B){var A=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:B.version||this.VERSION,service:"WCS"}});this.writeNode("ows:Identifier",B.identifier,A);this.writeNode("wcs:DomainSubset",B.domainSubset,A);this.writeNode("wcs:Output",B.output,A);return A},"DomainSubset":function(B){var A=this.createElementNSPlus("wcs:DomainSubset",{});this.writeNode("ows:BoundingBox",B.boundingBox,A);if(B.temporalSubset){this.writeNode("wcs:TemporalSubset",B.temporalSubset,A)}return A},"TemporalSubset":function(C){var B=this.createElementNSPlus("wcs:TemporalSubset",{});for(var A=0,D=C.timePeriods.length;A<D;++A){this.writeNode("wcs:TimePeriod",C.timePeriods[A],B)}return B},"TimePeriod":function(B){var A=this.createElementNSPlus("wcs:TimePeriod",{});this.writeNode("wcs:BeginPosition",B.begin,A);this.writeNode("wcs:EndPosition",B.end,A);if(B.resolution){this.writeNode("wcs:TimeResolution",B.resolution,A)}return A},"BeginPosition":function(A){var B=this.createElementNSPlus("wcs:BeginPosition",{value:A});return B},"EndPosition":function(B){var A=this.createElementNSPlus("wcs:EndPosition",{value:B});return A},"TimeResolution":function(B){var A=this.createElementNSPlus("wcs:TimeResolution",{value:B});return A},"Output":function(B){var A=this.createElementNSPlus("wcs:Output",{attributes:{format:B.format,store:B.store}});if(B.gridCRS){this.writeNode("wcs:GridCRS",B.gridCRS,A)}return A},"GridCRS":function(B){var A=this.createElementNSPlus("wcs:GridCRS",{});this.writeNode("wcs:GridBaseCRS",B.baseCRS,A);if(B.type){this.writeNode("wcs:GridType",B.type,A)}if(B.origin){this.writeNode("wcs:GridOrigin",B.origin,A)}this.writeNode("wcs:GridOffsets",B.offsets,A);if(B.CS){this.writeNode("wcs:GridCS",B.CS,A)}return A},"GridBaseCRS":function(A){return this.createElementNSPlus("wcs:GridBaseCRS",{value:A})},"GridOrigin":function(A){return this.createElementNSPlus("wcs:GridOrigin",{value:A})},"GridType":function(A){return this.createElementNSPlus("wcs:GridType",{value:A})},"GridOffsets":function(A){return this.createElementNSPlus("wcs:GridOffsets",{value:A})},"GridCS":function(A){return this.createElementNSPlus("wcs:GridCS",{value:A})}},"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"HGIS.Format.WCSGetCoverage"});HGIS.Format.KML=HGIS.Class(HGIS.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"HGIS export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,kvpAttributes:false,extractStyles:false,extractTracks:false,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(A){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};this.externalProjection=new HGIS.Projection("EPSG:4326");HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(B){this.features=[];this.styles={};this.fetched={};var A={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(B,A)},parseData:function(G,E){if(typeof G=="string"){G=HGIS.Format.XML.prototype.read.apply(this,[G])}var D=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var B=0,F=D.length;B<F;++B){var A=D[B];var C=this.getElementsByTagNameNS(G,"*",A);if(C.length==0){continue}switch(A.toLowerCase()){case"link":case"networklink":this.parseLinks(C,E);break;case"style":if(this.extractStyles){this.parseStyles(C,E)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(C,E)}break;case"placemark":this.parseFeatures(C,E);break}}return this.features},parseLinks:function(D,C){if(C.depth>=this.maxDepth){return false}var E=HGIS.Util.extend({},C);E.depth++;for(var B=0,F=D.length;B<F;B++){var A=this.parseProperty(D[B],"*","href");if(A&&!this.fetched[A]){this.fetched[A]=true;var G=this.fetchLink(A);if(G){this.parseData(G,E)}}}},fetchLink:function(A){var B=HGIS.Request.GET({url:A,async:false});if(B){return B.responseText}},parseStyles:function(D,C){for(var A=0,E=D.length;A<E;A++){var F=this.parseStyle(D[A]);if(F){var B=(C.styleBaseUrl||"")+"#"+F.id;this.styles[B]=F}}},parseKmlColor:function(B){var C=null;if(B){var A=B.match(this.regExes.kmlColor);if(A){C={color:"#"+A[4]+A[3]+A[2],opacity:parseInt(A[1],16)/255}}}return C},parseStyle:function(R){var V={};var S=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"];var A,U,T,H,b;for(var e=0,N=S.length;e<N;++e){A=S[e];U=this.getElementsByTagNameNS(R,"*",A)[0];if(!U){continue}switch(A.toLowerCase()){case"linestyle":var L=this.parseProperty(U,"*","color");var C=this.parseKmlColor(L);if(C){V["strokeColor"]=C.color;V["strokeOpacity"]=C.opacity}var F=this.parseProperty(U,"*","width");if(F){V["strokeWidth"]=F}break;case"polystyle":var L=this.parseProperty(U,"*","color");var C=this.parseKmlColor(L);if(C){V["fillOpacity"]=C.opacity;V["fillColor"]=C.color}var M=this.parseProperty(U,"*","fill");if(M=="0"){V["fillColor"]="none"}var Q=this.parseProperty(U,"*","outline");if(Q=="0"){V["strokeWidth"]="0"}break;case"iconstyle":var o=parseFloat(this.parseProperty(U,"*","scale")||1);var F=32*o;var D=32*o;var f=this.getElementsByTagNameNS(U,"*","Icon")[0];if(f){var J=this.parseProperty(f,"*","href");if(J){var a=this.parseProperty(f,"*","w");var d=this.parseProperty(f,"*","h");var X="http://maps.google.com/mapfiles/kml";if(HGIS.String.startsWith(J,X)&&!a&&!d){a=64;d=64;o=o/2}a=a||d;d=d||a;if(a){F=parseInt(a)*o}if(d){D=parseInt(d)*o}var I=J.match(this.regExes.kmlIconPalette);if(I){var n=I[1];var W=I[2];var Y=this.parseProperty(f,"*","x");var Z=this.parseProperty(f,"*","y");var O=Y?Y/32:0;var g=Z?(7-Z/32):7;var E=g*8+O;J="http://maps.google.com/mapfiles/kml/pal"+n+"/icon"+E+W}V["graphicOpacity"]=1;V["externalGraphic"]=J}}var G=this.getElementsByTagNameNS(U,"*","hotSpot")[0];if(G){var Y=parseFloat(G.getAttribute("x"));var Z=parseFloat(G.getAttribute("y"));var B=G.getAttribute("xunits");if(B=="pixels"){V["graphicXOffset"]=-Y*o}else{if(B=="insetPixels"){V["graphicXOffset"]=-F+(Y*o)}else{if(B=="fraction"){V["graphicXOffset"]=-F*Y}}}var P=G.getAttribute("yunits");if(P=="pixels"){V["graphicYOffset"]=-D+(Z*o)+1}else{if(P=="insetPixels"){V["graphicYOffset"]=-(Z*o)+1}else{if(P=="fraction"){V["graphicYOffset"]=-D*(1-Z)+1}}}}V["graphicWidth"]=F;V["graphicHeight"]=D;break;case"balloonstyle":var l=HGIS.Util.getXmlNodeValue(U);if(l){V["balloonStyle"]=l.replace(this.regExes.straightBracket,"${$1}")}break;case"labelstyle":var L=this.parseProperty(U,"*","color");var C=this.parseKmlColor(L);if(C){V["fontColor"]=C.color;V["fontOpacity"]=C.opacity}break;default:}}if(!V["strokeColor"]&&V["fillColor"]){V["strokeColor"]=V["fillColor"]}var K=R.getAttribute("id");if(K&&V){V.id=K}return V},parseStyleMaps:function(L,G){for(var E=0,J=L.length;E<J;E++){var H=L[E];var F=this.getElementsByTagNameNS(H,"*","Pair");var I=H.getAttribute("id");for(var C=0,D=F.length;C<D;C++){var A=F[C];var B=this.parseProperty(A,"*","key");var K=this.parseProperty(A,"*","styleUrl");if(K&&B=="normal"){this.styles[(G.styleBaseUrl||"")+"#"+I]=this.styles[(G.styleBaseUrl||"")+K]}}}},parseFeatures:function(L,G){var A=[];for(var E=0,J=L.length;E<J;E++){var I=L[E];var K=this.parseFeature.apply(this,[I]);if(K){if(this.extractStyles&&K.attributes&&K.attributes.styleUrl){K.style=this.getStyle(K.attributes.styleUrl,G)}if(this.extractStyles){var H=this.getElementsByTagNameNS(I,"*","Style")[0];if(H){var D=this.parseStyle(H);if(D){K.style=HGIS.Util.extend(K.style,D)}}}if(this.extractTracks){var B=this.getElementsByTagNameNS(I,this.namespaces.gx,"Track");if(B&&B.length>0){var F=B[0];var C={features:[],feature:K};this.readNode(F,C);if(C.features.length>0){A.push.apply(A,C.features)}}}else{A.push(K)}}else{throw"Bad Placemark: "+E}}this.features=this.features.concat(A)},readers:{"kml":{"when":function(A,B){B.whens.push(HGIS.Date.parse(this.getChildValue(A)))},"_trackPointAttribute":function(A,B){var C=A.nodeName.split(":").pop();B.attributes[C].push(this.getChildValue(A))}},"gx":{"Track":function(F,H){var I={whens:[],points:[],angles:[]};if(this.trackAttributes){var A;I.attributes={};for(var E=0,B=this.trackAttributes.length;E<B;++E){A=this.trackAttributes[E];I.attributes[A]=[];if(!(A in this.readers.kml)){this.readers.kml[A]=this.readers.kml._trackPointAttribute}}}this.readChildNodes(F,I);if(I.whens.length!==I.points.length){throw new Error("gx:Track with unequal number of when ("+I.whens.length+") and gx:coord ("+I.points.length+") elements.")}var D=I.angles.length>0;if(D&&I.whens.length!==I.angles.length){throw new Error("gx:Track with unequal number of when ("+I.whens.length+") and gx:angles ("+I.angles.length+") elements.")}var K,J,C;for(var E=0,B=I.whens.length;E<B;++E){K=H.feature.clone();K.fid=H.feature.fid||H.feature.id;J=I.points[E];K.geometry=J;if("z" in J){K.attributes.altitude=J.z}if(this.internalProjection&&this.externalProjection){K.geometry.transform(this.externalProjection,this.internalProjection)}if(this.trackAttributes){for(var G=0,L=this.trackAttributes.length;G<L;++G){var A=this.trackAttributes[G];K.attributes[A]=I.attributes[A][E]}}K.attributes.when=I.whens[E];K.attributes.trackId=H.feature.id;if(D){C=I.angles[E];K.attributes.heading=parseFloat(C[0]);K.attributes.tilt=parseFloat(C[1]);K.attributes.roll=parseFloat(C[2])}H.features.push(K)}},"coord":function(C,D){var E=this.getChildValue(C);var A=E.replace(this.regExes.trimSpace,"").split(/\s+/);var B=new HGIS.Geometry.Point(A[0],A[1]);if(A.length>2){B.z=parseFloat(A[2])}D.points.push(B)},"angles":function(B,C){var D=this.getChildValue(B);var A=D.replace(this.regExes.trimSpace,"").split(/\s+/);C.angles.push(A)}}},parseFeature:function(F){var G=["MultiGeometry","Polygon","LineString","Point"];var I,A,C,K;for(var D=0,H=G.length;D<H;++D){I=G[D];this.internalns=F.namespaceURI?F.namespaceURI:this.kmlns;A=this.getElementsByTagNameNS(F,this.internalns,I);if(A.length>0){var K=this.parseGeometry[I.toLowerCase()];if(K){C=K.apply(this,[A[0]]);if(this.internalProjection&&this.externalProjection){C.transform(this.externalProjection,this.internalProjection)}}else{throw new TypeError("Unsupported geometry type: "+I)}break}}var E;if(this.extractAttributes){E=this.parseAttributes(F)}var J=new HGIS.Feature.Vector(C,E);var B=F.getAttribute("id")||F.getAttribute("name");if(B!=null){J.fid=B}return J},getStyle:function(A,C){var B=HGIS.Util.removeTail(A);var D=HGIS.Util.extend({},C);D.depth++;D.styleBaseUrl=B;if(!this.styles[A]&&!HGIS.String.startsWith(A,"#")&&D.depth<=this.maxDepth&&!this.fetched[B]){var F=this.fetchLink(B);if(F){this.parseData(F,D)}}var E=HGIS.Util.extend({},this.styles[A]);return E},parseGeometry:{point:function(D){var A=this.getElementsByTagNameNS(D,this.internalns,"coordinates");var B=[];if(A.length>0){var E=A[0].firstChild.nodeValue;E=E.replace(this.regExes.removeSpace,"");B=E.split(",")}var C=null;if(B.length>1){if(B.length==2){B[2]=null}C=new HGIS.Geometry.Point(B[0],B[1],B[2])}else{throw"Bad coordinate string: "+E}return C},linestring:function(H,F){var A=this.getElementsByTagNameNS(H,this.internalns,"coordinates");var B=null;if(A.length>0){var C=this.getChildValue(A[0]);C=C.replace(this.regExes.trimSpace,"");C=C.replace(this.regExes.trimComma,",");var I=C.split(this.regExes.splitSpace);var G=I.length;var J=new Array(G);var K,D;for(var E=0;E<G;++E){K=I[E].split(",");D=K.length;if(D>1){if(K.length==2){K[2]=null}J[E]=new HGIS.Geometry.Point(K[0],K[1],K[2])}else{throw"Bad LineString point coordinates: "+I[E]}}if(G){if(F){B=new HGIS.Geometry.LinearRing(J)}else{B=new HGIS.Geometry.LineString(J)}}else{throw"Bad LineString coordinates: "+C}}return B},polygon:function(D){var A=this.getElementsByTagNameNS(D,this.internalns,"LinearRing");var C=A.length;var E=new Array(C);if(C>0){var G;for(var B=0,F=A.length;B<F;++B){G=this.parseGeometry.linestring.apply(this,[A[B],true]);if(G){E[B]=G}else{throw"Bad LinearRing geometry: "+B}}}return new HGIS.Geometry.Polygon(E)},multigeometry:function(C){var E,H;var D=[];var A=C.childNodes;for(var B=0,F=A.length;B<F;++B){E=A[B];if(E.nodeType==1){var G=(E.prefix)?E.nodeName.split(":")[1]:E.nodeName;var H=this.parseGeometry[G.toLowerCase()];if(H){D.push(H.apply(this,[E]))}}}return new HGIS.Geometry.Collection(D)}},parseAttributes:function(I){var H={};var K=I.getElementsByTagName("ExtendedData");if(K.length){H=this.parseExtendedData(K[0])}var J,A,F;var E=I.childNodes;for(var G=0,B=E.length;G<B;++G){J=E[G];if(J.nodeType==1){A=J.childNodes;if(A.length>=1&&A.length<=3){var F;switch(A.length){case 1:F=A[0];break;case 2:var D=A[0];var M=A[1];F=(D.nodeType==3||D.nodeType==4)?D:M;break;case 3:default:F=A[1];break}if(F.nodeType==3||F.nodeType==4){var C=(J.prefix)?J.nodeName.split(":")[1]:J.nodeName;var L=HGIS.Util.getXmlNodeValue(F);if(L){L=L.replace(this.regExes.trimSpace,"");H[C]=L}}}}}return H},parseExtendedData:function(H){var G={};var F,J,D,A;var E=H.getElementsByTagName("Data");for(F=0,J=E.length;F<J;F++){D=E[F];A=D.getAttribute("name");var C={};var K=D.getElementsByTagName("value");if(K.length){C["value"]=this.getChildValue(K[0])}if(this.kvpAttributes){G[A]=C["value"]}else{var B=D.getElementsByTagName("displayName");if(B.length){C["displayName"]=this.getChildValue(B[0])}G[A]=C}}var I=H.getElementsByTagName("SimpleData");for(F=0,J=I.length;F<J;F++){var C={};D=I[F];A=D.getAttribute("name");C["value"]=this.getChildValue(D);if(this.kvpAttributes){G[A]=C["value"]}else{C["displayName"]=A;G[A]=C}}return G},parseProperty:function(F,A,B){var E;var D=this.getElementsByTagNameNS(F,A,B);try{E=HGIS.Util.getXmlNodeValue(D[0])}catch(C){E=null}return E},write:function(A){if(!(HGIS.Util.isArray(A))){A=[A]}var C=this.createElementNS(this.kmlns,"kml");var D=this.createFolderXML();for(var B=0,E=A.length;B<E;++B){D.appendChild(this.createPlacemarkXML(A[B]))}C.appendChild(D);return HGIS.Format.XML.prototype.write.apply(this,[C])},createFolderXML:function(){var B=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var A=this.createElementNS(this.kmlns,"name");var D=this.createTextNode(this.foldersName);A.appendChild(D);B.appendChild(A)}if(this.foldersDesc){var E=this.createElementNS(this.kmlns,"description");var C=this.createTextNode(this.foldersDesc);E.appendChild(C);B.appendChild(E)}return B},createPlacemarkXML:function(H){var C=this.createElementNS(this.kmlns,"name");var F=(H.style&&H.style.label)?H.style.label:H.id;var G=H.attributes.name||F;C.appendChild(this.createTextNode(G));var B=this.createElementNS(this.kmlns,"description");var D=H.attributes.description||this.placemarksDesc;B.appendChild(this.createTextNode(D));var E=this.createElementNS(this.kmlns,"Placemark");if(H.fid!=null){E.setAttribute("id",H.fid)}E.appendChild(C);E.appendChild(B);var A=this.buildGeometryNode(H.geometry);E.appendChild(A);if(H.attributes){var I=this.buildExtendedData(H.attributes);if(I){E.appendChild(I)}}return E},buildGeometryNode:function(E){var B=E.CLASS_NAME;var A=B.substring(B.lastIndexOf(".")+1);var C=this.buildGeometry[A.toLowerCase()];var D=null;if(C){D=C.apply(this,[E])}return D},buildGeometry:{point:function(B){var A=this.createElementNS(this.kmlns,"Point");A.appendChild(this.buildCoordinatesNode(B));return A},multipoint:function(A){return this.buildGeometry.collection.apply(this,[A])},linestring:function(B){var A=this.createElementNS(this.kmlns,"LineString");A.appendChild(this.buildCoordinatesNode(B));return A},multilinestring:function(A){return this.buildGeometry.collection.apply(this,[A])},linearring:function(B){var A=this.createElementNS(this.kmlns,"LinearRing");A.appendChild(this.buildCoordinatesNode(B));return A},polygon:function(C){var B=this.createElementNS(this.kmlns,"Polygon");var E=C.components;var A,H,G;for(var D=0,F=E.length;D<F;++D){G=(D==0)?"outerBoundaryIs":"innerBoundaryIs";A=this.createElementNS(this.kmlns,G);H=this.buildGeometry.linearring.apply(this,[E[D]]);A.appendChild(H);B.appendChild(A)}return B},multipolygon:function(A){return this.buildGeometry.collection.apply(this,[A])},collection:function(D){var B=this.createElementNS(this.kmlns,"MultiGeometry");var C;for(var A=0,E=D.components.length;A<E;++A){C=this.buildGeometryNode.apply(this,[D.components[A]]);if(C){B.appendChild(C)}}return B}},buildCoordinatesNode:function(A){var I=this.createElementNS(this.kmlns,"coordinates");var E;var G=A.components;if(G){var H;var C=G.length;var D=new Array(C);for(var B=0;B<C;++B){H=G[B];D[B]=this.buildCoordinates(H)}E=D.join(" ")}else{E=this.buildCoordinates(A)}var F=this.createTextNode(E);I.appendChild(F);return I},buildCoordinates:function(A){if(this.internalProjection&&this.externalProjection){A=A.clone();A.transform(this.internalProjection,this.externalProjection)}return A.x+","+A.y},buildExtendedData:function(B){var E=this.createElementNS(this.kmlns,"ExtendedData");for(var C in B){if(B[C]&&C!="name"&&C!="description"&&C!="styleUrl"){var F=this.createElementNS(this.kmlns,"Data");F.setAttribute("name",C);var D=this.createElementNS(this.kmlns,"value");if(typeof B[C]=="object"){if(B[C].value){D.appendChild(this.createTextNode(B[C].value))}if(B[C].displayName){var A=this.createElementNS(this.kmlns,"displayName");A.appendChild(this.getXMLDoc().createCDATASection(B[C].displayName));F.appendChild(A)}}else{D.appendChild(this.createTextNode(B[C]))}F.appendChild(D);E.appendChild(F)}}if(this.isSimpleContent(E)){return null}else{return E}},CLASS_NAME:"HGIS.Format.KML"});HGIS.Format.WMSCapabilities=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"HGIS.Format.WMSCapabilities"});HGIS.Format.WMSCapabilities.v1=HGIS.Class(HGIS.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(D){if(typeof D=="string"){D=HGIS.Format.XML.prototype.read.apply(this,[D])}var A=D;if(D&&D.nodeType==9){D=D.documentElement}var B={};this.readNode(D,B);if(B.service===undefined){var C=new HGIS.Format.OGCExceptionReport();B.error=C.read(A)}return B},readers:{"wms":{"Service":function(B,A){A.service={};this.readChildNodes(B,A.service)},"Name":function(B,A){A.name=this.getChildValue(B)},"Title":function(B,A){A.title=this.getChildValue(B)},"Abstract":function(B,A){A["abstract"]=this.getChildValue(B)},"BoundingBox":function(B,A){var D={};D.bbox=[parseFloat(B.getAttribute("minx")),parseFloat(B.getAttribute("miny")),parseFloat(B.getAttribute("maxx")),parseFloat(B.getAttribute("maxy"))];var C={x:parseFloat(B.getAttribute("resx")),y:parseFloat(B.getAttribute("resy"))};if(!(isNaN(C.x)&&isNaN(C.y))){D.res=C}return D},"OnlineResource":function(B,A){A.href=this.getAttributeNS(B,this.namespaces.xlink,"href")},"ContactInformation":function(B,A){A.contactInformation={};this.readChildNodes(B,A.contactInformation)},"ContactPersonPrimary":function(B,A){A.personPrimary={};this.readChildNodes(B,A.personPrimary)},"ContactPerson":function(B,A){A.person=this.getChildValue(B)},"ContactOrganization":function(B,A){A.organization=this.getChildValue(B)},"ContactPosition":function(B,A){A.position=this.getChildValue(B)},"ContactAddress":function(B,A){A.contactAddress={};this.readChildNodes(B,A.contactAddress)},"AddressType":function(B,A){A.type=this.getChildValue(B)},"Address":function(B,A){A.address=this.getChildValue(B)},"City":function(B,A){A.city=this.getChildValue(B)},"StateOrProvince":function(B,A){A.stateOrProvince=this.getChildValue(B)},"PostCode":function(B,A){A.postcode=this.getChildValue(B)},"Country":function(B,A){A.country=this.getChildValue(B)},"ContactVoiceTelephone":function(B,A){A.phone=this.getChildValue(B)},"ContactFacsimileTelephone":function(B,A){A.fax=this.getChildValue(B)},"ContactElectronicMailAddress":function(B,A){A.email=this.getChildValue(B)},"Fees":function(C,B){var A=this.getChildValue(C);if(A&&A.toLowerCase()!="none"){B.fees=A}},"AccessConstraints":function(B,A){var C=this.getChildValue(B);if(C&&C.toLowerCase()!="none"){A.accessConstraints=C}},"Capability":function(B,A){A.capability={nestedLayers:[],layers:[]};this.readChildNodes(B,A.capability)},"Request":function(B,A){A.request={};this.readChildNodes(B,A.request)},"GetCapabilities":function(B,A){A.getcapabilities={formats:[]};this.readChildNodes(B,A.getcapabilities)},"Format":function(B,A){if(HGIS.Util.isArray(A.formats)){A.formats.push(this.getChildValue(B))}else{A.format=this.getChildValue(B)}},"DCPType":function(B,A){this.readChildNodes(B,A)},"HTTP":function(B,A){this.readChildNodes(B,A)},"Get":function(B,A){A.get={};this.readChildNodes(B,A.get);if(!A.href){A.href=A.get.href}},"Post":function(B,A){A.post={};this.readChildNodes(B,A.post);if(!A.href){A.href=A.get.href}},"GetMap":function(B,A){A.getmap={formats:[]};this.readChildNodes(B,A.getmap)},"GetFeatureInfo":function(B,A){A.getfeatureinfo={formats:[]};this.readChildNodes(B,A.getfeatureinfo)},"Exception":function(B,A){A.exception={formats:[]};this.readChildNodes(B,A.exception)},"Layer":function(K,D){var M,B;if(D.capability){B=D.capability;M=D}else{B=D}var F=K.getAttributeNode("queryable");var A=(F&&F.specified)?K.getAttribute("queryable"):null;F=K.getAttributeNode("cascaded");var L=(F&&F.specified)?K.getAttribute("cascaded"):null;F=K.getAttributeNode("opaque");var H=(F&&F.specified)?K.getAttribute("opaque"):null;var N=K.getAttribute("noSubsets");var E=K.getAttribute("fixedWidth");var P=K.getAttribute("fixedHeight");var J=M||{},I=HGIS.Util.extend;var G={nestedLayers:[],styles:M?[].concat(M.styles):[],srs:M?I({},J.srs):{},metadataURLs:[],bbox:M?I({},J.bbox):{},llbbox:J.llbbox,dimensions:M?I({},J.dimensions):{},authorityURLs:M?I({},J.authorityURLs):{},identifiers:{},keywords:[],queryable:(A&&A!=="")?(A==="1"||A==="true"):(J.queryable||false),cascaded:(L!==null)?parseInt(L):(J.cascaded||0),opaque:H?(H==="1"||H==="true"):(J.opaque||false),noSubsets:(N!==null)?(N==="1"||N==="true"):(J.noSubsets||false),fixedWidth:(E!=null)?parseInt(E):(J.fixedWidth||0),fixedHeight:(P!=null)?parseInt(P):(J.fixedHeight||0),minScale:J.minScale,maxScale:J.maxScale,attribution:J.attribution};D.nestedLayers.push(G);G.capability=B;this.readChildNodes(K,G);delete G.capability;if(G.name){var Q=G.name.split(":"),C=B.request,O=C.getfeatureinfo;if(Q.length>0){G.prefix=Q[0]}B.layers.push(G);if(G.formats===undefined){G.formats=C.getmap.formats}if(G.infoFormats===undefined&&O){G.infoFormats=O.formats}}},"Attribution":function(B,A){A.attribution={};this.readChildNodes(B,A.attribution)},"LogoURL":function(B,A){A.logo={width:B.getAttribute("width"),height:B.getAttribute("height")};this.readChildNodes(B,A.logo)},"Style":function(B,A){var C={};A.styles.push(C);this.readChildNodes(B,C)},"LegendURL":function(C,A){var B={width:C.getAttribute("width"),height:C.getAttribute("height")};A.legend=B;this.readChildNodes(C,B)},"MetadataURL":function(C,B){var A={type:C.getAttribute("type")};B.metadataURLs.push(A);this.readChildNodes(C,A)},"DataURL":function(B,A){A.dataURL={};this.readChildNodes(B,A.dataURL)},"FeatureListURL":function(B,A){A.featureListURL={};this.readChildNodes(B,A.featureListURL)},"AuthorityURL":function(C,B){var D=C.getAttribute("name");var A={};this.readChildNodes(C,A);B.authorityURLs[D]=A.href},"Identifier":function(C,B){var A=C.getAttribute("authority");B.identifiers[A]=this.getChildValue(C)},"KeywordList":function(B,A){this.readChildNodes(B,A)},"SRS":function(B,A){A.srs[this.getChildValue(B)]=true}}},CLASS_NAME:"HGIS.Format.WMSCapabilities.v1"});HGIS.Format.WMSCapabilities.v1_1=HGIS.Class(HGIS.Format.WMSCapabilities.v1,{readers:{"wms":HGIS.Util.applyDefaults({"WMT_MS_Capabilities":function(B,A){this.readChildNodes(B,A)},"Keyword":function(B,A){if(A.keywords){A.keywords.push(this.getChildValue(B))}},"DescribeLayer":function(B,A){A.describelayer={formats:[]};this.readChildNodes(B,A.describelayer)},"GetLegendGraphic":function(B,A){A.getlegendgraphic={formats:[]};this.readChildNodes(B,A.getlegendgraphic)},"GetStyles":function(B,A){A.getstyles={formats:[]};this.readChildNodes(B,A.getstyles)},"PutStyles":function(B,A){A.putstyles={formats:[]};this.readChildNodes(B,A.putstyles)},"UserDefinedSymbolization":function(B,A){var C={supportSLD:parseInt(B.getAttribute("SupportSLD"))==1,userLayer:parseInt(B.getAttribute("UserLayer"))==1,userStyle:parseInt(B.getAttribute("UserStyle"))==1,remoteWFS:parseInt(B.getAttribute("RemoteWFS"))==1};A.userSymbols=C},"LatLonBoundingBox":function(B,A){A.llbbox=[parseFloat(B.getAttribute("minx")),parseFloat(B.getAttribute("miny")),parseFloat(B.getAttribute("maxx")),parseFloat(B.getAttribute("maxy"))]},"BoundingBox":function(B,A){var C=HGIS.Format.WMSCapabilities.v1.prototype.readers["wms"].BoundingBox.apply(this,[B,A]);C.srs=B.getAttribute("SRS");A.bbox[C.srs]=C},"ScaleHint":function(C,B){var A=C.getAttribute("min");var F=C.getAttribute("max");var E=Math.pow(2,0.5);var D=HGIS.INCHES_PER_UNIT["m"];if(A!=0){B.maxScale=parseFloat(((A/E)*D*HGIS.DOTS_PER_INCH).toPrecision(13))}if(F!=Number.POSITIVE_INFINITY){B.minScale=parseFloat(((F/E)*D*HGIS.DOTS_PER_INCH).toPrecision(13))}},"Dimension":function(B,A){var C=B.getAttribute("name").toLowerCase();var D={name:C,units:B.getAttribute("units"),unitsymbol:B.getAttribute("unitSymbol")};A.dimensions[D.name]=D},"Extent":function(B,A){var C=B.getAttribute("name").toLowerCase();if(C in A["dimensions"]){var E=A.dimensions[C];E.nearestVal=B.getAttribute("nearestValue")==="1";E.multipleVal=B.getAttribute("multipleValues")==="1";E.current=B.getAttribute("current")==="1";E["default"]=B.getAttribute("default")||"";var D=this.getChildValue(B);E.values=D.split(",")}}},HGIS.Format.WMSCapabilities.v1.prototype.readers["wms"])},CLASS_NAME:"HGIS.Format.WMSCapabilities.v1_1"});HGIS.Format.WMSCapabilities.v1_1_0=HGIS.Class(HGIS.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{"wms":HGIS.Util.applyDefaults({"SRS":function(C,B){var F=this.getChildValue(C);var E=F.split(/ +/);for(var A=0,D=E.length;A<D;A++){B.srs[E[A]]=true}}},HGIS.Format.WMSCapabilities.v1_1.prototype.readers["wms"])},CLASS_NAME:"HGIS.Format.WMSCapabilities.v1_1_0"});HGIS.Protocol.WFS.v1=HGIS.Class(HGIS.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(A){HGIS.Protocol.prototype.initialize.apply(this,[A]);if(!A.format){this.format=HGIS.Format.WFST(HGIS.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))}if(!A.geometryName&&parseFloat(this.format.version)>1){this.setGeometryName(null)}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;HGIS.Protocol.prototype.destroy.apply(this)},read:function(A){HGIS.Protocol.prototype.read.apply(this,arguments);A=HGIS.Util.extend({},A);HGIS.Util.applyDefaults(A,this.options||{});var B=new HGIS.Protocol.Response({requestType:"read"});var C=HGIS.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",A)]);B.priv=HGIS.Request.POST({url:A.url,callback:this.createCallback(this.handleRead,B,A),params:A.params,headers:A.headers,data:C});return B},setFeatureType:function(A){this.featureType=A;this.format.featureType=A},setGeometryName:function(A){this.geometryName=A;this.format.geometryName=A},handleRead:function(D,B){B=HGIS.Util.extend({},B);HGIS.Util.applyDefaults(B,this.options);if(B.callback){var A=D.priv;if(A.status>=200&&A.status<300){var C=this.parseResponse(A,B.readOptions);if(C&&C.success!==false){if(B.readOptions&&B.readOptions.output=="object"){HGIS.Util.extend(D,C)}else{D.features=C}D.code=HGIS.Protocol.Response.SUCCESS}else{D.code=HGIS.Protocol.Response.FAILURE;D.error=C}}else{D.code=HGIS.Protocol.Response.FAILURE}B.callback.call(B.scope,D)}},parseResponse:function(B,C){var E=B.responseXML;if(!E||!E.documentElement){E=B.responseText}if(!E||E.length<=0){return null}var D=(this.readFormat!==null)?this.readFormat.read(E):this.format.read(E,C);if(!this.featureNS){var A=this.readFormat||this.format;this.featureNS=A.featureNS;A.autoConfig=false;if(!this.geometryName){this.setGeometryName(A.geometryName)}}return D},commit:function(A,B){B=HGIS.Util.extend({},B);HGIS.Util.applyDefaults(B,this.options);var C=new HGIS.Protocol.Response({requestType:"commit",reqFeatures:A});C.priv=HGIS.Request.POST({url:B.url,headers:B.headers,data:this.format.write(A,B),callback:this.createCallback(this.handleCommit,C,B)});return C},handleCommit:function(D,C){if(C.callback){var B=D.priv;var E=B.responseXML;if(!E||!E.documentElement){E=B.responseText}var A=this.format.read(E)||{};D.insertIds=A.insertIds||[];if(A.success){D.code=HGIS.Protocol.Response.SUCCESS}else{D.code=HGIS.Protocol.Response.FAILURE;D.error=A}C.callback.call(C.scope,D)}},filterDelete:function(D,C){C=HGIS.Util.extend({},C);HGIS.Util.applyDefaults(C,this.options);var F=new HGIS.Protocol.Response({requestType:"commit"});var A=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});var B=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(C.featureNS?this.featurePrefix+":":"")+C.featureType}});if(C.featureNS){B.setAttribute("xmlns:"+this.featurePrefix,C.featureNS)}var E=this.format.writeNode("ogc:Filter",D);B.appendChild(E);A.appendChild(B);var G=HGIS.Format.XML.prototype.write.apply(this.format,[A]);return HGIS.Request.POST({url:this.url,callback:C.callback||function(){},data:G})},abort:function(A){if(A){A.priv.abort()}},CLASS_NAME:"HGIS.Protocol.WFS.v1"});HGIS.Handler.Feature=HGIS.Class(HGIS.Handler,{EVENTMAP:{"click":{"in":"click","out":"clickout"},"mousemove":{"in":"over","out":"out"},"dblclick":{"in":"dblclick","out":null},"mousedown":{"in":null,"out":null},"mouseup":{"in":null,"out":null},"touchstart":{"in":"click","out":"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(C,B,D,A){HGIS.Handler.prototype.initialize.apply(this,[C,D,A]);this.layer=B},touchstart:function(A){this.startTouch();return HGIS.Event.isMultiTouch(A)?true:this.mousedown(A)},touchmove:function(A){HGIS.Event.preventDefault(A)},mousedown:function(A){if(HGIS.Event.isLeftClick(A)||HGIS.Event.isSingleTouch(A)){this.down=A.xy}return this.handle(A)?!this.stopDown:true},mouseup:function(A){this.up=A.xy;return this.handle(A)?!this.stopUp:true},click:function(A){return this.handle(A)?!this.stopClick:true},mousemove:function(A){if(!this.callbacks["over"]&&!this.callbacks["out"]){return true}this.handle(A);return true},dblclick:function(A){return !this.handle(A)},geometryTypeMatches:function(A){return this.geometryTypes==null||HGIS.Util.indexOf(this.geometryTypes,A.geometry.CLASS_NAME)>-1},handle:function(D){if(this.feature&&!this.feature.layer){this.feature=null}var A=D.type;var C=false;var F=!!(this.feature);var E=(A=="click"||A=="dblclick"||A=="touchstart");this.feature=this.layer.getFeatureFromEvent(D);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){if(A==="touchstart"){HGIS.Event.preventDefault(D)}var B=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(F&&B){if(this.lastFeature){this.triggerCallback(A,"out",[this.lastFeature])}this.triggerCallback(A,"in",[this.feature])}else{if(!F||E){this.triggerCallback(A,"in",[this.feature])}}this.lastFeature=this.feature;C=true}else{if(this.lastFeature&&(F&&B||E)){this.triggerCallback(A,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(F||E)){this.triggerCallback(A,"out",[this.lastFeature])}}return C},triggerCallback:function(A,C,E){var B=this.EVENTMAP[A][C];if(B){if(A=="click"&&this.up&&this.down){var D=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(D<=this.clickTolerance){this.callback(B,E)}this.up=this.down=null}else{this.callback(B,E)}}},activate:function(){var A=false;if(HGIS.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({"removelayer":this.handleMapEvents,"changelayer":this.handleMapEvents,scope:this});A=true}return A},deactivate:function(){var A=false;if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({"removelayer":this.handleMapEvents,"changelayer":this.handleMapEvents,scope:this});A=true}return A},handleMapEvents:function(A){if(A.type=="removelayer"||A.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var A=Math.max(this.map.Z_INDEX_BASE["Feature"]-1,this.layer.getZIndex())+1;this.layer.setZIndex(A)},moveLayerBack:function(){var A=this.layer.getZIndex()-1;if(A>=this.map.Z_INDEX_BASE["Feature"]){this.layer.setZIndex(A)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"HGIS.Handler.Feature"});HGIS.Layer.Vector.RootContainer=HGIS.Class(HGIS.Layer.Vector,{displayInLayerSwitcher:false,layers:null,display:function(){},getFeatureFromEvent:function(D){var C=this.layers;var A;for(var B=0;B<C.length;B++){A=C[B].getFeatureFromEvent(D);if(A){return A}}},setMap:function(A){HGIS.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();A.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(A){A.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();HGIS.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var B;for(var A=0;A<this.map.layers.length;++A){B=this.map.layers[A];if(HGIS.Util.indexOf(this.layers,B)!=-1){B.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var B;for(var A=0;A<this.layers.length;++A){B=this.layers[A];if(this.renderer&&B.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(B.renderer)}}},handleChangeLayer:function(A){var B=A.layer;if(A.property=="order"&&HGIS.Util.indexOf(this.layers,B)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"HGIS.Layer.Vector.RootContainer"});HGIS.Control.SelectFeature=HGIS.Class(HGIS.Control,{multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(A,B){HGIS.Control.prototype.initialize.apply(this,[B]);if(this.scope===null){this.scope=this}this.initLayer(A);var C={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){C.over=this.overFeature;C.out=this.outFeature}this.callbacks=HGIS.Util.extend(C,this.callbacks);this.handlers={feature:new HGIS.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new HGIS.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},initLayer:function(A){if(HGIS.Util.isArray(A)){this.layers=A;this.layer=new HGIS.Layer.Vector.RootContainer(this.id+"_container",{layers:A})}else{this.layer=A}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)}HGIS.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return HGIS.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return HGIS.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(E){var C=this.layers||[this.layer],A,B,D,F;for(D=0;D<C.length;++D){A=C[D];F=0;if(A.selectedFeatures!=null){while(A.selectedFeatures.length>F){B=A.selectedFeatures[F];if(!E||E.except!=B){this.unselect(B)}else{++F}}}}},clickFeature:function(A){if(!this.hover){var B=(HGIS.Util.indexOf(A.layer.selectedFeatures,A)>-1);if(B){if(this.toggleSelect()){this.unselect(A)}else{if(!this.multipleSelect()){this.unselectAll({except:A})}}}else{if(!this.multipleSelect()){this.unselectAll({except:A})}this.select(A)}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])},clickoutFeature:function(A){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(A){var B=A.layer;if(this.hover){if(this.highlightOnly){this.highlight(A)}else{if(HGIS.Util.indexOf(B.selectedFeatures,A)==-1){this.select(A)}}}},outFeature:function(A){if(this.hover){if(this.highlightOnly){if(A._lastHighlighter==this.id){if(A._prevHighlighter&&A._prevHighlighter!=this.id){delete A._lastHighlighter;var B=this.map.getControl(A._prevHighlighter);if(B){B.highlight(A)}}else{this.unhighlight(A)}}}else{this.unselect(A)}}},highlight:function(A){var C=A.layer;var B=this.events.triggerEvent("beforefeaturehighlighted",{feature:A});if(B!==false){A._prevHighlighter=A._lastHighlighter;A._lastHighlighter=this.id;var D=this.selectStyle||this.renderIntent;C.drawFeature(A,D);this.events.triggerEvent("featurehighlighted",{feature:A})}},unhighlight:function(A){var B=A.layer;if(A._prevHighlighter==undefined){delete A._lastHighlighter}else{if(A._prevHighlighter==this.id){delete A._prevHighlighter}else{A._lastHighlighter=A._prevHighlighter;delete A._prevHighlighter}}B.drawFeature(A,A.style||A.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:A})},select:function(A){var B=this.onBeforeSelect.call(this.scope,A);var C=A.layer;if(B!==false){B=C.events.triggerEvent("beforefeatureselected",{feature:A});if(B!==false){C.selectedFeatures.push(A);this.highlight(A);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=C.selectedFeatures[0]}C.events.triggerEvent("featureselected",{feature:A});this.onSelect.call(this.scope,A)}}},unselect:function(A){var B=A.layer;this.unhighlight(A);HGIS.Util.removeItem(B.selectedFeatures,A);B.events.triggerEvent("featureunselected",{feature:A});this.onUnselect.call(this.scope,A)},selectBox:function(G){if(G instanceof HGIS.Bounds){var H=this.map.getLonLatFromPixel({x:G.left,y:G.bottom});var D=this.map.getLonLatFromPixel({x:G.right,y:G.top});var C=new HGIS.Bounds(H.lon,H.lat,D.lon,D.lat);if(!this.multipleSelect()){this.unselectAll()}var K=this.multiple;this.multiple=true;var J=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:J});var F;for(var A=0;A<J.length;++A){F=J[A];for(var E=0,B=F.features.length;E<B;++E){var I=F.features[E];if(!I.getVisibility()){continue}if(this.geometryTypes==null||HGIS.Util.indexOf(this.geometryTypes,I.geometry.CLASS_NAME)>-1){if(C.toGeometry().intersects(I.geometry)){if(HGIS.Util.indexOf(F.selectedFeatures,I)==-1){this.select(I)}}}}}this.multiple=K;this.events.triggerEvent("boxselectionend",{layers:J})}},setMap:function(A){this.handlers.feature.setMap(A);if(this.box){this.handlers.box.setMap(A)}HGIS.Control.prototype.setMap.apply(this,arguments)},setLayer:function(B){var A=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(B);this.handlers.feature.layer=this.layer;if(A){this.activate()}},CLASS_NAME:"HGIS.Control.SelectFeature"});HGIS.Handler.Point=HGIS.Class(HGIS.Handler,{point:null,layer:null,multi:false,citeCompliant:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(B,C,A){if(!(A&&A.layerOptions&&A.layerOptions.styleMap)){this.style=HGIS.Util.extend(HGIS.Feature.Vector.style["default"],{})}HGIS.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!HGIS.Handler.prototype.activate.apply(this,arguments)){return false}var A=HGIS.Util.extend({displayInLayerSwitcher:false,calculateInRange:HGIS.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new HGIS.Layer.Vector(this.CLASS_NAME,A);this.map.addLayer(this.layer);return true},createFeature:function(A){var B=this.layer.getLonLatFromViewPortPx(A);var C=new HGIS.Geometry.Point(B.lon,B.lat);this.point=new HGIS.Feature.Vector(C);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!HGIS.Handler.prototype.deactivate.apply(this,arguments)){return false}this.cancel();if(this.layer.map!=null){this.destroyFeature(true);this.layer.destroy(false)}this.layer=null;return true},destroyFeature:function(A){if(this.layer&&(A||!this.persist)){this.layer.destroyFeatures()}this.point=null},destroyPersistedFeature:function(){var A=this.layer;if(A&&A.features.length>1){this.layer.features[0].destroy()}},finalize:function(B){var A=B?"cancel":"done";this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(A,[this.geometryClone()]);this.destroyFeature(B)},cancel:function(){this.finalize(true)},click:function(A){HGIS.Event.stop(A);return false},dblclick:function(A){HGIS.Event.stop(A);return false},modifyFeature:function(A){if(!this.point){this.createFeature(A)}var B=this.layer.getLonLatFromViewPortPx(A);this.point.geometry.x=B.lon;this.point.geometry.y=B.lat;this.callback("modify",[this.point.geometry,this.point,false]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var A=this.point&&this.point.geometry;if(A&&this.multi){A=new HGIS.Geometry.MultiPoint([A])}return A},geometryClone:function(){var A=this.getGeometry();return A&&A.clone()},mousedown:function(A){return this.down(A)},touchstart:function(A){this.startTouch();this.lastTouchPx=A.xy;return this.down(A)},mousemove:function(A){return this.move(A)},touchmove:function(A){this.lastTouchPx=A.xy;return this.move(A)},mouseup:function(A){return this.up(A)},touchend:function(A){A.xy=this.lastTouchPx;return this.up(A)},down:function(A){this.mouseDown=true;this.lastDown=A.xy;if(!this.touch){this.modifyFeature(A.xy)}this.stoppedDown=this.stopDown;return !this.stopDown},move:function(A){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(A.xy)}return true},up:function(A){this.mouseDown=false;this.stoppedDown=this.stopDown;if(!this.checkModifiers(A)){return true}if(this.lastUp&&this.lastUp.equals(A.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,A.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(A.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=A.xy;this.finalize();return !this.stopUp}else{return true}},mouseout:function(A){if(HGIS.Util.mouseLeft(A,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;this.mouseDown=false}},passesTolerance:function(E,B,A){var C=true;if(A!=null&&E&&B){var D=E.distanceTo(B);if(D>A){C=false}}return C},CLASS_NAME:"HGIS.Handler.Point"});HGIS.Handler.Path=HGIS.Class(HGIS.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:false,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(A){var B=this.layer.getLonLatFromViewPortPx(A);var C=new HGIS.Geometry.Point(B.lon,B.lat);this.point=new HGIS.Feature.Vector(C);this.line=new HGIS.Feature.Vector(new HGIS.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(A){HGIS.Handler.Point.prototype.destroyFeature.call(this,A);this.line=null},destroyPersistedFeature:function(){var A=this.layer;if(A&&A.features.length>2){this.layer.features[0].destroy()}},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(A){this.layer.removeFeatures([this.point]);var B=this.layer.getLonLatFromViewPortPx(A);this.point=new HGIS.Feature.Vector(new HGIS.Geometry.Point(B.lon,B.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(A,B){this.line.geometry.addComponent(new HGIS.Geometry.Point(A,B),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(B,D){var C=this.getCurrentPointIndex()-1;var A=this.line.geometry.components[C];if(A&&!isNaN(A.x)&&!isNaN(A.y)){this.insertXY(A.x+B,A.y+D)}},insertDirectionLength:function(D,A){D*=Math.PI/180;var B=A*Math.cos(D);var C=A*Math.sin(D);this.insertDeltaXY(B,C)},insertDeflectionLength:function(C,A){var D=this.getCurrentPointIndex()-1;if(D>0){var B=this.line.geometry.components[D];var F=this.line.geometry.components[D-1];var E=Math.atan2(B.y-F.y,B.x-F.x);this.insertDirectionLength((E*180/Math.PI)+C,A)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var D=this.line.geometry;var E=D.components;var C=this.getCurrentPointIndex()-1;var G=E[C];var B=D.removeComponent(G);if(B){if(this.touch&&C>0){E=D.components;var A=E[C-1];var H=this.getCurrentPointIndex();var F=E[H];F.x=A.x;F.y=A.y}if(!this.redoStack){this.redoStack=[]}this.redoStack.push(G);this.drawFeature()}return B},redo:function(){var A=this.redoStack&&this.redoStack.pop();if(A){this.line.geometry.addComponent(A,this.getCurrentPointIndex());this.drawFeature()}return !!A},freehandMode:function(A){return(this.freehandToggle&&A[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(A,C){if(!this.line){this.createFeature(A)}var B=this.layer.getLonLatFromViewPortPx(A);this.point.geometry.x=B.lon;this.point.geometry.y=B.lat;this.callback("modify",[this.point.geometry,this.getSketch(),C]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var A=this.line&&this.line.geometry;if(A&&this.multi){A=new HGIS.Geometry.MultiLineString([A])}return A},touchstart:function(A){if(this.timerId&&this.passesTolerance(this.lastTouchPx,A.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return false}else{if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(HGIS.Function.bind(function(){this.timerId=null},this),300);return HGIS.Handler.Point.prototype.touchstart.call(this,A)}},down:function(A){var B=this.stopDown;if(this.freehandMode(A)){B=true;if(this.touch){this.modifyFeature(A.xy,!!this.lastUp);HGIS.Event.stop(A)}}if(!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,A.xy,this.pixelTolerance))){this.modifyFeature(A.xy,!!this.lastUp)}this.mouseDown=true;this.lastDown=A.xy;this.stoppedDown=B;return !B},move:function(A){if(this.stoppedDown&&this.freehandMode(A)){if(this.persist){this.destroyPersistedFeature()}if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();this.finalize();return false}else{this.addPoint(A.xy);return true}}if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(A.xy,!!this.lastUp)}return true},up:function(A){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(A.xy))){if(this.stoppedDown&&this.freehandMode(A)){if(this.persist){this.destroyPersistedFeature()}this.removePoint();this.finalize()}else{if(this.passesTolerance(this.lastDown,A.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(A.xy)}if(this.lastUp==null&&this.persist){this.destroyPersistedFeature()}this.addPoint(A.xy);this.lastUp=A.xy;if(this.line.geometry.components.length===this.maxVertices+1){this.finishGeometry()}}}}this.stoppedDown=this.stopDown;this.mouseDown=false;return !this.stopUp},finishGeometry:function(){var A=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[A]);this.removePoint();this.finalize()},dblclick:function(A){if(!this.freehandMode(A)){this.finishGeometry()}return false},CLASS_NAME:"HGIS.Handler.Path"});HGIS.Spherical=HGIS.Spherical||{};HGIS.Spherical.DEFAULT_RADIUS=6378137;HGIS.Spherical.computeDistanceBetween=function(B,D,E){var C=E||HGIS.Spherical.DEFAULT_RADIUS;var F=Math.sin(Math.PI*(D.lon-B.lon)/360);var A=Math.sin(Math.PI*(D.lat-B.lat)/360);var G=A*A+F*F*Math.cos(Math.PI*B.lat/180)*Math.cos(Math.PI*D.lat/180);return 2*C*Math.atan2(Math.sqrt(G),Math.sqrt(1-G))};HGIS.Spherical.computeHeading=function(A,B){var D=Math.sin(Math.PI*(A.lon-B.lon)/180)*Math.cos(Math.PI*B.lat/180);var C=Math.cos(Math.PI*A.lat/180)*Math.sin(Math.PI*B.lat/180)-Math.sin(Math.PI*A.lat/180)*Math.cos(Math.PI*B.lat/180)*Math.cos(Math.PI*(A.lon-B.lon)/180);return 180*Math.atan2(D,C)/Math.PI};HGIS.Control.CacheWrite=HGIS.Class(HGIS.Control,{layers:null,imageFormat:"image/png",quotaRegEx:(/quota/i),setMap:function(B){HGIS.Control.prototype.setMap.apply(this,arguments);var A,C=this.layers||B.layers;for(A=C.length-1;A>=0;--A){this.addLayer({layer:C[A]})}if(!this.layers){B.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(A){A.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(A){A.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(B){if(this.active){var C=B.tile;if(C instanceof HGIS.Tile.Image&&!C.crossOriginKeyword&&C.url.substr(0,5)!=="data:"){var A=HGIS.Request.makeSameOrigin(C.url,HGIS.ProxyHost);HGIS.Control.CacheWrite.urlMap[A]=C.url;C.url=A}}},onTileLoaded:function(A){if(this.active&&!A.aborted&&A.tile instanceof HGIS.Tile.Image&&A.tile.url.substr(0,5)!=="data:"){this.cache({tile:A.tile});delete HGIS.Control.CacheWrite.urlMap[A.tile.url]}},cache:function(B){if(window.localStorage){var E=B.tile;try{var A=E.getCanvasContext();if(A){var F=HGIS.Control.CacheWrite.urlMap;var G=F[E.url]||E.url;window.localStorage.setItem("olCache_"+G,A.canvas.toDataURL(this.imageFormat))}}catch(D){var C=D.name||D.message;if(C&&this.quotaRegEx.test(C)){this.events.triggerEvent("cachefull",{tile:E})}else{HGIS.Console.error(D.toString())}}}},destroy:function(){if(this.layers||this.map){var A,B=this.layers||this.map.layers;for(A=B.length-1;A>=0;--A){this.removeLayer({layer:B[A]})}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}HGIS.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"HGIS.Control.CacheWrite"});HGIS.Control.CacheWrite.clearCache=function(){if(!window.localStorage){return}var B,A;for(B=window.localStorage.length-1;B>=0;--B){A=window.localStorage.key(B);if(A.substr(0,8)==="olCache_"){window.localStorage.removeItem(A)}}};HGIS.Control.CacheWrite.urlMap={};HGIS.Format.Context=HGIS.Class(HGIS.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(E,D){var A=HGIS.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);var B;if(D&&D.map){this.context=A;if(D.map instanceof HGIS.Map){B=this.mergeContextToMap(A,D.map)}else{var C=D.map;if(HGIS.Util.isElement(C)||typeof C=="string"){C={div:C}}B=this.contextToMap(A,C)}}else{B=A}return B},getLayerFromContext:function(G){var D,H;var F={queryable:G.queryable,visibility:G.visibility,maxExtent:G.maxExtent,metadata:HGIS.Util.applyDefaults(G.metadata,{styles:G.styles,formats:G.formats,"abstract":G["abstract"],dataURL:G.dataURL}),numZoomLevels:G.numZoomLevels,units:G.units,isBaseLayer:G.isBaseLayer,opacity:G.opacity,displayInLayerSwitcher:G.displayInLayerSwitcher,singleTile:G.singleTile,tileSize:(G.tileSize)?new HGIS.Size(G.tileSize.width,G.tileSize.height):undefined,minScale:G.minScale||G.maxScaleDenominator,maxScale:G.maxScale||G.minScaleDenominator,srs:G.srs,dimensions:G.dimensions,metadataURL:G.metadataURL};if(this.layerOptions){HGIS.Util.applyDefaults(F,this.layerOptions)}var E={layers:G.name,transparent:G.transparent,version:G.version};if(G.formats&&G.formats.length>0){E.format=G.formats[0].value;for(D=0,H=G.formats.length;D<H;D++){var A=G.formats[D];if(A.current==true){E.format=A.value;break}}}if(G.styles&&G.styles.length>0){for(D=0,H=G.styles.length;D<H;D++){var C=G.styles[D];if(C.current==true){if(C.href){E.sld=C.href}else{if(C.body){E.sld_body=C.body}else{E.styles=C.name}}break}}}if(this.layerParams){HGIS.Util.applyDefaults(E,this.layerParams)}var I=null;var B=G.service;if(B==HGIS.Format.Context.serviceTypes.WFS){F.strategies=[new HGIS.Strategy.BBOX()];F.protocol=new HGIS.Protocol.WFS({url:G.url,featurePrefix:G.name.split(":")[0],featureType:G.name.split(":").pop()});I=new HGIS.Layer.Vector(G.title||G.name,F)}else{if(B==HGIS.Format.Context.serviceTypes.KML){F.strategies=[new HGIS.Strategy.Fixed()];F.protocol=new HGIS.Protocol.HTTP({url:G.url,format:new HGIS.Format.KML()});I=new HGIS.Layer.Vector(G.title||G.name,F)}else{if(B==HGIS.Format.Context.serviceTypes.GML){F.strategies=[new HGIS.Strategy.Fixed()];F.protocol=new HGIS.Protocol.HTTP({url:G.url,format:new HGIS.Format.GML()});I=new HGIS.Layer.Vector(G.title||G.name,F)}else{if(G.features){I=new HGIS.Layer.Vector(G.title||G.name,F);I.addFeatures(G.features)}else{if(G.categoryLayer!==true){I=new HGIS.Layer.WMS(G.title||G.name,G.url,E,F)}}}}}return I},getLayersFromContext:function(C){var B=[];for(var A=0,E=C.length;A<E;A++){var D=this.getLayerFromContext(C[A]);if(D!==null){B.push(D)}}return B},contextToMap:function(A,C){C=HGIS.Util.applyDefaults({maxExtent:A.maxExtent,projection:A.projection,units:A.units},C);if(C.maxExtent){C.maxResolution=C.maxExtent.getWidth()/HGIS.Map.TILE_WIDTH}var D={contactInformation:A.contactInformation,"abstract":A["abstract"],keywords:A.keywords,logo:A.logo,descriptionURL:A.descriptionURL};C.metadata=D;var B=new HGIS.Map(C);B.addLayers(this.getLayersFromContext(A.layersContext));B.setCenter(A.bounds.getCenterLonLat(),B.getZoomForExtent(A.bounds,true));return B},mergeContextToMap:function(A,B){B.addLayers(this.getLayersFromContext(A.layersContext));return B},write:function(A,B){A=this.toContext(A);return HGIS.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"HGIS.Format.Context"});HGIS.Format.Context.serviceTypes={"WMS":"urn:ogc:serviceType:WMS","WFS":"urn:ogc:serviceType:WFS","WCS":"urn:ogc:serviceType:WCS","GML":"urn:ogc:serviceType:GML","SLD":"urn:ogc:serviceType:SLD","FES":"urn:ogc:serviceType:FES","KML":"urn:ogc:serviceType:KML"};HGIS.Format.WMC=HGIS.Class(HGIS.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(C){var F=this.getParser();var G={queryable:C.queryable,visibility:C.visibility,name:C.params["LAYERS"],title:C.name,"abstract":C.metadata["abstract"],dataURL:C.metadata.dataURL,metadataURL:C.metadataURL,server:{version:C.params["VERSION"],url:C.url},maxExtent:C.maxExtent,transparent:C.params["TRANSPARENT"],numZoomLevels:C.numZoomLevels,units:C.units,isBaseLayer:C.isBaseLayer,opacity:C.opacity==1?undefined:C.opacity,displayInLayerSwitcher:C.displayInLayerSwitcher,singleTile:C.singleTile,tileSize:(C.singleTile||!C.tileSize)?undefined:{width:C.tileSize.w,height:C.tileSize.h},minScale:(C.options.resolutions||C.options.scales||C.options.maxResolution||C.options.minScale)?C.minScale:undefined,maxScale:(C.options.resolutions||C.options.scales||C.options.minResolution||C.options.maxScale)?C.maxScale:undefined,formats:[],styles:[],srs:C.srs,dimensions:C.dimensions};if(C.metadata.servertitle){G.server.title=C.metadata.servertitle}if(C.metadata.formats&&C.metadata.formats.length>0){for(var A=0,D=C.metadata.formats.length;A<D;A++){var B=C.metadata.formats[A];G.formats.push({value:B.value,current:(B.value==C.params["FORMAT"])})}}else{G.formats.push({value:C.params["FORMAT"],current:true})}if(C.metadata.styles&&C.metadata.styles.length>0){for(var A=0,D=C.metadata.styles.length;A<D;A++){var E=C.metadata.styles[A];if((E.href==C.params["SLD"])||(E.body==C.params["SLD_BODY"])||(E.name==C.params["STYLES"])){E.current=true}else{E.current=false}G.styles.push(E)}}else{G.styles.push({href:C.params["SLD"],body:C.params["SLD_BODY"],name:C.params["STYLES"]||F.defaultStyleName,title:F.defaultStyleTitle,current:true})}return G},toContext:function(B){var A={};var C=B.layers;if(B.CLASS_NAME=="HGIS.Map"){var G=B.metadata||{};A.size=B.getSize();A.bounds=B.getExtent();A.projection=B.projection;A.title=B.title;A.keywords=G.keywords;A["abstract"]=G["abstract"];A.logo=G.logo;A.descriptionURL=G.descriptionURL;A.contactInformation=G.contactInformation;A.maxExtent=B.maxExtent}else{HGIS.Util.applyDefaults(A,B);if(A.layers!=undefined){delete (A.layers)}}if(A.layersContext==undefined){A.layersContext=[]}if(C!=undefined&&HGIS.Util.isArray(C)){for(var D=0,F=C.length;D<F;D++){var E=C[D];if(E instanceof HGIS.Layer.WMS){A.layersContext.push(this.layerToContext(E))}}}return A},CLASS_NAME:"HGIS.Format.WMC"});HGIS.Format.WMC.v1=HGIS.Class(HGIS.Format.XML,{namespaces:{ol:"http://HGIS.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(B){var A=null;if(B==null){A=this.namespaces[this.defaultPrefix]}else{for(A in this.namespaces){if(this.namespaces[A]==B){break}}}return A},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(C){if(typeof C=="string"){C=HGIS.Format.XML.prototype.read.apply(this,[C])}var B=C.documentElement;this.rootPrefix=B.prefix;var A={version:B.getAttribute("version")};this.runChildNodes(A,B);return A},runChildNodes:function(F,D){var A=D.childNodes;var H,B,E,I;for(var C=0,G=A.length;C<G;++C){H=A[C];if(H.nodeType==1){E=this.getNamespacePrefix(H.namespaceURI);I=H.nodeName.split(":").pop();B=this["read_"+E+"_"+I];if(B){B.apply(this,[F,H])}}}},read_wmc_General:function(A,B){this.runChildNodes(A,B)},read_wmc_BoundingBox:function(A,B){A.projection=B.getAttribute("SRS");A.bounds=new HGIS.Bounds(B.getAttribute("minx"),B.getAttribute("miny"),B.getAttribute("maxx"),B.getAttribute("maxy"))},read_wmc_LayerList:function(A,B){A.layersContext=[];this.runChildNodes(A,B)},read_wmc_Layer:function(A,B){var C={visibility:(B.getAttribute("hidden")!="1"),queryable:(B.getAttribute("queryable")=="1"),formats:[],styles:[],metadata:{}};this.runChildNodes(C,B);A.layersContext.push(C)},read_wmc_Extension:function(A,B){this.runChildNodes(A,B)},read_ol_units:function(B,A){B.units=this.getChildValue(A)},read_ol_maxExtent:function(A,C){var B=new HGIS.Bounds(C.getAttribute("minx"),C.getAttribute("miny"),C.getAttribute("maxx"),C.getAttribute("maxy"));A.maxExtent=B},read_ol_transparent:function(B,A){B.transparent=this.getChildValue(A)},read_ol_numZoomLevels:function(B,A){B.numZoomLevels=parseInt(this.getChildValue(A))},read_ol_opacity:function(B,A){B.opacity=parseFloat(this.getChildValue(A))},read_ol_singleTile:function(B,A){B.singleTile=(this.getChildValue(A)=="true")},read_ol_tileSize:function(C,B){var A={"width":B.getAttribute("width"),"height":B.getAttribute("height")};C.tileSize=A},read_ol_isBaseLayer:function(B,A){B.isBaseLayer=(this.getChildValue(A)=="true")},read_ol_displayInLayerSwitcher:function(B,A){B.displayInLayerSwitcher=(this.getChildValue(A)=="true")},read_wmc_Server:function(B,A){B.version=A.getAttribute("version");B.url=this.getOnlineResource_href(A);B.metadata.servertitle=A.getAttribute("title")},read_wmc_FormatList:function(B,A){this.runChildNodes(B,A)},read_wmc_Format:function(C,B){var A={value:this.getChildValue(B)};if(B.getAttribute("current")=="1"){A.current=true}C.formats.push(A)},read_wmc_StyleList:function(B,A){this.runChildNodes(B,A)},read_wmc_Style:function(C,A){var B={};this.runChildNodes(B,A);if(A.getAttribute("current")=="1"){B.current=true}C.styles.push(B)},read_wmc_SLD:function(B,A){this.runChildNodes(B,A)},read_sld_StyledLayerDescriptor:function(A,B){var C=HGIS.Format.XML.prototype.write.apply(this,[B]);A.body=C},read_sld_FeatureTypeStyle:function(A,B){var C=HGIS.Format.XML.prototype.write.apply(this,[B]);A.body=C},read_wmc_OnlineResource:function(A,B){A.href=this.getAttributeNS(B,this.namespaces.xlink,"href")},read_wmc_Name:function(A,B){var C=this.getChildValue(B);if(C){A.name=C}},read_wmc_Title:function(A,B){var C=this.getChildValue(B);if(C){A.title=C}},read_wmc_MetadataURL:function(B,A){B.metadataURL=this.getOnlineResource_href(A)},read_wmc_KeywordList:function(A,B){A.keywords=[];this.runChildNodes(A.keywords,B)},read_wmc_Keyword:function(B,A){B.push(this.getChildValue(A))},read_wmc_Abstract:function(A,B){var C=this.getChildValue(B);if(C){A["abstract"]=C}},read_wmc_LogoURL:function(A,B){A.logo={width:B.getAttribute("width"),height:B.getAttribute("height"),format:B.getAttribute("format"),href:this.getOnlineResource_href(B)}},read_wmc_DescriptionURL:function(A,B){A.descriptionURL=this.getOnlineResource_href(B)},read_wmc_ContactInformation:function(B,C){var A={};this.runChildNodes(A,C);B.contactInformation=A},read_wmc_ContactPersonPrimary:function(A,B){var C={};this.runChildNodes(C,B);A.personPrimary=C},read_wmc_ContactPerson:function(C,B){var A=this.getChildValue(B);if(A){C.person=A}},read_wmc_ContactOrganization:function(B,A){var C=this.getChildValue(A);if(C){B.organization=C}},read_wmc_ContactPosition:function(A,B){var C=this.getChildValue(B);if(C){A.position=C}},read_wmc_ContactAddress:function(A,C){var B={};this.runChildNodes(B,C);A.contactAddress=B},read_wmc_AddressType:function(B,C){var A=this.getChildValue(C);if(A){B.type=A}},read_wmc_Address:function(A,C){var B=this.getChildValue(C);if(B){A.address=B}},read_wmc_City:function(A,C){var B=this.getChildValue(C);if(B){A.city=B}},read_wmc_StateOrProvince:function(A,B){var C=this.getChildValue(B);if(C){A.stateOrProvince=C}},read_wmc_PostCode:function(B,C){var A=this.getChildValue(C);if(A){B.postcode=A}},read_wmc_Country:function(A,B){var C=this.getChildValue(B);if(C){A.country=C}},read_wmc_ContactVoiceTelephone:function(B,C){var A=this.getChildValue(C);if(A){B.phone=A}},read_wmc_ContactFacsimileTelephone:function(A,B){var C=this.getChildValue(B);if(C){A.fax=C}},read_wmc_ContactElectronicMailAddress:function(A,B){var C=this.getChildValue(B);if(C){A.email=C}},read_wmc_DataURL:function(B,A){B.dataURL=this.getOnlineResource_href(A)},read_wmc_LegendURL:function(C,B){var A={width:B.getAttribute("width"),height:B.getAttribute("height"),format:B.getAttribute("format"),href:this.getOnlineResource_href(B)};C.legend=A},read_wmc_DimensionList:function(B,A){B.dimensions={};this.runChildNodes(B.dimensions,A)},read_wmc_Dimension:function(C,A){var B=A.getAttribute("name").toLowerCase();var D={name:B,units:A.getAttribute("units")||"",unitSymbol:A.getAttribute("unitSymbol")||"",userValue:A.getAttribute("userValue")||"",nearestValue:A.getAttribute("nearestValue")==="1",multipleValues:A.getAttribute("multipleValues")==="1",current:A.getAttribute("current")==="1","default":A.getAttribute("default")||""};var E=this.getChildValue(A);D.values=E.split(",");C[D.name]=D},write:function(A,C){var B=this.createElementDefaultNS("ViewContext");this.setAttributes(B,{version:this.VERSION,id:(C&&typeof C.id=="string")?C.id:HGIS.Util.createUniqueID("HGIS_Context_")});this.setAttributeNS(B,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);B.appendChild(this.write_wmc_General(A));B.appendChild(this.write_wmc_LayerList(A));return HGIS.Format.XML.prototype.write.apply(this,[B])},createElementDefaultNS:function(C,D,A){var B=this.createElementNS(this.namespaces[this.defaultPrefix],C);if(D){B.appendChild(this.createTextNode(D))}if(A){this.setAttributes(B,A)}return B},setAttributes:function(B,A){var D;for(var C in A){D=A[C].toString();if(D.match(/[A-Z]/)){this.setAttributeNS(B,null,C,D)}else{B.setAttribute(C,D)}}},write_wmc_General:function(A){var C=this.createElementDefaultNS("General");if(A.size){C.appendChild(this.createElementDefaultNS("Window",null,{width:A.size.w,height:A.size.h}))}var B=A.bounds;C.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:B.left.toPrecision(18),miny:B.bottom.toPrecision(18),maxx:B.right.toPrecision(18),maxy:B.top.toPrecision(18),SRS:A.projection}));C.appendChild(this.createElementDefaultNS("Title",A.title));if(A.keywords){C.appendChild(this.write_wmc_KeywordList(A.keywords))}if(A["abstract"]){C.appendChild(this.createElementDefaultNS("Abstract",A["abstract"]))}if(A.logo){C.appendChild(this.write_wmc_URLType("LogoURL",A.logo.href,A.logo))}if(A.descriptionURL){C.appendChild(this.write_wmc_URLType("DescriptionURL",A.descriptionURL))}if(A.contactInformation){C.appendChild(this.write_wmc_ContactInformation(A.contactInformation))}C.appendChild(this.write_ol_MapExtension(A));return C},write_wmc_KeywordList:function(D){var B=this.createElementDefaultNS("KeywordList");for(var A=0,C=D.length;A<C;A++){B.appendChild(this.createElementDefaultNS("Keyword",D[A]))}return B},write_wmc_ContactInformation:function(A){var B=this.createElementDefaultNS("ContactInformation");if(A.personPrimary){B.appendChild(this.write_wmc_ContactPersonPrimary(A.personPrimary))}if(A.position){B.appendChild(this.createElementDefaultNS("ContactPosition",A.position))}if(A.contactAddress){B.appendChild(this.write_wmc_ContactAddress(A.contactAddress))}if(A.phone){B.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",A.phone))}if(A.fax){B.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",A.fax))}if(A.email){B.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",A.email))}return B},write_wmc_ContactPersonPrimary:function(B){var A=this.createElementDefaultNS("ContactPersonPrimary");if(B.person){A.appendChild(this.createElementDefaultNS("ContactPerson",B.person))}if(B.organization){A.appendChild(this.createElementDefaultNS("ContactOrganization",B.organization))}return A},write_wmc_ContactAddress:function(A){var B=this.createElementDefaultNS("ContactAddress");if(A.type){B.appendChild(this.createElementDefaultNS("AddressType",A.type))}if(A.address){B.appendChild(this.createElementDefaultNS("Address",A.address))}if(A.city){B.appendChild(this.createElementDefaultNS("City",A.city))}if(A.stateOrProvince){B.appendChild(this.createElementDefaultNS("StateOrProvince",A.stateOrProvince))}if(A.postcode){B.appendChild(this.createElementDefaultNS("PostCode",A.postcode))}if(A.country){B.appendChild(this.createElementDefaultNS("Country",A.country))}return B},write_ol_MapExtension:function(A){var C=this.createElementDefaultNS("Extension");var B=A.maxExtent;if(B){var D=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(D,{minx:B.left.toPrecision(18),miny:B.bottom.toPrecision(18),maxx:B.right.toPrecision(18),maxy:B.top.toPrecision(18)});C.appendChild(D)}return C},write_wmc_LayerList:function(A){var C=this.createElementDefaultNS("LayerList");for(var B=0,D=A.layersContext.length;B<D;++B){C.appendChild(this.write_wmc_Layer(A.layersContext[B]))}return C},write_wmc_Layer:function(A){var B=this.createElementDefaultNS("Layer",null,{queryable:A.queryable?"1":"0",hidden:A.visibility?"0":"1"});B.appendChild(this.write_wmc_Server(A));B.appendChild(this.createElementDefaultNS("Name",A.name));B.appendChild(this.createElementDefaultNS("Title",A.title));if(A["abstract"]){B.appendChild(this.createElementDefaultNS("Abstract",A["abstract"]))}if(A.dataURL){B.appendChild(this.write_wmc_URLType("DataURL",A.dataURL))}if(A.metadataURL){B.appendChild(this.write_wmc_URLType("MetadataURL",A.metadataURL))}return B},write_wmc_LayerExtension:function(C){var F=this.createElementDefaultNS("Extension");var B=C.maxExtent;var A=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(A,{minx:B.left.toPrecision(18),miny:B.bottom.toPrecision(18),maxx:B.right.toPrecision(18),maxy:B.top.toPrecision(18)});F.appendChild(A);if(C.tileSize&&!C.singleTile){var D=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(D,C.tileSize);F.appendChild(D)}var G=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var H;for(var E=0,I=G.length;E<I;++E){H=this.createOLPropertyNode(C,G[E]);if(H){F.appendChild(H)}}return F},createOLPropertyNode:function(A,C){var B=null;if(A[C]!=null){B=this.createElementNS(this.namespaces.ol,"ol:"+C);B.appendChild(this.createTextNode(A[C].toString()))}return B},write_wmc_Server:function(A){var D=A.server;var C=this.createElementDefaultNS("Server");var B={service:"OGC:WMS",version:D.version};if(D.title){B.title=D.title}this.setAttributes(C,B);C.appendChild(this.write_wmc_OnlineResource(D.url));return C},write_wmc_URLType:function(E,B,F){var C=this.createElementDefaultNS(E);C.appendChild(this.write_wmc_OnlineResource(B));if(F){var D=["width","height","format"];for(var A=0;A<D.length;A++){if(D[A] in F){C.setAttribute(D[A],F[D[A]])}}}return C},write_wmc_DimensionList:function(D){var G=this.createElementDefaultNS("DimensionList");var B={name:true,units:true,unitSymbol:true,userValue:true};for(var E in D.dimensions){var F={};var C=D.dimensions[E];for(var A in C){if(typeof C[A]=="boolean"){F[A]=Number(C[A])}else{F[A]=C[A]}}var H="";if(F.values){H=F.values.join(",");delete F.values}G.appendChild(this.createElementDefaultNS("Dimension",H,F))}return G},write_wmc_FormatList:function(B){var D=this.createElementDefaultNS("FormatList");for(var C=0,E=B.formats.length;C<E;C++){var A=B.formats[C];D.appendChild(this.createElementDefaultNS("Format",A.value,(A.current&&A.current==true)?{current:"1"}:null))}return D},write_wmc_StyleList:function(G){var H=this.createElementDefaultNS("StyleList");var D=G.styles;if(D&&HGIS.Util.isArray(D)){var I;for(var E=0,J=D.length;E<J;E++){var A=D[E];var F=this.createElementDefaultNS("Style",null,(A.current&&A.current==true)?{current:"1"}:null);if(A.href){I=this.createElementDefaultNS("SLD");if(A.name){I.appendChild(this.createElementDefaultNS("Name",A.name))}if(A.title){I.appendChild(this.createElementDefaultNS("Title",A.title))}if(A.legend){I.appendChild(this.write_wmc_URLType("LegendURL",A.legend.href,A.legend))}var B=this.write_wmc_OnlineResource(A.href);I.appendChild(B);F.appendChild(I)}else{if(A.body){I=this.createElementDefaultNS("SLD");if(A.name){I.appendChild(this.createElementDefaultNS("Name",A.name))}if(A.title){I.appendChild(this.createElementDefaultNS("Title",A.title))}if(A.legend){I.appendChild(this.write_wmc_URLType("LegendURL",A.legend.href,A.legend))}var C=HGIS.Format.XML.prototype.read.apply(this,[A.body]);var K=C.documentElement;if(I.ownerDocument&&I.ownerDocument.importNode){K=I.ownerDocument.importNode(K,true)}I.appendChild(K);F.appendChild(I)}else{F.appendChild(this.createElementDefaultNS("Name",A.name));F.appendChild(this.createElementDefaultNS("Title",A.title));if(A["abstract"]){F.appendChild(this.createElementDefaultNS("Abstract",A["abstract"]))}if(A.legend){F.appendChild(this.write_wmc_URLType("LegendURL",A.legend.href,A.legend))}}}H.appendChild(F)}}return H},write_wmc_OnlineResource:function(A){var B=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(B,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(B,this.namespaces.xlink,"xlink:href",A);return B},getOnlineResource_href:function(B){var A={};var C=B.getElementsByTagName("OnlineResource");if(C.length>0){this.read_wmc_OnlineResource(A,C[0])}return A.href},CLASS_NAME:"HGIS.Format.WMC.v1"});HGIS.Control.PanPanel=HGIS.Class(HGIS.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(A){HGIS.Control.Panel.prototype.initialize.apply(this,[A]);var A={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new HGIS.Control.Pan(HGIS.Control.Pan.NORTH,A),new HGIS.Control.Pan(HGIS.Control.Pan.SOUTH,A),new HGIS.Control.Pan(HGIS.Control.Pan.EAST,A),new HGIS.Control.Pan(HGIS.Control.Pan.WEST,A)])},CLASS_NAME:"HGIS.Control.PanPanel"});HGIS.Control.Attribution=HGIS.Class(HGIS.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({"removelayer":this.updateAttribution,"addlayer":this.updateAttribution,"changelayer":this.updateAttribution,"changebaselayer":this.updateAttribution,scope:this});HGIS.Control.prototype.destroy.apply(this,arguments)},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);this.map.events.on({"changebaselayer":this.updateAttribution,"changelayer":this.updateAttribution,"addlayer":this.updateAttribution,"removelayer":this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var D=[];if(this.map&&this.map.layers){for(var A=0,C=this.map.layers.length;A<C;A++){var B=this.map.layers[A];if(B.attribution&&B.getVisibility()){if(HGIS.Util.indexOf(D,B.attribution)===-1){D.push(B.attribution)}}}this.div.innerHTML=HGIS.String.format(this.template,{layers:D.join(this.separator)})}},CLASS_NAME:"HGIS.Control.Attribution"});HGIS.Kinetic=HGIS.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(A){HGIS.Util.extend(this,A)},begin:function(){HGIS.Animation.stop(this.timerId);this.timerId=undefined;this.points=[]},update:function(A){this.points.unshift({xy:A,tick:new Date().getTime()});if(this.points.length>this.nbPoints){this.points.pop()}},end:function(D){var F,A=new Date().getTime();for(var E=0,G=this.points.length,J;E<G;E++){J=this.points[E];if(A-J.tick>this.delay){break}F=J}if(!F){return}var B=new Date().getTime()-F.tick;var H=Math.sqrt(Math.pow(D.x-F.xy.x,2)+Math.pow(D.y-F.xy.y,2));var C=H/B;if(C==0||C<this.threshold){return}var I=Math.asin((D.y-F.xy.y)/H);if(F.xy.x<=D.x){I=Math.PI-I}return{speed:C,theta:I}},move:function(G,A){var H=G.speed;var F=Math.cos(G.theta);var D=-Math.sin(G.theta);var C=new Date().getTime();var E=0;var I=0;var B=function(){if(this.timerId==null){return}var M=new Date().getTime()-C;var J=(-this.deceleration*Math.pow(M,2))/2+H*M;var L=J*F;var N=J*D;var O={};O.end=false;var K=-this.deceleration*M+H;if(K<=0){HGIS.Animation.stop(this.timerId);this.timerId=null;O.end=true}O.x=L-E;O.y=N-I;E=L;I=N;A(O.x,O.y,O.end)};this.timerId=HGIS.Animation.start(HGIS.Function.bind(B,this))},CLASS_NAME:"HGIS.Kinetic"});HGIS.Format.WPSExecute=HGIS.Class(HGIS.Format.XML,HGIS.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(A){return undefined},write:function(B){var C;if(window.ActiveXObject){C=new ActiveXObject("Microsoft.XMLDOM");this.xmldom=C}else{C=document.implementation.createDocument("","",null)}var A=this.writeNode("wps:Execute",B,C);this.setAttributeNS(A,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[A])},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);return A},writers:{"wps":{"Execute":function(B){var A=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});this.writeNode("ows:Identifier",B.identifier,A);this.writeNode("wps:DataInputs",B.dataInputs,A);this.writeNode("wps:ResponseForm",B.responseForm,A);return A},"ResponseForm":function(B){var A=this.createElementNSPlus("wps:ResponseForm",{});if(B.rawDataOutput){this.writeNode("wps:RawDataOutput",B.rawDataOutput,A)}if(B.responseDocument){this.writeNode("wps:ResponseDocument",B.responseDocument,A)}return A},"ResponseDocument":function(B){var C=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:B.storeExecuteResponse,lineage:B.lineage,status:B.status}});if(B.outputs){for(var A=0,D=B.outputs.length;A<D;A++){this.writeNode("wps:Output",B.outputs[A],C)}}return C},"Output":function(B){var A=this.createElementNSPlus("wps:Output",{attributes:{asReference:B.asReference,mimeType:B.mimeType,encoding:B.encoding,schema:B.schema}});this.writeNode("ows:Identifier",B.identifier,A);this.writeNode("ows:Title",B.title,A);this.writeNode("ows:Abstract",B["abstract"],A);return A},"RawDataOutput":function(A){var B=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:A.mimeType,encoding:A.encoding,schema:A.schema}});this.writeNode("ows:Identifier",A.identifier,B);return B},"DataInputs":function(C){var B=this.createElementNSPlus("wps:DataInputs",{});for(var A=0,D=C.length;A<D;++A){this.writeNode("wps:Input",C[A],B)}return B},"Input":function(B){var A=this.createElementNSPlus("wps:Input",{});this.writeNode("ows:Identifier",B.identifier,A);if(B.title){this.writeNode("ows:Title",B.title,A)}if(B.data){this.writeNode("wps:Data",B.data,A)}if(B.reference){this.writeNode("wps:Reference",B.reference,A)}if(B.boundingBoxData){this.writeNode("wps:BoundingBoxData",B.boundingBoxData,A)}return A},"Data":function(B){var A=this.createElementNSPlus("wps:Data",{});if(B.literalData){this.writeNode("wps:LiteralData",B.literalData,A)}else{if(B.complexData){this.writeNode("wps:ComplexData",B.complexData,A)}else{if(B.boundingBoxData){this.writeNode("ows:BoundingBox",B.boundingBoxData,A)}}}return A},"LiteralData":function(B){var A=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:B.uom},value:B.value});return A},"ComplexData":function(B){var A=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:B.mimeType,encoding:B.encoding,schema:B.schema}});var C=B.value;if(typeof C==="string"){A.appendChild(this.getXMLDoc().createCDATASection(B.value))}else{A.appendChild(C)}return A},"Reference":function(B){var A=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:B.mimeType,"xlink:href":B.href,method:B.method,encoding:B.encoding,schema:B.schema}});if(B.body){this.writeNode("wps:Body",B.body,A)}return A},"BoundingBoxData":function(B,A){this.writers["ows"]["BoundingBox"].apply(this,[B,A,"wps:BoundingBoxData"])},"Body":function(A){var B=this.createElementNSPlus("wps:Body",{});if(A.wcs){this.writeNode("wcs:GetCoverage",A.wcs,B)}else{if(A.wfs){this.featureType=A.wfs.featureType;this.version=A.wfs.version;this.writeNode("wfs:GetFeature",A.wfs,B)}else{this.writeNode("wps:Execute",A,B)}}return B}},"wcs":HGIS.Format.WCSGetCoverage.prototype.writers.wcs,"wfs":HGIS.Format.WFST.v1_1_0.prototype.writers.wfs,"ogc":HGIS.Format.Filter.v1_1_0.prototype.writers.ogc,"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{"wps":{"ExecuteResponse":function(B,A){A.executeResponse={lang:B.getAttribute("lang"),statusLocation:B.getAttribute("statusLocation"),serviceInstance:B.getAttribute("serviceInstance"),service:B.getAttribute("service")};this.readChildNodes(B,A.executeResponse)},"Process":function(B,A){A.process={};this.readChildNodes(B,A.process)},"Status":function(B,A){A.status={creationTime:B.getAttribute("creationTime")};this.readChildNodes(B,A.status)},"ProcessSucceeded":function(B,A){A.processSucceeded=true},"ProcessOutputs":function(B,A){A.processOutputs=[];this.readChildNodes(B,A.processOutputs)},"Output":function(B,A){var C={};this.readChildNodes(B,C);A.push(C)},"Reference":function(A,B){B.reference={href:A.getAttribute("href"),mimeType:A.getAttribute("mimeType"),encoding:A.getAttribute("encoding"),schema:A.getAttribute("schema")}},"Data":function(A,B){B.data={};this.readChildNodes(A,B)},"LiteralData":function(A,B){B.literalData={dataType:A.getAttribute("dataType"),uom:A.getAttribute("uom"),value:this.getChildValue(A)}},"ComplexData":function(B,C){C.complexData={mimeType:B.getAttribute("mimeType"),schema:B.getAttribute("schema"),encoding:B.getAttribute("encoding"),value:""};if(this.isSimpleContent(B)){var A;for(A=B.firstChild;A;A=A.nextSibling){switch(A.nodeType){case 3:case 4:C.complexData.value+=A.nodeValue}}}else{for(A=B.firstChild;A;A=A.nextSibling){if(A.nodeType==1){C.complexData.value=A}}}},"BoundingBox":function(A,B){B.boundingBoxData={dimensions:A.getAttribute("dimensions"),crs:A.getAttribute("crs")};this.readChildNodes(A,B.boundingBoxData)}},"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.readers["ows"]},CLASS_NAME:"HGIS.Format.WPSExecute"});HGIS.Layer.GeoRSS=HGIS.Class(HGIS.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(C,A,B){HGIS.Layer.Markers.prototype.initialize.apply(this,[C,B]);this.location=A;this.features=[]},destroy:function(){HGIS.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");HGIS.Request.GET({url:this.location,success:this.parseData,scope:this});this.loaded=true}},moveTo:function(B,A,C){HGIS.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadRSS()}},parseData:function(B){var I=B.responseXML;if(!I||!I.documentElement){I=HGIS.Format.XML.prototype.read(B.responseText)}if(this.useFeedTitle){var P=null;try{P=I.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(D){P=I.getElementsByTagName("title")[0].firstChild.nodeValue}if(P){this.setName(P)}}var M={};HGIS.Util.extend(M,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){M.externalProjection=this.projection;M.internalProjection=this.map.getProjectionObject()}var L=new HGIS.Format.GeoRSS(M);var Q=L.read(I);for(var F=0,C=Q.length;F<C;F++){var N={};var H=Q[F];if(!H.geometry){continue}var G=H.attributes.title?H.attributes.title:"Untitled";var K=H.attributes.description?H.attributes.description:"No description.";var J=H.attributes.link?H.attributes.link:"";var E=H.geometry.getBounds().getCenterLonLat();N.icon=this.icon==null?HGIS.Marker.defaultIcon():this.icon.clone();N.popupSize=this.popupSize?this.popupSize.clone():new HGIS.Size(250,120);if(G||K){N.title=G;N.description=K;var O='<div class="olLayerGeoRSSClose">[x]</div>';O+='<div class="olLayerGeoRSSTitle">';if(J){O+='<a class="link" href="'+J+'" target="_blank">'}O+=G;if(J){O+="</a>"}O+="</div>";O+='<div style="" class="olLayerGeoRSSDescription">';O+=K;O+="</div>";N["popupContentHTML"]=O}var H=new HGIS.Feature(this,E,N);this.features.push(H);var A=H.createMarker();A.events.register("click",H,this.markerClick);this.addMarker(A)}this.events.triggerEvent("loadend")},markerClick:function(B){var C=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!C)?this:null;for(var A=0,D=this.layer.map.popups.length;A<D;A++){this.layer.map.removePopup(this.layer.map.popups[A])}if(!C){var E=this.createPopup();HGIS.Event.observe(E.div,"click",HGIS.Function.bind(function(){for(var F=0,G=this.layer.map.popups.length;F<G;F++){this.layer.map.removePopup(this.layer.map.popups[F])}},this));this.layer.map.addPopup(E)}HGIS.Event.stop(B)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var A=this.features[0];HGIS.Util.removeItem(this.features,A);A.destroy()}}},CLASS_NAME:"HGIS.Layer.GeoRSS"});HGIS.Symbolizer.Point=HGIS.Class(HGIS.Symbolizer,{initialize:function(A){HGIS.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"HGIS.Symbolizer.Point"});HGIS.Symbolizer.Line=HGIS.Class(HGIS.Symbolizer,{initialize:function(A){HGIS.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"HGIS.Symbolizer.Line"});HGIS.Symbolizer.Text=HGIS.Class(HGIS.Symbolizer,{initialize:function(A){HGIS.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"HGIS.Symbolizer.Text"});HGIS.Format.SLD.v1=HGIS.Class(HGIS.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(C,B){B=HGIS.Util.applyDefaults(B,this.options);var A={namedLayers:B.namedLayersAsArray===true?[]:{}};this.readChildNodes(C,A);return A},readers:HGIS.Util.applyDefaults({"sld":{"StyledLayerDescriptor":function(B,A){A.version=B.getAttribute("version");this.readChildNodes(B,A)},"Name":function(B,A){A.name=this.getChildValue(B)},"Title":function(B,A){A.title=this.getChildValue(B)},"Abstract":function(B,A){A.description=this.getChildValue(B)},"NamedLayer":function(C,A){var D={userStyles:[],namedStyles:[]};this.readChildNodes(C,D);for(var B=0,E=D.userStyles.length;B<E;++B){D.userStyles[B].layerName=D.name}if(HGIS.Util.isArray(A.namedLayers)){A.namedLayers.push(D)}else{A.namedLayers[D.name]=D}},"NamedStyle":function(A,B){B.namedStyles.push(this.getChildName(A.firstChild))},"UserStyle":function(B,C){var A={defaultsPerSymbolizer:true,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(B,A);var D;if(this.multipleSymbolizers){delete A.defaultsPerSymbolizer;D=new HGIS.Style2(A)}else{D=new HGIS.Style(this.defaultSymbolizer,A)}C.userStyles.push(D)},"IsDefault":function(A,B){if(this.getChildValue(A)=="1"){B.isDefault=true}},"FeatureTypeStyle":function(B,C){++this.featureTypeCounter;var A={rules:this.multipleSymbolizers?C.rules:[]};this.readChildNodes(B,A);if(!this.multipleSymbolizers){C.rules=A.rules}},"Rule":function(C,B){var D;if(this.multipleSymbolizers){D={symbolizers:[]}}var A=new HGIS.Rule(D);this.readChildNodes(C,A);B.rules.push(A)},"ElseFilter":function(B,A){A.elseFilter=true},"MinScaleDenominator":function(B,A){A.minScaleDenominator=parseFloat(this.getChildValue(B))},"MaxScaleDenominator":function(B,A){A.maxScaleDenominator=parseFloat(this.getChildValue(B))},"TextSymbolizer":function(B,A){var C={};this.readChildNodes(B,C);if(this.multipleSymbolizers){C.zIndex=this.featureTypeCounter;A.symbolizers.push(new HGIS.Symbolizer.Text(C))}else{A.symbolizer["Text"]=HGIS.Util.applyDefaults(C,A.symbolizer["Text"])}},"LabelPlacement":function(B,A){this.readChildNodes(B,A)},"PointPlacement":function(B,A){var D={};this.readChildNodes(B,D);D.labelRotation=D.rotation;delete D.rotation;var C,E=A.labelAnchorPointX,F=A.labelAnchorPointY;if(E<=1/3){C="l"}else{if(E>1/3&&E<2/3){C="c"}else{if(E>=2/3){C="r"}}}if(F<=1/3){C+="b"}else{if(F>1/3&&F<2/3){C+="m"}else{if(F>=2/3){C+="t"}}}D.labelAlign=C;HGIS.Util.applyDefaults(A,D)},"AnchorPoint":function(B,A){this.readChildNodes(B,A)},"AnchorPointX":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.labelAnchorPointX=C}},"AnchorPointY":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.labelAnchorPointY=C}},"Displacement":function(B,A){this.readChildNodes(B,A)},"DisplacementX":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.labelXOffset=C}},"DisplacementY":function(C,B){var A=this.readers.ogc._expression.call(this,C);if(A){B.labelYOffset=A}},"LinePlacement":function(B,A){this.readChildNodes(B,A)},"PerpendicularOffset":function(C,A){var B=this.readers.ogc._expression.call(this,C);if(B){A.labelPerpendicularOffset=B}},"Label":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.label=C}},"Font":function(B,A){this.readChildNodes(B,A)},"Halo":function(B,A){var C={};this.readChildNodes(B,C);A.haloRadius=C.haloRadius;A.haloColor=C.fillColor;A.haloOpacity=C.fillOpacity},"Radius":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C!=null){A.haloRadius=C}},"RasterSymbolizer":function(B,A){var C={};this.readChildNodes(B,C);if(this.multipleSymbolizers){C.zIndex=this.featureTypeCounter;A.symbolizers.push(new HGIS.Symbolizer.Raster(C))}else{A.symbolizer["Raster"]=HGIS.Util.applyDefaults(C,A.symbolizer["Raster"])}},"Geometry":function(B,A){A.geometry={};this.readChildNodes(B,A.geometry)},"ColorMap":function(B,A){A.colorMap=[];this.readChildNodes(B,A.colorMap)},"ColorMapEntry":function(C,A){var D=C.getAttribute("quantity");var B=C.getAttribute("opacity");A.push({color:C.getAttribute("color"),quantity:D!==null?parseFloat(D):undefined,label:C.getAttribute("label")||undefined,opacity:B!==null?parseFloat(B):undefined})},"LineSymbolizer":function(B,A){var C={};this.readChildNodes(B,C);if(this.multipleSymbolizers){C.zIndex=this.featureTypeCounter;A.symbolizers.push(new HGIS.Symbolizer.Line(C))}else{A.symbolizer["Line"]=HGIS.Util.applyDefaults(C,A.symbolizer["Line"])}},"PolygonSymbolizer":function(B,A){var C={fill:false,stroke:false};if(!this.multipleSymbolizers){C=A.symbolizer["Polygon"]||C}this.readChildNodes(B,C);if(this.multipleSymbolizers){C.zIndex=this.featureTypeCounter;A.symbolizers.push(new HGIS.Symbolizer.Polygon(C))}else{A.symbolizer["Polygon"]=C}},"PointSymbolizer":function(B,A){var C={fill:false,stroke:false,graphic:false};if(!this.multipleSymbolizers){C=A.symbolizer["Point"]||C}this.readChildNodes(B,C);if(this.multipleSymbolizers){C.zIndex=this.featureTypeCounter;A.symbolizers.push(new HGIS.Symbolizer.Point(C))}else{A.symbolizer["Point"]=C}},"Stroke":function(B,A){A.stroke=true;this.readChildNodes(B,A)},"Fill":function(B,A){A.fill=true;this.readChildNodes(B,A)},"CssParameter":function(C,B){var D=C.getAttribute("name");var A=this.cssMap[D];if(B.label){if(D==="fill"){A="fontColor"}else{if(D==="fill-opacity"){A="fontOpacity"}}}if(A){var E=this.readers.ogc._expression.call(this,C);if(E){B[A]=E}}},"Graphic":function(F,I){I.graphic=true;var E={};this.readChildNodes(F,E);var G=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var A,C;for(var D=0,H=G.length;D<H;++D){A=G[D];C=E[A];if(C!=undefined){I[A]=C}}if(E.opacity!=undefined){I.graphicOpacity=E.opacity}if(E.size!=undefined){var B=E.size/2;if(isNaN(B)){I.graphicWidth=E.size}else{I.pointRadius=E.size/2}}if(E.href!=undefined){I.externalGraphic=E.href}if(E.rotation!=undefined){I.rotation=E.rotation}},"ExternalGraphic":function(B,A){this.readChildNodes(B,A)},"Mark":function(B,A){this.readChildNodes(B,A)},"WellKnownName":function(B,A){A.graphicName=this.getChildValue(B)},"Opacity":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.opacity=C}},"Size":function(C,B){var A=this.readers.ogc._expression.call(this,C);if(A){B.size=A}},"Rotation":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.rotation=C}},"OnlineResource":function(B,A){A.href=this.getAttributeNS(B,this.namespaces.xlink,"href")},"Format":function(B,A){A.graphicFormat=this.getChildValue(B)}}},HGIS.Format.Filter.v1_0_0.prototype.readers),cssMap:{"stroke":"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle","fill":"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(C){var A=null;for(var B in this.cssMap){if(this.cssMap[B]==C){A=B;break}}return A},getGraphicFormat:function(A){var C,B;for(var D in this.graphicFormats){if(this.graphicFormats[D].test(A)){C=D;break}}return C||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(A){return this.writers.sld.StyledLayerDescriptor.apply(this,[A])},writers:HGIS.Util.applyDefaults({"sld":{"_OGCExpression":function(A,C){var F=this.createElementNSPlus(A);var B=typeof C=="string"?C.split("${"):[C];F.appendChild(this.createTextNode(B[0]));var H,E;for(var D=1,G=B.length;D<G;D++){H=B[D];E=H.indexOf("}");if(E>0){this.writeNode("ogc:PropertyName",{property:H.substring(0,E)},F);F.appendChild(this.createTextNode(H.substring(++E)))}else{F.appendChild(this.createTextNode("${"+H))}}return F},"StyledLayerDescriptor":function(A){var B=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{"version":this.VERSION,"xsi:schemaLocation":this.schemaLocation}});B.setAttribute("xmlns:ogc",this.namespaces.ogc);B.setAttribute("xmlns:gml",this.namespaces.gml);if(A.name){this.writeNode("Name",A.name,B)}if(A.title){this.writeNode("Title",A.title,B)}if(A.description){this.writeNode("Abstract",A.description,B)}if(HGIS.Util.isArray(A.namedLayers)){for(var C=0,E=A.namedLayers.length;C<E;++C){this.writeNode("NamedLayer",A.namedLayers[C],B)}}else{for(var D in A.namedLayers){this.writeNode("NamedLayer",A.namedLayers[D],B)}}return B},"Name":function(A){return this.createElementNSPlus("sld:Name",{value:A})},"Title":function(A){return this.createElementNSPlus("sld:Title",{value:A})},"Abstract":function(A){return this.createElementNSPlus("sld:Abstract",{value:A})},"NamedLayer":function(C){var B=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",C.name,B);if(C.namedStyles){for(var A=0,D=C.namedStyles.length;A<D;++A){this.writeNode("NamedStyle",C.namedStyles[A],B)}}if(C.userStyles){for(var A=0,D=C.userStyles.length;A<D;++A){this.writeNode("UserStyle",C.userStyles[A],B)}}return B},"NamedStyle":function(B){var A=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",B,A);return A},"UserStyle":function(H){var I=this.createElementNSPlus("sld:UserStyle");if(H.name){this.writeNode("Name",H.name,I)}if(H.title){this.writeNode("Title",H.title,I)}if(H.description){this.writeNode("Abstract",H.description,I)}if(H.isDefault){this.writeNode("IsDefault",H.isDefault,I)}if(this.multipleSymbolizers&&H.rules){var J={0:[]};var C=[0];var L,A,N,K,B;for(var G=0,E=H.rules.length;G<E;++G){L=H.rules[G];if(L.symbolizers){A={};for(var F=0,M=L.symbolizers.length;F<M;++F){N=L.symbolizers[F];K=N.zIndex;if(!(K in A)){B=L.clone();B.symbolizers=[];A[K]=B}A[K].symbolizers.push(N.clone())}for(K in A){if(!(K in J)){C.push(K);J[K]=[]}J[K].push(A[K])}}else{J[0].push(L.clone())}}C.sort();var D;for(var G=0,E=C.length;G<E;++G){D=J[C[G]];if(D.length>0){B=H.clone();B.rules=J[C[G]];this.writeNode("FeatureTypeStyle",B,I)}}}else{this.writeNode("FeatureTypeStyle",H,I)}return I},"IsDefault":function(A){return this.createElementNSPlus("sld:IsDefault",{value:(A)?"1":"0"})},"FeatureTypeStyle":function(C){var B=this.createElementNSPlus("sld:FeatureTypeStyle");for(var A=0,D=C.rules.length;A<D;++A){this.writeNode("Rule",C.rules[A],B)}return B},"Rule":function(D){var E=this.createElementNSPlus("sld:Rule");if(D.name){this.writeNode("Name",D.name,E)}if(D.title){this.writeNode("Title",D.title,E)}if(D.description){this.writeNode("Abstract",D.description,E)}if(D.elseFilter){this.writeNode("ElseFilter",null,E)}else{if(D.filter){this.writeNode("ogc:Filter",D.filter,E)}}if(D.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",D.minScaleDenominator,E)}if(D.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",D.maxScaleDenominator,E)}var G,H;if(this.multipleSymbolizers&&D.symbolizers){var H;for(var C=0,A=D.symbolizers.length;C<A;++C){H=D.symbolizers[C];G=H.CLASS_NAME.split(".").pop();this.writeNode(G+"Symbolizer",H,E)}}else{var B=HGIS.Style.SYMBOLIZER_PREFIXES;for(var C=0,F=B.length;C<F;++C){G=B[C];H=D.symbolizer[G];if(H){this.writeNode(G+"Symbolizer",H,E)}}}return E},"ElseFilter":function(){return this.createElementNSPlus("sld:ElseFilter")},"MinScaleDenominator":function(A){return this.createElementNSPlus("sld:MinScaleDenominator",{value:A})},"MaxScaleDenominator":function(A){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:A})},"LineSymbolizer":function(A){var B=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",A,B);return B},"Stroke":function(A){var B=this.createElementNSPlus("sld:Stroke");if(A.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:A,key:"strokeColor"},B)}if(A.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:A,key:"strokeOpacity"},B)}if(A.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:A,key:"strokeWidth"},B)}if(A.strokeDashstyle!=undefined&&A.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:A,key:"strokeDashstyle"},B)}if(A.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:A,key:"strokeLinecap"},B)}return B},"CssParameter":function(A){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(A.key)},value:A.symbolizer[A.key]})},"TextSymbolizer":function(A){var B=this.createElementNSPlus("sld:TextSymbolizer");if(A.label!=null){this.writeNode("Label",A.label,B)}if(A.fontFamily!=null||A.fontSize!=null||A.fontWeight!=null||A.fontStyle!=null){this.writeNode("Font",A,B)}if(A.labelAnchorPointX!=null||A.labelAnchorPointY!=null||A.labelAlign!=null||A.labelXOffset!=null||A.labelYOffset!=null||A.labelRotation!=null||A.labelPerpendicularOffset!=null){this.writeNode("LabelPlacement",A,B)}if(A.haloRadius!=null||A.haloColor!=null||A.haloOpacity!=null){this.writeNode("Halo",A,B)}if(A.fontColor!=null||A.fontOpacity!=null){this.writeNode("Fill",{fillColor:A.fontColor,fillOpacity:A.fontOpacity},B)}return B},"LabelPlacement":function(A){var B=this.createElementNSPlus("sld:LabelPlacement");if((A.labelAnchorPointX!=null||A.labelAnchorPointY!=null||A.labelAlign!=null||A.labelXOffset!=null||A.labelYOffset!=null||A.labelRotation!=null)&&A.labelPerpendicularOffset==null){this.writeNode("PointPlacement",A,B)}if(A.labelPerpendicularOffset!=null){this.writeNode("LinePlacement",A,B)}return B},"LinePlacement":function(A){var B=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",A.labelPerpendicularOffset,B);return B},"PerpendicularOffset":function(A){return this.createElementNSPlus("sld:PerpendicularOffset",{value:A})},"PointPlacement":function(A){var B=this.createElementNSPlus("sld:PointPlacement");if(A.labelAnchorPointX!=null||A.labelAnchorPointY!=null||A.labelAlign!=null){this.writeNode("AnchorPoint",A,B)}if(A.labelXOffset!=null||A.labelYOffset!=null){this.writeNode("Displacement",A,B)}if(A.labelRotation!=null){this.writeNode("Rotation",A.labelRotation,B)}return B},"AnchorPoint":function(A){var B=this.createElementNSPlus("sld:AnchorPoint");var C=A.labelAnchorPointX,D=A.labelAnchorPointY;if(C!=null){this.writeNode("AnchorPointX",C,B)}if(D!=null){this.writeNode("AnchorPointY",D,B)}if(C==null&&D==null){var F=A.labelAlign.substr(0,1),E=A.labelAlign.substr(1,1);if(F==="l"){C=0}else{if(F==="c"){C=0.5}else{if(F==="r"){C=1}}}if(E==="b"){D=0}else{if(E==="m"){D=0.5}else{if(E==="t"){D=1}}}this.writeNode("AnchorPointX",C,B);this.writeNode("AnchorPointY",D,B)}return B},"AnchorPointX":function(A){return this.createElementNSPlus("sld:AnchorPointX",{value:A})},"AnchorPointY":function(A){return this.createElementNSPlus("sld:AnchorPointY",{value:A})},"Displacement":function(A){var B=this.createElementNSPlus("sld:Displacement");if(A.labelXOffset!=null){this.writeNode("DisplacementX",A.labelXOffset,B)}if(A.labelYOffset!=null){this.writeNode("DisplacementY",A.labelYOffset,B)}return B},"DisplacementX":function(A){return this.createElementNSPlus("sld:DisplacementX",{value:A})},"DisplacementY":function(A){return this.createElementNSPlus("sld:DisplacementY",{value:A})},"Font":function(A){var B=this.createElementNSPlus("sld:Font");if(A.fontFamily){this.writeNode("CssParameter",{symbolizer:A,key:"fontFamily"},B)}if(A.fontSize){this.writeNode("CssParameter",{symbolizer:A,key:"fontSize"},B)}if(A.fontWeight){this.writeNode("CssParameter",{symbolizer:A,key:"fontWeight"},B)}if(A.fontStyle){this.writeNode("CssParameter",{symbolizer:A,key:"fontStyle"},B)}return B},"Label":function(A){return this.writers.sld._OGCExpression.call(this,"sld:Label",A)},"Halo":function(A){var B=this.createElementNSPlus("sld:Halo");if(A.haloRadius){this.writeNode("Radius",A.haloRadius,B)}if(A.haloColor||A.haloOpacity){this.writeNode("Fill",{fillColor:A.haloColor,fillOpacity:A.haloOpacity},B)}return B},"Radius":function(A){return this.createElementNSPlus("sld:Radius",{value:A})},"RasterSymbolizer":function(A){var B=this.createElementNSPlus("sld:RasterSymbolizer");if(A.geometry){this.writeNode("Geometry",A.geometry,B)}if(A.opacity){this.writeNode("Opacity",A.opacity,B)}if(A.colorMap){this.writeNode("ColorMap",A.colorMap,B)}return B},"Geometry":function(B){var A=this.createElementNSPlus("sld:Geometry");if(B.property){this.writeNode("ogc:PropertyName",B,A)}return A},"ColorMap":function(A){var C=this.createElementNSPlus("sld:ColorMap");for(var B=0,D=A.length;B<D;++B){this.writeNode("ColorMapEntry",A[B],C)}return C},"ColorMapEntry":function(A){var B=this.createElementNSPlus("sld:ColorMapEntry");var C=A;B.setAttribute("color",C.color);C.opacity!==undefined&&B.setAttribute("opacity",parseFloat(C.opacity));C.quantity!==undefined&&B.setAttribute("quantity",parseFloat(C.quantity));C.label!==undefined&&B.setAttribute("label",C.label);return B},"PolygonSymbolizer":function(A){var B=this.createElementNSPlus("sld:PolygonSymbolizer");if(A.fill!==false){this.writeNode("Fill",A,B)}if(A.stroke!==false){this.writeNode("Stroke",A,B)}return B},"Fill":function(A){var B=this.createElementNSPlus("sld:Fill");if(A.fillColor){this.writeNode("CssParameter",{symbolizer:A,key:"fillColor"},B)}if(A.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:A,key:"fillOpacity"},B)}return B},"PointSymbolizer":function(A){var B=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",A,B);return B},"Graphic":function(A){var B=this.createElementNSPlus("sld:Graphic");if(A.externalGraphic!=undefined){this.writeNode("ExternalGraphic",A,B)}else{this.writeNode("Mark",A,B)}if(A.graphicOpacity!=undefined){this.writeNode("Opacity",A.graphicOpacity,B)}if(A.pointRadius!=undefined){this.writeNode("Size",A.pointRadius*2,B)}else{if(A.graphicWidth!=undefined){this.writeNode("Size",A.graphicWidth,B)}}if(A.rotation!=undefined){this.writeNode("Rotation",A.rotation,B)}return B},"ExternalGraphic":function(B){var C=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",B.externalGraphic,C);var A=B.graphicFormat||this.getGraphicFormat(B.externalGraphic);this.writeNode("Format",A,C);return C},"Mark":function(A){var B=this.createElementNSPlus("sld:Mark");if(A.graphicName){this.writeNode("WellKnownName",A.graphicName,B)}if(A.fill!==false){this.writeNode("Fill",A,B)}if(A.stroke!==false){this.writeNode("Stroke",A,B)}return B},"WellKnownName":function(A){return this.createElementNSPlus("sld:WellKnownName",{value:A})},"Opacity":function(A){return this.createElementNSPlus("sld:Opacity",{value:A})},"Size":function(A){return this.writers.sld._OGCExpression.call(this,"sld:Size",A)},"Rotation":function(A){return this.createElementNSPlus("sld:Rotation",{value:A})},"OnlineResource":function(A){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":A}})},"Format":function(A){return this.createElementNSPlus("sld:Format",{value:A})}}},HGIS.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"HGIS.Format.SLD.v1"});HGIS.Layer.WMS=HGIS.Class(HGIS.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{},initialize:function(C,A,E,B){var D=[];E=HGIS.Util.upperCaseObject(E);if(parseFloat(E.VERSION)>=1.3&&!E.EXCEPTIONS){E.EXCEPTIONS="INIMAGE"}D.push(C,A,E,B);HGIS.Layer.Grid.prototype.initialize.apply(this,D);HGIS.Util.applyDefaults(this.params,HGIS.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((B==null)||(!B.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=HGIS.Util.alphaHack()?"image/gif":"image/png"}}},clone:function(A){if(A==null){A=new HGIS.Layer.WMS(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},reverseAxisOrder:function(){var A=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[A]||(HGIS.Projection.defaults[A]&&HGIS.Projection.defaults[A].yx))},getURL:function(B){B=this.adjustBounds(B);var E=this.getImageSize();var D={};var C=this.reverseAxisOrder();D.BBOX=this.encodeBBOX?B.toBBOX(null,C):B.toArray(C);D.WIDTH=E.w;D.HEIGHT=E.h;D.ZOOM=this.map.getZoom();var A=this.getFullRequestString(D);return A},mergeNewParams:function(B){var A=HGIS.Util.upperCaseObject(B);var C=[A];return HGIS.Layer.Grid.prototype.mergeNewParams.apply(this,C)},getFullRequestString:function(B,C){var D=this.map.getProjectionObject();var A=this.projection&&this.projection.equals(D)?this.projection.getCode():D.getCode();var E=(A=="none")?null:A;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=E}else{this.params.SRS=E}if(typeof this.params.TRANSPARENT=="boolean"){B.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return HGIS.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"HGIS.Layer.WMS"});HGIS.Layer.KaMap=HGIS.Class(HGIS.Layer.Grid,{isBaseLayer:true,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(C,A,D,B){HGIS.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=HGIS.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(C){C=this.adjustBounds(C);var B=this.map.getResolution();var E=Math.round((this.map.getScale()*10000))/10000;var A=Math.round(C.left/B);var D=-Math.round(C.top/B);return this.getFullRequestString({t:D,l:A,s:E})},calculateGridLayout:function(B,E,H){var C=H*this.tileSize.w;var F=H*this.tileSize.h;var G=B.left;var D=Math.floor(G/C)-this.buffer;var I=B.top;var A=Math.floor(I/F)+this.buffer;return{tilelon:C,tilelat:F,startcol:D,startrow:A}},getTileBoundsForGridIndex:function(G,H){var D=this.getTileOrigin();var A=this.gridLayout;var B=A.tilelon;var C=A.tilelat;var E=(A.startcol+H)*B;var F=(A.startrow-G)*C;return new HGIS.Bounds(E,F,E+B,F+C)},clone:function(A){if(A==null){A=new HGIS.Layer.KaMap(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);if(this.tileSize!=null){A.tileSize=this.tileSize.clone()}A.grid=[];return A},getTileBounds:function(B){var E=this.getResolution();var F=E*this.tileSize.w;var C=E*this.tileSize.h;var A=this.getLonLatFromViewPortPx(B);var D=F*Math.floor(A.lon/F);var G=C*Math.floor(A.lat/C);return new HGIS.Bounds(D,G,D+F,G+C)},CLASS_NAME:"HGIS.Layer.KaMap"});HGIS.Format.WMC.v1_1_0=HGIS.Class(HGIS.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(A){HGIS.Format.WMC.v1.prototype.initialize.apply(this,[A])},read_sld_MinScaleDenominator:function(C,B){var A=parseFloat(this.getChildValue(B));if(A>0){C.maxScale=A}},read_sld_MaxScaleDenominator:function(B,A){B.minScale=parseFloat(this.getChildValue(A))},read_wmc_SRS:function(B,A){if(!("srs" in B)){B.srs={}}B.srs[this.getChildValue(A)]=true},write_wmc_Layer:function(B){var C=HGIS.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[B]);if(B.maxScale){var A=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");A.appendChild(this.createTextNode(B.maxScale.toPrecision(16)));C.appendChild(A)}if(B.minScale){var E=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");E.appendChild(this.createTextNode(B.minScale.toPrecision(16)));C.appendChild(E)}if(B.srs){for(var D in B.srs){C.appendChild(this.createElementDefaultNS("SRS",D))}}C.appendChild(this.write_wmc_FormatList(B));C.appendChild(this.write_wmc_StyleList(B));if(B.dimensions){C.appendChild(this.write_wmc_DimensionList(B))}C.appendChild(this.write_wmc_LayerExtension(B));return C},CLASS_NAME:"HGIS.Format.WMC.v1_1_0"});HGIS.Format.XLS=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:true,CLASS_NAME:"HGIS.Format.XLS"});HGIS.Format.XLS.v1=HGIS.Class(HGIS.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},xy:true,defaultPrefix:"xls",schemaLocation:null,read:function(C,A){A=HGIS.Util.applyDefaults(A,this.options);var B={};this.readChildNodes(C,B);return B},readers:{"xls":{"XLS":function(A,B){B.version=A.getAttribute("version");this.readChildNodes(A,B)},"Response":function(A,B){this.readChildNodes(A,B)},"GeocodeResponse":function(A,B){B.responseLists=[];this.readChildNodes(A,B)},"GeocodeResponseList":function(B,C){var A={features:[],numberOfGeocodedAddresses:parseInt(B.getAttribute("numberOfGeocodedAddresses"))};C.responseLists.push(A);this.readChildNodes(B,A)},"GeocodedAddress":function(C,A){var B=new HGIS.Feature.Vector();A.features.push(B);this.readChildNodes(C,B);B.geometry=B.components[0]},"GeocodeMatchCode":function(B,A){A.attributes.matchCode={accuracy:parseFloat(B.getAttribute("accuracy")),matchType:B.getAttribute("matchType")}},"Address":function(C,A){var B={countryCode:C.getAttribute("countryCode"),addressee:C.getAttribute("addressee"),street:[],place:[]};A.attributes.address=B;this.readChildNodes(C,B)},"freeFormAddress":function(B,A){A.freeFormAddress=this.getChildValue(B)},"StreetAddress":function(B,A){this.readChildNodes(B,A)},"Building":function(B,A){A.building={"number":B.getAttribute("number"),subdivision:B.getAttribute("subdivision"),buildingName:B.getAttribute("buildingName")}},"Street":function(B,A){A.street.push(this.getChildValue(B))},"Place":function(B,A){A.place[B.getAttribute("type")]=this.getChildValue(B)},"PostalCode":function(B,A){A.postalCode=this.getChildValue(B)}},"gml":HGIS.Format.GML.v3.prototype.readers.gml},write:function(A){return this.writers.xls.XLS.apply(this,[A])},writers:{"xls":{"XLS":function(B){var A=this.createElementNSPlus("xls:XLS",{attributes:{"version":this.VERSION,"xsi:schemaLocation":this.schemaLocation}});this.writeNode("RequestHeader",B.header,A);this.writeNode("Request",B,A);return A},"RequestHeader":function(A){return this.createElementNSPlus("xls:RequestHeader")},"Request":function(A){var B=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:A.requestID||"",version:this.VERSION}});this.writeNode("GeocodeRequest",A.addresses,B);return B},"GeocodeRequest":function(D){var B=this.createElementNSPlus("xls:GeocodeRequest");for(var A=0,C=D.length;A<C;A++){this.writeNode("Address",D[A],B)}return B},"Address":function(A){var B=this.createElementNSPlus("xls:Address",{attributes:{countryCode:A.countryCode}});if(A.freeFormAddress){this.writeNode("freeFormAddress",A.freeFormAddress,B)}else{if(A.street){this.writeNode("StreetAddress",A,B)}if(A.municipality){this.writeNode("Municipality",A.municipality,B)}if(A.countrySubdivision){this.writeNode("CountrySubdivision",A.countrySubdivision,B)}if(A.postalCode){this.writeNode("PostalCode",A.postalCode,B)}}return B},"freeFormAddress":function(A){return this.createElementNSPlus("freeFormAddress",{value:A})},"StreetAddress":function(C){var D=this.createElementNSPlus("xls:StreetAddress");if(C.building){this.writeNode(D,"Building",C.building)}var A=C.street;if(!(HGIS.Util.isArray(A))){A=[A]}for(var B=0,E=A.length;B<E;B++){this.writeNode("Street",A[B],D)}return D},"Building":function(A){return this.createElementNSPlus("xls:Building",{attributes:{"number":A["number"],"subdivision":A.subdivision,"buildingName":A.buildingName}})},"Street":function(A){return this.createElementNSPlus("xls:Street",{value:A})},"Municipality":function(A){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:A})},"CountrySubdivision":function(A){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:A})},"PostalCode":function(A){return this.createElementNSPlus("xls:PostalCode",{value:A})}}},CLASS_NAME:"HGIS.Format.XLS.v1"});HGIS.Format.XLS.v1_1_0=HGIS.Class(HGIS.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"HGIS.Format.XLS.v1_1_0"});HGIS.Format.XLS.v1_1=HGIS.Format.XLS.v1_1_0;HGIS.Renderer.SVG=HGIS.Class(HGIS.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(A){if(!this.supported()){return}HGIS.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}},supported:function(){var A="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(A+"SVG","1.1")||document.implementation.hasFeature(A+"BasicStructure","1.1")))},inValidRange:function(D,E,B){var A=D+(B?0:this.translationParameters.x);var C=E+(B?0:this.translationParameters.y);return(A>=-this.MAX_PIXEL&&A<=this.MAX_PIXEL&&C>=-this.MAX_PIXEL&&C<=this.MAX_PIXEL)},setExtent:function(B,G){var E=HGIS.Renderer.Elements.prototype.setExtent.apply(this,arguments);var F=this.getResolution(),D=-B.left/F,C=B.top/F;if(G){this.left=D;this.top=C;var H="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",H);this.translate(this.xOffset,0);return true}else{var A=this.translate(D-this.left+this.xOffset,C-this.top);if(!A){this.setExtent(B,true)}return E&&A}},translate:function(A,B){if(!this.inValidRange(A,B,true)){return false}else{var C="";if(A||B){C="translate("+A+","+B+")"}this.root.setAttributeNS(null,"transform",C);this.translationParameters={x:A,y:B};return true}},setSize:function(A){HGIS.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(C,B){var A=null;switch(C.CLASS_NAME){case"HGIS.Geometry.Point":if(B.externalGraphic){A="image"}else{if(this.isComplexSymbol(B.graphicName)){A="svg"}else{A="circle"}}break;case"HGIS.Geometry.Rectangle":A="rect";break;case"HGIS.Geometry.LineString":A="polyline";break;case"HGIS.Geometry.LinearRing":A="polygon";break;case"HGIS.Geometry.Polygon":case"HGIS.Geometry.Curve":A="path";break;default:break}return A},setStyle:function(O,U,P){U=U||O._style;P=P||O._options;var J=U.title||U.graphicTitle;if(J){O.setAttributeNS(null,"title",J);var C=O.getElementsByTagName("title");if(C.length>0){C[0].firstChild.textContent=J}else{var R=this.nodeFactory(null,"title");R.textContent=J;O.appendChild(R)}}var A=parseFloat(O.getAttributeNS(null,"r"));var Q=1;var M;if(O._geometryClass=="HGIS.Geometry.Point"&&A){O.style.visibility="";if(U.graphic===false){O.style.visibility="hidden"}else{if(U.externalGraphic){M=this.getPosition(O);if(U.graphicWidth&&U.graphicHeight){O.setAttributeNS(null,"preserveAspectRatio","none")}var F=U.graphicWidth||U.graphicHeight;var S=U.graphicHeight||U.graphicWidth;F=F?F:U.pointRadius*2;S=S?S:U.pointRadius*2;var E=(U.graphicXOffset!=undefined)?U.graphicXOffset:-(0.5*F);var T=(U.graphicYOffset!=undefined)?U.graphicYOffset:-(0.5*S);var I=U.graphicOpacity||U.fillOpacity;O.setAttributeNS(null,"x",(M.x+E).toFixed());O.setAttributeNS(null,"y",(M.y+T).toFixed());O.setAttributeNS(null,"width",F);O.setAttributeNS(null,"height",S);O.setAttributeNS(this.xlinkns,"xlink:href",U.externalGraphic);O.setAttributeNS(null,"style","opacity: "+I);O.onclick=HGIS.Event.preventDefault}else{if(this.isComplexSymbol(U.graphicName)){var K=U.pointRadius*3;var D=K*2;var H=this.importSymbol(U.graphicName);M=this.getPosition(O);Q=this.symbolMetrics[H.id][0]*3/D;var N=O.parentNode;var B=O.nextSibling;if(N){N.removeChild(O)}O.firstChild&&O.removeChild(O.firstChild);O.appendChild(H.firstChild.cloneNode(true));O.setAttributeNS(null,"viewBox",H.getAttributeNS(null,"viewBox"));O.setAttributeNS(null,"width",D);O.setAttributeNS(null,"height",D);O.setAttributeNS(null,"x",M.x-K);O.setAttributeNS(null,"y",M.y-K);if(B){N.insertBefore(O,B)}else{if(N){N.appendChild(O)}}}else{if(U.pointRadius!=null&&U.pointRadius!=undefined&&U.pointRadius>=0){O.setAttributeNS(null,"r",U.pointRadius)}}}}var G=U.rotation;if((G!==undefined||O._rotation!==undefined)&&M){O._rotation=G;G|=0;if(O.nodeName!=="svg"){O.setAttributeNS(null,"transform","rotate("+G+" "+M.x+" "+M.y+")")}else{var L=this.symbolMetrics[H.id];O.firstChild.setAttributeNS(null,"transform","rotate("+G+" "+L[1]+" "+L[2]+")")}}}if(P.isFilled){O.setAttributeNS(null,"fill",U.fillColor);O.setAttributeNS(null,"fill-opacity",U.fillOpacity)}else{O.setAttributeNS(null,"fill","none")}if(P.isStroked){O.setAttributeNS(null,"stroke",U.strokeColor);O.setAttributeNS(null,"stroke-opacity",U.strokeOpacity);O.setAttributeNS(null,"stroke-width",U.strokeWidth*Q);if(U.strokeLinecap&&U.strokeLinecap!="butt"&&U.strokeLinecap!="square"){U.strokeLinecap=null}O.setAttributeNS(null,"stroke-linecap",U.strokeLinecap||"round");O.setAttributeNS(null,"stroke-linejoin","round");U.strokeDashstyle&&O.setAttributeNS(null,"stroke-dasharray",this.dashStyle(U,Q))}else{O.setAttributeNS(null,"stroke","none")}if(U.pointerEvents){O.setAttributeNS(null,"pointer-events",U.pointerEvents)}if(U.cursor!=null){O.setAttributeNS(null,"cursor",U.cursor)}return O},dashStyle:function(B,D){var C=B.strokeWidth*D;var A=B.strokeDashstyle;switch(A){case"solid":return"none";case"dot":return[1,4*C].join();case"dash":return[4*C,4*C].join();case"dashdot":return[4*C,4*C,1,4*C].join();case"longdash":return[8*C,4*C].join();case"longdashdot":return[8*C,4*C,1,4*C].join();default:return HGIS.String.trim(A).replace(/\s+/g,",")}},createNode:function(A,C){var B=document.createElementNS(this.xmlns,A);if(C){B.setAttributeNS(null,"id",C)}return B},nodeTypeCompare:function(B,A){return(A==B.nodeName)},createRenderRoot:function(){var A=this.nodeFactory(this.container.id+"_svgRoot","svg");A.style.display="block";return A},createRoot:function(A){return this.nodeFactory(this.container.id+A,"g")},createDefs:function(){var A=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(A);return A},drawPoint:function(A,B){return this.drawCircle(A,B,1)},drawCircle:function(A,B,D){var C=this.getResolution();var E=((B.x-this.featureDx)/C+this.left);var F=(this.top-B.y/C);if(this.inValidRange(E,F)){A.setAttributeNS(null,"cx",E);A.setAttributeNS(null,"cy",F);A.setAttributeNS(null,"r",D);return A}else{return false}},drawLineString:function(B,C){var A=this.getComponentsString(C.components);if(A.path){B.setAttributeNS(null,"points",A.path);return(A.complete?B:null)}else{return false}},drawLinearRing:function(B,C){var A=this.getComponentsString(C.components);if(A.path){B.setAttributeNS(null,"points",A.path);return(A.complete?B:null)}else{return false}},drawPolygon:function(D,B){var I="";var H=true;var F=true;var A,E;for(var C=0,G=B.components.length;C<G;C++){I+=" M";A=this.getComponentsString(B.components[C].components," ");E=A.path;if(E){I+=" "+E;F=A.complete&&F}else{H=false}}I+=" z";if(H){D.setAttributeNS(null,"d",I);D.setAttributeNS(null,"fill-rule","evenodd");return F?D:null}else{return false}},drawRectangle:function(A,B){var C=this.getResolution();var D=((B.x-this.featureDx)/C+this.left);var E=(this.top-B.y/C);if(this.inValidRange(D,E)){A.setAttributeNS(null,"x",D);A.setAttributeNS(null,"y",E);A.setAttributeNS(null,"width",B.width/C);A.setAttributeNS(null,"height",B.height/C);return A}else{return false}},drawText:function(M,V,B){var Q=(!!V.labelOutlineWidth);if(Q){var J=HGIS.Util.extend({},V);J.fontColor=J.labelOutlineColor;J.fontStrokeColor=J.labelOutlineColor;J.fontStrokeWidth=V.labelOutlineWidth;if(!isNaN(V.labelOutlineOpacity)){J.fontOpacity=V.labelOutlineOpacity}delete J.labelOutlineWidth;this.drawText(M,J,B)}var N=this.getResolution();var S=((B.x-this.featureDx)/N+this.left);var T=(B.y/N-this.top);var C=(Q)?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX;var R=this.nodeFactory(M+C,"text");R.setAttributeNS(null,"x",S);R.setAttributeNS(null,"y",-T);if(V.fontColor){R.setAttributeNS(null,"fill",V.fontColor)}if(V.fontStrokeColor){R.setAttributeNS(null,"stroke",V.fontStrokeColor)}if(V.fontStrokeWidth){R.setAttributeNS(null,"stroke-width",V.fontStrokeWidth)}if(!isNaN(V.fontOpacity)){R.setAttributeNS(null,"opacity",V.fontOpacity)}if(V.fontFamily){R.setAttributeNS(null,"font-family",V.fontFamily)}if(V.fontSize){R.setAttributeNS(null,"font-size",V.fontSize)}if(V.fontWeight){R.setAttributeNS(null,"font-weight",V.fontWeight)}if(V.fontStyle){R.setAttributeNS(null,"font-style",V.fontStyle)}if(V.labelSelect===true){R.setAttributeNS(null,"pointer-events","visible");R._featureId=M}else{R.setAttributeNS(null,"pointer-events","none")}var A=V.labelAlign||HGIS.Renderer.defaultSymbolizer.labelAlign;R.setAttributeNS(null,"text-anchor",HGIS.Renderer.SVG.LABEL_ALIGN[A[0]]||"middle");if(HGIS.IS_GECKO===true){R.setAttributeNS(null,"dominant-baseline",HGIS.Renderer.SVG.LABEL_ALIGN[A[1]]||"central")}var D=V.label.split("\n");var I=D.length;while(R.childNodes.length>I){R.removeChild(R.lastChild)}for(var E=0;E<I;E++){var G=this.nodeFactory(M+C+"_tspan_"+E,"tspan");if(V.labelSelect===true){G._featureId=M;G._geometry=B;G._geometryClass=B.CLASS_NAME}if(HGIS.IS_GECKO===false){G.setAttributeNS(null,"baseline-shift",HGIS.Renderer.SVG.LABEL_VSHIFT[A[1]]||"-35%")}G.setAttribute("x",S);if(E==0){var F=HGIS.Renderer.SVG.LABEL_VFACTOR[A[1]];if(F==null){F=-0.5}G.setAttribute("dy",(F*(I-1))+"em")}else{G.setAttribute("dy","1em")}G.textContent=(D[E]==="")?" ":D[E];if(!G.parentNode){R.appendChild(G)}}if(!R.parentNode){this.vectorRoot.appendChild(R)}if(V.labelBackgroundColor||V.labelBorderColor||V.labelBorderSize){var U=this.nodeFactory(M+this.LABEL_ID_SUFFIX+"_bg","rect");if(V.labelBackgroundColor){U.setAttributeNS(null,"fill",V.labelBackgroundColor)}if(V.labelBorderColor||V.labelBorderSize){U.setAttributeNS(null,"stroke",(V.labelBorderColor?V.labelBorderColor:"#000000"));U.setAttributeNS(null,"stroke-width",(V.labelBorderSize?V.labelBorderSize:"0.5"))}var K=R.getBBox();var O=K.width;var P=K.height;var L=2;if(V.labelPadding){var H=V.labelPadding.indexOf("px");if(H==-1){L=V.labelPadding}else{L=parseInt(V.labelPadding.substr(0,H))}}U.setAttributeNS(null,"x",K.x-L);U.setAttributeNS(null,"y",K.y-L);U.setAttributeNS(null,"height",(P+L*2)+"px");U.setAttributeNS(null,"width",(O+L*2)+"px");this.vectorRoot.insertBefore(U,R)}},getComponentsString:function(D,B){var A=[];var G=true;var H=D.length;var I=[];var C,E;for(var F=0;F<H;F++){E=D[F];A.push(E);C=this.getShortString(E);if(C){I.push(C)}else{if(F>0){if(this.getShortString(D[F-1])){I.push(this.clipLine(D[F],D[F-1]))}}if(F<H-1){if(this.getShortString(D[F+1])){I.push(this.clipLine(D[F],D[F+1]))}}G=false}}return{path:I.join(B||","),complete:G}},clipLine:function(A,I){if(I.equals(A)){return""}var J=this.getResolution();var D=this.MAX_PIXEL-this.translationParameters.x;var G=this.MAX_PIXEL-this.translationParameters.y;var B=(I.x-this.featureDx)/J+this.left;var C=this.top-I.y/J;var E=(A.x-this.featureDx)/J+this.left;var F=this.top-A.y/J;var H;if(E<-D||E>D){H=(F-C)/(E-B);E=E<0?-D:D;F=C+(E-B)*H}if(F<-G||F>G){H=(E-B)/(F-C);F=F<0?-G:G;E=B+(F-C)*H}return E+","+F},getShortString:function(A){var C=this.getResolution();var B=((A.x-this.featureDx)/C+this.left);var D=(this.top-A.y/C);return B+","+D},getPosition:function(A){return({x:parseFloat(A.getAttributeNS(null,"cx")),y:parseFloat(A.getAttributeNS(null,"cy"))})},importSymbol:function(K){if(!this.defs){this.defs=this.createDefs()}var H=this.container.id+"-"+K;var D=document.getElementById(H);if(D!=null){return D}var C=HGIS.Renderer.symbol[K];if(!C){throw new Error(K+" is not a valid symbol name")}var F=this.nodeFactory(H,"symbol");var G=this.nodeFactory(null,"polygon");F.appendChild(G);var N=new HGIS.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var I=[];var L,J;for(var E=0;E<C.length;E=E+2){L=C[E];J=C[E+1];N.left=Math.min(N.left,L);N.bottom=Math.min(N.bottom,J);N.right=Math.max(N.right,L);N.top=Math.max(N.top,J);I.push(L,",",J)}G.setAttributeNS(null,"points",I.join(" "));var B=N.getWidth();var A=N.getHeight();var M=[N.left-B,N.bottom-A,B*3,A*3];F.setAttributeNS(null,"viewBox",M.join(" "));this.symbolMetrics[H]=[Math.max(B,A),N.getCenterLonLat().lon,N.getCenterLonLat().lat];this.defs.appendChild(F);return F},getFeatureIdFromEvent:function(B){var A=HGIS.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!A){var C=B.target;A=C.parentNode&&C!=this.rendererRoot?C.parentNode._featureId:undefined}return A},CLASS_NAME:"HGIS.Renderer.SVG"});HGIS.Renderer.SVG.LABEL_ALIGN={"l":"start","r":"end","b":"bottom","t":"hanging"};HGIS.Renderer.SVG.LABEL_VSHIFT={"t":"-70%","b":"0"};HGIS.Renderer.SVG.LABEL_VFACTOR={"t":0,"b":-1};HGIS.Renderer.SVG.preventDefault=function(A){HGIS.Event.preventDefault(A)};HGIS.Format.SLD.v1_0_0=HGIS.Class(HGIS.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"HGIS.Format.SLD.v1_0_0"});HGIS.Format.OWSContext=HGIS.Class(HGIS.Format.Context,{defaultVersion:"0.3.1",getVersion:function(A,B){var C=HGIS.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);if(C==="0.3.0"){C=this.defaultVersion}return C},toContext:function(B){var A={};if(B.CLASS_NAME=="HGIS.Map"){A.bounds=B.getExtent();A.maxExtent=B.maxExtent;A.projection=B.projection;A.size=B.getSize();A.layers=B.layers}return A},CLASS_NAME:"HGIS.Format.OWSContext"});HGIS.Format.OWSContext.v0_3_1=HGIS.Class(HGIS.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:true,xy:true,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A]);HGIS.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(C){if(C.layersContext){for(var B=0,D=C.layersContext.length;B<D;B++){var F=C.layersContext[B];var E=[];var A=C.title||"";if(C.metadata&&C.metadata.nestingPath){E=C.metadata.nestingPath.slice()}if(A!=""){E.push(A)}F.metadata.nestingPath=E;if(F.layersContext){this.setNestingPath(F)}}}},decomposeNestingPath:function(A){var B=[];if(HGIS.Util.isArray(A)){var C=A.slice();while(C.length>0){B.push(C.slice());C.pop()}B.reverse()}return B},read:function(C){if(typeof C=="string"){C=HGIS.Format.XML.prototype.read.apply(this,[C])}if(C&&C.nodeType==9){C=C.documentElement}var A={};this.readNode(C,A);this.setNestingPath({layersContext:A.layersContext});var B=[];this.processLayer(B,A);delete A.layersContext;A.layersContext=B;return A},processLayer:function(A,D){if(D.layersContext){for(var B=0,E=D.layersContext.length;B<E;B++){var C=D.layersContext[B];A.push(C);if(C.layersContext){this.processLayer(A,C)}}}},write:function(A,C){var D="OWSContext";this.nestingLayerLookup={};C=C||{};HGIS.Util.applyDefaults(C,A);var B=this.writeNode(D,C);this.nestingLayerLookup=null;this.setAttributeNS(B,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[B])},readers:{"kml":{"Document":function(B,A){A.features=new HGIS.Format.KML({kmlns:this.namespaces.kml,extractStyles:true}).read(B)}},"owc":{"OWSContext":function(B,A){this.readChildNodes(B,A)},"General":function(B,A){this.readChildNodes(B,A)},"ResourceList":function(B,A){this.readChildNodes(B,A)},"Layer":function(B,A){var C={metadata:{},visibility:(B.getAttribute("hidden")!="1"),queryable:(B.getAttribute("queryable")=="1"),opacity:((B.getAttribute("opacity")!=null)?parseFloat(B.getAttribute("opacity")):null),name:B.getAttribute("name"),categoryLayer:(B.getAttribute("name")==null),formats:[],styles:[]};if(!A.layersContext){A.layersContext=[]}A.layersContext.push(C);this.readChildNodes(B,C)},"InlineGeometry":function(D,B){B.features=[];var C=this.getElementsByTagNameNS(D,this.namespaces.gml,"featureMember");var A;if(C.length>=1){A=C[0]}if(A&&A.firstChild){var E=(A.firstChild.nextSibling)?A.firstChild.nextSibling:A.firstChild;this.setNamespace("feature",E.namespaceURI);this.featureType=E.localName||E.nodeName.split(":").pop();this.readChildNodes(D,B)}},"Server":function(B,A){if((!A.service&&!A.version)||(A.service!=HGIS.Format.Context.serviceTypes.WMS)){A.service=B.getAttribute("service");A.version=B.getAttribute("version");this.readChildNodes(B,A)}},"Name":function(B,A){A.name=this.getChildValue(B);this.readChildNodes(B,A)},"Title":function(B,A){A.title=this.getChildValue(B);this.readChildNodes(B,A)},"StyleList":function(B,A){this.readChildNodes(B,A.styles)},"Style":function(B,A){var C={};A.push(C);this.readChildNodes(B,C)},"LegendURL":function(C,A){var B={};A.legend=B;this.readChildNodes(C,B)},"OnlineResource":function(B,A){A.url=this.getAttributeNS(B,this.namespaces.xlink,"href");this.readChildNodes(B,A)}},"ows":HGIS.Format.OWSCommon.v1_0_0.prototype.readers.ows,"gml":HGIS.Format.GML.v2.prototype.readers.gml,"sld":HGIS.Format.SLD.v1_0_0.prototype.readers.sld,"feature":HGIS.Format.GML.v2.prototype.readers.feature},writers:{"owc":{"OWSContext":function(B){var A=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:B.id||HGIS.Util.createUniqueID("HGIS_OWSContext_")}});this.writeNode("General",B,A);this.writeNode("ResourceList",B,A);return A},"General":function(B){var A=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",B,A);this.writeNode("ows:Title",B.title||"HGIS OWSContext",A);return A},"ResourceList":function(E){var D=this.createElementNSPlus("ResourceList");for(var B=0,F=E.layers.length;B<F;B++){var A=E.layers[B];var C=this.decomposeNestingPath(A.metadata.nestingPath);this.writeNode("_Layer",{layer:A,subPaths:C},D)}return D},"Server":function(B){var A=this.createElementNSPlus("Server",{attributes:{version:B.version,service:B.service}});this.writeNode("OnlineResource",B,A);return A},"OnlineResource":function(B){var A=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":B.url}});return A},"InlineGeometry":function(C){var B=this.createElementNSPlus("InlineGeometry"),E=C.getDataExtent();if(E!==null){this.writeNode("gml:boundedBy",E,B)}for(var A=0,D=C.features.length;A<D;A++){this.writeNode("gml:featureMember",C.features[A],B)}return B},"StyleList":function(C){var B=this.createElementNSPlus("StyleList");for(var A=0,D=C.length;A<D;A++){this.writeNode("Style",C[A],B)}return B},"Style":function(B){var A=this.createElementNSPlus("Style");this.writeNode("Name",B,A);this.writeNode("Title",B,A);if(B.legend){this.writeNode("LegendURL",B,A)}return A},"Name":function(A){var B=this.createElementNSPlus("Name",{value:A.name});return B},"Title":function(A){var B=this.createElementNSPlus("Title",{value:A.title});return B},"LegendURL":function(B){var A=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",B.legend,A);return A},"_WMS":function(B){var A=this.createElementNSPlus("Layer",{attributes:{name:B.params.LAYERS,queryable:B.queryable?"1":"0",hidden:B.visibility?"0":"1",opacity:B.hasOwnProperty("opacity")?B.opacity:null}});this.writeNode("ows:Title",B.name,A);this.writeNode("ows:OutputFormat",B.params.FORMAT,A);this.writeNode("Server",{service:HGIS.Format.Context.serviceTypes.WMS,version:B.params.VERSION,url:B.url},A);if(B.metadata.styles&&B.metadata.styles.length>0){this.writeNode("StyleList",B.metadata.styles,A)}return A},"_Layer":function(D){var A,B,C,E;A=D.layer;B=D.subPaths;C=null;E=null;if(B.length>0){var G=B[0].join("/");var F=G.lastIndexOf("/");C=this.nestingLayerLookup[G];E=(F>0)?G.substring(F+1,G.length):G;if(!C){C=this.createElementNSPlus("Layer");this.writeNode("ows:Title",E,C);this.nestingLayerLookup[G]=C}D.subPaths.shift();this.writeNode("_Layer",D,C);return C}else{if(A instanceof HGIS.Layer.WMS){C=this.writeNode("_WMS",A)}else{if(A instanceof HGIS.Layer.Vector){if(A.protocol instanceof HGIS.Protocol.WFS.v1){C=this.writeNode("_WFS",A)}else{if(A.protocol instanceof HGIS.Protocol.HTTP){if(A.protocol.format instanceof HGIS.Format.GML){A.protocol.format.version="2.1.2";C=this.writeNode("_GML",A)}else{if(A.protocol.format instanceof HGIS.Format.KML){A.protocol.format.version="2.2";C=this.writeNode("_KML",A)}}}else{this.setNamespace("feature",this.featureNS);C=this.writeNode("_InlineGeometry",A)}}}}if(A.options.maxScale){this.writeNode("sld:MinScaleDenominator",A.options.maxScale,C)}if(A.options.minScale){this.writeNode("sld:MaxScaleDenominator",A.options.minScale,C)}this.nestingLayerLookup[A.name]=C;return C}},"_WFS":function(B){var A=this.createElementNSPlus("Layer",{attributes:{name:B.protocol.featurePrefix+":"+B.protocol.featureType,hidden:B.visibility?"0":"1"}});this.writeNode("ows:Title",B.name,A);this.writeNode("Server",{service:HGIS.Format.Context.serviceTypes.WFS,version:B.protocol.version,url:B.protocol.url},A);return A},"_InlineGeometry":function(B){var A=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:B.visibility?"0":"1"}});this.writeNode("ows:Title",B.name,A);this.writeNode("InlineGeometry",B,A);return A},"_GML":function(B){var A=this.createElementNSPlus("Layer");this.writeNode("ows:Title",B.name,A);this.writeNode("Server",{service:HGIS.Format.Context.serviceTypes.GML,url:B.protocol.url,version:B.protocol.format.version},A);return A},"_KML":function(B){var A=this.createElementNSPlus("Layer");this.writeNode("ows:Title",B.name,A);this.writeNode("Server",{service:HGIS.Format.Context.serviceTypes.KML,version:B.protocol.format.version,url:B.protocol.url},A);return A}},"gml":HGIS.Util.applyDefaults({"boundedBy":function(A){var B=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",A,B);return B}},HGIS.Format.GML.v2.prototype.writers.gml),"ows":HGIS.Format.OWSCommon.v1_0_0.prototype.writers.ows,"sld":HGIS.Format.SLD.v1_0_0.prototype.writers.sld,"feature":HGIS.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"HGIS.Format.OWSContext.v0_3_1"});HGIS.Popup=HGIS.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new HGIS.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(G,B,D,E,C,F){if(G==null){G=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=G;this.lonlat=B;this.contentSize=(D!=null)?D:new HGIS.Size(HGIS.Popup.WIDTH,HGIS.Popup.HEIGHT);if(E!=null){if(E!=undefined){this.contentHTML=E}else{this.contentHTML=""}}this.backgroundColor=HGIS.Popup.COLOR;this.opacity=HGIS.Popup.OPACITY;this.border=HGIS.Popup.BORDER;this.div=HGIS.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var A=this.id+"_GroupDiv";this.groupDiv=HGIS.Util.createDiv(A,null,null,null,"relative",null,"hidden");var G=this.div.id+"_contentDiv";this.contentDiv=HGIS.Util.createDiv(G,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(C){this.addCloseBox(F)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){HGIS.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(A){if(A==null){if((this.lonlat!=null)&&(this.map!=null)){A=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(!this.disableFirefoxOverflowHack&&HGIS.BROWSER_NAME=="firefox"){this.map.events.register("movestart",this,function(){var C=document.defaultView.getComputedStyle(this.contentDiv,null);var B=C.getPropertyValue("overflow");if(B!="hidden"){this.contentDiv._oldOverflow=B;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var B=this.contentDiv._oldOverflow;if(B){this.contentDiv.style.overflow=B;this.contentDiv._oldOverflow=null}})}this.moveTo(A);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if((this.lonlat)&&(this.map)){var A=this.map.getLayerPxFromLonLat(this.lonlat);if(A){this.moveTo(A)}}},moveTo:function(A){if((A!=null)&&(this.div!=null)){this.div.style.left=A.x+"px";this.div.style.top=A.y+"px"}},visible:function(){return HGIS.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){this.div.style.display="";if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){this.div.style.display="none"},setSize:function(E){this.size=E.clone();var A=this.getContentDivPadding();var C=A.left+A.right;var B=A.top+A.bottom;this.fixPadding();C+=this.padding.left+this.padding.right;B+=this.padding.top+this.padding.bottom;if(this.closeDiv){var D=parseInt(this.closeDiv.style.width);C+=D+A.right}this.size.w+=C;this.size.h+=B;if(HGIS.BROWSER_NAME=="msie"){this.contentSize.w+=A.left+A.right;this.contentSize.h+=A.bottom+A.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=E.w+"px";this.contentDiv.style.height=E.h+"px"}},updateSize:function(){var I="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var H=(this.map)?this.map.div:document.body;var F=HGIS.Util.getRenderedDimensions(I,null,{displayClass:this.displayClass,containerElement:H});var B=this.getSafeContentSize(F);var C=null;if(B.equals(F)){C=F}else{var D={w:(B.w<F.w)?B.w:null,h:(B.h<F.h)?B.h:null};if(D.w&&D.h){C=B}else{var A=HGIS.Util.getRenderedDimensions(I,D,{displayClass:this.contentDisplayClass,containerElement:H});var E=HGIS.Element.getStyle(this.contentDiv,"overflow");if((E!="hidden")&&(A.equals(B))){var G=HGIS.Util.getScrollbarWidth();if(D.w){A.h+=G}else{A.w+=G}}C=this.getSafeContentSize(A)}}this.setSize(C)},setBackgroundColor:function(A){if(A!=undefined){this.backgroundColor=A}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(A){if(A!=undefined){this.opacity=A}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(A){if(A!=undefined){this.border=A}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(A){if(A!=null){this.contentHTML=A}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var D=function(){if(this.popup.id===null){return}this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}HGIS.Event.stopObserving(this.img,"load",this.img._onImgLoad)};var F=this.contentDiv.getElementsByTagName("img");for(var B=0,E=F.length;B<E;B++){var C=F[B];if(C.width==0||C.height==0){var A={"popup":this,"img":C};C._onImgLoad=HGIS.Function.bind(D,A);HGIS.Event.observe(C,"load",C._onImgLoad)}}},getSafeContentSize:function(C){var D=C.clone();var G=this.getContentDivPadding();var K=G.left+G.right;var B=G.top+G.bottom;this.fixPadding();K+=this.padding.left+this.padding.right;B+=this.padding.top+this.padding.bottom;if(this.closeDiv){var A=parseInt(this.closeDiv.style.width);K+=A+G.right}if(this.minSize){D.w=Math.max(D.w,(this.minSize.w-K));D.h=Math.max(D.h,(this.minSize.h-B))}if(this.maxSize){D.w=Math.min(D.w,(this.maxSize.w-K));D.h=Math.min(D.h,(this.maxSize.h-B))}if(this.map&&this.map.size){var I=0,H=0;if(this.keepInMap&&!this.panMapIfOutOfView){var J=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":I=J.x;H=this.map.size.h-J.y;break;case"tl":I=this.map.size.w-J.x;H=this.map.size.h-J.y;break;case"bl":I=this.map.size.w-J.x;H=J.y;break;case"br":I=J.x;H=J.y;break;default:I=J.x;H=this.map.size.h-J.y;break}}var F=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-B-H;var E=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-K-I;D.w=Math.min(D.w,E);D.h=Math.min(D.h,F)}return D},getContentDivPadding:function(){var A=this._contentDivPadding;if(!A){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}A=new HGIS.Bounds(HGIS.Element.getStyle(this.contentDiv,"padding-left"),HGIS.Element.getStyle(this.contentDiv,"padding-bottom"),HGIS.Element.getStyle(this.contentDiv,"padding-right"),HGIS.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=A;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return A},addCloseBox:function(A){this.closeDiv=HGIS.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var B=this.getContentDivPadding();this.closeDiv.style.right=B.right+"px";this.closeDiv.style.top=B.top+"px";this.groupDiv.appendChild(this.closeDiv);var D=function(E){this.hide();HGIS.Event.stop(E)};if(A){var C=this;D=function(E){C.hide();HGIS.Event.stop(E);A()}}HGIS.Event.observe(this.closeDiv,"touchend",HGIS.Function.bindAsEventListener(D,this));HGIS.Event.observe(this.closeDiv,"click",HGIS.Function.bindAsEventListener(D,this))},panIntoView:function(){var A=this.calculateOffset();this.map.pan(A[0],A[1])},calculateOffset:function(){var A=this.map.getSize();var D=this.map.getViewPortPxFromLayerPx(new HGIS.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var C=D.clone();if(D.x<this.map.paddingForPopups.left){C.x=this.map.paddingForPopups.left}else{if((D.x+this.size.w)>(A.w-this.map.paddingForPopups.right)){C.x=A.w-this.map.paddingForPopups.right-this.size.w}}if(D.y<this.map.paddingForPopups.top){C.y=this.map.paddingForPopups.top}else{if((D.y+this.size.h)>(A.h-this.map.paddingForPopups.bottom)){C.y=A.h-this.map.paddingForPopups.bottom-this.size.h}}var B=D.x-C.x;var E=D.y-C.y;var F=new Array(B,E);return F},registerEvents:function(){this.events=new HGIS.Events(this,this.div,null,true);function A(B){HGIS.Event.stop(B,true)}this.events.on({"mousedown":this.onmousedown,"mousemove":this.onmousemove,"mouseup":this.onmouseup,"click":this.onclick,"mouseout":this.onmouseout,"dblclick":this.ondblclick,"touchstart":A,scope:this})},onmousedown:function(A){this.mousedown=true;HGIS.Event.stop(A,true)},onmousemove:function(A){if(this.mousedown){HGIS.Event.stop(A,true)}},onmouseup:function(A){if(this.mousedown){this.mousedown=false;HGIS.Event.stop(A,true)}},onclick:function(A){HGIS.Event.stop(A,true)},onmouseout:function(A){this.mousedown=false},ondblclick:function(A){HGIS.Event.stop(A,true)},CLASS_NAME:"HGIS.Popup"});HGIS.Popup.WIDTH=200;HGIS.Popup.HEIGHT=200;HGIS.Popup.COLOR="white";HGIS.Popup.OPACITY=1;HGIS.Popup.BORDER="0px";HGIS.Control.ScaleLine=HGIS.Class(HGIS.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var A=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(E){var A=parseInt(Math.log(E)/Math.log(10));var B=Math.pow(10,A);var D=parseInt(E/B);var C;if(D>5){C=5}else{if(D>2){C=2}else{C=1}}return C*B},update:function(){var M=this.map.getResolution();if(!M){return}var L=this.map.getUnits();var F=HGIS.INCHES_PER_UNIT;var A=this.maxWidth*M*F[L];var N=1;if(this.geodesic===true){var O=(this.map.getGeodesicPixelSize().w||1e-06)*this.maxWidth;var D=A/F["km"];N=O/D;A*=N}var I;var H;if(A>100000){I=this.topOutUnits;H=this.bottomOutUnits}else{I=this.topInUnits;H=this.bottomInUnits}var C=A/F[I];var K=A/F[H];var G=this.getBarLen(C);var E=this.getBarLen(K);C=G/F[L]*F[I];K=E/F[L]*F[H];var J=C/M/N;var B=K/M/N;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(B)+"px";this.eBottom.innerHTML=E+" "+H}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(J)+"px";this.eTop.innerHTML=G+" "+I}},CLASS_NAME:"HGIS.Control.ScaleLine"});HGIS.Icon=HGIS.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(C,A,B,D){this.url=C;this.size=A||{w:20,h:20};this.offset=B||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=D;var E=HGIS.Util.createUniqueID("OL_Icon_");this.imageDiv=HGIS.Util.createAlphaImageDiv(E)},destroy:function(){this.erase();HGIS.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new HGIS.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(A){if(A!=null){this.size=A}this.draw()},setUrl:function(A){if(A!=null){this.url=A}this.draw()},draw:function(A){HGIS.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(A);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){HGIS.Element.remove(this.imageDiv)}},setOpacity:function(A){HGIS.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,A)},moveTo:function(A){if(A!=null){this.px=A}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}HGIS.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}}},display:function(A){this.imageDiv.style.display=(A)?"":"none"},isDrawn:function(){var A=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return A},CLASS_NAME:"HGIS.Icon"});HGIS.Marker=HGIS.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(A,C){this.lonlat=A;var B=(C)?C:HGIS.Marker.defaultIcon();if(this.icon==null){this.icon=B}else{this.icon.url=B.url;this.icon.size=B.size;this.icon.offset=B.offset;this.icon.calculateOffset=B.calculateOffset}this.events=new HGIS.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(A){return this.icon.draw(A)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(A){if((A!=null)&&(this.icon!=null)){this.icon.moveTo(A)}this.lonlat=this.map.getLonLatFromLayerPx(A)},isDrawn:function(){var A=(this.icon&&this.icon.isDrawn());return A},onScreen:function(){var B=false;if(this.map){var A=this.map.getExtent();B=A.containsLonLat(this.lonlat)}return B},inflate:function(A){if(this.icon){this.icon.setSize({w:this.icon.size.w*A,h:this.icon.size.h*A})}},setOpacity:function(A){this.icon.setOpacity(A)},setUrl:function(A){this.icon.setUrl(A)},display:function(A){this.icon.display(A)},CLASS_NAME:"HGIS.Marker"});HGIS.Marker.defaultIcon=function(){return new HGIS.Icon(HGIS.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};HGIS.Layer.TileCache=HGIS.Class(HGIS.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(C,A,D,B){this.layername=D;HGIS.Layer.Grid.prototype.initialize.apply(this,[C,A,{},B]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension},clone:function(A){if(A==null){A=new HGIS.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(D){var E=this.getServerResolution();var J=this.maxExtent;var F=this.tileSize;var B=Math.round((D.left-J.left)/(E*F.w));var C=Math.round((D.bottom-J.bottom)/(E*F.h));var A=this.serverResolutions!=null?HGIS.Util.indexOf(this.serverResolutions,E):this.map.getZoom();var G=[this.layername,HGIS.Number.zeroPad(A,2),HGIS.Number.zeroPad(parseInt(B/1000000),3),HGIS.Number.zeroPad((parseInt(B/1000)%1000),3),HGIS.Number.zeroPad((parseInt(B)%1000),3),HGIS.Number.zeroPad(parseInt(C/1000000),3),HGIS.Number.zeroPad((parseInt(C/1000)%1000),3),HGIS.Number.zeroPad((parseInt(C)%1000),3)+"."+this.extension];var H=G.join("/");var I=this.url;if(HGIS.Util.isArray(I)){I=this.selectUrl(H,I)}I=(I.charAt(I.length-1)=="/")?I:I+"/";return I+H},CLASS_NAME:"HGIS.Layer.TileCache"});HGIS.Strategy.Paging=HGIS.Class(HGIS.Strategy,{features:null,length:10,num:null,paging:false,activate:function(){var A=HGIS.Strategy.prototype.activate.call(this);if(A){this.layer.events.on({"beforefeaturesadded":this.cacheFeatures,scope:this})}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){this.clearCache();this.layer.events.un({"beforefeaturesadded":this.cacheFeatures,scope:this})}return A},cacheFeatures:function(A){if(!this.paging){this.clearCache();this.features=A.features;this.pageNext(A)}},clearCache:function(){if(this.features){for(var A=0;A<this.features.length;++A){this.features[A].destroy()}}this.features=null;this.num=null},pageCount:function(){var A=this.features?this.features.length:0;return Math.ceil(A/this.length)},pageNum:function(){return this.num},pageLength:function(A){if(A&&A>0){this.length=A}return this.length},pageNext:function(A){var C=false;if(this.features){if(this.num===null){this.num=-1}var B=(this.num+1)*this.length;C=this.page(B,A)}return C},pagePrevious:function(){var B=false;if(this.features){if(this.num===null){this.num=this.pageCount()}var A=(this.num-1)*this.length;B=this.page(A)}return B},page:function(D,C){var E=false;if(this.features){if(D>=0&&D<this.features.length){var B=Math.floor(D/this.length);if(B!=this.num){this.paging=true;var A=this.features.slice(D,D+this.length);this.layer.removeFeatures(this.layer.features);this.num=B;if(C&&C.features){C.features=A}else{this.layer.addFeatures(A)}this.paging=false;E=true}}}return E},CLASS_NAME:"HGIS.Strategy.Paging"});HGIS.Control.DragFeature=HGIS.Class(HGIS.Control,{geometryTypes:null,onStart:function(B,A){},onDrag:function(B,A){},onComplete:function(B,A){},onEnter:function(A){},onLeave:function(A){},documentDrag:false,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(B,A){HGIS.Control.prototype.initialize.apply(this,[A]);this.layer=B;this.handlers={drag:new HGIS.Handler.Drag(this,HGIS.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new HGIS.Handler.Feature(this,this.layer,HGIS.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(A){if(this.handlers.feature.touch&&!this.over&&this.overFeature(A)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=false}},clickoutFeature:function(A){if(this.handlers.feature.touch&&this.over){this.outFeature(A);this.handlers.drag.stopDown=true}},destroy:function(){this.layer=null;HGIS.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&HGIS.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;HGIS.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return HGIS.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(A){var B=false;if(!this.handlers.drag.dragging){this.feature=A;this.handlers.drag.activate();B=true;this.over=true;HGIS.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(A)}else{if(this.feature.id==A.id){this.over=true}else{this.over=false}}return B},downFeature:function(A){this.lastPixel=A;this.onStart(this.feature,A)},moveFeature:function(A){var B=this.map.getResolution();this.feature.geometry.move(B*(A.x-this.lastPixel.x),B*(this.lastPixel.y-A.y));this.layer.drawFeature(this.feature);this.lastPixel=A;this.onDrag(this.feature,A)},upFeature:function(A){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(A){this.onComplete(this.feature,A)},outFeature:function(A){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();HGIS.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(A);this.feature=null}else{if(this.feature.id==A.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(A){this.handlers.drag.setMap(A);this.handlers.feature.setMap(A);HGIS.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"HGIS.Control.DragFeature"});HGIS.Control.TransformFeature=HGIS.Class(HGIS.Control,{geometryTypes:null,layer:null,preserveAspectRatio:false,rotate:true,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:false,initialize:function(B,A){HGIS.Control.prototype.initialize.apply(this,[A]);this.layer=B;if(!this.rotationHandleSymbolizer){this.rotationHandleSymbolizer={stroke:false,pointRadius:10,fillOpacity:0,cursor:"pointer"}}this.createBox();this.createControl()},activate:function(){var A=false;if(HGIS.Control.prototype.activate.apply(this,arguments)){this.dragControl.activate();this.layer.addFeatures([this.box]);this.rotate&&this.layer.addFeatures(this.rotationHandles);this.layer.addFeatures(this.handles);A=true}return A},deactivate:function(){var A=false;if(HGIS.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.handles);this.rotate&&this.layer.removeFeatures(this.rotationHandles);this.layer.removeFeatures([this.box]);this.dragControl.deactivate();A=true}return A},setMap:function(A){this.dragControl.setMap(A);HGIS.Control.prototype.setMap.apply(this,arguments)},setFeature:function(B,D){D=HGIS.Util.applyDefaults(D,{rotation:0,scale:1,ratio:1});var G=this.rotation;var H=this.center;HGIS.Util.extend(this,D);var J=this.events.triggerEvent("beforesetfeature",{feature:B});if(J===false){return}this.feature=B;this.activate();this._setfeature=true;var I=this.feature.geometry.getBounds();this.box.move(I.getCenterLonLat());this.box.geometry.rotate(-G,H);this._angle=0;var A;if(this.rotation){var F=B.geometry.clone();F.rotate(-this.rotation,this.center);var E=new HGIS.Feature.Vector(F.getBounds().toGeometry());E.geometry.rotate(this.rotation,this.center);this.box.geometry.rotate(this.rotation,this.center);this.box.move(E.geometry.getBounds().getCenterLonLat());var C=E.geometry.components[0].components[0];A=C.getBounds().getCenterLonLat()}else{A=new HGIS.LonLat(I.left,I.bottom)}this.handles[0].move(A);delete this._setfeature;this.events.triggerEvent("setfeature",{feature:B})},unsetFeature:function(){if(this.active){this.deactivate()}else{this.feature=null;this.rotation=0;this.scale=1;this.ratio=1}},createBox:function(){var L=this;this.center=new HGIS.Geometry.Point(0,0);this.box=new HGIS.Feature.Vector(new HGIS.Geometry.LineString([new HGIS.Geometry.Point(-1,-1),new HGIS.Geometry.Point(0,-1),new HGIS.Geometry.Point(1,-1),new HGIS.Geometry.Point(1,0),new HGIS.Geometry.Point(1,1),new HGIS.Geometry.Point(0,1),new HGIS.Geometry.Point(-1,1),new HGIS.Geometry.Point(-1,0),new HGIS.Geometry.Point(-1,-1)]),null,typeof this.renderIntent=="string"?null:this.renderIntent);this.box.geometry.move=function(N,O){L._moving=true;HGIS.Geometry.LineString.prototype.move.apply(this,arguments);L.center.move(N,O);delete L._moving};var E=function(N,O){HGIS.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(N,O);this._handle.geometry.move(N,O)};var M=function(P,O,N){HGIS.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(P,O,N);this._handle.geometry.resize(P,O,N)};var I=function(O,N){HGIS.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(O,N);this._handle.geometry.rotate(O,N)};var K=function(d,e){var Q=this.x,Y=this.y;HGIS.Geometry.Point.prototype.move.call(this,d,e);if(L._moving){return}var U=L.dragControl.handlers.drag.evt;var P=!L._setfeature&&L.preserveAspectRatio;var X=!P&&!(U&&U.shiftKey);var N=new HGIS.Geometry.Point(Q,Y);var T=L.center;this.rotate(-L.rotation,T);N.rotate(-L.rotation,T);var b=this.x-T.x;var S=this.y-T.y;var a=b-(this.x-N.x);var R=S-(this.y-N.y);if(L.irregular&&!L._setfeature){b-=(this.x-N.x)/2;S-=(this.y-N.y)/2}this.x=Q;this.y=Y;var W,f=1;if(X){W=Math.abs(R)<1e-05?1:S/R;f=(Math.abs(a)<1e-05?1:(b/a))/W}else{var Z=Math.sqrt((a*a)+(R*R));var V=Math.sqrt((b*b)+(S*S));W=V/Z}L._moving=true;L.box.geometry.rotate(-L.rotation,T);delete L._moving;L.box.geometry.resize(W,T,f);L.box.geometry.rotate(L.rotation,T);L.transformFeature({scale:W,ratio:f});if(L.irregular&&!L._setfeature){var O=T.clone();O.x+=Math.abs(Q-T.x)<1e-05?0:(this.x-Q);O.y+=Math.abs(Y-T.y)<1e-05?0:(this.y-Y);L.box.geometry.move(this.x-Q,this.y-Y);L.transformFeature({center:O})}};var J=function(Y,Z){var N=this.x,W=this.y;HGIS.Geometry.Point.prototype.move.call(this,Y,Z);if(L._moving){return}var O=L.dragControl.handlers.drag.evt;var b=(O&&O.shiftKey)?45:1;var T=L.center;var U=this.x-T.x;var R=this.y-T.y;var V=U-Y;var Q=R-Z;this.x=N;this.y=W;var P=Math.atan2(Q,V);var S=Math.atan2(R,U);var X=S-P;X*=180/Math.PI;L._angle=(L._angle+X)%360;var a=L.rotation%b;if(Math.abs(L._angle)>=b||a!==0){X=Math.round(L._angle/b)*b-a;L._angle=0;L.box.geometry.rotate(X,T);L.transformFeature({rotation:X})}};var F=new Array(8);var C=new Array(4);var H,D,B;var A=["sw","s","se","e","ne","n","nw","w"];for(var G=0;G<8;++G){H=this.box.geometry.components[G];D=new HGIS.Feature.Vector(H.clone(),{role:A[G]+"-resize"},typeof this.renderIntent=="string"?null:this.renderIntent);if(G%2==0){B=new HGIS.Feature.Vector(H.clone(),{role:A[G]+"-rotate"},typeof this.rotationHandleSymbolizer=="string"?null:this.rotationHandleSymbolizer);B.geometry.move=J;H._rotationHandle=B;C[G/2]=B}H.move=E;H.resize=M;H.rotate=I;D.geometry.move=K;H._handle=D;F[G]=D}this.rotationHandles=C;this.handles=F},createControl:function(){var A=this;this.dragControl=new HGIS.Control.DragFeature(this.layer,{documentDrag:true,moveFeature:function(B){if(this.feature===A.feature){this.feature=A.box}HGIS.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(C,B){if(C===A.box){A.transformFeature({center:A.center})}},onStart:function(C,B){var E=!A.geometryTypes||HGIS.Util.indexOf(A.geometryTypes,C.geometry.CLASS_NAME)!==-1;var D=HGIS.Util.indexOf(A.handles,C);D+=HGIS.Util.indexOf(A.rotationHandles,C);if(C!==A.feature&&C!==A.box&&D==-2&&E){A.setFeature(C)}},onComplete:function(C,B){A.events.triggerEvent("transformcomplete",{feature:A.feature})}})},drawHandles:function(){var B=this.layer;for(var A=0;A<8;++A){if(this.rotate&&A%2===0){B.drawFeature(this.rotationHandles[A/2],this.rotationHandleSymbolizer)}B.drawFeature(this.handles[A],this.renderIntent)}},transformFeature:function(D){if(!this._setfeature){this.scale*=(D.scale||1);this.ratio*=(D.ratio||1);var B=this.rotation;this.rotation=(this.rotation+(D.rotation||0))%360;if(this.events.triggerEvent("beforetransform",D)!==false){var A=this.feature;var E=A.geometry;var C=this.center;E.rotate(-B,C);if(D.scale||D.ratio){E.resize(D.scale,C,D.ratio)}else{if(D.center){A.move(D.center.getBounds().getCenterLonLat())}}E.rotate(this.rotation,C);this.layer.drawFeature(A);A.toState(HGIS.State.UPDATE);this.events.triggerEvent("transform",D)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){var B;for(var A=0;A<8;++A){B=this.box.geometry.components[A];B._handle.destroy();B._handle=null;B._rotationHandle&&B._rotationHandle.destroy();B._rotationHandle=null}this.center=null;this.feature=null;this.handles=null;this.rotationHandleSymbolizer=null;this.rotationHandles=null;this.box.destroy();this.box=null;this.layer=null;this.dragControl.destroy();this.dragControl=null;HGIS.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"HGIS.Control.TransformFeature"});HGIS.Handler.Box=HGIS.Class(HGIS.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(B,C,A){HGIS.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new HGIS.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){HGIS.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(A){HGIS.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(A)}},startBox:function(A){this.callback("start",[]);this.zoomBox=HGIS.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.viewPortDiv.appendChild(this.zoomBox);HGIS.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(A){var C=this.dragHandler.start.x;var E=this.dragHandler.start.y;var F=Math.abs(C-A.x);var D=Math.abs(E-A.y);var B=this.getBoxOffsets();this.zoomBox.style.width=(F+B.width+1)+"px";this.zoomBox.style.height=(D+B.height+1)+"px";this.zoomBox.style.left=(A.x<C?C-F-B.left:C-B.left)+"px";this.zoomBox.style.top=(A.y<E?E-D-B.top:E-B.top)+"px"},endBox:function(E){var C;if(Math.abs(this.dragHandler.start.x-E.x)>5||Math.abs(this.dragHandler.start.y-E.y)>5){var F=this.dragHandler.start;var D=Math.min(F.y,E.y);var G=Math.max(F.y,E.y);var B=Math.min(F.x,E.x);var A=Math.max(F.x,E.x);C=new HGIS.Bounds(B,G,A,D)}else{C=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[C])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;HGIS.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(HGIS.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){if(this.dragHandler.deactivate()){if(this.zoomBox){this.removeBox()}}return true}else{return false}},getBoxOffsets:function(){if(!this.boxOffsets){var E=document.createElement("div");E.style.position="absolute";E.style.border="1px solid black";E.style.width="3px";document.body.appendChild(E);var D=E.clientWidth==3;document.body.removeChild(E);var B=parseInt(HGIS.Element.getStyle(this.zoomBox,"border-left-width"));var A=parseInt(HGIS.Element.getStyle(this.zoomBox,"border-right-width"));var C=parseInt(HGIS.Element.getStyle(this.zoomBox,"border-top-width"));var F=parseInt(HGIS.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:B,right:A,top:C,bottom:F,width:D===false?B+A:0,height:D===false?C+F:0}}return this.boxOffsets},CLASS_NAME:"HGIS.Handler.Box"});HGIS.Control.ZoomBox=HGIS.Class(HGIS.Control,{type:HGIS.Control.TYPE_TOOL,out:false,keyMask:null,alwaysZoom:false,zoomOnClick:true,draw:function(){this.handler=new HGIS.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(S){if(S instanceof HGIS.Bounds){var O,E=S.getCenterPixel();if(!this.out){var G=this.map.getLonLatFromPixel({x:S.left,y:S.bottom});var F=this.map.getLonLatFromPixel({x:S.right,y:S.top});O=new HGIS.Bounds(G.lon,G.lat,F.lon,F.lat)}else{var A=S.right-S.left;var R=S.bottom-S.top;var C=Math.min((this.map.size.h/R),(this.map.size.w/A));var N=this.map.getExtent();var U=this.map.getLonLatFromPixel(E);var Q=U.lon-(N.getWidth()/2)*C;var K=U.lon+(N.getWidth()/2)*C;var B=U.lat-(N.getHeight()/2)*C;var T=U.lat+(N.getHeight()/2)*C;O=new HGIS.Bounds(Q,B,K,T)}var J=this.map.getZoom(),D=this.map.getSize(),H={x:D.w/2,y:D.h/2},P=this.map.getZoomForExtent(O),I=this.map.getResolution(),M=this.map.getResolutionForZoom(P);if(I==M){this.map.setCenter(this.map.getLonLatFromPixel(E))}else{var L={x:(I*E.x-M*H.x)/(I-M),y:(I*E.y-M*H.y)/(I-M)};this.map.zoomTo(P,L)}if(J==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(J+(this.out?-1:1))}}else{if(this.zoomOnClick){if(!this.out){this.map.zoomTo(this.map.getZoom()+1,S)}else{this.map.zoomTo(this.map.getZoom()-1,S)}}}},CLASS_NAME:"HGIS.Control.ZoomBox"});HGIS.Control.DragPan=HGIS.Class(HGIS.Control,{type:HGIS.Control.TYPE_TOOL,panned:false,interval:0,documentDrag:false,kinetic:null,enableKinetic:true,kineticInterval:10,draw:function(){if(this.enableKinetic&&HGIS.Kinetic){var A={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){A=HGIS.Util.extend(A,this.enableKinetic)}this.kinetic=new HGIS.Kinetic(A);this.interval=this.kinetic.interval?this.kinetic.interval:0}this.handler=new HGIS.Handler.Drag(this,{"move":this.panMap,"done":this.panMapDone,"down":this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){if(this.kinetic){this.kinetic.begin()}},panMap:function(A){if(this.kinetic){this.kinetic.update(A)}this.panned=true;this.map.pan(this.handler.last.x-A.x,this.handler.last.y-A.y,{dragging:true,animate:false})},panMapDone:function(A){if(this.panned){var C=null;if(this.kinetic){C=this.kinetic.end(A)}this.map.pan(this.handler.last.x-A.x,this.handler.last.y-A.y,{dragging:!!C,animate:false});if(C){var B=this;this.kinetic.move(C,function(E,F,D){B.map.pan(E,F,{dragging:!D,animate:false})})}this.panned=false}},CLASS_NAME:"HGIS.Control.DragPan"});HGIS.Control.Navigation=HGIS.Class(HGIS.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:HGIS.Handler.MOD_SHIFT,autoActivate:true,initialize:function(A){this.handlers={};HGIS.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;if(this.pinchZoom){this.pinchZoom.destroy()}this.pinchZoom=null;HGIS.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate()}if(this.pinchZoom){this.pinchZoom.activate()}return HGIS.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.pinchZoom){this.pinchZoom.deactivate()}this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return HGIS.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=HGIS.Function.False}var C={"click":this.defaultClick,"dblclick":this.defaultDblClick,"dblrightclick":this.defaultDblRightClick};var A={"double":true,"stopDouble":true};this.handlers.click=new HGIS.Handler.Click(this,C,A);this.dragPan=new HGIS.Control.DragPan(HGIS.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new HGIS.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();var B=this.map.fractionalZoom?{}:{cumulative:false,interval:50,maxDelta:6};this.handlers.wheel=new HGIS.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},HGIS.Util.extend(B,this.mouseWheelOptions));if(HGIS.Control.PinchZoom){this.pinchZoom=new HGIS.Control.PinchZoom(HGIS.Util.extend({map:this.map},this.pinchZoomOptions))}},defaultClick:function(A){if(A.lastTouches&&A.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(A){this.map.zoomTo(this.map.zoom+1,A.xy)},defaultDblRightClick:function(A){this.map.zoomTo(this.map.zoom-1,A.xy)},wheelChange:function(B,A){if(!this.map.fractionalZoom){A=Math.round(A)}var C=this.map.getZoom(),D=C+A;if(HGIS.InitParam.minLevel){D=Math.max(D,HGIS.InitParam.minLevel)}else{D=Math.max(D,0)}D=Math.min(D,this.map.getNumZoomLevels());if(D===C){return}this.map.zoomTo(D,B.xy)},wheelUp:function(B,A){this.wheelChange(B,A||1)},wheelDown:function(B,A){this.wheelChange(B,A||-1)},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate()}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"HGIS.Control.Navigation"});HGIS.Control.DrawFeature=HGIS.Class(HGIS.Control,{layer:null,callbacks:null,multi:false,featureAdded:function(){},initialize:function(C,B,A){HGIS.Control.prototype.initialize.apply(this,[A]);this.callbacks=HGIS.Util.extend({done:this.drawFeature,modify:function(F,E){this.layer.events.triggerEvent("sketchmodified",{vertex:F,feature:E})},create:function(F,E){this.layer.events.triggerEvent("sketchstarted",{vertex:F,feature:E})}},this.callbacks);this.layer=C;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=HGIS.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:C.renderers,rendererOptions:C.rendererOptions});if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi}var D=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(D){this.handlerOptions.layerOptions=HGIS.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new HGIS.StyleMap({"default":D})})}this.handler=new B(this,this.callbacks,this.handlerOptions)},drawFeature:function(B){var A=new HGIS.Feature.Vector(B);var C=this.layer.events.triggerEvent("sketchcomplete",{feature:A});if(C!==false){A.state=HGIS.State.INSERT;this.layer.addFeatures([A]);this.featureAdded(A);this.events.triggerEvent("featureadded",{feature:A})}},insertXY:function(A,B){if(this.handler&&this.handler.line){this.handler.insertXY(A,B)}},insertDeltaXY:function(A,B){if(this.handler&&this.handler.line){this.handler.insertDeltaXY(A,B)}},insertDirectionLength:function(B,A){if(this.handler&&this.handler.line){this.handler.insertDirectionLength(B,A)}},insertDeflectionLength:function(B,A){if(this.handler&&this.handler.line){this.handler.insertDeflectionLength(B,A)}},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"HGIS.Control.DrawFeature"});HGIS.Handler.Polygon=HGIS.Class(HGIS.Handler.Path,{holeModifier:null,drawingHole:false,polygon:null,createFeature:function(A){var B=this.layer.getLonLatFromViewPortPx(A);var C=new HGIS.Geometry.Point(B.lon,B.lat);this.point=new HGIS.Feature.Vector(C);this.line=new HGIS.Feature.Vector(new HGIS.Geometry.LinearRing([this.point.geometry]));this.polygon=new HGIS.Feature.Vector(new HGIS.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},addPoint:function(A){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){var D=this.point.geometry;var B=this.control.layer.features;var F,E;for(var C=B.length-1;C>=0;--C){F=B[C].geometry;if((F instanceof HGIS.Geometry.Polygon||F instanceof HGIS.Geometry.MultiPolygon)&&F.intersects(D)){E=B[C];this.control.layer.removeFeatures([E],{silent:true});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);E.geometry.addComponent(this.line.geometry);this.polygon=E;this.drawingHole=true;break}}}HGIS.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(B){var A=B.vertex;var D=this.line.geometry.components;if(!this.polygon.geometry.intersects(A)){var C=D[D.length-3];A.x=C.x;A.y=C.y}},finishGeometry:function(){var A=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[A]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var A=this.line.geometry;var F=(A.getArea()!==0);if(F){var E=this.polygon.geometry.components;for(var D=E.length-2;D>=0;--D){if(A.intersects(E[D])){F=false;break}}if(F){var G;outer:for(var D=E.length-2;D>0;--D){var H=E[D].components;for(var C=0,B=H.length;C<B;++C){if(A.containsPoint(H[C])){F=false;break outer}}}}}if(F){if(this.polygon.state!==HGIS.State.INSERT){this.polygon.state=HGIS.State.UPDATE}}else{this.polygon.geometry.removeComponent(A)}this.restoreFeature();return false},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(true)}return HGIS.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(A){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:true});this.control.layer.addFeatures([this.polygon],{silent:true});this.drawingHole=false;if(!A){this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})}},destroyFeature:function(A){HGIS.Handler.Path.prototype.destroyFeature.call(this,A);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var A=this.polygon&&this.polygon.geometry;if(A&&this.multi){A=new HGIS.Geometry.MultiPolygon([A])}return A},CLASS_NAME:"HGIS.Handler.Polygon"});HGIS.Control.EditingToolbar=HGIS.Class(HGIS.Control.Panel,{citeCompliant:false,initialize:function(C,B){HGIS.Control.Panel.prototype.initialize.apply(this,[B]);this.addControls([new HGIS.Control.Navigation()]);var A=[new HGIS.Control.DrawFeature(C,HGIS.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new HGIS.Control.DrawFeature(C,HGIS.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new HGIS.Control.DrawFeature(C,HGIS.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(A)},draw:function(){var A=HGIS.Control.Panel.prototype.draw.apply(this,arguments);if(this.defaultControl===null){this.defaultControl=this.controls[0]}return A},CLASS_NAME:"HGIS.Control.EditingToolbar"});HGIS.Strategy.BBOX=HGIS.Class(HGIS.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var A=HGIS.Strategy.prototype.activate.call(this);if(A){this.layer.events.on({"moveend":this.update,"refresh":this.update,"visibilitychanged":this.update,scope:this});this.update()}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){this.layer.events.un({"moveend":this.update,"refresh":this.update,"visibilitychanged":this.update,scope:this})}return A},update:function(A){var B=this.getMapBounds();if(B!==null&&((A&&A.force)||(this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(B)))){this.calculateBounds(B);this.resolution=this.layer.map.getResolution();this.triggerRead(A)}},getMapBounds:function(){if(this.layer.map===null){return null}var A=this.layer.map.getExtent();if(A&&!this.layer.projection.equals(this.layer.map.getProjectionObject())){A=A.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return A},invalidBounds:function(C){if(!C){C=this.getMapBounds()}var A=!this.bounds||!this.bounds.containsBounds(C);if(!A&&this.resFactor){var B=this.resolution/this.layer.map.getResolution();A=(B>=this.resFactor||B<=(1/this.resFactor))}return A},calculateBounds:function(D){if(!D){D=this.getMapBounds()}var B=D.getCenterLonLat();var A=D.getWidth()*this.ratio;var C=D.getHeight()*this.ratio;this.bounds=new HGIS.Bounds(B.lon-(A/2),B.lat-(C/2),B.lon+(A/2),B.lat+(C/2))},triggerRead:function(B){if(this.response&&!(B&&B.noAbort===true)){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadend")}var A={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",A);this.response=this.layer.protocol.read(HGIS.Util.applyDefaults({filter:A.filter,callback:this.merge,scope:this},B))},createFilter:function(){var A=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){A=new HGIS.Filter.Logical({type:HGIS.Filter.Logical.AND,filters:[this.layer.filter,A]})}return A},merge:function(E){this.layer.destroyFeatures();if(E.success()){var A=E.features;if(A&&A.length>0){var F=this.layer.projection;var C=this.layer.map.getProjectionObject();if(!C.equals(F)){var G;for(var B=0,D=A.length;B<D;++B){G=A[B].geometry;if(G){G.transform(F,C)}}}this.layer.addFeatures(A)}}else{this.bounds=null}this.response=null;this.layer.events.triggerEvent("loadend",{response:E})},CLASS_NAME:"HGIS.Strategy.BBOX"});HGIS.Layer.WorldWind=HGIS.Class(HGIS.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:true,lzd:null,zoomLevels:null,initialize:function(C,A,G,E,F,B){this.lzd=G;this.zoomLevels=E;var D=[];D.push(C,A,F,B);HGIS.Layer.Grid.prototype.initialize.apply(this,D);this.params=HGIS.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var B=this.map.getZoom();var A=this.map.getMaxExtent();B=B-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2);return B},getURL:function(A){A=this.adjustBounds(A);var F=this.getZoom();var B=this.map.getMaxExtent();var E=this.lzd/Math.pow(2,this.getZoom());var C=Math.floor((A.left-B.left)/E);var D=Math.floor((A.bottom-B.bottom)/E);if(this.map.getResolution()<=(this.lzd/512)&&this.getZoom()<=this.zoomLevels){return this.getFullRequestString({L:F,X:C,Y:D})}else{return HGIS.Util.getImageLocation("blank.gif")}},CLASS_NAME:"HGIS.Layer.WorldWind"});HGIS.Protocol.CSW=function(B){B=HGIS.Util.applyDefaults(B,HGIS.Protocol.CSW.DEFAULTS);var A=HGIS.Protocol.CSW["v"+B.version.replace(/\./g,"_")];if(!A){throw"Unsupported CSW version: "+B.version}return new A(B)};HGIS.Protocol.CSW.DEFAULTS={"version":"2.0.2"};HGIS.Format.WMTSCapabilities=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":true},createLayer:function(f,b){var Q;if(!("layer" in b)){throw new Error("Missing property 'layer' in configuration.")}var I=f.contents;var U=I.layers;var M;for(var H=0,O=I.layers.length;H<O;++H){if(I.layers[H].identifier===b.layer){M=I.layers[H];break}}if(!M){throw new Error("Layer not found")}var L=b.format;if(!L&&M.formats&&M.formats.length){L=M.formats[0]}var V;if(b.matrixSet){V=I.tileMatrixSets[b.matrixSet]}else{if(M.tileMatrixSetLinks.length>=1){V=I.tileMatrixSets[M.tileMatrixSetLinks[0].tileMatrixSet]}}if(!V){throw new Error("matrixSet not found")}var e;for(var H=0,O=M.styles.length;H<O;++H){e=M.styles[H];if(e.isDefault){break}}var X=b.requestEncoding;if(!X){X="KVP";if(f.operationsMetadata.GetTile.dcp.http){var G=f.operationsMetadata.GetTile.dcp.http;if(G.get[0].constraints){var W=G.get[0].constraints;var P=W.GetEncoding.allowedValues;if(!P.KVP&&(P.REST||P.RESTful)){X="REST"}}}}var T=[];var B=b.params||{};delete b.params;for(var Y=0,a=M.dimensions.length;Y<a;Y++){var J=M.dimensions[Y];T.push(J.identifier);if(!B.hasOwnProperty(J.identifier)){B[J.identifier]=J["default"]}}var F=b.projection||V.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3");var N=b.units||(F==="EPSG:4326"?"degrees":"m");var R=[];for(var K in V.matrixIds){if(V.matrixIds.hasOwnProperty(K)){R.push(V.matrixIds[K].scaleDenominator*0.00028/HGIS.METERS_PER_INCH/HGIS.INCHES_PER_UNIT[N])}}var A;if(X==="REST"&&M.resourceUrls){A=[];var d=M.resourceUrls,Z;for(var C=0,S=M.resourceUrls.length;C<S;++C){Z=M.resourceUrls[C];if(Z.format===L&&Z.resourceType==="tile"){A.push(Z.template)}}}else{var E=f.operationsMetadata.GetTile.dcp.http.get;A=[];var D;for(var H=0,O=E.length;H<O;H++){D=E[H].constraints;if(!D||(D&&D.GetEncoding.allowedValues[X])){A.push(E[H].url)}}}return new HGIS.Layer.WMTS(HGIS.Util.applyDefaults(b,{url:A,requestEncoding:X,name:M.title,style:e.identifier,format:L,matrixIds:V.matrixIds,matrixSet:V.identifier,projection:F,units:N,resolutions:b.isBaseLayer===false?undefined:R,serverResolutions:R,tileFullExtent:V.bounds,dimensions:T,params:B}))},CLASS_NAME:"HGIS.Format.WMTSCapabilities"});HGIS.Layer.Google.v3={DEFAULTS:{sphericalMercator:true,projection:"EPSG:900913"},animationEnabled:true,loadMapObject:function(){if(!this.type){this.type=google.maps.MapTypeId.ROADMAP}var C;var A=HGIS.Layer.Google.cache[this.map.id];if(A){C=A.mapObject;++A.count}else{var B=this.map.getCenter();var E=document.createElement("div");E.className="olForeignContainer";E.style.width="100%";E.style.height="100%";C=new google.maps.Map(E,{center:B?new google.maps.LatLng(B.lat,B.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});var D=document.createElement("div");D.style.width="100%";D.style.height="100%";C.controls[google.maps.ControlPosition.TOP_LEFT].push(D);A={googleControl:D,mapObject:C,count:1};HGIS.Layer.Google.cache[this.map.id]=A}this.mapObject=C;this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")}},setGMapVisibility:function(A){var I=HGIS.Layer.Google.cache[this.map.id];var D=this.map;if(I){var G=this.type;var H=D.layers;var C;for(var B=H.length-1;B>=0;--B){C=H[B];if(C instanceof HGIS.Layer.Google&&C.visibility===true&&C.inRange===true){G=C.type;A=true;break}}var E=this.mapObject.getDiv();if(A===true){if(E.parentNode!==D.div){if(!I.rendered){var F=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){I.rendered=true;F.setGMapVisibility(F.getVisibility());F.moveTo(F.map.getCenter())})}else{D.div.appendChild(E);I.googleControl.appendChild(D.viewPortDiv);google.maps.event.trigger(this.mapObject,"resize")}}this.mapObject.setMapTypeId(G)}else{if(I.googleControl.hasChildNodes()){D.div.appendChild(D.viewPortDiv);D.div.removeChild(E)}}}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(C){var D=null;if(C!=null){var A=this.sphericalMercator?this.inverseMercator(C.bottom,C.left):new HGIS.LonLat(C.bottom,C.left);var B=this.sphericalMercator?this.inverseMercator(C.top,C.right):new HGIS.LonLat(C.top,C.right);D=new google.maps.LatLngBounds(new google.maps.LatLng(A.lat,A.lon),new google.maps.LatLng(B.lat,B.lon))}return D},getMapObjectLonLatFromMapObjectPixel:function(C){var D=this.map.getSize();var B=this.getLongitudeFromMapObjectLonLat(this.mapObject.center);var A=this.getLatitudeFromMapObjectLonLat(this.mapObject.center);var H=this.map.getResolution();var E=C.x-(D.w/2);var G=C.y-(D.h/2);var F=new HGIS.LonLat(B+E*H,A-G*H);if(this.wrapDateLine){F=F.wrapDateLine(this.maxExtent)}return this.getMapObjectLonLatFromLonLat(F.lon,F.lat)},getMapObjectPixelFromMapObjectLonLat:function(B){var A=this.getLongitudeFromMapObjectLonLat(B);var D=this.getLatitudeFromMapObjectLonLat(B);var C=this.map.getResolution();var E=this.map.getExtent();return this.getMapObjectPixelFromXY((1/C*(A-E.left)),(1/C*(E.top-D)))},setMapObjectCenter:function(B,C){if(this.animationEnabled===false&&C!=this.mapObject.zoom){var A=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){A.style.visibility=""});A.style.visibility="hidden"}this.mapObject.setOptions({center:B,zoom:C})},getMapObjectZoomFromMapObjectBounds:function(A){return this.mapObject.getBoundsZoomLevel(A)},getMapObjectLonLatFromLonLat:function(B,C){var D;if(this.sphericalMercator){var A=this.inverseMercator(B,C);D=new google.maps.LatLng(A.lat,A.lon)}else{D=new google.maps.LatLng(C,B)}return D},getMapObjectPixelFromXY:function(A,B){return new google.maps.Point(A,B)}};HGIS.Format.WPSDescribeProcess=HGIS.Class(HGIS.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);return A},readers:{"wps":{"ProcessDescriptions":function(B,A){A.processDescriptions={};this.readChildNodes(B,A.processDescriptions)},"ProcessDescription":function(C,A){var D=this.getAttributeNS(C,this.namespaces.wps,"processVersion");var B={processVersion:D,statusSupported:(C.getAttribute("statusSupported")==="true"),storeSupported:(C.getAttribute("storeSupported")==="true")};this.readChildNodes(C,B);A[B.identifier]=B},"DataInputs":function(B,A){A.dataInputs=[];this.readChildNodes(B,A.dataInputs)},"ProcessOutputs":function(B,A){A.processOutputs=[];this.readChildNodes(B,A.processOutputs)},"Output":function(B,A){var C={};this.readChildNodes(B,C);A.push(C)},"ComplexOutput":function(A,B){B.complexOutput={};this.readChildNodes(A,B.complexOutput)},"LiteralOutput":function(A,B){B.literalOutput={};this.readChildNodes(A,B.literalOutput)},"Input":function(A,B){var C={maxOccurs:parseInt(A.getAttribute("maxOccurs")),minOccurs:parseInt(A.getAttribute("minOccurs"))};this.readChildNodes(A,C);B.push(C)},"BoundingBoxData":function(A,B){B.boundingBoxData={};this.readChildNodes(A,B.boundingBoxData)},"CRS":function(B,A){if(!A.CRSs){A.CRSs={}}A.CRSs[this.getChildValue(B)]=true},"LiteralData":function(A,B){B.literalData={};this.readChildNodes(A,B.literalData)},"ComplexData":function(A,B){B.complexData={};this.readChildNodes(A,B.complexData)},"Default":function(A,B){B["default"]={};this.readChildNodes(A,B["default"])},"Supported":function(A,B){B["supported"]={};this.readChildNodes(A,B["supported"])},"Format":function(C,B){var A={};this.readChildNodes(C,A);if(!B.formats){B.formats={}}B.formats[A.mimeType]=true},"MimeType":function(B,A){A.mimeType=this.getChildValue(B)}},"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.readers["ows"]},CLASS_NAME:"HGIS.Format.WPSDescribeProcess"});HGIS.Format.WKT=HGIS.Class(HGIS.Format,{initialize:function(A){this.regExes={"typeStr":/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,"spaces":/\s+/,"parenComma":/\)\s*,\s*\(/,"doubleParenComma":/\)\s*\)\s*,\s*\(\s*\(/,"trimParens":/^\s*\(?(.*?)\)?\s*$/};HGIS.Format.prototype.initialize.apply(this,[A])},read:function(F){var B,H,C;F=F.replace(/[\n\r]/g," ");var E=this.regExes.typeStr.exec(F);if(E){H=E[1].toLowerCase();C=E[2];if(this.parse[H]){B=this.parse[H].apply(this,[C])}if(this.internalProjection&&this.externalProjection){if(B&&B.CLASS_NAME=="HGIS.Feature.Vector"){B.geometry.transform(this.externalProjection,this.internalProjection)}else{if(B&&H!="geometrycollection"&&typeof B=="object"){for(var D=0,G=B.length;D<G;D++){var A=B[D];A.geometry.transform(this.externalProjection,this.internalProjection)}}}}}return B},write:function(A){var D,F,E;if(A.constructor==Array){D=A;E=true}else{D=[A];E=false}var B=[];if(E){B.push("GEOMETRYCOLLECTION(")}for(var C=0,G=D.length;C<G;++C){if(E&&C>0){B.push(",")}F=D[C].geometry;B.push(this.extractGeometry(F))}if(E){B.push(")")}return B.join("")},extractGeometry:function(C){var A=C.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[A]){return null}if(this.internalProjection&&this.externalProjection){C=C.clone();C.transform(this.internalProjection,this.externalProjection)}var B=A=="collection"?"GEOMETRYCOLLECTION":A.toUpperCase();var D=B+"("+this.extract[A].apply(this,[C])+")";return D},extract:{"point":function(A){return A.x+" "+A.y},"multipoint":function(A){var B=[];for(var C=0,D=A.components.length;C<D;++C){B.push("("+this.extract.point.apply(this,[A.components[C]])+")")}return B.join(",")},"linestring":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push(this.extract.point.apply(this,[C.components[B]]))}return A.join(",")},"multilinestring":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push("("+this.extract.linestring.apply(this,[C.components[B]])+")")}return A.join(",")},"polygon":function(D){var A=[];for(var B=0,C=D.components.length;B<C;++B){A.push("("+this.extract.linestring.apply(this,[D.components[B]])+")")}return A.join(",")},"multipolygon":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push("("+this.extract.polygon.apply(this,[C.components[B]])+")")}return A.join(",")},"collection":function(C){var A=[];for(var B=0,D=C.components.length;B<D;++B){A.push(this.extractGeometry.apply(this,[C.components[B]]))}return A.join(",")}},parse:{"point":function(B){var A=HGIS.String.trim(B).split(this.regExes.spaces);return new HGIS.Feature.Vector(new HGIS.Geometry.Point(A[0],A[1]))},"multipoint":function(D){var B;var C=HGIS.String.trim(D).split(",");var F=[];for(var A=0,E=C.length;A<E;++A){B=C[A].replace(this.regExes.trimParens,"$1");F.push(this.parse.point.apply(this,[B]).geometry)}return new HGIS.Feature.Vector(new HGIS.Geometry.MultiPoint(F))},"linestring":function(C){var B=HGIS.String.trim(C).split(",");var E=[];for(var A=0,D=B.length;A<D;++A){E.push(this.parse.point.apply(this,[B[A]]).geometry)}return new HGIS.Feature.Vector(new HGIS.Geometry.LineString(E))},"multilinestring":function(C){var E;var B=HGIS.String.trim(C).split(this.regExes.parenComma);var F=[];for(var A=0,D=B.length;A<D;++A){E=B[A].replace(this.regExes.trimParens,"$1");F.push(this.parse.linestring.apply(this,[E]).geometry)}return new HGIS.Feature.Vector(new HGIS.Geometry.MultiLineString(F))},"polygon":function(C){var E,B,A;var G=HGIS.String.trim(C).split(this.regExes.parenComma);var D=[];for(var F=0,H=G.length;F<H;++F){E=G[F].replace(this.regExes.trimParens,"$1");B=this.parse.linestring.apply(this,[E]).geometry;A=new HGIS.Geometry.LinearRing(B.components);D.push(A)}return new HGIS.Feature.Vector(new HGIS.Geometry.Polygon(D))},"multipolygon":function(C){var E;var B=HGIS.String.trim(C).split(this.regExes.doubleParenComma);var F=[];for(var A=0,D=B.length;A<D;++A){E=B[A].replace(this.regExes.trimParens,"$1");F.push(this.parse.polygon.apply(this,[E]).geometry)}return new HGIS.Feature.Vector(new HGIS.Geometry.MultiPolygon(F))},"geometrycollection":function(C){C=C.replace(/,\s*([A-Za-z])/g,"|$1");var B=HGIS.String.trim(C).split("|");var E=[];for(var A=0,D=B.length;A<D;++A){E.push(HGIS.Format.WKT.prototype.read.apply(this,[B[A]]))}return E}},CLASS_NAME:"HGIS.Format.WKT"});HGIS.WPSProcess=HGIS.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(A){HGIS.Util.extend(this,A);this.executeCallbacks=[];this.formats={"application/wkt":new HGIS.Format.WKT(),"application/json":new HGIS.Format.GeoJSON()}},describe:function(B){B=B||{};if(!this.description){this.client.describeProcess(this.server,this.identifier,function(C){if(!this.description){this.parseDescription(C)}if(B.callback){B.callback.call(B.scope,this.description)}},this)}else{if(B.callback){var A=this.description;window.setTimeout(function(){B.callback.call(B.scope,A)},0)}}},configure:function(A){this.describe({callback:function(){var E=this.description,B=A.inputs,F,C,D;for(C=0,D=E.dataInputs.length;C<D;++C){F=E.dataInputs[C];this.setInputData(F,B[F.identifier])}if(A.callback){A.callback.call(A.scope)}},scope:this});return this},execute:function(A){this.configure({inputs:A.inputs,callback:function(){var D=this;var C=this.getOutputIndex(D.description.processOutputs,A.output);D.setResponseForm({outputIndex:C});(function B(){HGIS.Util.removeItem(D.executeCallbacks,B);if(D.chained!==0){D.executeCallbacks.push(B);return}HGIS.Request.POST({url:D.client.servers[D.server].url,data:new HGIS.Format.WPSExecute().write(D.description),success:function(H){var I=D.description.processOutputs[C];var F=D.findMimeType(I.complexOutput.supported.formats);var E=D.formats[F].read(H.responseText);if(E instanceof HGIS.Feature.Vector){E=[E]}if(A.success){var G={};G[A.output||"result"]=E;A.success.call(A.scope,G)}},scope:D})})()},scope:this})},output:function(A){return new HGIS.WPSProcess.ChainLink({process:this,output:A})},parseDescription:function(A){var B=this.client.servers[this.server];this.description=new HGIS.Format.WPSDescribeProcess().read(B.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(C,D){delete C.data;delete C.reference;if(D instanceof HGIS.WPSProcess.ChainLink){++this.chained;C.reference={method:"POST",href:D.process.server===this.server?this.localWPS:this.client.servers[D.process.server].url};D.process.describe({callback:function(){--this.chained;this.chainProcess(C,D)},scope:this})}else{C.data={};var A=C.complexData;if(A){var B=this.findMimeType(A.supported.formats);C.data.complexData={mimeType:B,value:this.formats[B].write(this.toFeatures(D))}}else{C.data.literalData={value:D}}}},setResponseForm:function(A){A=A||{};var B=this.description.processOutputs[A.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:B.identifier,mimeType:this.findMimeType(B.complexOutput.supported.formats,A.supportedFormats)}}},getOutputIndex:function(C,A){var D;if(A){for(var B=C.length-1;B>=0;--B){if(C[B].identifier===A){D=B;break}}}else{D=0}return D},chainProcess:function(B,C){var D=this.getOutputIndex(C.process.description.processOutputs,C.output);B.reference.mimeType=this.findMimeType(B.complexData.supported.formats,C.process.description.processOutputs[D].complexOutput.supported.formats);var A={};A[B.reference.mimeType]=true;C.process.setResponseForm({outputIndex:D,supportedFormats:A});B.reference.body=C.process.description;while(this.executeCallbacks.length>0){this.executeCallbacks[0]()}},toFeatures:function(B){var E=HGIS.Util.isArray(B);if(!E){B=[B]}var F=new Array(B.length),D;for(var A=0,C=B.length;A<C;++A){D=B[A];F[A]=D instanceof HGIS.Feature.Vector?D:new HGIS.Feature.Vector(D)}return E?F:F[0]},findMimeType:function(B,A){A=A||this.formats;for(var C in B){if(C in A){return C}}},CLASS_NAME:"HGIS.WPSProcess"});HGIS.WPSProcess.ChainLink=HGIS.Class({process:null,output:null,initialize:function(A){HGIS.Util.extend(this,A)},CLASS_NAME:"HGIS.WPSProcess.ChainLink"});HGIS.WPSClient=HGIS.Class({servers:null,version:"1.0.0",lazy:false,events:null,initialize:function(B){HGIS.Util.extend(this,B);this.events=new HGIS.Events(this);this.servers={};for(var A in B.servers){this.servers[A]=typeof B.servers[A]=="string"?{url:B.servers[A],version:this.version,processDescription:{}}:B.servers[A]}},execute:function(A){var B=this.getProcess(A.server,A.process);B.execute({inputs:A.inputs,success:A.success,scope:A.scope})},getProcess:function(A,B){var C=new HGIS.WPSProcess({client:this,server:A,identifier:B});if(!this.lazy){C.describe()}return C},describeProcess:function(B,C,A,E){var D=this.servers[B];if(!D.processDescription[C]){if(!(C in D.processDescription)){D.processDescription[C]=null;HGIS.Request.GET({url:D.url,params:{SERVICE:"WPS",VERSION:D.version,REQUEST:"DescribeProcess",IDENTIFIER:C},success:function(G){D.processDescription[C]=G.responseText;this.events.triggerEvent("describeprocess",{identifier:C,raw:G.responseText})},scope:this})}else{this.events.register("describeprocess",this,function F(G){if(G.identifier===C){this.events.unregister("describeprocess",this,F);A.call(E,G.raw)}})}}else{window.setTimeout(function(){A.call(E,D.processDescription[C])},0)}},destroy:function(){this.events.destroy();this.events=null;this.servers=null},CLASS_NAME:"HGIS.WPSClient"});HGIS.Format.CSWGetRecords.v2_0_2=HGIS.Class(HGIS.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);return A},readers:{"csw":{"GetRecordsResponse":function(B,A){A.records=[];this.readChildNodes(B,A);var C=this.getAttributeNS(B,"","version");if(C!=""){A.version=C}},"RequestId":function(B,A){A.RequestId=this.getChildValue(B)},"SearchStatus":function(C,B){B.SearchStatus={};var A=this.getAttributeNS(C,"","timestamp");if(A!=""){B.SearchStatus.timestamp=A}},"SearchResults":function(D,B){this.readChildNodes(D,B);var E=D.attributes;var A={};for(var C=0,F=E.length;C<F;++C){if((E[C].name=="numberOfRecordsMatched")||(E[C].name=="numberOfRecordsReturned")||(E[C].name=="nextRecord")){A[E[C].name]=parseInt(E[C].nodeValue)}else{A[E[C].name]=E[C].nodeValue}}B.SearchResults=A},"SummaryRecord":function(B,A){var C={type:"SummaryRecord"};this.readChildNodes(B,C);A.records.push(C)},"BriefRecord":function(B,A){var C={type:"BriefRecord"};this.readChildNodes(B,C);A.records.push(C)},"DCMIRecord":function(B,A){var C={type:"DCMIRecord"};this.readChildNodes(B,C);A.records.push(C)},"Record":function(B,A){var C={type:"Record"};this.readChildNodes(B,C);A.records.push(C)},"*":function(B,A){var C=B.localName||B.nodeName.split(":").pop();A[C]=this.getChildValue(B)}},"geonet":{"info":function(B,A){var C={};this.readChildNodes(B,C);A.gninfo=C}},"dc":{"*":function(D,B){var E=D.localName||D.nodeName.split(":").pop();if(!(HGIS.Util.isArray(B[E]))){B[E]=[]}var C={};var F=D.attributes;for(var A=0,G=F.length;A<G;++A){C[F[A].name]=F[A].nodeValue}C.value=this.getChildValue(D);if(C.value!=""){B[E].push(C)}}},"dct":{"*":function(B,A){var C=B.localName||B.nodeName.split(":").pop();if(!(HGIS.Util.isArray(A[C]))){A[C]=[]}A[C].push(this.getChildValue(B))}},"ows":HGIS.Util.applyDefaults({"BoundingBox":function(B,A){if(A.bounds){A.BoundingBox=[{crs:A.projection,value:[A.bounds.left,A.bounds.bottom,A.bounds.right,A.bounds.top]}];delete A.projection;delete A.bounds}HGIS.Format.OWSCommon.v1_0_0.prototype.readers["ows"]["BoundingBox"].apply(this,arguments)}},HGIS.Format.OWSCommon.v1_0_0.prototype.readers["ows"])},write:function(B){var A=this.writeNode("csw:GetRecords",B);A.setAttribute("xmlns:gmd",this.namespaces.gmd);return HGIS.Format.XML.prototype.write.apply(this,[A])},writers:{"csw":{"GetRecords":function(D){if(!D){D={}}var C=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:D.requestId||this.requestId,resultType:D.resultType||this.resultType,outputFormat:D.outputFormat||this.outputFormat,outputSchema:D.outputSchema||this.outputSchema,startPosition:D.startPosition||this.startPosition,maxRecords:D.maxRecords||this.maxRecords}});if(D.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",D.DistributedSearch||this.DistributedSearch,C)}var B=D.ResponseHandler||this.ResponseHandler;if(HGIS.Util.isArray(B)&&B.length>0){for(var A=0,E=B.length;A<E;A++){this.writeNode("csw:ResponseHandler",B[A],C)}}this.writeNode("Query",D.Query||this.Query,C);return C},"DistributedSearch":function(B){var A=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:B.hopCount}});return A},"ResponseHandler":function(B){var A=this.createElementNSPlus("csw:ResponseHandler",{value:B.value});return A},"Query":function(D){if(!D){D={}}var C=this.createElementNSPlus("csw:Query",{attributes:{typeNames:D.typeNames||"csw:Record"}});var B=D.ElementName;if(HGIS.Util.isArray(B)&&B.length>0){for(var A=0,E=B.length;A<E;A++){this.writeNode("csw:ElementName",B[A],C)}}else{this.writeNode("csw:ElementSetName",D.ElementSetName||{value:"summary"},C)}if(D.Constraint){this.writeNode("csw:Constraint",D.Constraint,C)}if(D.SortBy){this.writeNode("ogc:SortBy",D.SortBy,C)}return C},"ElementName":function(B){var A=this.createElementNSPlus("csw:ElementName",{value:B.value});return A},"ElementSetName":function(B){var A=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:B.typeNames},value:B.value});return A},"Constraint":function(D){var C=this.createElementNSPlus("csw:Constraint",{attributes:{version:D.version}});if(D.Filter){var B=new HGIS.Format.Filter({version:D.version});C.appendChild(B.write(D.Filter))}else{if(D.CqlText){var A=this.createElementNSPlus("CqlText",{value:D.CqlText.value});C.appendChild(A)}}return C}},"ogc":HGIS.Format.Filter.v1_1_0.prototype.writers["ogc"]},CLASS_NAME:"HGIS.Format.CSWGetRecords.v2_0_2"});HGIS.Marker.Box=HGIS.Class(HGIS.Marker,{bounds:null,div:null,initialize:function(A,B,C){this.bounds=A;this.div=HGIS.Util.createDiv();this.div.style.overflow="hidden";this.events=new HGIS.Events(this,this.div);this.setBorder(B,C)},destroy:function(){this.bounds=null;this.div=null;HGIS.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(B,A){if(!B){B="red"}if(!A){A=2}this.div.style.border=A+"px solid "+B},draw:function(B,A){HGIS.Util.modifyDOMElement(this.div,null,B,A);return this.div},onScreen:function(){var B=false;if(this.map){var A=this.map.getExtent();B=A.containsBounds(this.bounds,true,true)}return B},display:function(A){this.div.style.display=(A)?"":"none"},CLASS_NAME:"HGIS.Marker.Box"});HGIS.Format.Text=HGIS.Class(HGIS.Format,{defaultStyle:null,extractStyles:true,initialize:function(A){A=A||{};if(A.extractStyles!==false){A.defaultStyle={"externalGraphic":HGIS.Util.getImageLocation("marker.png"),"graphicWidth":21,"graphicHeight":25,"graphicXOffset":-10.5,"graphicYOffset":-12.5}}HGIS.Format.prototype.initialize.apply(this,[A])},read:function(H){var K=H.split("\n");var I;var S=[];for(var Q=0;Q<(K.length-1);Q++){var P=K[Q].replace(/^\s*/,"").replace(/\s*$/,"");if(P.charAt(0)!="#"){if(!I){I=P.split("\t")}else{var E=P.split("\t");var O=new HGIS.Geometry.Point(0,0);var N={};var T=this.defaultStyle?HGIS.Util.applyDefaults({},this.defaultStyle):null;var F,L,B,G;var D=false;for(var A=0;A<E.length;A++){if(E[A]){if(I[A]=="point"){var M=E[A].split(",");O.y=parseFloat(M[0]);O.x=parseFloat(M[1]);D=true}else{if(I[A]=="lat"){O.y=parseFloat(E[A]);D=true}else{if(I[A]=="lon"){O.x=parseFloat(E[A]);D=true}else{if(I[A]=="title"){N["title"]=E[A]}else{if(I[A]=="image"||I[A]=="icon"&&T){T["externalGraphic"]=E[A]}else{if(I[A]=="iconSize"&&T){var C=E[A].split(",");T["graphicWidth"]=parseFloat(C[0]);T["graphicHeight"]=parseFloat(C[1])}else{if(I[A]=="iconOffset"&&T){var R=E[A].split(",");T["graphicXOffset"]=parseFloat(R[0]);T["graphicYOffset"]=parseFloat(R[1])}else{if(I[A]=="description"){N["description"]=E[A]}else{if(I[A]=="overflow"){N["overflow"]=E[A]}else{N[I[A]]=E[A]}}}}}}}}}}}if(D){if(this.internalProjection&&this.externalProjection){O.transform(this.externalProjection,this.internalProjection)}var J=new HGIS.Feature.Vector(O,N,T);S.push(J)}}}}return S},CLASS_NAME:"HGIS.Format.Text"});HGIS.Layer.Text=HGIS.Class(HGIS.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(B,A){HGIS.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){HGIS.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var A=function(B){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");HGIS.Request.GET({url:this.location,success:this.parseData,failure:A,scope:this});this.loaded=true}}},moveTo:function(B,A,C){HGIS.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(M){var H=M.responseText;var F={};HGIS.Util.extend(F,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){F.externalProjection=this.projection;F.internalProjection=this.map.getProjectionObject()}var N=new HGIS.Format.Text(F);var C=N.read(H);for(var G=0,J=C.length;G<J;G++){var A={};var L=C[G];var K;var I,D;K=new HGIS.LonLat(L.geometry.x,L.geometry.y);if(L.style.graphicWidth&&L.style.graphicHeight){I=new HGIS.Size(L.style.graphicWidth,L.style.graphicHeight)}if(L.style.graphicXOffset!==undefined&&L.style.graphicYOffset!==undefined){D=new HGIS.Pixel(L.style.graphicXOffset,L.style.graphicYOffset)}if(L.style.externalGraphic!=null){A.icon=new HGIS.Icon(L.style.externalGraphic,I,D)}else{A.icon=HGIS.Marker.defaultIcon();if(I!=null){A.icon.setSize(I)}}if((L.attributes.title!=null)&&(L.attributes.description!=null)){A["popupContentHTML"]="<h2>"+L.attributes.title+"</h2><p>"+L.attributes.description+"</p>"}A["overflow"]=L.attributes.overflow||"auto";var E=new HGIS.Feature(this,K,A);this.features.push(E);var B=E.createMarker();if((L.attributes.title!=null)&&(L.attributes.description!=null)){B.events.register("click",E,this.markerClick)}this.addMarker(B)}this.events.triggerEvent("loadend")},markerClick:function(B){var C=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!C)?this:null;for(var A=0,D=this.layer.map.popups.length;A<D;A++){this.layer.map.removePopup(this.layer.map.popups[A])}if(!C){this.layer.map.addPopup(this.createPopup())}HGIS.Event.stop(B)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var A=this.features[0];HGIS.Util.removeItem(this.features,A);A.destroy()}}},CLASS_NAME:"HGIS.Layer.Text"});HGIS.Handler.RegularPolygon=HGIS.Class(HGIS.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,citeCompliant:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(B,C,A){if(!(A&&A.layerOptions&&A.layerOptions.styleMap)){this.style=HGIS.Util.extend(HGIS.Feature.Vector.style["default"],{})}HGIS.Handler.Drag.prototype.initialize.apply(this,[B,C,A]);this.options=(A)?A:{}},setOptions:function(A){HGIS.Util.extend(this.options,A);HGIS.Util.extend(this,A)},activate:function(){var A=false;if(HGIS.Handler.Drag.prototype.activate.apply(this,arguments)){var B=HGIS.Util.extend({displayInLayerSwitcher:false,calculateInRange:HGIS.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new HGIS.Layer.Vector(this.CLASS_NAME,B);this.map.addLayer(this.layer);A=true}return A},deactivate:function(){var A=false;if(HGIS.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy()}}this.layer=null;this.feature=null;A=true}return A},down:function(B){this.fixedRadius=!!(this.radius);var A=this.layer.getLonLatFromViewPortPx(B.xy);this.origin=new HGIS.Geometry.Point(A.lon,A.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}if(this.persist){this.clear()}this.feature=new HGIS.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(D){var A=this.layer.getLonLatFromViewPortPx(D.xy);var C=new HGIS.Geometry.Point(A.lon,A.lat);if(this.irregular){var F=Math.sqrt(2)*Math.abs(C.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,F)}else{if(this.fixedRadius){this.origin=C}else{this.calculateAngle(C,D);this.radius=Math.max(this.map.getResolution()/2,C.distanceTo(this.origin))}}this.modifyGeometry();if(this.irregular){var B=C.x-this.origin.x;var G=C.y-this.origin.y;var E;if(G==0){E=B/(this.radius*Math.sqrt(2))}else{E=B/G}this.feature.geometry.resize(1,this.origin,E);this.feature.geometry.move(B/2,G/2)}this.layer.drawFeature(this.feature,this.style)},up:function(A){this.finalize();if(this.start==this.last){this.callback("done",[A.xy])}},out:function(A){this.finalize()},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)}this.feature.geometry=HGIS.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var D,B;var C=this.feature.geometry.components[0];if(C.components.length!=(this.sides+1)){this.createGeometry();C=this.feature.geometry.components[0]}for(var A=0;A<this.sides;++A){B=C.components[A];D=this.angle+(A*2*Math.PI/this.sides);B.x=this.origin.x+(this.radius*Math.cos(D));B.y=this.origin.y+(this.radius*Math.sin(D));B.clearBounds()}},calculateAngle:function(B,C){var D=Math.atan2(B.y-this.origin.y,B.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!C[this.snapToggle])){var A=(Math.PI/180)*this.snapAngle;this.angle=Math.round(D/A)*A}else{this.angle=D}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures()}},callback:function(A,B){if(this.callbacks[A]){this.callbacks[A].apply(this.control,[this.feature.geometry.clone()])}if(!this.persist&&(A=="done"||A=="cancel")){this.clear()}},CLASS_NAME:"HGIS.Handler.RegularPolygon"});HGIS.Control.SLDSelect=HGIS.Class(HGIS.Control,{clearOnDeactivate:false,layers:null,callbacks:null,selectionSymbolizer:{"Polygon":{fillColor:"#FF0000",stroke:false},"Line":{strokeColor:"#FF0000",strokeWidth:2},"Point":{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(A,B){HGIS.Control.prototype.initialize.apply(this,[B]);this.callbacks=HGIS.Util.extend({done:this.select,click:this.select},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.layerOptions=HGIS.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:false,tileOptions:{maxGetUrlLength:2048}});if(this.sketchStyle){this.handlerOptions.layerOptions=HGIS.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new HGIS.StyleMap({"default":this.sketchStyle})})}this.handler=new A(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var A in this.layerCache){delete this.layerCache[A]}for(var A in this.wfsCache){delete this.wfsCache[A]}HGIS.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(A){this.setVisibility(A.object.getVisibility())},createSelectionLayer:function(A){var B;if(!this.layerCache[A.id]){B=new HGIS.Layer.WMS(A.name,A.url,A.params,HGIS.Util.applyDefaults(this.layerOptions,A.getOptions()));this.layerCache[A.id]=B;if(this.layerOptions.displayInLayerSwitcher===false){A.events.on({"visibilitychanged":this.coupleLayerVisiblity,scope:B})}this.map.addLayer(B)}else{B=this.layerCache[A.id]}return B},createSLD:function(F,J,K){var C={version:"1.0.0",namedLayers:{}};var G=[F.params.LAYERS].join(",").split(",");for(var E=0,H=G.length;E<H;E++){var B=G[E];C.namedLayers[B]={name:B,userStyles:[]};var I=this.selectionSymbolizer;var A=K[E];if(A.type.indexOf("Polygon")>=0){I={Polygon:this.selectionSymbolizer["Polygon"]}}else{if(A.type.indexOf("LineString")>=0){I={Line:this.selectionSymbolizer["Line"]}}else{if(A.type.indexOf("Point")>=0){I={Point:this.selectionSymbolizer["Point"]}}}}var D=J[E];C.namedLayers[B].userStyles.push({name:"default",rules:[new HGIS.Rule({symbolizer:I,filter:D,maxScaleDenominator:F.options.minScale})]})}return new HGIS.Format.SLD({srsName:this.map.getProjection()}).write(C)},parseDescribeLayer:function(D){var C=new HGIS.Format.WMSDescribeLayer();var H=D.responseXML;if(!H||!H.documentElement){H=D.responseText}var B=C.read(H);var F=[];var I=null;for(var E=0,A=B.length;E<A;E++){if(B[E].owsType=="WFS"){F.push(B[E].typeName);I=B[E].owsURL}}var G={url:I,params:{SERVICE:"WFS",TYPENAME:F.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(K){var J=new HGIS.Format.WFSDescribeFeatureType();var M=K.responseXML;if(!M||!M.documentElement){M=K.responseText}var L=J.read(M);this.control.wfsCache[this.layer.id]=L;this.control._queue&&this.control.applySelection()},scope:this};HGIS.Request.GET(G)},getGeometryAttributes:function(F){var A=[];var K=this.wfsCache[F.id];for(var E=0,I=K.featureTypes.length;E<I;E++){var G=K.featureTypes[E];var H=G.properties;for(var D=0,C=H.length;D<C;D++){var B=H[D];var J=B.type;if((J.indexOf("LineString")>=0)||(J.indexOf("GeometryAssociationType")>=0)||(J.indexOf("GeometryPropertyType")>=0)||(J.indexOf("Point")>=0)||(J.indexOf("Polygon")>=0)){A.push(B)}}}return A},activate:function(){var B=HGIS.Control.prototype.activate.call(this);if(B){for(var A=0,E=this.layers.length;A<E;A++){var D=this.layers[A];if(D&&!this.wfsCache[D.id]){var C={url:D.url,params:{SERVICE:"WMS",VERSION:D.params.VERSION,LAYERS:D.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:D,control:this}};HGIS.Request.GET(C)}}}return B},deactivate:function(){var D=HGIS.Control.prototype.deactivate.call(this);if(D){for(var B=0,E=this.layers.length;B<E;B++){var A=this.layers[B];if(A&&this.clearOnDeactivate===true){var C=this.layerCache;var F=C[A.id];if(F){A.events.un({"visibilitychanged":this.coupleLayerVisiblity,scope:F});F.destroy();delete C[A.id]}}}}return D},setLayers:function(A){if(this.active){this.deactivate();this.layers=A;this.activate()}else{this.layers=A}},createFilter:function(A,B){var C=null;if(this.handler instanceof HGIS.Handler.RegularPolygon){if(this.handler.irregular===true){C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.BBOX,property:A.name,value:B.getBounds()})}else{C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.INTERSECTS,property:A.name,value:B})}}else{if(this.handler instanceof HGIS.Handler.Polygon){C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.INTERSECTS,property:A.name,value:B})}else{if(this.handler instanceof HGIS.Handler.Path){if(A.type.indexOf("Point")>=0){C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.DWITHIN,property:A.name,distance:this.map.getExtent().getWidth()*0.01,distanceUnits:this.map.getUnits(),value:B})}else{C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.INTERSECTS,property:A.name,value:B})}}else{if(this.handler instanceof HGIS.Handler.Click){if(A.type.indexOf("Polygon")>=0){C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.INTERSECTS,property:A.name,value:B})}else{C=new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.DWITHIN,property:A.name,distance:this.map.getExtent().getWidth()*0.01,distanceUnits:this.map.getUnits(),value:B})}}}}}return C},select:function(A){this._queue=function(){for(var H=0,J=this.layers.length;H<J;H++){var I=this.layers[H];var M=this.getGeometryAttributes(I);var L=[];for(var G=0,E=M.length;G<E;G++){var C=M[G];if(C!==null){if(!(A instanceof HGIS.Geometry)){var K=this.map.getLonLatFromPixel(A.xy);A=new HGIS.Geometry.Point(K.lon,K.lat)}var F=this.createFilter(C,A);if(F!==null){L.push(F)}}}var B=this.createSelectionLayer(I);this.events.triggerEvent("selected",{layer:I,filters:L});var D=this.createSLD(I,L,M);B.mergeNewParams({SLD_BODY:D});delete this._queue}};this.applySelection()},applySelection:function(){var B=true;for(var A=0,C=this.layers.length;A<C;A++){if(!this.wfsCache[this.layers[A].id]){B=false;break}}B&&this._queue.call(this)},CLASS_NAME:"HGIS.Control.SLDSelect"});HGIS.Control.Scale=HGIS.Class(HGIS.Control,{element:null,geodesic:false,initialize:function(B,A){HGIS.Control.prototype.initialize.apply(this,[A]);this.element=HGIS.Util.getElement(B)},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var C;if(this.geodesic===true){var A=this.map.getUnits();if(!A){return}var B=HGIS.INCHES_PER_UNIT;C=(this.map.getGeodesicPixelSize().w||1e-06)*B["km"]*HGIS.DOTS_PER_INCH}else{C=this.map.getScale()}if(!C){return}if(C>=9500&&C<=950000){C=Math.round(C/1000)+"K"}else{if(C>=950000){C=Math.round(C/1000000)+"M"}else{C=Math.round(C)}}this.element.innerHTML=HGIS.i18n("Scale = 1 : ${scaleDenom}",{"scaleDenom":C})},CLASS_NAME:"HGIS.Control.Scale"});HGIS.Layer.MapGuide=HGIS.Class(HGIS.Layer.Grid,{isBaseLayer:true,useHttpTile:false,singleTile:false,useOverlay:false,useAsyncOverlay:true,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new HGIS.Size(300,300),tileOriginCorner:"tl",initialize:function(C,A,D,B){HGIS.Layer.Grid.prototype.initialize.apply(this,arguments);if(B==null||B.isBaseLayer==null){this.isBaseLayer=((this.transparent!="true")&&(this.transparent!=true))}if(B&&B.useOverlay!=null){this.useOverlay=B.useOverlay}if(this.singleTile){if(this.useOverlay){HGIS.Util.applyDefaults(this.params,this.OVERLAY_PARAMS);if(!this.useAsyncOverlay){this.params.version="1.0.0"}}else{HGIS.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS)}}else{if(this.useHttpTile){HGIS.Util.applyDefaults(this.params,this.FOLDER_PARAMS)}else{HGIS.Util.applyDefaults(this.params,this.TILE_PARAMS)}this.setTileSize(this.defaultSize)}},clone:function(A){if(A==null){A=new HGIS.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(C){var G;var A=C.getCenterLonLat();var B=this.map.getSize();if(this.singleTile){var E={setdisplaydpi:HGIS.DOTS_PER_INCH,setdisplayheight:B.h*this.ratio,setdisplaywidth:B.w*this.ratio,setviewcenterx:A.lon,setviewcentery:A.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var F={};F=HGIS.Util.extend(F,E);F.operation="GETVISIBLEMAPEXTENT";F.version="1.0.0";F.session=this.params.session;F.mapName=this.params.mapName;F.format="text/xml";G=this.getFullRequestString(F);HGIS.Request.GET({url:G,async:false})}G=this.getFullRequestString(E)}else{var I=this.map.getResolution();var H=Math.floor((C.left-this.maxExtent.left)/I);H=Math.round(H/this.tileSize.w);var D=Math.floor((this.maxExtent.top-C.top)/I);D=Math.round(D/this.tileSize.h);if(this.useHttpTile){G=this.getImageFilePath({tilecol:H,tilerow:D,scaleindex:this.resolutions.length-this.map.zoom-1})}else{G=this.getFullRequestString({tilecol:H,tilerow:D,scaleindex:this.resolutions.length-this.map.zoom-1})}}return G},getFullRequestString:function(B,D){var G=(D==null)?this.url:D;if(typeof G=="object"){G=G[Math.floor(Math.random()*G.length)]}var I=G;var H=HGIS.Util.extend({},this.params);H=HGIS.Util.extend(H,B);var C=HGIS.Util.upperCaseObject(HGIS.Util.getParameters(G));for(var E in H){if(E.toUpperCase() in C){delete H[E]}}var A=HGIS.Util.getParameterString(H);A=A.replace(/,/g,"+");if(A!=""){var F=G.charAt(G.length-1);if((F=="&")||(F=="?")){I+=A}else{if(G.indexOf("?")==-1){I+="?"+A}else{I+="&"+A}}}return I},getImageFilePath:function(D,E){var C=(E==null)?this.url:E;if(typeof C=="object"){C=C[Math.floor(Math.random()*C.length)]}var B=C;var G="";var F="";if(D.tilerow<0){G="-"}if(D.tilerow==0){G+="0"}else{G+=Math.floor(Math.abs(D.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder}if(D.tilecol<0){F="-"}if(D.tilecol==0){F+="0"}else{F+=Math.floor(Math.abs(D.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder}var A="/S"+Math.floor(D.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+G+"/C"+F+"/"+(D.tilerow%this.params.tileRowsPerFolder)+"_"+(D.tilecol%this.params.tileColumnsPerFolder)+"."+this.params.format;if(this.params.querystring){A+="?"+this.params.querystring}B+=A;return B},CLASS_NAME:"HGIS.Layer.MapGuide"});HGIS.Control.Measure=HGIS.Class(HGIS.Control,{callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,immediate:false,initialize:function(A,B){HGIS.Control.prototype.initialize.apply(this,[B]);var C={done:this.measureComplete,point:this.measurePartial};if(this.immediate){C.modify=this.measureImmediate}this.callbacks=HGIS.Util.extend(C,this.callbacks);this.handlerOptions=HGIS.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new A(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return HGIS.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(A){this.immediate=A;if(this.immediate){this.callbacks.modify=this.measureImmediate}else{delete this.callbacks.modify}},updateHandler:function(B,C){var A=this.active;if(A){this.deactivate()}this.handler=new B(this,this.callbacks,C);if(A){this.activate()}},measureComplete:function(A){this.cancelDelay();this.measure(A,"measure")},measurePartial:function(A,D){this.cancelDelay();D=D.clone();if(this.handler.freehandMode(this.handler.evt)){this.measure(D,"measurepartial")}else{var C=this;function B(){C.measure(D,"measurepartial")}window.setTimeout(B,this.partialDelay)}},measureImmediate:function(B,A,C){if(C&&!this.handler.freehandMode(this.handler.evt)){this.cancelDelay();this.measure(A.geometry,"measurepartial")}},cancelDelay:function(){if(this.delayedTrigger!==null){window.clearTimeout(this.delayedTrigger);this.delayedTrigger=null}},measure:function(C,A){var D,B;if(C.CLASS_NAME.indexOf("LineString")>-1){D=this.getBestLength(C);B=1}else{D=this.getBestArea(C);B=2}this.events.triggerEvent(A,{measure:D[0],units:D[1],order:B,geometry:C})},getBestArea:function(C){var E=this.displaySystemUnits[this.displaySystem];var B,F;for(var A=0,D=E.length;A<D;++A){B=E[A];F=this.getArea(C,B);if(F>1){break}}return[F,B]},getArea:function(C,E){var F,D;if(HGIS.InitParam.geodesic){F=C.getGeodesicArea(this.map.getProjectionObject());D="m"}else{F=C.getArea();D=this.map.getUnits()}var A=HGIS.INCHES_PER_UNIT[E];if(A){var B=HGIS.INCHES_PER_UNIT[D];F*=Math.pow((B/A),2)}return F},getBestLength:function(D){var F=this.displaySystemUnits[this.displaySystem];var C,A;for(var B=0,E=F.length;B<E;++B){C=F[B];A=this.getLength(D,C);if(A>1){break}}return[A,C]},getLength:function(C,E){var B,D;if(HGIS.InitParam.geodesic){B=C.getGeodesicLength(this.map.getProjectionObject());D="m"}else{B=C.getLength();D=this.map.getUnits()}var A=HGIS.INCHES_PER_UNIT[E];if(A){var F=HGIS.INCHES_PER_UNIT[D];B*=(F/A)}return B},CLASS_NAME:"HGIS.Control.Measure"});HGIS.Format.WMC.v1_0_0=HGIS.Class(HGIS.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(A){HGIS.Format.WMC.v1.prototype.initialize.apply(this,[A])},read_wmc_SRS:function(F,C){var B=this.getChildValue(C);if(typeof F.projections!="object"){F.projections={}}var E=B.split(/ +/);for(var A=0,D=E.length;A<D;A++){F.projections[E[A]]=true}},write_wmc_Layer:function(A){var B=HGIS.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[A]);if(A.srs){var D=[];for(var C in A.srs){D.push(C)}B.appendChild(this.createElementDefaultNS("SRS",D.join(" ")))}B.appendChild(this.write_wmc_FormatList(A));B.appendChild(this.write_wmc_StyleList(A));if(A.dimensions){B.appendChild(this.write_wmc_DimensionList(A))}B.appendChild(this.write_wmc_LayerExtension(A))},CLASS_NAME:"HGIS.Format.WMC.v1_0_0"});HGIS.Popup.Anchored=HGIS.Class(HGIS.Popup,{relativePosition:null,keepInMap:true,anchor:null,changeAnchorIfOutOfView:false,initialize:function(E,F,C,D,A,H,B){var G=[E,F,C,D,H,B];HGIS.Popup.prototype.initialize.apply(this,G);this.anchor=(A!=null)?A:{size:new HGIS.Size(0,0),offset:new HGIS.Pixel(0,0)};this.contentSize=C?C:null},destroy:function(){this.anchor=null;this.relativePosition=null;HGIS.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();HGIS.Popup.prototype.show.apply(this,arguments)},moveTo:function(A){var B=this.relativePosition;this.relativePosition=this.calculateRelativePosition(A);HGIS.Popup.prototype.moveTo.call(this,this.calculateNewPx(A));if(this.relativePosition!=B){this.updateRelativePosition()}},changeAnchorSize:function(){var A=HGIS.Popup.prototype.calculateOffset.call(this);if(A[0]!=0||A[1]!=0){this.div.style.left=parseInt(this.div.style.left)-A[0]+"px";this.div.style.top=parseInt(this.div.style.top)-A[1]+"px"}},setSize:function(B){HGIS.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var A=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(A)}},calculateRelativePosition:function(C){var A=this.map.getLonLatFromLayerPx(C);var B=this.map.getExtent();var D=B.determineQuadrant(A);return HGIS.Bounds.oppositeQuadrant(D)},updateRelativePosition:function(){},calculateNewPx:function(E){var D=E.offset(this.anchor.offset);var A=this.size||this.contentSize;var C=(this.relativePosition.charAt(0)=="t");D.y+=(C)?-A.h:this.anchor.size.h;var B=(this.relativePosition.charAt(1)=="l");D.x+=(B)?-A.w:this.anchor.size.w;return D},CLASS_NAME:"HGIS.Popup.Anchored"});HGIS.Popup.Framed=HGIS.Class(HGIS.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,changeAnchorIfOutOfView:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(G,A,C,D,F,B,E){HGIS.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(H){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(B){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var A=0;A<this.blocks.length;A++){var B=this.blocks[A];if(B.image){B.div.removeChild(B.image)}B.image=null;if(B.div){this.groupDiv.removeChild(B.div)}B.div=null}this.blocks=null;HGIS.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(A){},setBorder:function(){},setOpacity:function(A){},setSize:function(A){HGIS.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var A=this.getContentDivPadding();this.closeDiv.style.right=A.right+this.padding.right+"px";this.closeDiv.style.top=A.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(B){var A=HGIS.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);A=A.offset(this.positionBlocks[this.relativePosition].offset);return A},createBlocks:function(){this.blocks=[];var G=null;for(var A in this.positionBlocks){G=A;break}var E=this.positionBlocks[G];for(var H=0;H<E.blocks.length;H++){var F={};this.blocks.push(F);var C=this.id+"_FrameDecorationDiv_"+H;F.div=HGIS.Util.createDiv(C,null,null,null,"absolute",null,"hidden",null);var B=this.id+"_FrameDecorationImg_"+H;var D=(this.isAlphaImage)?HGIS.Util.createAlphaImageDiv:HGIS.Util.createImage;F.image=D(B,null,this.imageSize,this.imageSrc,"absolute",null,null,null);F.div.appendChild(F.image);this.groupDiv.appendChild(F.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var H=this.positionBlocks[this.relativePosition];for(var E=0;E<H.blocks.length;E++){var G=H.blocks[E];var F=this.blocks[E];var J=G.anchor.left;var I=G.anchor.bottom;var A=G.anchor.right;var C=G.anchor.top;var B=(isNaN(G.size.w))?this.size.w-(A+J):G.size.w;var D=(isNaN(G.size.h))?this.size.h-(I+C):G.size.h;F.div.style.width=(B<0?0:B)+"px";F.div.style.height=(D<0?0:D)+"px";F.div.style.left=(J!=null)?J+"px":"";F.div.style.bottom=(I!=null)?I+"px":"";F.div.style.right=(A!=null)?A+"px":"";F.div.style.top=(C!=null)?C+"px":"";F.image.style.left=G.position.x+"px";F.image.style.top=G.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"HGIS.Popup.Framed"});HGIS.Popup.FramedCloud=HGIS.Class(HGIS.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,changeAnchorIfOutOfView:false,imageSize:new HGIS.Size(1276,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{"tl":{"offset":new HGIS.Pixel(44,0),"padding":new HGIS.Bounds(8,40,8,9),"blocks":[{size:new HGIS.Size("auto","auto"),anchor:new HGIS.Bounds(0,51,22,0),position:new HGIS.Pixel(0,0)},{size:new HGIS.Size(22,"auto"),anchor:new HGIS.Bounds(null,50,0,0),position:new HGIS.Pixel(-1238,0)},{size:new HGIS.Size("auto",19),anchor:new HGIS.Bounds(0,32,22,null),position:new HGIS.Pixel(0,-631)},{size:new HGIS.Size(22,18),anchor:new HGIS.Bounds(null,32,0,null),position:new HGIS.Pixel(-1238,-632)},{size:new HGIS.Size(81,35),anchor:new HGIS.Bounds(null,0,0,null),position:new HGIS.Pixel(0,-688)}]},"tr":{"offset":new HGIS.Pixel(-45,0),"padding":new HGIS.Bounds(8,40,8,9),"blocks":[{size:new HGIS.Size("auto","auto"),anchor:new HGIS.Bounds(0,51,22,0),position:new HGIS.Pixel(0,0)},{size:new HGIS.Size(22,"auto"),anchor:new HGIS.Bounds(null,50,0,0),position:new HGIS.Pixel(-1238,0)},{size:new HGIS.Size("auto",19),anchor:new HGIS.Bounds(0,32,22,null),position:new HGIS.Pixel(0,-631)},{size:new HGIS.Size(22,19),anchor:new HGIS.Bounds(null,32,0,null),position:new HGIS.Pixel(-1238,-631)},{size:new HGIS.Size(81,35),anchor:new HGIS.Bounds(0,0,null,null),position:new HGIS.Pixel(-215,-687)}]},"bl":{"offset":new HGIS.Pixel(45,0),"padding":new HGIS.Bounds(8,9,8,40),"blocks":[{size:new HGIS.Size("auto","auto"),anchor:new HGIS.Bounds(0,21,22,32),position:new HGIS.Pixel(0,0)},{size:new HGIS.Size(22,"auto"),anchor:new HGIS.Bounds(null,21,0,32),position:new HGIS.Pixel(-1238,0)},{size:new HGIS.Size("auto",21),anchor:new HGIS.Bounds(0,0,22,null),position:new HGIS.Pixel(0,-629)},{size:new HGIS.Size(22,21),anchor:new HGIS.Bounds(null,0,0,null),position:new HGIS.Pixel(-1238,-629)},{size:new HGIS.Size(81,33),anchor:new HGIS.Bounds(null,null,0,0),position:new HGIS.Pixel(-101,-674)}]},"br":{"offset":new HGIS.Pixel(-44,0),"padding":new HGIS.Bounds(8,9,8,40),"blocks":[{size:new HGIS.Size("auto","auto"),anchor:new HGIS.Bounds(0,21,22,32),position:new HGIS.Pixel(0,0)},{size:new HGIS.Size(22,"auto"),anchor:new HGIS.Bounds(null,21,0,32),position:new HGIS.Pixel(-1238,0)},{size:new HGIS.Size("auto",21),anchor:new HGIS.Bounds(0,0,22,null),position:new HGIS.Pixel(0,-629)},{size:new HGIS.Size(22,21),anchor:new HGIS.Bounds(null,0,0,null),position:new HGIS.Pixel(-1238,-629)},{size:new HGIS.Size(81,33),anchor:new HGIS.Bounds(0,null,null,0),position:new HGIS.Pixel(-311,-674)}]}},minSize:new HGIS.Size(105,10),maxSize:new HGIS.Size(1200,660),initialize:function(G,A,C,D,F,B,E){this.imageSrc=HGIS.Util.getImageLocation("cloud-popup-relative.png");HGIS.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"HGIS.Popup.FramedCloud"});HGIS.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var D=HGIS.Tile.Image.prototype.shouldDraw.call(this);if(D){var C=this.layer.getURL(this.bounds);var A=this.useIFrame;this.useIFrame=this.maxGetUrlLength!==null&&!this.layer.async&&C.length>this.maxGetUrlLength;var B=A&&!this.useIFrame;var E=!A&&this.useIFrame;if(B||E){if(this.imgDiv&&this.imgDiv.parentNode===this.frame){this.frame.removeChild(this.imgDiv)}this.imgDiv=null;if(B){this.frame.removeChild(this.frame.firstChild)}}}return HGIS.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===true){if(!this.frame.childNodes.length){var C=document.createElement("div"),B=C.style;B.position="absolute";B.width="100%";B.height="100%";B.zIndex=1;B.backgroundImage="url("+this.blankImageUrl+")";this.frame.appendChild(C)}var D=this.id+"_iFrame",A;if(parseFloat(navigator.appVersion.split("MSIE")[1])<9){A=document.createElement('<iframe name="'+D+'">');A.style.backgroundColor="#FFFFFF";A.style.filter="chroma(color=#FFFFFF)"}else{A=document.createElement("iframe");A.style.backgroundColor="transparent";A.name=D}A.scrolling="no";A.marginWidth="0px";A.marginHeight="0px";A.frameBorder="0";A.style.position="absolute";A.style.width="100%";A.style.height="100%";if(this.layer.opacity<1){HGIS.Util.modifyDOMElement(A,null,null,null,null,null,null,this.layer.opacity)}this.frame.appendChild(A);this.imgDiv=A;return A}else{return HGIS.Tile.Image.prototype.getImage.apply(this,arguments)}},createRequestForm:function(){var B=document.createElement("form");B.method="POST";var A=this.layer.params["_OLSALT"];A=(A?A+"_":"")+this.bounds.toBBOX();B.action=HGIS.Util.urlAppend(this.layer.url,A);B.target=this.id+"_iFrame";var D=this.layer.getImageSize(),F=HGIS.Util.getParameters(this.url),E;for(var C in F){E=document.createElement("input");E.type="hidden";E.name=C;E.value=F[C];B.appendChild(E)}return B},setImgSrc:function(A){if(this.useIFrame===true){if(A){var B=this.createRequestForm();this.frame.appendChild(B);B.submit();this.frame.removeChild(B)}else{if(this.imgDiv.parentNode===this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv=null}}}else{HGIS.Tile.Image.prototype.setImgSrc.apply(this,arguments)}},onImageLoad:function(){HGIS.Tile.Image.prototype.onImageLoad.apply(this,arguments);if(this.useIFrame===true){this.imgDiv.style.opacity=1;this.frame.style.opacity=this.layer.opacity}},createBackBuffer:function(){var A;if(this.useIFrame===false){A=HGIS.Tile.Image.prototype.createBackBuffer.call(this)}return A}};HGIS.Format.SOSCapabilities=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"HGIS.Format.SOSCapabilities"});HGIS.Format.SOSCapabilities.v1_0_0=HGIS.Class(HGIS.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A]);this.options=A},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);return A},readers:{"gml":HGIS.Util.applyDefaults({"name":function(B,A){A.name=this.getChildValue(B)},"TimePeriod":function(B,A){A.timePeriod={};this.readChildNodes(B,A.timePeriod)},"beginPosition":function(A,B){B.beginPosition=this.getChildValue(A)},"endPosition":function(A,B){B.endPosition=this.getChildValue(A)}},HGIS.Format.GML.v3.prototype.readers["gml"]),"sos":{"Capabilities":function(B,A){this.readChildNodes(B,A)},"Contents":function(B,A){A.contents={};this.readChildNodes(B,A.contents)},"ObservationOfferingList":function(A,B){B.offeringList={};this.readChildNodes(A,B.offeringList)},"ObservationOffering":function(A,B){var C=this.getAttributeNS(A,this.namespaces.gml,"id");B[C]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(A,B[C])},"time":function(A,B){B.time={};this.readChildNodes(A,B.time)},"procedure":function(A,B){B.procedures.push(this.getAttributeNS(A,this.namespaces.xlink,"href"))},"observedProperty":function(A,B){B.observedProperties.push(this.getAttributeNS(A,this.namespaces.xlink,"href"))},"featureOfInterest":function(A,B){B.featureOfInterestIds.push(this.getAttributeNS(A,this.namespaces.xlink,"href"))},"responseFormat":function(A,B){B.responseFormats.push(this.getChildValue(A))},"resultModel":function(A,B){B.resultModels.push(this.getChildValue(A))},"responseMode":function(A,B){B.responseModes.push(this.getChildValue(A))}},"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.readers["ows"]},CLASS_NAME:"HGIS.Format.SOSCapabilities.v1_0_0"});HGIS.Handler.Pinch=HGIS.Class(HGIS.Handler,{started:false,stopDown:false,pinching:false,last:null,start:null,touchstart:function(B){var A=true;this.pinching=false;if(HGIS.Event.isMultiTouch(B)){this.started=true;this.last=this.start={distance:this.getDistance(B.touches),delta:0,scale:1};this.callback("start",[B,this.start]);A=!this.stopDown}else{if(this.started){return false}else{this.started=false;this.start=null;this.last=null}}HGIS.Event.preventDefault(B);return A},touchmove:function(A){if(this.started&&HGIS.Event.isMultiTouch(A)){this.pinching=true;var B=this.getPinchData(A);this.callback("move",[A,B]);this.last=B;HGIS.Event.stop(A)}else{if(this.started){return false}}return true},touchend:function(A){if(this.started&&!HGIS.Event.isMultiTouch(A)){this.started=false;this.pinching=false;this.callback("done",[A,this.start,this.last]);this.start=null;this.last=null;return false}return true},activate:function(){var A=false;if(HGIS.Handler.prototype.activate.apply(this,arguments)){this.pinching=false;A=true}return A},deactivate:function(){var A=false;if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.pinching=false;this.start=null;this.last=null;A=true}return A},getDistance:function(A){var B=A[0];var C=A[1];return Math.sqrt(Math.pow(B.olClientX-C.olClientX,2)+Math.pow(B.olClientY-C.olClientY,2))},getPinchData:function(A){var C=this.getDistance(A.touches);var B=C/this.start.distance;return{distance:C,delta:this.last.distance-C,scale:B}},CLASS_NAME:"HGIS.Handler.Pinch"});HGIS.Control.NavToolbar=HGIS.Class(HGIS.Control.Panel,{initialize:function(A){HGIS.Control.Panel.prototype.initialize.apply(this,[A]);this.addControls([new HGIS.Control.Navigation(),new HGIS.Control.ZoomBox()])},draw:function(){var A=HGIS.Control.Panel.prototype.draw.apply(this,arguments);if(this.defaultControl===null){this.defaultControl=this.controls[0]}return A},CLASS_NAME:"HGIS.Control.NavToolbar"});HGIS.Strategy.Refresh=HGIS.Class(HGIS.Strategy,{force:false,interval:0,timer:null,activate:function(){var A=HGIS.Strategy.prototype.activate.call(this);if(A){if(this.layer.visibility===true){this.start()}this.layer.events.on({"visibilitychanged":this.reset,scope:this})}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){this.stop();this.layer.events.un({"visibilitychanged":this.reset,scope:this})}return A},reset:function(){if(this.layer.visibility===true){this.start()}else{this.stop()}},start:function(){if(this.interval&&typeof this.interval==="number"&&this.interval>0){this.timer=window.setInterval(HGIS.Function.bind(this.refresh,this),this.interval)}},refresh:function(){if(this.layer&&this.layer.refresh&&typeof this.layer.refresh=="function"){this.layer.refresh({force:this.force})}},stop:function(){if(this.timer!==null){window.clearInterval(this.timer);this.timer=null}},CLASS_NAME:"HGIS.Strategy.Refresh"});HGIS.Layer.ArcGIS93Rest=HGIS.Class(HGIS.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(C,A,E,B){var D=[];E=HGIS.Util.upperCaseObject(E);D.push(C,A,E,B);HGIS.Layer.Grid.prototype.initialize.apply(this,D);HGIS.Util.applyDefaults(this.params,HGIS.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((B==null)||(!B.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="jpg"){this.params.FORMAT=HGIS.Util.alphaHack()?"gif":"png"}}},clone:function(A){if(A==null){A=new HGIS.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(B){B=this.adjustBounds(B);var G=this.projection.getCode().split(":");var E=G[G.length-1];var D=this.getImageSize();var C={"BBOX":B.toBBOX(),"SIZE":D.w+","+D.h,"F":"image","BBOXSR":E,"IMAGESR":E};if(this.layerDefs){var F=[];var A;for(A in this.layerDefs){if(this.layerDefs.hasOwnProperty(A)){if(this.layerDefs[A]){F.push(A);F.push(":");F.push(this.layerDefs[A]);F.push(";")}}}if(F.length>0){C["LAYERDEFS"]=F.join("")}}var H=this.getFullRequestString(C);return H},setLayerFilter:function(B,A){if(!this.layerDefs){this.layerDefs={}}if(A){this.layerDefs[B]=A}else{delete this.layerDefs[B]}},clearLayerFilter:function(A){if(A){delete this.layerDefs[A]}else{delete this.layerDefs}},mergeNewParams:function(B){var A=HGIS.Util.upperCaseObject(B);var C=[A];return HGIS.Layer.Grid.prototype.mergeNewParams.apply(this,C)},CLASS_NAME:"HGIS.Layer.ArcGIS93Rest"});HGIS.Handler.Hover=HGIS.Class(HGIS.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,mousemove:function(A){if(this.passesTolerance(A.xy)){this.clearTimer();this.callback("move",[A]);this.px=A.xy;A=HGIS.Util.extend({},A);this.timerId=window.setTimeout(HGIS.Function.bind(this.delayedCall,this,A),this.delay)}return !this.stopMove},mouseout:function(A){if(HGIS.Util.mouseLeft(A,this.map.viewPortDiv)){this.clearTimer();this.callback("move",[A])}return true},passesTolerance:function(C){var A=true;if(this.pixelTolerance&&this.px){var B=Math.sqrt(Math.pow(this.px.x-C.x,2)+Math.pow(this.px.y-C.y,2));if(B<this.pixelTolerance){A=false}}return A},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(A){this.callback("pause",[A])},deactivate:function(){var A=false;if(HGIS.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();A=true}return A},CLASS_NAME:"HGIS.Handler.Hover"});HGIS.Control.GetFeature=HGIS.Class(HGIS.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,single:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:HGIS.Filter.Spatial.BBOX,initialize:function(A){A.handlerOptions=A.handlerOptions||{};HGIS.Control.prototype.initialize.apply(this,[A]);this.features={};this.handlers={};if(this.click){this.handlers.click=new HGIS.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})}if(this.box){this.handlers.box=new HGIS.Handler.Box(this,{done:this.selectBox},HGIS.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))}if(this.hover){this.handlers.hover=new HGIS.Handler.Hover(this,{"move":this.cancelHover,"pause":this.selectHover},HGIS.Util.extend(this.handlerOptions.hover,{"delay":250,"pixelTolerance":2}))}},activate:function(){if(!this.active){for(var A in this.handlers){this.handlers[A].activate()}}return HGIS.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var A in this.handlers){this.handlers[A].deactivate()}}return HGIS.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(B){var A=this.pixelToBounds(B.xy);this.setModifiers(B);this.request(A,{single:this.single})},selectBox:function(C){var B;if(C instanceof HGIS.Bounds){var A=this.map.getLonLatFromPixel({x:C.left,y:C.bottom});var D=this.map.getLonLatFromPixel({x:C.right,y:C.top});B=new HGIS.Bounds(A.lon,A.lat,D.lon,D.lat)}else{if(this.click){return}B=this.pixelToBounds(C)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(B)},selectHover:function(B){var A=this.pixelToBounds(B.xy);this.request(A,{single:true,hover:true})},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);this.hoverResponse=null;HGIS.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},request:function(A,B){B=B||{};var C=new HGIS.Filter.Spatial({type:this.filterType,value:A});HGIS.Element.addClass(this.map.viewPortDiv,"olCursorWait");var D=this.protocol.read({maxFeatures:B.single==true?this.maxFeatures:undefined,filter:C,callback:function(E){if(E.success()){if(E.features.length){if(B.single==true){this.selectBestFeature(E.features,A.getCenterLonLat(),B)}else{this.select(E.features)}}else{if(B.hover){this.hoverSelect()}else{this.events.triggerEvent("clickout");if(this.clickout){this.unselectAll()}}}}HGIS.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});if(B.hover==true){this.hoverResponse=D}},selectBestFeature:function(B,C,E){E=E||{};if(B.length){var H=new HGIS.Geometry.Point(C.lon,C.lat);var I,A,G;var F=Number.MAX_VALUE;for(var D=0;D<B.length;++D){I=B[D];if(I.geometry){G=H.distanceTo(I.geometry,{edge:false});if(G<F){F=G;A=I;if(F==0){break}}}}if(E.hover==true){this.hoverSelect(A)}else{this.select(A||B)}}},setModifiers:function(A){this.modifiers={multiple:this.multiple||(this.multipleKey&&A[this.multipleKey]),toggle:this.toggle||(this.toggleKey&&A[this.toggleKey])}},select:function(A){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()}if(!(HGIS.Util.isArray(A))){A=[A]}var D=this.events.triggerEvent("beforefeaturesselected",{features:A});if(D!==false){var F=[];var B;for(var C=0,E=A.length;C<E;++C){B=A[C];if(this.features[B.fid||B.id]){if(this.modifiers.toggle){this.unselect(this.features[B.fid||B.id])}}else{D=this.events.triggerEvent("beforefeatureselected",{feature:B});if(D!==false){this.features[B.fid||B.id]=B;F.push(B);this.events.triggerEvent("featureselected",{feature:B})}}}this.events.triggerEvent("featuresselected",{features:F})}},hoverSelect:function(A){var C=A?A.fid||A.id:null;var B=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;if(B&&B!=C){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});this.hoverFeature=null}if(C&&C!=B){this.events.triggerEvent("hoverfeature",{feature:A});this.hoverFeature=A}},unselect:function(A){delete this.features[A.fid||A.id];this.events.triggerEvent("featureunselected",{feature:A})},unselectAll:function(){for(var A in this.features){this.unselect(this.features[A])}},setMap:function(B){for(var A in this.handlers){this.handlers[A].setMap(B)}HGIS.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(A){var C=A.add(-this.clickTolerance/2,this.clickTolerance/2);var E=A.add(this.clickTolerance/2,-this.clickTolerance/2);var B=this.map.getLonLatFromPixel(C);var D=this.map.getLonLatFromPixel(E);return new HGIS.Bounds(B.lon,B.lat,D.lon,D.lat)},CLASS_NAME:"HGIS.Control.GetFeature"});HGIS.Format.QueryStringFilter=(function(){var B={};B[HGIS.Filter.Comparison.EQUAL_TO]="eq";B[HGIS.Filter.Comparison.NOT_EQUAL_TO]="ne";B[HGIS.Filter.Comparison.LESS_THAN]="lt";B[HGIS.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";B[HGIS.Filter.Comparison.GREATER_THAN]="gt";B[HGIS.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";B[HGIS.Filter.Comparison.LIKE]="ilike";function A(C){C=C.replace(/%/g,"\\%");C=C.replace(/\\\\\.(\*)?/g,function(E,D){return D?E:"\\\\_"});C=C.replace(/\\\\\.\*/g,"\\\\%");C=C.replace(/(\\)?\.(\*)?/g,function(F,D,E){return D||E?F:"_"});C=C.replace(/(\\)?\.\*/g,function(E,D){return D?E:"%"});C=C.replace(/\\\./g,".");C=C.replace(/(\\)?\\\*/g,function(E,D){return D?E:"*"});return C}return HGIS.Class(HGIS.Format,{wildcarded:false,srsInBBOX:false,write:function(E,H){H=H||{};var D=E.CLASS_NAME;var C=D.substring(D.lastIndexOf(".")+1);switch(C){case"Spatial":switch(E.type){case HGIS.Filter.Spatial.BBOX:H.bbox=E.value.toArray();if(this.srsInBBOX&&E.projection){H.bbox.push(E.projection.getCode())}break;case HGIS.Filter.Spatial.DWITHIN:H.tolerance=E.distance;case HGIS.Filter.Spatial.WITHIN:H.lon=E.value.x;H.lat=E.value.y;break;default:HGIS.Console.warn("Unknown spatial filter type "+E.type)}break;case"Comparison":var J=B[E.type];if(J!==undefined){var F=E.value;if(E.type==HGIS.Filter.Comparison.LIKE){F=A(F);if(this.wildcarded){F="%"+F+"%"}}H[E.property+"__"+J]=F;H.queryable=H.queryable||[];H.queryable.push(E.property)}else{HGIS.Console.warn("Unknown comparison filter type "+E.type)}break;case"Logical":if(E.type===HGIS.Filter.Logical.AND){for(var G=0,I=E.filters.length;G<I;G++){H=this.write(E.filters[G],H)}}else{HGIS.Console.warn("Unsupported logical filter type "+E.type)}break;default:HGIS.Console.warn("Unknown filter type "+C)}return H},CLASS_NAME:"HGIS.Format.QueryStringFilter"})})();HGIS.Control.MousePosition=HGIS.Class(HGIS.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();HGIS.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(HGIS.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true}else{return false}},deactivate:function(){if(HGIS.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true}else{return false}},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}return this.div},redraw:function(B){var A;if(B==null){this.reset();return}else{if(this.lastXy==null||Math.abs(B.xy.x-this.lastXy.x)>this.granularity||Math.abs(B.xy.y-this.lastXy.y)>this.granularity){this.lastXy=B.xy;return}A=this.map.getLonLatFromPixel(B.xy);if(!A){return}if(this.displayProjection){A.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=B.xy}var C=this.formatOutput(A);if(C!=this.element.innerHTML){this.element.innerHTML=C}},reset:function(A){if(this.emptyString!=null){this.element.innerHTML=this.emptyString}},formatOutput:function(A){var C=parseInt(this.numDigits);var B=this.prefix+A.lon.toFixed(C)+this.separator+A.lat.toFixed(C)+this.suffix;return B},CLASS_NAME:"HGIS.Control.MousePosition"});HGIS.Control.Geolocate=HGIS.Class(HGIS.Control,{geolocation:null,available:("geolocation" in navigator),bind:true,watch:false,geolocationOptions:null,destroy:function(){this.deactivate();HGIS.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(this.available&&!this.geolocation){this.geolocation=navigator.geolocation}if(!this.geolocation){this.events.triggerEvent("locationuncapable");return false}if(HGIS.Control.prototype.activate.apply(this,arguments)){if(this.watch){this.watchId=this.geolocation.watchPosition(HGIS.Function.bind(this.geolocate,this),HGIS.Function.bind(this.failure,this),this.geolocationOptions)}else{this.getCurrentLocation()}return true}return false},deactivate:function(){if(this.active&&this.watchId!==null){this.geolocation.clearWatch(this.watchId)}return HGIS.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(B){var A=new HGIS.LonLat(B.coords.longitude,B.coords.latitude).transform(new HGIS.Projection("EPSG:4326"),this.map.getProjectionObject());if(this.bind){this.map.setCenter(A)}this.events.triggerEvent("locationupdated",{position:B,point:new HGIS.Geometry.Point(A.lon,A.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return false}this.geolocation.getCurrentPosition(HGIS.Function.bind(this.geolocate,this),HGIS.Function.bind(this.failure,this),this.geolocationOptions);return true},failure:function(A){this.events.triggerEvent("locationfailed",{error:A})},CLASS_NAME:"HGIS.Control.Geolocate"});HGIS.Tile.UTFGrid=HGIS.Class(HGIS.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();HGIS.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var B=HGIS.Tile.prototype.draw.apply(this,arguments);if(B){if(this.isLoading){this.abortLoading();this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.url=this.layer.getURL(this.bounds);if(this.layer.useJSONP){var A=new HGIS.Protocol.Script({url:this.url,callback:function(C){this.isLoading=false;this.events.triggerEvent("loadend");this.json=C.data},scope:this});A.read();this.request=A}else{this.request=HGIS.Request.GET({url:this.url,callback:function(C){this.isLoading=false;this.events.triggerEvent("loadend");if(C.status===200){this.parseData(C.responseText)}},scope:this})}}else{this.unload()}return B},abortLoading:function(){if(this.request){this.request.abort();delete this.request}this.isLoading=false},getFeatureInfo:function(A,C){var B=null;if(this.json){var D=this.getFeatureId(A,C);if(D!==null){B={id:D,data:this.json.data[D]}}}return B},getFeatureId:function(E,C){var G=null;if(this.json){var H=this.utfgridResolution;var F=Math.floor(C/H);var I=Math.floor(E/H);var D=this.json.grid[F].charCodeAt(I);var A=this.indexFromCharCode(D);var B=this.json.keys;if(!isNaN(A)&&(A in B)){G=B[A]}}return G},indexFromCharCode:function(A){if(A>=93){A--}if(A>=35){A--}return A-32},parseData:function(A){if(!this.format){this.format=new HGIS.Format.JSON()}this.json=this.format.read(A)},clear:function(){this.json=null},CLASS_NAME:"HGIS.Tile.UTFGrid"});HGIS.Protocol.HTTP=HGIS.Class(HGIS.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,updateWithPOST:false,deleteWithPOST:false,wildcarded:false,srsInBBOX:false,initialize:function(B){B=B||{};this.params={};this.headers={};HGIS.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&HGIS.Format.QueryStringFilter){var A=new HGIS.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(C,D){return A.write(C,D)}}},destroy:function(){this.params=null;this.headers=null;HGIS.Protocol.prototype.destroy.apply(this)},read:function(B){HGIS.Protocol.prototype.read.apply(this,arguments);B=B||{};B.params=HGIS.Util.applyDefaults(B.params,this.options.params);B=HGIS.Util.applyDefaults(B,this.options);if(B.filter&&this.filterToParams){B.params=this.filterToParams(B.filter,B.params)}var C=(B.readWithPOST!==undefined)?B.readWithPOST:this.readWithPOST;var D=new HGIS.Protocol.Response({requestType:"read"});if(C){var A=B.headers||{};A["Content-Type"]="application/x-www-form-urlencoded";D.priv=HGIS.Request.POST({url:B.url,callback:this.createCallback(this.handleRead,D,B),data:HGIS.Util.getParameterString(B.params),headers:A})}else{D.priv=HGIS.Request.GET({url:B.url,callback:this.createCallback(this.handleRead,D,B),params:B.params,headers:B.headers})}return D},handleRead:function(B,A){this.handleResponse(B,A)},create:function(A,B){B=HGIS.Util.applyDefaults(B,this.options);var C=new HGIS.Protocol.Response({reqFeatures:A,requestType:"create"});C.priv=HGIS.Request.POST({url:B.url,callback:this.createCallback(this.handleCreate,C,B),headers:B.headers,data:this.format.write(A)});return C},handleCreate:function(B,A){this.handleResponse(B,A)},update:function(A,C){C=C||{};var B=C.url||A.url||this.options.url+"/"+A.fid;C=HGIS.Util.applyDefaults(C,this.options);var E=new HGIS.Protocol.Response({reqFeatures:A,requestType:"update"});var D=this.updateWithPOST?"POST":"PUT";E.priv=HGIS.Request[D]({url:B,callback:this.createCallback(this.handleUpdate,E,C),headers:C.headers,data:this.format.write(A)});return E},handleUpdate:function(B,A){this.handleResponse(B,A)},"delete":function(A,D){D=D||{};var B=D.url||A.url||this.options.url+"/"+A.fid;D=HGIS.Util.applyDefaults(D,this.options);var F=new HGIS.Protocol.Response({reqFeatures:A,requestType:"delete"});var E=this.deleteWithPOST?"POST":"DELETE";var C={url:B,callback:this.createCallback(this.handleDelete,F,D),headers:D.headers};if(this.deleteWithPOST){C.data=this.format.write(A)}F.priv=HGIS.Request[E](C);return F},handleDelete:function(B,A){this.handleResponse(B,A)},handleResponse:function(C,B){var A=C.priv;if(B.callback){if(A.status>=200&&A.status<300){if(C.requestType!="delete"){C.features=this.parseFeatures(A)}C.code=HGIS.Protocol.Response.SUCCESS}else{C.code=HGIS.Protocol.Response.FAILURE}B.callback.call(B.scope,C)}},parseFeatures:function(A){var B=A.responseXML;if(!B||!B.documentElement){B=A.responseText}if(!B||B.length<=0){return null}return this.format.read(B)},commit:function(P,K){K=HGIS.Util.applyDefaults(K,this.options);var L=[],F=0;var I={};I[HGIS.State.INSERT]=[];I[HGIS.State.UPDATE]=[];I[HGIS.State.DELETE]=[];var O,E,C=[];for(var J=0,N=P.length;J<N;++J){O=P[J];E=I[O.state];if(E){E.push(O);C.push(O)}}var B=(I[HGIS.State.INSERT].length>0?1:0)+I[HGIS.State.UPDATE].length+I[HGIS.State.DELETE].length;var H=true;var D=new HGIS.Protocol.Response({reqFeatures:C});function M(T){var S=T.features?T.features.length:0;var R=new Array(S);for(var Q=0;Q<S;++Q){R[Q]=T.features[Q].fid}D.insertIds=R;A.apply(this,[T])}function A(Q){this.callUserCallback(Q,K);H=H&&Q.success();F++;if(F>=B){if(K.callback){D.code=H?HGIS.Protocol.Response.SUCCESS:HGIS.Protocol.Response.FAILURE;K.callback.apply(K.scope,[D])}}}var G=I[HGIS.State.INSERT];if(G.length>0){L.push(this.create(G,HGIS.Util.applyDefaults({callback:M,scope:this},K.create)))}G=I[HGIS.State.UPDATE];for(var J=G.length-1;J>=0;--J){L.push(this.update(G[J],HGIS.Util.applyDefaults({callback:A,scope:this},K.update)))}G=I[HGIS.State.DELETE];for(var J=G.length-1;J>=0;--J){L.push(this["delete"](G[J],HGIS.Util.applyDefaults({callback:A,scope:this},K["delete"])))}return L},abort:function(A){if(A){A.priv.abort()}},callUserCallback:function(C,B){var A=B[C.requestType];if(A&&A.callback){A.callback.call(A.scope,C)}},CLASS_NAME:"HGIS.Protocol.HTTP"});HGIS.Strategy.Cluster=HGIS.Class(HGIS.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,activate:function(){var A=HGIS.Strategy.prototype.activate.call(this);if(A){this.layer.events.on({"beforefeaturesadded":this.cacheFeatures,"featuresremoved":this.clearCache,"moveend":this.cluster,scope:this})}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){this.clearCache();this.layer.events.un({"beforefeaturesadded":this.cacheFeatures,"featuresremoved":this.clearCache,"moveend":this.cluster,scope:this})}return A},cacheFeatures:function(B){var A=true;if(!this.clustering){this.clearCache();this.features=B.features;this.cluster();A=false}return A},clearCache:function(){if(!this.clustering){this.features=null}},cluster:function(D){if((!D||D.zoomChanged)&&this.features){var H=this.layer.map.getResolution();if(H!=this.resolution||!this.clustersExist()){this.resolution=H;var F=[];var J,A,B;for(var E=0;E<this.features.length;++E){J=this.features[E];if(J.geometry){A=false;for(var G=F.length-1;G>=0;--G){B=F[G];if(this.shouldCluster(B,J)){this.addToCluster(B,J);A=true;break}}if(!A){F.push(this.createCluster(this.features[E]))}}}this.clustering=true;this.layer.removeAllFeatures();this.clustering=false;if(F.length>0){if(this.threshold>1){var C=F.slice();F=[];var K;for(var E=0,I=C.length;E<I;++E){K=C[E];if(K.attributes.count<this.threshold){Array.prototype.push.apply(F,K.cluster)}else{F.push(K)}}}this.clustering=true;this.layer.addFeatures(F);this.clustering=false}this.clusters=F}}},clustersExist:function(){var B=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){B=true;for(var A=0;A<this.clusters.length;++A){if(this.clusters[A]!=this.layer.features[A]){B=false;break}}}return B},shouldCluster:function(C,A){var B=C.geometry.getBounds().getCenterLonLat();var D=A.geometry.getBounds().getCenterLonLat();var E=(Math.sqrt(Math.pow((B.lon-D.lon),2)+Math.pow((B.lat-D.lat),2))/this.resolution);return(E<=this.distance)},addToCluster:function(B,A){B.cluster.push(A);B.attributes.count+=1},createCluster:function(A){var B=A.geometry.getBounds().getCenterLonLat();var C=new HGIS.Feature.Vector(new HGIS.Geometry.Point(B.lon,B.lat),{count:1});C.cluster=[A];return C},CLASS_NAME:"HGIS.Strategy.Cluster"});HGIS.Strategy.Filter=HGIS.Class(HGIS.Strategy,{filter:null,cache:null,caching:false,activate:function(){var A=HGIS.Strategy.prototype.activate.apply(this,arguments);if(A){this.cache=[];this.layer.events.on({"beforefeaturesadded":this.handleAdd,"beforefeaturesremoved":this.handleRemove,scope:this})}return A},deactivate:function(){this.cache=null;if(this.layer&&this.layer.events){this.layer.events.un({"beforefeaturesadded":this.handleAdd,"beforefeaturesremoved":this.handleRemove,scope:this})}return HGIS.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(E){if(!this.caching&&this.filter){var A=E.features;E.features=[];var B;for(var C=0,D=A.length;C<D;++C){B=A[C];if(this.filter.evaluate(B)){E.features.push(B)}else{this.cache.push(B)}}}},handleRemove:function(A){if(!this.caching){this.cache=[]}},setFilter:function(B){this.filter=B;var A=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=true;this.layer.removeFeatures(this.cache.slice());this.caching=false}if(A.length>0){var C={features:A};this.handleAdd(C);if(C.features.length>0){this.caching=true;this.layer.addFeatures(C.features);this.caching=false}}},CLASS_NAME:"HGIS.Strategy.Filter"});HGIS.Strategy.Grid=HGIS.Class(HGIS.Strategy,{tileSize:null,grid:null,buffer:1,loadedBounds:null,numLoadingTiles:0,zoom:null,geometryFeatureMap:{},tiles:{},totalTileCount:0,allFeatures:[],progress:0,initialize:function(A){HGIS.Strategy.prototype.initialize.apply(this,[A])},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;HGIS.Strategy.prototype.destroy.apply(this,arguments)},activate:function(){var A=HGIS.Strategy.prototype.activate.call(this);if(A){this.layer.events.on({"moveend":this.update,"refresh":this.update,scope:this});if(this.layer.visibility==true||this.preload){this.update()}else{this.layer.events.on({"visibilitychanged":this.load,scope:this})}}return A},deactivate:function(){var A=HGIS.Strategy.prototype.deactivate.call(this);if(A){this.layer.events.un({"moveend":this.update,"refresh":this.update,"visibilitychanged":this.load,scope:this})}return A},update:function(){this.progress=0;this.totalTileCount=0;this.allFeatures=[];var D=this.layer.map.getExtent();if(D==null){return}var M=this.layer.map;var K=M.getResolution();var E=M.getTileSize();var A=M.zoom;var L=this.layer.maxExtent;var C=K*E.w;var G=K*E.h;var P=Math.floor((D.left-L.left)/C)-this.buffer;var F=Math.ceil((D.right-L.left)/C)+this.buffer;var N=Math.floor((L.top-D.top)/G)-this.buffer;var J=Math.ceil((L.top-D.bottom)/G)+this.buffer;if(A!=this.zoom){this.layer.destroyFeatures();this.geometryFeatureMap={};this.tiles={};this.zoom=A}var H=[];for(var R=P;R<F;R++){for(var S=N;S<J;S++){if(!([R,S] in this.tiles)){var O=R*C+L.left;var B=L.top-S*G;var I={x:R,y:S,curZoom:A,bl:O,bt:B};H.push(I)}}}this.totalTileCount=H.length;for(var Q=0;Q<H.length;Q++){this.loadTile(H[Q].x,H[Q].y,H[Q].curZoom,new HGIS.Bounds(H[Q].bl,H[Q].bt-G,H[Q].bl+C,H[Q].bt),Q)}},loadTile_promise:function(E,F,D,C){var A=this;var B=HGIS.String.format(this.layer.protocol.url,{x:E,y:F,z:D});new Promise(function(H,G){if(HGIS.Strategy.Parameters.isCache&&HGIS.Strategy.Parameters.isConnected){var J=function(K){H(URL.createObjectURL(K))};var I=function(K){A.takeUrlToIndexedDB(B,D);H(B)};HGIS.Strategy.Parameters.wtc.query(B.hashCode(),D,J,I)}else{H(B)}}).then(function(G){A.response=A.layer.protocol.read({url:G,filter:A.layer.filter,callback:A.readDone,scope:{scope:A,options:{x:E,y:F,z:D,bounds:C}}})})},takeUrlToIndexedDB:function(A,B){var C=new XMLHttpRequest();C.open("GET",A,true);C.responseType="blob";C.addEventListener("load",function(){if(C.status===200){HGIS.Strategy.Parameters.wtc.insert(A.hashCode(),B,C.response)}else{}},false);C.send()},loadTile:function(D,E,C,B,A){if(HGIS.Strategy.Parameters.isCache&&HGIS.Strategy.Parameters.isConnected){this.loadTile_promise(D,E,C,B,A)}else{this.loadTile_origin(D,E,C,B,A)}},loadTile_origin:function(E,F,D,C,A){var B=HGIS.String.format(this.layer.protocol.url,{x:E,y:F,z:D});this.response=this.layer.protocol.read({url:B,filter:this.layer.filter,callback:this.readDone,scope:{scope:this,options:{x:E,y:F,z:D,bounds:C},totalTileCount:this.totalTileCount}})},readDone:function(A){this.scope.merge(A,this.options)},merge:function(C,S){this.progress+=1;if(S.z!=this.zoom){return}var D=S.bounds;var V=C.features;if(V!=null&&V.length>0){var P=this.layer.map.resolution;var H=this.layer.map.getExtent();var R=this.caculateOrigin(V[0].origin,P);var A=this.calculateDXY(R,H,P);var T=this.layer.projection;var N=this.layer.map.getProjectionObject();var U=!N.equals(T);for(var G=0,B=V.length;G<B;++G){var Q=V[G].geometry;V[G].oldGeometry=[];for(var F=0;F<V[G].geometry.length;F++){V[G].oldGeometry[F]=V[G].geometry[F]}if(V[G].type==1){Q[0]+=A.x;Q[1]+=A.y}else{if(V[G].type==2){for(var E=0,L=Q.length;E<L;E=E+2){if(Q[E]=="|"){continue}Q[E]+=A.x;Q[E+1]+=A.y}if(V[G].attributes["superType"]=="ROAD"&&V[G].attributes["textCoords"]!==""){V[G].attributes["oldTextCoords"]=V[G].attributes["textCoords"];var M=[];var O=V[G].attributes["textCoords"].split(",");for(var I=0,J=O.length;I<J;I++){var K=O[I].split(" ");M.push([parseInt(K[0])+A.x,parseInt(K[1])+A.y,K[2]])}V[G].attributes["textCoords"]=M}}else{if(V[G].type==3){for(var E=0,L=Q.length;E<L;E=E+2){if(Q[E]=="|"){continue}Q[E]+=A.x;Q[E+1]+=A.y}}}}if(Q){if(U){Q.transform(T,N)}this.allFeatures.push(V[G])}}this.tiles[[S.x,S.y]]=true}if(this.progress==this.totalTileCount){this.layer.addFeatures(this.allFeatures)}this.response=null},caculateOrigin:function(D,B){var C=[0,0];var A=D.split("-");C[0]=HGIS.InitParam.tileOrigin.lon+(A[1])*256*B;C[1]=HGIS.InitParam.tileOrigin.lat-(A[0])*256*B;return C},calculateDXY:function(D,A,C){var B=(D[0]-A.left)/C;B=Math.round(B);var E=(A.top-D[1])/C;E=Math.round(E);return{"x":B,"y":E}},CLASS_NAME:"HGIS.Strategy.Grid"});HGIS.Protocol.SOS=function(B){B=HGIS.Util.applyDefaults(B,HGIS.Protocol.SOS.DEFAULTS);var A=HGIS.Protocol.SOS["v"+B.version.replace(/\./g,"_")];if(!A){throw"Unsupported SOS version: "+B.version}return new A(B)};HGIS.Protocol.SOS.DEFAULTS={"version":"1.0.0"};HGIS.Format.WFSDescribeFeatureType=HGIS.Class(HGIS.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g)},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{"xsd":{"schema":function(I,J){var L=[];var E={};var A={complexTypes:L,customTypes:E};var G,K;this.readChildNodes(I,A);var H=I.attributes;var F,B;for(G=0,K=H.length;G<K;++G){F=H[G];B=F.name;if(B.indexOf("xmlns")===0){this.setNamespace(B.split(":")[1]||"",F.value)}else{J[B]=F.value}}J.featureTypes=L;J.targetPrefix=this.namespaceAlias[J.targetNamespace];var D,C;for(G=0,K=L.length;G<K;++G){D=L[G];C=E[D.typeName];if(E[D.typeName]){D.typeName=C.name}}},"complexType":function(B,A){var C={"typeName":B.getAttribute("name")};this.readChildNodes(B,C);A.complexTypes.push(C)},"complexContent":function(B,A){this.readChildNodes(B,A)},"extension":function(B,A){this.readChildNodes(B,A)},"sequence":function(C,B){var A={elements:[]};this.readChildNodes(C,A);B.properties=A.elements},"element":function(G,H){var J;if(H.elements){var A={};var F=G.attributes;var C;for(var E=0,I=F.length;E<I;++E){C=F[E];A[C.name]=C.value}J=A.type;if(!J){J={};this.readChildNodes(G,J);A.restriction=J;A.type=J.base}var B=J.base||J;A.localType=B.split(":").pop();H.elements.push(A);this.readChildNodes(G,A)}if(H.complexTypes){J=G.getAttribute("type");var D=J.split(":").pop();H.customTypes[D]={"name":G.getAttribute("name"),"type":J}}},"annotation":function(B,A){A.annotation={};this.readChildNodes(B,A.annotation)},"appinfo":function(B,A){if(!A.appinfo){A.appinfo=[]}A.appinfo.push(this.getChildValue(B))},"documentation":function(B,A){if(!A.documentation){A.documentation=[]}var C=this.getChildValue(B);A.documentation.push({lang:B.getAttribute("xml:lang"),textContent:C.replace(this.regExes.trimSpace,"")})},"simpleType":function(B,A){this.readChildNodes(B,A)},"restriction":function(B,A){A.base=B.getAttribute("base");this.readRestriction(B,A)}}},readRestriction:function(F,G){var C=F.childNodes;var A,B,D;for(var E=0,H=C.length;E<H;++E){A=C[E];if(A.nodeType==1){B=A.nodeName.split(":").pop();D=A.getAttribute("value");if(!G[B]){G[B]=D}else{if(typeof G[B]=="string"){G[B]=[G[B]]}G[B].push(D)}}}},read:function(C){if(typeof C=="string"){C=HGIS.Format.XML.prototype.read.apply(this,[C])}if(C&&C.nodeType==9){C=C.documentElement}var A={};if(C.nodeName.split(":").pop()==="ExceptionReport"){var B=new HGIS.Format.OGCExceptionReport();A.error=B.read(C)}else{this.readNode(C,A)}return A},CLASS_NAME:"HGIS.Format.WFSDescribeFeatureType"});HGIS.Format.GeoRSS=HGIS.Class(HGIS.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,createGeometryFromItem:function(O){var M=this.getElementsByTagNameNS(O,this.georssns,"point");var A=this.getElementsByTagNameNS(O,this.geons,"lat");var E=this.getElementsByTagNameNS(O,this.geons,"long");var B=this.getElementsByTagNameNS(O,this.georssns,"line");var I=this.getElementsByTagNameNS(O,this.georssns,"polygon");var C=this.getElementsByTagNameNS(O,this.georssns,"where");var G=this.getElementsByTagNameNS(O,this.georssns,"box");if(M.length>0||(A.length>0&&E.length>0)){var L;if(M.length>0){L=HGIS.String.trim(M[0].firstChild.nodeValue).split(/\s+/);if(L.length!=2){L=HGIS.String.trim(M[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{L=[parseFloat(A[0].firstChild.nodeValue),parseFloat(E[0].firstChild.nodeValue)]}var N=new HGIS.Geometry.Point(L[1],L[0])}else{if(B.length>0){var K=HGIS.String.trim(this.getChildValue(B[0])).split(/\s+/);var H=[];var M;for(var J=0,F=K.length;J<F;J+=2){M=new HGIS.Geometry.Point(K[J+1],K[J]);H.push(M)}N=new HGIS.Geometry.LineString(H)}else{if(I.length>0){var K=HGIS.String.trim(this.getChildValue(I[0])).split(/\s+/);var H=[];var M;for(var J=0,F=K.length;J<F;J+=2){M=new HGIS.Geometry.Point(K[J+1],K[J]);H.push(M)}N=new HGIS.Geometry.Polygon([new HGIS.Geometry.LinearRing(H)])}else{if(C.length>0){if(!this.gmlParser){this.gmlParser=new HGIS.Format.GML({"xy":this.xy})}var D=this.gmlParser.parseFeature(C[0]);N=D.geometry}else{if(G.length>0){var K=HGIS.String.trim(G[0].firstChild.nodeValue).split(/\s+/);var H=[];var M;if(K.length>3){M=new HGIS.Geometry.Point(K[1],K[0]);H.push(M);M=new HGIS.Geometry.Point(K[1],K[2]);H.push(M);M=new HGIS.Geometry.Point(K[3],K[2]);H.push(M);M=new HGIS.Geometry.Point(K[3],K[0]);H.push(M);M=new HGIS.Geometry.Point(K[1],K[0]);H.push(M)}N=new HGIS.Geometry.Polygon([new HGIS.Geometry.LinearRing(H)])}}}}}if(N&&this.internalProjection&&this.externalProjection){N.transform(this.externalProjection,this.internalProjection)}return N},createFeatureFromItem:function(I){var D=this.createGeometryFromItem(I);var F=this._getChildValue(I,"*","title",this.featureTitle);var H=this._getChildValue(I,"*","description",this._getChildValue(I,"*","content",this._getChildValue(I,"*","summary",this.featureDescription)));var B=this._getChildValue(I,"*","link");if(!B){try{B=this.getElementsByTagNameNS(I,"*","link")[0].getAttribute("href")}catch(A){B=null}}var E=this._getChildValue(I,"*","id",null);var C={"title":F,"description":H,"link":B};var G=new HGIS.Feature.Vector(D,C);G.fid=E;return G},_getChildValue:function(A,C,B,F){var D;var E=this.getElementsByTagNameNS(A,C,B);if(E&&E[0]&&E[0].firstChild&&E[0].firstChild.nodeValue){D=this.getChildValue(E[0])}else{D=(F==undefined)?"":F}return D},read:function(E){if(typeof E=="string"){E=HGIS.Format.XML.prototype.read.apply(this,[E])}var D=null;D=this.getElementsByTagNameNS(E,"*","item");if(D.length==0){D=this.getElementsByTagNameNS(E,"*","entry")}var C=D.length;var A=new Array(C);for(var B=0;B<C;B++){A[B]=this.createFeatureFromItem(D[B])}return A},write:function(A){var C;if(HGIS.Util.isArray(A)){C=this.createElementNS(this.rssns,"rss");for(var B=0,D=A.length;B<D;B++){C.appendChild(this.createFeatureXML(A[B]))}}else{C=this.createFeatureXML(A)}return HGIS.Format.XML.prototype.write.apply(this,[C])},createFeatureXML:function(H){var A=this.buildGeometryNode(H.geometry);var G=this.createElementNS(this.rssns,"item");var I=this.createElementNS(this.rssns,"title");I.appendChild(this.createTextNode(H.attributes.title?H.attributes.title:""));var B=this.createElementNS(this.rssns,"description");B.appendChild(this.createTextNode(H.attributes.description?H.attributes.description:""));G.appendChild(I);G.appendChild(B);if(H.attributes.link){var C=this.createElementNS(this.rssns,"link");C.appendChild(this.createTextNode(H.attributes.link));G.appendChild(C)}for(var E in H.attributes){if(E=="link"||E=="title"||E=="description"){continue}var J=this.createTextNode(H.attributes[E]);var F=E;if(E.search(":")!=-1){F=E.split(":")[1]}var D=this.createElementNS(this.featureNS,"feature:"+F);D.appendChild(J);G.appendChild(D)}G.appendChild(A);return G},buildGeometryNode:function(B){if(this.internalProjection&&this.externalProjection){B=B.clone();B.transform(this.internalProjection,this.externalProjection)}var A;if(B.CLASS_NAME=="HGIS.Geometry.Polygon"){A=this.createElementNS(this.georssns,"georss:polygon");A.appendChild(this.buildCoordinatesNode(B.components[0]))}else{if(B.CLASS_NAME=="HGIS.Geometry.LineString"){A=this.createElementNS(this.georssns,"georss:line");A.appendChild(this.buildCoordinatesNode(B))}else{if(B.CLASS_NAME=="HGIS.Geometry.Point"){A=this.createElementNS(this.georssns,"georss:point");A.appendChild(this.buildCoordinatesNode(B))}else{throw"Couldn't parse "+B.CLASS_NAME}}}return A},buildCoordinatesNode:function(E){var D=null;if(E.components){D=E.components}var F;if(D){var C=D.length;var A=new Array(C);for(var B=0;B<C;B++){A[B]=D[B].y+" "+D[B].x}F=A.join(" ")}else{F=E.y+" "+E.x}return this.createTextNode(F)},CLASS_NAME:"HGIS.Format.GeoRSS"});HGIS.Format.WPSCapabilities=HGIS.Class(HGIS.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"HGIS.Format.WPSCapabilities"});HGIS.Format.WPSCapabilities.v1_0_0=HGIS.Class(HGIS.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A])},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);return A},readers:{"wps":{"Capabilities":function(B,A){this.readChildNodes(B,A)},"ProcessOfferings":function(B,A){A.processOfferings={};this.readChildNodes(B,A.processOfferings)},"Process":function(A,B){var C=this.getAttributeNS(A,this.namespaces.wps,"processVersion");var D={processVersion:C};this.readChildNodes(A,D);B[D.identifier]=D},"Languages":function(B,A){A.languages=[];this.readChildNodes(B,A.languages)},"Default":function(C,A){var B={isDefault:true};this.readChildNodes(C,B);A.push(B)},"Supported":function(C,A){var B={};this.readChildNodes(C,B);A.push(B)}},"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.readers["ows"]},CLASS_NAME:"HGIS.Format.WPSCapabilities.v1_0_0"});HGIS.Control.PinchZoom=HGIS.Class(HGIS.Control,{type:HGIS.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:true,preserveCenter:false,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,arguments);this.handler=new HGIS.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(B,C){var A=(this.preserveCenter)?this.map.getPixelFromLonLat(this.map.getCenter()):B.xy;this.pinchOrigin=A;this.currentCenter=A},pinchMove:function(B,G){var C=G.scale;var D=this.map.layerContainerOriginPx;var A=this.pinchOrigin;var H=(this.preserveCenter)?this.map.getPixelFromLonLat(this.map.getCenter()):B.xy;var E=Math.round((D.x+H.x-A.x)+(C-1)*(D.x-A.x));var F=Math.round((D.y+H.y-A.y)+(C-1)*(D.y-A.y));this.map.applyTransform(E,F,C);this.currentCenter=H},pinchDone:function(A,B,E){this.map.applyTransform();var C=this.map.getZoomForResolution(this.map.getResolution()/E.scale,true);if(C!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var G=this.map.getResolutionForZoom(C);var H=this.map.getLonLatFromPixel(this.pinchOrigin);var F=this.currentCenter;var D=this.map.getSize();H.lon+=G*((D.w/2)-F.x);H.lat-=G*((D.h/2)-F.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(H,C)}},CLASS_NAME:"HGIS.Control.PinchZoom"});HGIS.Control.TouchNavigation=HGIS.Class(HGIS.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:false,autoActivate:true,initialize:function(A){this.handlers={};HGIS.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.pinchZoom){this.pinchZoom.destroy();delete this.pinchZoom}HGIS.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(HGIS.Control.prototype.activate.apply(this,arguments)){this.dragPan.activate();this.handlers.click.activate();this.pinchZoom.activate();return true}return false},deactivate:function(){if(HGIS.Control.prototype.deactivate.apply(this,arguments)){this.dragPan.deactivate();this.handlers.click.deactivate();this.pinchZoom.deactivate();return true}return false},draw:function(){var B={click:this.defaultClick,dblclick:this.defaultDblClick};var A=HGIS.Util.extend({"double":true,stopDouble:true,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new HGIS.Handler.Click(this,B,A);this.dragPan=new HGIS.Control.DragPan(HGIS.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new HGIS.Control.PinchZoom(HGIS.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(A){if(A.lastTouches&&A.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(A){this.map.zoomTo(this.map.zoom+1,A.xy)},CLASS_NAME:"HGIS.Control.TouchNavigation"});HGIS.Console.warn("HGIS.Rico is deprecated");HGIS.Rico=HGIS.Rico||{};HGIS.Rico.Color=HGIS.Class({initialize:function(A,C,B){this.rgb={r:A,g:C,b:B}},setRed:function(A){this.rgb.r=A},setGreen:function(A){this.rgb.g=A},setBlue:function(A){this.rgb.b=A},setHue:function(A){var B=this.asHSB();B.h=A;this.rgb=HGIS.Rico.Color.HSBtoRGB(B.h,B.s,B.b)},setSaturation:function(B){var A=this.asHSB();A.s=B;this.rgb=HGIS.Rico.Color.HSBtoRGB(A.h,A.s,A.b)},setBrightness:function(B){var A=this.asHSB();A.b=B;this.rgb=HGIS.Rico.Color.HSBtoRGB(A.h,A.s,A.b)},darken:function(A){var B=this.asHSB();this.rgb=HGIS.Rico.Color.HSBtoRGB(B.h,B.s,Math.max(B.b-A,0))},brighten:function(A){var B=this.asHSB();this.rgb=HGIS.Rico.Color.HSBtoRGB(B.h,B.s,Math.min(B.b+A,1))},blend:function(A){this.rgb.r=Math.floor((this.rgb.r+A.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+A.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+A.rgb.b)/2)},isBright:function(){var A=this.asHSB();return this.asHSB().b>0.5},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return HGIS.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});HGIS.Rico.Color.createFromHex=function(E){if(E.length==4){var D=E;var E="#";for(var A=1;A<4;A++){E+=(D.charAt(A)+D.charAt(A))}}if(E.indexOf("#")==0){E=E.substring(1)}var C=E.substring(0,2);var F=E.substring(2,4);var B=E.substring(4,6);return new HGIS.Rico.Color(parseInt(C,16),parseInt(F,16),parseInt(B,16))};HGIS.Rico.Color.createColorFromBackground=function(B){var A=HGIS.Element.getStyle(HGIS.Util.getElement(B),"backgroundColor");if(A=="transparent"&&B.parentNode){return HGIS.Rico.Color.createColorFromBackground(B.parentNode)}if(A==null){return new HGIS.Rico.Color(255,255,255)}if(A.indexOf("rgb(")==0){var D=A.substring(4,A.length-1);var C=D.split(",");return new HGIS.Rico.Color(parseInt(C[0]),parseInt(C[1]),parseInt(C[2]))}else{if(A.indexOf("#")==0){return HGIS.Rico.Color.createFromHex(A)}else{return new HGIS.Rico.Color(255,255,255)}}};HGIS.Rico.Color.HSBtoRGB=function(G,A,C){var J=0;var F=0;var I=0;if(A==0){J=parseInt(C*255+0.5);F=J;I=J}else{var H=(G-Math.floor(G))*6;var K=H-Math.floor(H);var D=C*(1-A);var B=C*(1-A*K);var E=C*(1-(A*(1-K)));switch(parseInt(H)){case 0:J=(C*255+0.5);F=(E*255+0.5);I=(D*255+0.5);break;case 1:J=(B*255+0.5);F=(C*255+0.5);I=(D*255+0.5);break;case 2:J=(D*255+0.5);F=(C*255+0.5);I=(E*255+0.5);break;case 3:J=(D*255+0.5);F=(B*255+0.5);I=(C*255+0.5);break;case 4:J=(E*255+0.5);F=(D*255+0.5);I=(C*255+0.5);break;case 5:J=(C*255+0.5);F=(D*255+0.5);I=(B*255+0.5);break}}return{r:parseInt(J),g:parseInt(F),b:parseInt(I)}};HGIS.Rico.Color.RGBtoHSB=function(A,K,H){var G;var B;var D;var I=(A>K)?A:K;if(H>I){I=H}var J=(A<K)?A:K;if(H<J){J=H}D=I/255;if(I!=0){B=(I-J)/I}else{B=0}if(B==0){G=0}else{var F=(I-A)/(I-J);var C=(I-K)/(I-J);var E=(I-H)/(I-J);if(A==I){G=E-C}else{if(K==I){G=2+F-E}else{G=4+C-F}}G=G/6;if(G<0){G=G+1}}return{h:G,s:B,b:D}};HGIS.Style2=HGIS.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,initialize:function(A){HGIS.Util.extend(this,A);this.id=HGIS.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var A=0,B=this.rules.length;A<B;A++){this.rules[A].destroy()}delete this.rules},clone:function(){var B=HGIS.Util.extend({},this);if(this.rules){B.rules=[];for(var A=0,C=this.rules.length;A<C;++A){B.rules.push(this.rules[A].clone())}}return new HGIS.Style2(B)},CLASS_NAME:"HGIS.Style2"});HGIS.Format.WFS=HGIS.Class(HGIS.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(B,A){HGIS.Format.GML.prototype.initialize.apply(this,[B]);this.layer=A;if(this.layer.featureNS){this.featureNS=this.layer.featureNS}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column}if(this.layer.options.typename){this.featureName=this.layer.options.typename}},write:function(A){var C=this.createElementNS(this.wfsns,"wfs:Transaction");C.setAttribute("version","1.0.0");C.setAttribute("service","WFS");for(var B=0;B<A.length;B++){switch(A[B].state){case HGIS.State.INSERT:C.appendChild(this.insert(A[B]));break;case HGIS.State.UPDATE:C.appendChild(this.update(A[B]));break;case HGIS.State.DELETE:C.appendChild(this.remove(A[B]));break}}return HGIS.Format.XML.prototype.write.apply(this,[C])},createFeatureXML:function(G){var A=this.buildGeometryNode(G.geometry);var F=this.createElementNS(this.featureNS,"feature:"+this.geometryName);F.appendChild(A);var B=this.createElementNS(this.featureNS,"feature:"+this.featureName);B.appendChild(F);for(var D in G.attributes){var H=this.createTextNode(G.attributes[D]);var E=D;if(D.search(":")!=-1){E=D.split(":")[1]}var C=this.createElementNS(this.featureNS,"feature:"+E);C.appendChild(H);B.appendChild(C)}return B},insert:function(A){var B=this.createElementNS(this.wfsns,"wfs:Insert");B.appendChild(this.createFeatureXML(A));return B},update:function(J){if(!J.fid){HGIS.Console.userError(HGIS.i18n("noFID"))}var G=this.createElementNS(this.wfsns,"wfs:Update");G.setAttribute("typeName",this.featurePrefix+":"+this.featureName);G.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var E=this.createElementNS(this.wfsns,"wfs:Property");var F=this.createElementNS(this.wfsns,"wfs:Name");var H=this.createTextNode(this.geometryName);F.appendChild(H);E.appendChild(F);var B=this.createElementNS(this.wfsns,"wfs:Value");var A=this.buildGeometryNode(J.geometry);if(J.layer){A.setAttribute("srsName",J.layer.projection.getCode())}B.appendChild(A);E.appendChild(B);G.appendChild(E);for(var C in J.attributes){E=this.createElementNS(this.wfsns,"wfs:Property");F=this.createElementNS(this.wfsns,"wfs:Name");F.appendChild(this.createTextNode(C));E.appendChild(F);B=this.createElementNS(this.wfsns,"wfs:Value");B.appendChild(this.createTextNode(J.attributes[C]));E.appendChild(B);G.appendChild(E)}var D=this.createElementNS(this.ogcns,"ogc:Filter");var I=this.createElementNS(this.ogcns,"ogc:FeatureId");I.setAttribute("fid",J.fid);D.appendChild(I);G.appendChild(D);return G},remove:function(A){if(!A.fid){HGIS.Console.userError(HGIS.i18n("noFID"));return false}var B=this.createElementNS(this.wfsns,"wfs:Delete");B.setAttribute("typeName",this.featurePrefix+":"+this.featureName);B.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var C=this.createElementNS(this.ogcns,"ogc:Filter");var D=this.createElementNS(this.ogcns,"ogc:FeatureId");D.setAttribute("fid",A.fid);C.appendChild(D);B.appendChild(C);return B},destroy:function(){this.layer=null},CLASS_NAME:"HGIS.Format.WFS"});HGIS.Format.SLD.v1_0_0_GeoServer=HGIS.Class(HGIS.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:HGIS.Util.applyDefaults({"sld":HGIS.Util.applyDefaults({"Priority":function(B,A){var C=this.readers.ogc._expression.call(this,B);if(C){A.priority=C}},"VendorOption":function(B,A){if(!A.vendorOptions){A.vendorOptions={}}A.vendorOptions[B.getAttribute("name")]=this.getChildValue(B)},"TextSymbolizer":function(B,A){HGIS.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var C=this.multipleSymbolizers?A.symbolizers[A.symbolizers.length-1]:A.symbolizer["Text"];if(C.graphic===undefined){C.graphic=false}}},HGIS.Format.SLD.v1_0_0.prototype.readers["sld"])},HGIS.Format.SLD.v1_0_0.prototype.readers),writers:HGIS.Util.applyDefaults({"sld":HGIS.Util.applyDefaults({"Priority":function(A){return this.writers.sld._OGCExpression.call(this,"sld:Priority",A)},"VendorOption":function(A){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:A.name},value:A.value})},"TextSymbolizer":function(A){var C=HGIS.Format.SLD.v1_0_0.prototype.writers;var B=C["sld"]["TextSymbolizer"].apply(this,arguments);if(A.graphic!==false&&(A.externalGraphic||A.graphicName)){this.writeNode("Graphic",A,B)}if("priority" in A){this.writeNode("Priority",A.priority,B)}return this.addVendorOptions(B,A)},"PointSymbolizer":function(A){var C=HGIS.Format.SLD.v1_0_0.prototype.writers;var B=C["sld"]["PointSymbolizer"].apply(this,arguments);return this.addVendorOptions(B,A)},"LineSymbolizer":function(A){var C=HGIS.Format.SLD.v1_0_0.prototype.writers;var B=C["sld"]["LineSymbolizer"].apply(this,arguments);return this.addVendorOptions(B,A)},"PolygonSymbolizer":function(A){var C=HGIS.Format.SLD.v1_0_0.prototype.writers;var B=C["sld"]["PolygonSymbolizer"].apply(this,arguments);return this.addVendorOptions(B,A)}},HGIS.Format.SLD.v1_0_0.prototype.writers["sld"])},HGIS.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(C,B){var D=B.vendorOptions;if(D){for(var A in B.vendorOptions){this.writeNode("VendorOption",{name:A,value:B.vendorOptions[A]},C)}}return C},CLASS_NAME:"HGIS.Format.SLD.v1_0_0_GeoServer"});HGIS.Layer.Boxes=HGIS.Class(HGIS.Layer.Markers,{drawMarker:function(C){var D=this.map.getLayerPxFromLonLat({lon:C.bounds.left,lat:C.bounds.top});var B=this.map.getLayerPxFromLonLat({lon:C.bounds.right,lat:C.bounds.bottom});if(B==null||D==null){C.display(false)}else{var A=C.draw(D,{w:Math.max(1,B.x-D.x),h:Math.max(1,B.y-D.y)});if(!C.drawn){this.div.appendChild(A);C.drawn=true}}},removeMarker:function(A){HGIS.Util.removeItem(this.markers,A);if((A.div!=null)&&(A.div.parentNode==this.div)){this.div.removeChild(A.div)}},CLASS_NAME:"HGIS.Layer.Boxes"});HGIS.Format.WFSCapabilities.v1_0_0=HGIS.Class(HGIS.Format.WFSCapabilities.v1,{readers:{"wfs":HGIS.Util.applyDefaults({"Service":function(A,B){B.service={};this.readChildNodes(A,B.service)},"Fees":function(B,C){var A=this.getChildValue(B);if(A&&A.toLowerCase()!="none"){C.fees=A}},"AccessConstraints":function(A,B){var C=this.getChildValue(A);if(C&&C.toLowerCase()!="none"){B.accessConstraints=C}},"OnlineResource":function(B,C){var A=this.getChildValue(B);if(A&&A.toLowerCase()!="none"){C.onlineResource=A}},"Keywords":function(A,B){var C=this.getChildValue(A);if(C&&C.toLowerCase()!="none"){B.keywords=C.split(", ")}},"Capability":function(A,B){B.capability={};this.readChildNodes(A,B.capability)},"Request":function(B,A){A.request={};this.readChildNodes(B,A.request)},"GetFeature":function(B,A){A.getfeature={href:{},formats:[]};this.readChildNodes(B,A.getfeature)},"ResultFormat":function(C,B){var E=C.childNodes;var D;for(var A=0;A<E.length;A++){D=E[A];if(D.nodeType==1){B.formats.push(D.nodeName)}}},"DCPType":function(B,A){this.readChildNodes(B,A)},"HTTP":function(B,A){this.readChildNodes(B,A.href)},"Get":function(B,A){A.get=B.getAttribute("onlineResource")},"Post":function(B,A){A.post=B.getAttribute("onlineResource")},"SRS":function(B,A){var C=this.getChildValue(B);if(C){A.srs=C}}},HGIS.Format.WFSCapabilities.v1.prototype.readers["wfs"])},CLASS_NAME:"HGIS.Format.WFSCapabilities.v1_0_0"});HGIS.Format.WMSCapabilities.v1_3=HGIS.Class(HGIS.Format.WMSCapabilities.v1,{readers:{"wms":HGIS.Util.applyDefaults({"WMS_Capabilities":function(B,A){this.readChildNodes(B,A)},"LayerLimit":function(B,A){A.layerLimit=parseInt(this.getChildValue(B))},"MaxWidth":function(B,A){A.maxWidth=parseInt(this.getChildValue(B))},"MaxHeight":function(B,A){A.maxHeight=parseInt(this.getChildValue(B))},"BoundingBox":function(B,A){var C=HGIS.Format.WMSCapabilities.v1.prototype.readers["wms"].BoundingBox.apply(this,[B,A]);C.srs=B.getAttribute("CRS");A.bbox[C.srs]=C},"CRS":function(B,A){this.readers.wms.SRS.apply(this,[B,A])},"EX_GeographicBoundingBox":function(B,A){A.llbbox=[];this.readChildNodes(B,A.llbbox)},"westBoundLongitude":function(B,A){A[0]=this.getChildValue(B)},"eastBoundLongitude":function(B,A){A[2]=this.getChildValue(B)},"southBoundLatitude":function(B,A){A[1]=this.getChildValue(B)},"northBoundLatitude":function(B,A){A[3]=this.getChildValue(B)},"MinScaleDenominator":function(B,A){A.maxScale=parseFloat(this.getChildValue(B)).toPrecision(16)},"MaxScaleDenominator":function(B,A){A.minScale=parseFloat(this.getChildValue(B)).toPrecision(16)},"Dimension":function(B,A){var C=B.getAttribute("name").toLowerCase();var D={name:C,units:B.getAttribute("units"),unitsymbol:B.getAttribute("unitSymbol"),nearestVal:B.getAttribute("nearestValue")==="1",multipleVal:B.getAttribute("multipleValues")==="1","default":B.getAttribute("default")||"",current:B.getAttribute("current")==="1",values:this.getChildValue(B).split(",")};A.dimensions[D.name]=D},"Keyword":function(B,A){var C={value:this.getChildValue(B),vocabulary:B.getAttribute("vocabulary")};if(A.keywords){A.keywords.push(C)}}},HGIS.Format.WMSCapabilities.v1.prototype.readers["wms"]),"sld":{"UserDefinedSymbolization":function(B,A){this.readers.wms.UserDefinedSymbolization.apply(this,[B,A]);A.userSymbols.inlineFeature=parseInt(B.getAttribute("InlineFeature"))==1;A.userSymbols.remoteWCS=parseInt(B.getAttribute("RemoteWCS"))==1},"DescribeLayer":function(B,A){this.readers.wms.DescribeLayer.apply(this,[B,A])},"GetLegendGraphic":function(B,A){this.readers.wms.GetLegendGraphic.apply(this,[B,A])}}},CLASS_NAME:"HGIS.Format.WMSCapabilities.v1_3"});HGIS.Layer.Zoomify=HGIS.Class(HGIS.Layer.Grid,{size:null,isBaseLayer:true,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(D,B,A,C){this.initializeZoomify(A);HGIS.Layer.Grid.prototype.initialize.apply(this,[D,B,A,{},C])},initializeZoomify:function(A){var D=A.clone();this.size=A.clone();var C=new HGIS.Size(Math.ceil(D.w/this.standardTileSize),Math.ceil(D.h/this.standardTileSize));this.tierSizeInTiles=[C];this.tierImageSize=[D];while(D.w>this.standardTileSize||D.h>this.standardTileSize){D=new HGIS.Size(Math.floor(D.w/2),Math.floor(D.h/2));C=new HGIS.Size(Math.ceil(D.w/this.standardTileSize),Math.ceil(D.h/this.standardTileSize));this.tierSizeInTiles.push(C);this.tierImageSize.push(D)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;var E=[1];this.tileCountUpToTier=[0];for(var B=1;B<this.numberOfTiers;B++){E.unshift(Math.pow(2,B));this.tileCountUpToTier.push(this.tierSizeInTiles[B-1].w*this.tierSizeInTiles[B-1].h+this.tileCountUpToTier[B-1])}if(!this.serverResolutions){this.serverResolutions=E}},destroy:function(){HGIS.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(A){if(A==null){A=new HGIS.Layer.Zoomify(this.name,this.url,this.size,this.options)}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(B){B=this.adjustBounds(B);var F=this.getServerResolution();var D=Math.round((B.left-this.tileOrigin.lon)/(F*this.tileSize.w));var E=Math.round((this.tileOrigin.lat-B.top)/(F*this.tileSize.h));var H=this.getZoomForResolution(F);var G=D+E*this.tierSizeInTiles[H].w+this.tileCountUpToTier[H];var C="TileGroup"+Math.floor((G)/256)+"/"+H+"-"+D+"-"+E+".jpg";var A=this.url;if(HGIS.Util.isArray(A)){A=this.selectUrl(C,A)}return A+C},getImageSize:function(){if(arguments.length>0){var B=this.adjustBounds(arguments[0]);var D=this.getServerResolution();var E=Math.round((B.left-this.tileOrigin.lon)/(D*this.tileSize.w));var F=Math.round((this.tileOrigin.lat-B.top)/(D*this.tileSize.h));var C=this.getZoomForResolution(D);var G=this.standardTileSize;var A=this.standardTileSize;if(E==this.tierSizeInTiles[C].w-1){var G=this.tierImageSize[C].w%this.standardTileSize}if(F==this.tierSizeInTiles[C].h-1){var A=this.tierImageSize[C].h%this.standardTileSize}return(new HGIS.Size(G,A))}else{return this.tileSize}},setMap:function(A){HGIS.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new HGIS.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"HGIS.Layer.Zoomify"});HGIS.Layer.MapServer=HGIS.Class(HGIS.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(C,A,D,B){HGIS.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=HGIS.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(B==null||B.isBaseLayer==null){this.isBaseLayer=((this.params.transparent!="true")&&(this.params.transparent!=true))}},clone:function(A){if(A==null){A=new HGIS.Layer.MapServer(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(B){B=this.adjustBounds(B);var C=[B.left,B.bottom,B.right,B.top];var D=this.getImageSize();var A=this.getFullRequestString({mapext:C,imgext:C,map_size:[D.w,D.h],imgx:D.w/2,imgy:D.h/2,imgxy:[D.w,D.h]});return A},getFullRequestString:function(A,C){var G=(C==null)?this.url:C;var H=HGIS.Util.extend({},this.params);H=HGIS.Util.extend(H,A);var D=HGIS.Util.getParameterString(H);if(HGIS.Util.isArray(G)){G=this.selectUrl(D,G)}var B=HGIS.Util.upperCaseObject(HGIS.Util.getParameters(G));for(var E in H){if(E.toUpperCase() in B){delete H[E]}}D=HGIS.Util.getParameterString(H);var I=G;D=D.replace(/,/g,"+");if(D!=""){var F=G.charAt(G.length-1);if((F=="&")||(F=="?")){I+=D}else{if(G.indexOf("?")==-1){I+="?"+D}else{I+="&"+D}}}return I},CLASS_NAME:"HGIS.Layer.MapServer"});HGIS.Renderer.VML=HGIS.Class(HGIS.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(A){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var D=document.createStyleSheet();var C=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var B=0,E=C.length;B<E;B++){D.addRule("olv\\:"+C[B],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}HGIS.Renderer.Elements.prototype.initialize.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(D,L){var H=HGIS.Renderer.Elements.prototype.setExtent.apply(this,arguments);var J=this.getResolution();var F=(D.left/J)|0;var E=(D.top/J-this.size.h)|0;if(L||!this.offset){this.offset={x:F,y:E};F=0;E=0}else{F=F-this.offset.x;E=E-this.offset.y}var B=(F-this.xOffset)+" "+E;this.root.coordorigin=B;var C=[this.root,this.vectorRoot,this.textRoot];var A;for(var G=0,K=C.length;G<K;++G){A=C[G];var I=this.size.w+" "+this.size.h;A.coordsize=I}this.root.style.flip="y";return H},setSize:function(A){HGIS.Renderer.prototype.setSize.apply(this,arguments);var D=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var F=this.size.w+"px";var B=this.size.h+"px";var C;for(var E=0,G=D.length;E<G;++E){C=D[E];C.style.width=F;C.style.height=B}},getNodeType:function(C,B){var A=null;switch(C.CLASS_NAME){case"HGIS.Geometry.Point":if(B.externalGraphic){A="olv:rect"}else{if(this.isComplexSymbol(B.graphicName)){A="olv:shape"}else{A="olv:oval"}}break;case"HGIS.Geometry.Rectangle":A="olv:rect";break;case"HGIS.Geometry.LineString":case"HGIS.Geometry.LinearRing":case"HGIS.Geometry.Polygon":case"HGIS.Geometry.Curve":A="olv:shape";break;default:break}return A},setStyle:function(K,Q,L,M){Q=Q||K._style;L=L||K._options;var C=Q.fillColor;var G=Q.title||Q.graphicTitle;if(G){K.title=G}if(K._geometryClass==="HGIS.Geometry.Point"){if(Q.externalGraphic){L.isFilled=true;var I=Q.graphicWidth||Q.graphicHeight;var O=Q.graphicHeight||Q.graphicWidth;I=I?I:Q.pointRadius*2;O=O?O:Q.pointRadius*2;var J=this.getResolution();var E=(Q.graphicXOffset!=undefined)?Q.graphicXOffset:-(0.5*I);var P=(Q.graphicYOffset!=undefined)?Q.graphicYOffset:-(0.5*O);K.style.left=((((M.x-this.featureDx)/J-this.offset.x)+E)|0)+"px";K.style.top=(((M.y/J-this.offset.y)-(P+O))|0)+"px";K.style.width=I+"px";K.style.height=O+"px";K.style.flip="y";C="none";L.isStroked=false}else{if(this.isComplexSymbol(Q.graphicName)){var B=this.importSymbol(Q.graphicName);K.path=B.path;K.coordorigin=B.left+","+B.bottom;var D=B.size;K.coordsize=D+","+D;this.drawCircle(K,M,Q.pointRadius);K.style.flip="y"}else{this.drawCircle(K,M,Q.pointRadius)}}}if(L.isFilled){K.fillcolor=C}else{K.filled="false"}var N=K.getElementsByTagName("fill");var R=(N.length==0)?null:N[0];if(!L.isFilled){if(R){K.removeChild(R)}}else{if(!R){R=this.createNode("olv:fill",K.id+"_fill")}R.opacity=Q.fillOpacity;if(K._geometryClass==="HGIS.Geometry.Point"&&Q.externalGraphic){if(Q.graphicOpacity){R.opacity=Q.graphicOpacity}R.src=Q.externalGraphic;R.type="frame";if(!(Q.graphicWidth&&Q.graphicHeight)){R.aspect="atmost"}}if(R.parentNode!=K){K.appendChild(R)}}var F=Q.rotation;if((F!==undefined||K._rotation!==undefined)){K._rotation=F;if(Q.externalGraphic){this.graphicRotate(K,E,P,Q);R.opacity=0}else{if(K._geometryClass==="HGIS.Geometry.Point"){K.style.rotation=F||0}}}var A=K.getElementsByTagName("stroke");var H=(A.length==0)?null:A[0];if(!L.isStroked){K.stroked=false;if(H){H.on=false}}else{if(!H){H=this.createNode("olv:stroke",K.id+"_stroke");K.appendChild(H)}H.on=true;H.color=Q.strokeColor;H.weight=Q.strokeWidth+"px";H.opacity=Q.strokeOpacity;H.endcap=Q.strokeLinecap=="butt"?"flat":(Q.strokeLinecap||"round");if(Q.strokeDashstyle){H.dashstyle=this.dashStyle(Q)}}if(Q.cursor!="inherit"&&Q.cursor!=null){K.style.cursor=Q.cursor}return K},graphicRotate:function(L,D,R,S){var S=S||L._style;var F=S.rotation||0;var H,E;if(!(S.graphicWidth&&S.graphicHeight)){var P=new Image();P.onreadystatechange=HGIS.Function.bind(function(){if(P.readyState=="complete"||P.readyState=="interactive"){H=P.width/P.height;E=Math.max(S.pointRadius*2,S.graphicWidth||0,S.graphicHeight||0);D=D*H;S.graphicWidth=E*H;S.graphicHeight=E;this.graphicRotate(L,D,R,S)}},this);P.src=S.externalGraphic;return}else{E=Math.max(S.graphicWidth,S.graphicHeight);H=S.graphicWidth/S.graphicHeight}var J=Math.round(S.graphicWidth||E*H);var Q=Math.round(S.graphicHeight||E);L.style.width=J+"px";L.style.height=Q+"px";var K=document.getElementById(L.id+"_image");if(!K){K=this.createNode("olv:imagedata",L.id+"_image");L.appendChild(K)}K.style.width=J+"px";K.style.height=Q+"px";K.src=S.externalGraphic;K.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var O=F*Math.PI/180;var C=Math.sin(O);var M=Math.cos(O);var N="progid:DXImageTransform.Microsoft.Matrix(M11="+M+",M12="+(-C)+",M21="+C+",M22="+M+",SizingMethod='auto expand')\n";var G=S.graphicOpacity||S.fillOpacity;if(G&&G!=1){N+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+G+")\n"}L.style.filter=N;var A=new HGIS.Geometry.Point(-D,-R);var B=new HGIS.Bounds(0,0,J,Q).toGeometry();B.rotate(S.rotation,A);var I=B.getBounds();L.style.left=Math.round(parseInt(L.style.left)+I.left)+"px";L.style.top=Math.round(parseInt(L.style.top)-I.bottom)+"px"},postDraw:function(A){A.style.visibility="visible";var B=A._style.fillColor;var C=A._style.strokeColor;if(B=="none"&&A.fillcolor!=B){A.fillcolor=B}if(C=="none"&&A.strokecolor!=C){A.strokecolor=C}},setNodeDimension:function(B,C){var E=C.getBounds();if(E){var D=this.getResolution();var A=new HGIS.Bounds(((E.left-this.featureDx)/D-this.offset.x)|0,(E.bottom/D-this.offset.y)|0,((E.right-this.featureDx)/D-this.offset.x)|0,(E.top/D-this.offset.y)|0);B.style.left=A.left+"px";B.style.top=A.top+"px";B.style.width=A.getWidth()+"px";B.style.height=A.getHeight()+"px";B.coordorigin=A.left+" "+A.top;B.coordsize=A.getWidth()+" "+A.getHeight()}},dashStyle:function(B){var C=B.strokeDashstyle;switch(C){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return C;default:var A=C.split(/[ ,]/);if(A.length==2){if(1*A[0]>=2*A[1]){return"longdash"}return(A[0]==1||A[1]==1)?"dot":"dash"}else{if(A.length==4){return(1*A[0]>=2*A[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(A,C){var B=document.createElement(A);if(C){B.id=C}B.unselectable="on";B.onselectstart=HGIS.Function.False;return B},nodeTypeCompare:function(C,A){var D=A;var B=D.indexOf(":");if(B!=-1){D=D.substr(B+1)}var E=C.nodeName;B=E.indexOf(":");if(B!=-1){E=E.substr(B+1)}return(D==E)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(A){return this.nodeFactory(this.container.id+A,"olv:group")},drawPoint:function(A,B){return this.drawCircle(A,B,1)},drawCircle:function(B,C,E){if(!isNaN(C.x)&&!isNaN(C.y)){var D=this.getResolution();B.style.left=((((C.x-this.featureDx)/D-this.offset.x)|0)-E)+"px";B.style.top=(((C.y/D-this.offset.y)|0)-E)+"px";var A=E*2;B.style.width=A+"px";B.style.height=A+"px";return B}return false},drawLineString:function(A,B){return this.drawLine(A,B,false)},drawLinearRing:function(A,B){return this.drawLine(A,B,true)},drawLine:function(F,C,B){this.setNodeDimension(F,C);var G=this.getResolution();var A=C.components.length;var J=new Array(A);var E,H,I;for(var D=0;D<A;D++){E=C.components[D];H=((E.x-this.featureDx)/G-this.offset.x)|0;I=(E.y/G-this.offset.y)|0;J[D]=" "+H+","+I+" l "}var K=(B)?" x e":" e";F.path="m"+J.join("")+K;return F},drawPolygon:function(K,I){this.setNodeDimension(K,I);var M=this.getResolution();var L=[];var G,F,N,D,C,A,J,B,H,E,P,O;for(G=0,F=I.components.length;G<F;G++){L.push("m");N=I.components[G].components;D=(G===0);C=null;A=null;for(J=0,B=N.length;J<B;J++){H=N[J];P=((H.x-this.featureDx)/M-this.offset.x)|0;O=(H.y/M-this.offset.y)|0;E=" "+P+","+O;L.push(E);if(J==0){L.push(" l")}if(!D){if(!C){C=E}else{if(C!=E){if(!A){A=E}else{if(A!=E){D=true}}}}}}L.push(D?" x ":" ")}L.push("e");K.path=L.join("");return K},drawRectangle:function(A,B){var C=this.getResolution();A.style.left=(((B.x-this.featureDx)/C-this.offset.x)|0)+"px";A.style.top=((B.y/C-this.offset.y)|0)+"px";A.style.width=((B.width/C)|0)+"px";A.style.height=((B.height/C)|0)+"px";return A},drawText:function(B,E,H){var F=this.nodeFactory(B+this.LABEL_ID_SUFFIX,"olv:rect");var A=this.nodeFactory(B+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var G=this.getResolution();F.style.left=(((H.x-this.featureDx)/G-this.offset.x)|0)+"px";F.style.top=((H.y/G-this.offset.y)|0)+"px";F.style.flip="y";A.innerText=E.label;if(E.labelBackgroundColor){A.style.backgroundColor=E.labelBackgroundColor}if(E.labelBorderColor||E.labelBorderSize){A.style.border="solid"+(E.labelBorderSize?E.labelBorderSize:"1px")+" "+(E.labelBorderColor?E.labelBorderColor:"#000000")}if(E.cursor!="inherit"&&E.cursor!=null){A.style.cursor=E.cursor}if(E.fontColor){A.style.color=E.fontColor}if(E.fontOpacity){A.style.filter="alpha(opacity="+(E.fontOpacity*100)+")"}if(E.fontFamily){A.style.fontFamily=E.fontFamily}if(E.fontSize){A.style.fontSize=E.fontSize}if(E.fontWeight){A.style.fontWeight=E.fontWeight}if(E.fontStyle){A.style.fontStyle=E.fontStyle}if(E.labelSelect===true){F._featureId=B;A._featureId=B;A._geometry=H;A._geometryClass=H.CLASS_NAME}A.style.whiteSpace="nowrap";A.inset="1px,0px,0px,0px";if(!F.parentNode){F.appendChild(A);this.textRoot.appendChild(F)}var D=E.labelAlign||"cm";if(D.length==1){D+="m"}var C=A.clientWidth*(HGIS.Renderer.VML.LABEL_SHIFT[D.substr(0,1)]);var I=A.clientHeight*(HGIS.Renderer.VML.LABEL_SHIFT[D.substr(1,1)]);F.style.left=parseInt(F.style.left)-C-1+"px";F.style.top=parseInt(F.style.top)+I+"px"},moveRoot:function(B){var A=this.map.getLayer(B.container.id);if(A instanceof HGIS.Layer.Vector.RootContainer){A=this.map.getLayer(this.container.id)}A&&A.renderer.clear();HGIS.Renderer.Elements.prototype.moveRoot.apply(this,arguments);A&&A.redraw()},importSymbol:function(E){var F=this.container.id+"-"+E;var I=this.symbolCache[F];if(I){return I}var D=HGIS.Renderer.symbol[E];if(!D){throw new Error(E+" is not a valid symbol name")}var K=new HGIS.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var B=["m"];for(var C=0;C<D.length;C=C+2){var G=D[C];var H=D[C+1];K.left=Math.min(K.left,G);K.bottom=Math.min(K.bottom,H);K.right=Math.max(K.right,G);K.top=Math.max(K.top,H);B.push(G);B.push(H);if(C==0){B.push("l")}}B.push("x e");var J=B.join(" ");var A=(K.getWidth()-K.getHeight())/2;if(A>0){K.bottom=K.bottom-A;K.top=K.top+A}else{K.left=K.left+A;K.right=K.right-A}I={path:J,size:K.getWidth(),left:K.left,bottom:K.bottom};this.symbolCache[F]=I;return I},CLASS_NAME:"HGIS.Renderer.VML"});HGIS.Renderer.VML.LABEL_SHIFT={"l":0,"c":0.5,"r":1,"t":0,"m":0.5,"b":1};HGIS.Control.CacheRead=HGIS.Class(HGIS.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:true,setMap:function(B){HGIS.Control.prototype.setMap.apply(this,arguments);var A,C=this.layers||B.layers;for(A=C.length-1;A>=0;--A){this.addLayer({layer:C[A]})}if(!this.layers){B.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(A){A.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(A){A.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(C){if(this.active&&window.localStorage&&C.tile instanceof HGIS.Tile.Image){var D=C.tile,B=D.url;if(!D.layer.crossOriginKeyword&&HGIS.ProxyHost&&B.indexOf(HGIS.ProxyHost)===0){B=HGIS.Control.CacheWrite.urlMap[B]}var A=window.localStorage.getItem("olCache_"+B);if(A){D.url=A;if(C.type==="tileerror"){D.setImgSrc(A)}}}},destroy:function(){if(this.layers||this.map){var A,B=this.layers||this.map.layers;for(A=B.length-1;A>=0;--A){this.removeLayer({layer:B[A]})}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}HGIS.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"HGIS.Control.CacheRead"});HGIS.Protocol.WFS.v1_0_0=HGIS.Class(HGIS.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"HGIS.Protocol.WFS.v1_0_0"});HGIS.Format.WMSGetFeatureInfo=HGIS.Class(HGIS.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,read:function(E){var B;if(typeof E=="string"){E=HGIS.Format.XML.prototype.read.apply(this,[E])}var A=E.documentElement;if(A){var C=this;var D=this["read_"+A.nodeName];if(D){B=D.call(this,A)}else{B=new HGIS.Format.GML((this.options?this.options:{})).read(E)}}else{B=E}return B},read_msGMLOutput:function(B){var M=[];var A=this.getSiblingNodesByTagCriteria(B,this.layerIdentifier);if(A){for(var F=0,J=A.length;F<J;++F){var H=A[F];var E=H.nodeName;if(H.prefix){E=E.split(":")[1]}var E=E.replace(this.layerIdentifier,"");var K=this.getSiblingNodesByTagCriteria(H,this.featureIdentifier);if(K){for(var D=0;D<K.length;D++){var I=K[D];var C=this.parseGeometry(I);var G=this.parseAttributes(I);var L=new HGIS.Feature.Vector(C.geometry,G,null);L.bounds=C.bounds;L.type=E;M.push(L)}}}}return M},read_FeatureInfoResponse:function(B){var M=[];var L=this.getElementsByTagNameNS(B,"*","FIELDS");for(var G=0,K=L.length;G<K;G++){var J=L[G];var H=null;var F={};var D;var E=J.attributes.length;if(E>0){for(D=0;D<E;D++){var A=J.attributes[D];F[A.nodeName]=A.nodeValue}}else{var C=J.childNodes;for(D=0,E=C.length;D<E;++D){var I=C[D];if(I.nodeType!=3){F[I.getAttribute("name")]=I.getAttribute("value")}}}M.push(new HGIS.Feature.Vector(H,F,null))}return M},getSiblingNodesByTagCriteria:function(E,A){var I=[];var B,H,D,G,F;if(E&&E.hasChildNodes()){B=E.childNodes;D=B.length;for(var C=0;C<D;C++){F=B[C];while(F&&F.nodeType!=1){F=F.nextSibling;C++}H=(F?F.nodeName:"");if(H.length>0&&H.indexOf(A)>-1){I.push(F)}else{G=this.getSiblingNodesByTagCriteria(F,A);if(G.length>0){(I.length==0)?I=G:I.push(G)}}}}return I},parseAttributes:function(H){var G={};if(H.nodeType==1){var D=H.childNodes;var I=D.length;for(var F=0;F<I;++F){var J=D[F];if(J.nodeType==1){var A=J.childNodes;var B=(J.prefix)?J.nodeName.split(":")[1]:J.nodeName;if(A.length==0){G[B]=null}else{if(A.length==1){var E=A[0];if(E.nodeType==3||E.nodeType==4){var C=E.nodeValue.replace(this.regExes.trimSpace,"");G[B]=C}}}}}}return G},parseGeometry:function(C){if(!this.gmlFormat){this.gmlFormat=new HGIS.Format.GML()}var A=this.gmlFormat.parseFeature(C);var D,B=null;if(A){D=A.geometry&&A.geometry.clone();B=A.bounds&&A.bounds.clone();A.destroy()}return{geometry:D,bounds:B}},CLASS_NAME:"HGIS.Format.WMSGetFeatureInfo"});HGIS.Control.WMTSGetFeatureInfo=HGIS.Class(HGIS.Control,{hover:false,requestEncoding:"KVP",drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:true,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(A){A=A||{};A.handlerOptions=A.handlerOptions||{};HGIS.Control.prototype.initialize.apply(this,[A]);if(!this.format){this.format=new HGIS.Format.WMSGetFeatureInfo(A.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new HGIS.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},HGIS.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var B={};B[this.clickCallback]=this.getInfoForClick;this.handler=new HGIS.Handler.Click(this,B,this.handlerOptions.click||{})}},getInfoForClick:function(A){this.request(A.xy,{})},getInfoForHover:function(A){this.request(A.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){--this.pending;if(this.pending<=0){HGIS.Element.removeClass(this.map.viewPortDiv,"olCursorWait");this.pending=0}this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var D=this.layers||this.map.layers;var C=[];var A;for(var B=D.length-1;B>=0;--B){A=D[B];if(A instanceof HGIS.Layer.WMTS&&A.requestEncoding===this.requestEncoding&&(!this.queryVisible||A.getVisibility())){C.push(A);if(!this.drillDown||this.hover){break}}}return C},buildRequestOptions:function(C,A){var F=this.map.getLonLatFromPixel(A);var D=C.getURL(new HGIS.Bounds(F.lon,F.lat,F.lon,F.lat));var E=HGIS.Util.getParameters(D);var B=C.getTileInfo(F);HGIS.Util.extend(E,{service:"WMTS",version:C.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:B.i,j:B.j});HGIS.Util.applyDefaults(E,this.vendorParams);return{url:HGIS.Util.isArray(C.url)?C.url[0]:C.url,params:HGIS.Util.upperCaseObject(E),callback:function(G){this.handleResponse(A,G,C)},scope:this}},request:function(B,E){E=E||{};var H=this.findLayers();if(H.length>0){var C,I;for(var D=0,F=H.length;D<F;D++){I=H[D];C=this.events.triggerEvent("beforegetfeatureinfo",{xy:B,layer:I});if(C!==false){++this.pending;var G=this.buildRequestOptions(I,B);var A=HGIS.Request.GET(G);if(E.hover===true){this.hoverRequest=A}}}if(this.pending>0){HGIS.Element.addClass(this.map.viewPortDiv,"olCursorWait")}}},handleResponse:function(A,C,D){--this.pending;if(this.pending<=0){HGIS.Element.removeClass(this.map.viewPortDiv,"olCursorWait");this.pending=0}if(C.status&&(C.status<200||C.status>=300)){this.events.triggerEvent("exception",{xy:A,request:C,layer:D})}else{var G=C.responseXML;if(!G||!G.documentElement){G=C.responseText}var B,E;try{B=this.format.read(G)}catch(F){E=true;this.events.triggerEvent("exception",{xy:A,request:C,error:F,layer:D})}if(!E){this.events.triggerEvent("getfeatureinfo",{text:C.responseText,features:B,request:C,xy:A,layer:D})}}},CLASS_NAME:"HGIS.Control.WMTSGetFeatureInfo"});HGIS.Protocol.CSW.v2_0_2=HGIS.Class(HGIS.Protocol,{formatOptions:null,initialize:function(A){HGIS.Protocol.prototype.initialize.apply(this,[A]);if(!A.format){this.format=new HGIS.Format.CSWGetRecords.v2_0_2(HGIS.Util.extend({},this.formatOptions))}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;HGIS.Protocol.prototype.destroy.apply(this)},read:function(A){A=HGIS.Util.extend({},A);HGIS.Util.applyDefaults(A,this.options||{});var B=new HGIS.Protocol.Response({requestType:"read"});var C=this.format.write(A.params||A);B.priv=HGIS.Request.POST({url:A.url,callback:this.createCallback(this.handleRead,B,A),params:A.params,headers:A.headers,data:C});return B},handleRead:function(C,B){if(B.callback){var A=C.priv;if(A.status>=200&&A.status<300){C.data=this.parseData(A);C.code=HGIS.Protocol.Response.SUCCESS}else{C.code=HGIS.Protocol.Response.FAILURE}B.callback.call(B.scope,C)}},parseData:function(A){var B=A.responseXML;if(!B||!B.documentElement){B=A.responseText}if(!B||B.length<=0){return null}return this.format.read(B)},CLASS_NAME:"HGIS.Protocol.CSW.v2_0_2"});HGIS.Format.WCSCapabilities.v1_1_0=HGIS.Class(HGIS.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{"wcs":HGIS.Util.applyDefaults({"Capabilities":function(B,A){this.readChildNodes(B,A)},"Contents":function(B,A){A.contentMetadata=[];this.readChildNodes(B,A.contentMetadata)},"CoverageSummary":function(B,A){var C={};this.readChildNodes(B,C);A.push(C)},"Identifier":function(B,A){A.identifier=this.getChildValue(B)},"Title":function(B,A){A.title=this.getChildValue(B)},"Abstract":function(B,A){A["abstract"]=this.getChildValue(B)},"SupportedCRS":function(B,A){var C=this.getChildValue(B);if(C){if(!A.supportedCRS){A.supportedCRS=[]}A.supportedCRS.push(C)}},"SupportedFormat":function(C,B){var A=this.getChildValue(C);if(A){if(!B.supportedFormat){B.supportedFormat=[]}B.supportedFormat.push(A)}}},HGIS.Format.WCSCapabilities.v1.prototype.readers["wcs"]),"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.readers["ows"]},CLASS_NAME:"HGIS.Format.WCSCapabilities.v1_1_0"});HGIS.Control.Graticule=HGIS.Class(HGIS.Control,{autoActivate:true,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:true,visible:true,numPoints:50,targetSize:200,layerName:null,labelled:true,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(A){A=A||{};A.layerName=A.layerName||HGIS.i18n("Graticule");HGIS.Control.prototype.initialize.apply(this,[A]);this.labelSymbolizer.stroke=false;this.labelSymbolizer.fill=false;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();HGIS.Control.prototype.destroy.apply(this,arguments);if(this.gratLayer){this.gratLayer.destroy();this.gratLayer=null}},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var A=new HGIS.Style({},{rules:[new HGIS.Rule({"symbolizer":{"Point":this.labelSymbolizer,"Line":this.lineSymbolizer}})]});this.gratLayer=new HGIS.Layer.Vector(this.layerName,{styleMap:new HGIS.StyleMap({"default":A}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){if(HGIS.Control.prototype.activate.apply(this,arguments)){this.map.addLayer(this.gratLayer);this.map.events.register("moveend",this,this.update);this.update();return true}else{return false}},deactivate:function(){if(HGIS.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("moveend",this,this.update);this.map.removeLayer(this.gratLayer);return true}else{return false}},update:function(){var b=this.map.getExtent();if(!b){return}this.gratLayer.destroyFeatures();var P=new HGIS.Projection("EPSG:4326");var N=this.map.getProjectionObject();var J=this.map.getResolution();if(N.proj&&N.proj.projName=="longlat"){this.numPoints=1}var R=this.map.getCenter();var M=new HGIS.Pixel(R.lon,R.lat);HGIS.Projection.transform(M,N,P);var E=this.targetSize*J;E*=E;var G;for(var h=0;h<this.intervals.length;++h){G=this.intervals[h];var W=G/2;var O=M.offset({x:-W,y:-W});var F=M.offset({x:W,y:W});HGIS.Projection.transform(O,P,N);HGIS.Projection.transform(F,P,N);var X=(O.x-F.x)*(O.x-F.x)+(O.y-F.y)*(O.y-F.y);if(X<=E){break}}M.x=Math.floor(M.x/G)*G;M.y=Math.floor(M.y/G)*G;var L=0;var D=[M.clone()];var d=M.clone();var H;do{d=d.offset({x:0,y:G});H=HGIS.Projection.transform(d.clone(),P,N);D.unshift(d)}while(b.containsPixel(H)&&++L<1000);d=M.clone();do{d=d.offset({x:0,y:-G});H=HGIS.Projection.transform(d.clone(),P,N);D.push(d)}while(b.containsPixel(H)&&++L<1000);L=0;var I=[M.clone()];d=M.clone();do{d=d.offset({x:-G,y:0});H=HGIS.Projection.transform(d.clone(),P,N);I.unshift(d)}while(b.containsPixel(H)&&++L<1000);d=M.clone();do{d=d.offset({x:G,y:0});H=HGIS.Projection.transform(d.clone(),P,N);I.push(d)}while(b.containsPixel(H)&&++L<1000);var Y=[];for(var h=0;h<I.length;++h){var a=I[h].x;var e=[];var g=null;var B=Math.min(D[0].y,90);var S=Math.max(D[D.length-1].y,-90);var A=(B-S)/this.numPoints;var Z=S;for(var f=0;f<=this.numPoints;++f){var V=new HGIS.Geometry.Point(a,Z);V.transform(P,N);e.push(V);Z+=A;if(V.y>=b.bottom&&!g){g=V}}if(this.labelled){var Q=new HGIS.Geometry.Point(g.x,b.bottom);var C={value:a,label:this.labelled?HGIS.Util.getFormattedLonLat(a,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new HGIS.Feature.Vector(Q,C))}var U=new HGIS.Geometry.LineString(e);Y.push(new HGIS.Feature.Vector(U))}for(var f=0;f<D.length;++f){Z=D[f].y;if(Z<-90||Z>90){continue}var e=[];var K=I[0].x;var T=I[I.length-1].x;var l=(T-K)/this.numPoints;var a=K;var g=null;for(var h=0;h<=this.numPoints;++h){var V=new HGIS.Geometry.Point(a,Z);V.transform(P,N);e.push(V);a+=l;if(V.x<b.right){g=V}}if(this.labelled){var Q=new HGIS.Geometry.Point(b.right,g.y);var C={value:Z,label:this.labelled?HGIS.Util.getFormattedLonLat(Z,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new HGIS.Feature.Vector(Q,C))}var U=new HGIS.Geometry.LineString(e);Y.push(new HGIS.Feature.Vector(U))}this.gratLayer.addFeatures(Y)},CLASS_NAME:"HGIS.Control.Graticule"});HGIS.Console.warn("HGIS.Rico is deprecated");HGIS.Rico=HGIS.Rico||{};HGIS.Rico.Corner={round:function(A,C){A=HGIS.Util.getElement(A);this._setOptions(C);var D=this.options.color;if(this.options.color=="fromElement"){D=this._background(A)}var B=this.options.bgColor;if(this.options.bgColor=="fromParent"){B=this._background(A.offsetParent)}this._roundCornersImpl(A,D,B)},changeColor:function(B,A){B.style.backgroundColor=A;var D=B.parentNode.getElementsByTagName("span");for(var C=0;C<D.length;C++){D[C].style.backgroundColor=A}},changeOpacity:function(B,D){var A=D;var C="alpha(opacity="+D*100+")";B.style.opacity=A;B.style.filter=C;var F=B.parentNode.getElementsByTagName("span");for(var E=0;E<F.length;E++){F[E].style.opacity=A;F[E].style.filter=C}},reRound:function(A,C){var B=A.parentNode.childNodes[0];var D=A.parentNode.childNodes[2];A.parentNode.removeChild(B);A.parentNode.removeChild(D);this.round(A.parentNode,C)},_roundCornersImpl:function(A,C,B){if(this.options.border){this._renderBorder(A,B)}if(this._isTopRounded()){this._roundTopCorners(A,C,B)}if(this._isBottomRounded()){this._roundBottomCorners(A,C,B)}},_renderBorder:function(A,C){var F="1px solid "+this._borderColor(C);var D="border-left: "+F;var B="border-right: "+F;var E="style='"+D+";"+B+"'";A.innerHTML="<div "+E+">"+A.innerHTML+"</div>"},_roundTopCorners:function(A,E,C){var D=this._createCorner(C);for(var B=0;B<this.options.numSlices;B++){D.appendChild(this._createCornerSlice(E,C,B,"top"))}A.style.paddingTop=0;A.insertBefore(D,A.firstChild)},_roundBottomCorners:function(A,E,C){var D=this._createCorner(C);for(var B=(this.options.numSlices-1);B>=0;B--){D.appendChild(this._createCornerSlice(E,C,B,"bottom"))}A.style.paddingBottom=0;A.appendChild(D)},_createCorner:function(A){var B=document.createElement("div");B.style.backgroundColor=(this._isTransparent()?"transparent":A);return B},_createCornerSlice:function(F,C,A,D){var G=document.createElement("span");var B=G.style;B.backgroundColor=F;B.display="block";B.height="1px";B.overflow="hidden";B.fontSize="1px";var E=this._borderColor(F,C);if(this.options.border&&A==0){B.borderTopStyle="solid";B.borderTopWidth="1px";B.borderLeftWidth="0px";B.borderRightWidth="0px";B.borderBottomWidth="0px";B.height="0px";B.borderColor=E}else{if(E){B.borderColor=E;B.borderStyle="solid";B.borderWidth="0px 1px"}}if(!this.options.compact&&(A==(this.options.numSlices-1))){B.height="2px"}this._setMargin(G,A,D);this._setBorder(G,A,D);return G},_setOptions:function(A){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};HGIS.Util.extend(this.options,A||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else{if(this.options.corners.indexOf("tr")>=0){return"right"}}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else{if(this.options.corners.indexOf("br")>=0){return"right"}}return""},_borderColor:function(B,A){if(B=="transparent"){return A}else{if(this.options.border){return this.options.border}else{if(this.options.blend){return this._blend(A,B)}else{return""}}}},_setMargin:function(A,C,D){var E=this._marginSize(C);var B=D=="top"?this._whichSideTop():this._whichSideBottom();if(B=="left"){A.style.marginLeft=E+"px";A.style.marginRight="0px"}else{if(B=="right"){A.style.marginRight=E+"px";A.style.marginLeft="0px"}else{A.style.marginLeft=E+"px";A.style.marginRight=E+"px"}}},_setBorder:function(A,C,D){var E=this._borderSize(C);var B=D=="top"?this._whichSideTop():this._whichSideBottom();if(B=="left"){A.style.borderLeftWidth=E+"px";A.style.borderRightWidth="0px"}else{if(B=="right"){A.style.borderRightWidth=E+"px";A.style.borderLeftWidth="0px"}else{A.style.borderLeftWidth=E+"px";A.style.borderRightWidth=E+"px"}}if(this.options.border!=false){A.style.borderLeftWidth=E+"px";A.style.borderRightWidth=E+"px"}},_marginSize:function(A){if(this._isTransparent()){return 0}var D=[5,3,2,1];var E=[3,2,1,0];var C=[2,1];var B=[1,0];if(this.options.compact&&this.options.blend){return B[A]}else{if(this.options.compact){return C[A]}else{if(this.options.blend){return E[A]}else{return D[A]}}}},_borderSize:function(A){var C=[5,3,2,1];var B=[2,1,1,1];var D=[1,0];var E=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else{if(this.options.compact){return D[A]}else{if(this.options.blend){return B[A]}else{if(this.options.border){return E[A]}else{if(this._isTransparent()){return C[A]}}}}}return 0},_hasString:function(B){for(var A=1;A<arguments.length;A++){if(B.indexOf(arguments[A])>=0){return true}}return false},_blend:function(C,A){var B=HGIS.Rico.Color.createFromHex(C);B.blend(HGIS.Rico.Color.createFromHex(A));return B},_background:function(A){try{return HGIS.Rico.Color.createColorFromBackground(A).asHex()}catch(B){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(A){return A.childNodes.length==1&&A.childNodes[0].nodeType==3}};HGIS.Control.NavigationHistory=HGIS.Class(HGIS.Control,{type:HGIS.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(B){HGIS.Control.prototype.initialize.apply(this,[B]);this.registry=HGIS.Util.extend({"moveend":this.getState},this.registry);var A={trigger:HGIS.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};HGIS.Util.extend(A,this.previousOptions);this.previous=new HGIS.Control.Button(A);var C={trigger:HGIS.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};HGIS.Util.extend(C,this.nextOptions);this.next=new HGIS.Control.Button(C);this.clear()},onPreviousChange:function(B,A){if(B&&!this.previous.active){this.previous.activate()}else{if(!B&&this.previous.active){this.previous.deactivate()}}},onNextChange:function(B,A){if(B&&!this.next.active){this.next.activate()}else{if(!B&&this.next.active){this.next.deactivate()}}},destroy:function(){HGIS.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var A in this){this[A]=null}},setMap:function(A){this.map=A;this.next.setMap(A);this.previous.setMap(A)},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var A=this.previousStack.shift();var B=this.previousStack.shift();if(B!=undefined){this.nextStack.unshift(A);this.previousStack.unshift(B);this.restoring=true;this.restore(B);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(A)}return B},nextTrigger:function(){var A=this.nextStack.shift();if(A!=undefined){this.previousStack.unshift(A);this.restoring=true;this.restore(A);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return A},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(F){var C,E;if(this.map.getProjectionObject()==F.projection){E=this.map.getZoomForResolution(F.resolution);C=F.center}else{C=F.center.clone();C.transform(F.projection,this.map.getProjectionObject());var B=F.units;var A=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var D=B&&A?HGIS.INCHES_PER_UNIT[B]/HGIS.INCHES_PER_UNIT[A]:1;E=this.map.getZoomForResolution(D*F.resolution)}this.map.setCenter(C,E)},setListeners:function(){this.listeners={};for(var A in this.registry){this.listeners[A]=HGIS.Function.bind(function(){if(!this.restoring){var B=this.registry[A].apply(this,arguments);this.previousStack.unshift(B);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var B=false;if(this.map){if(HGIS.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var A in this.listeners){this.map.events.register(A,this,this.listeners[A])}B=true;if(this.previousStack.length==0){this.initStack()}}}return B},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var B=false;if(this.map){if(HGIS.Control.prototype.deactivate.apply(this)){for(var A in this.listeners){this.map.events.unregister(A,this,this.listeners[A])}if(this.clearOnDeactivate){this.clear()}B=true}}return B},CLASS_NAME:"HGIS.Control.NavigationHistory"});HGIS.Layer.UTFGrid=HGIS.Class(HGIS.Layer.XYZ,{isBaseLayer:false,projection:new HGIS.Projection("EPSG:900913"),useJSONP:false,tileClass:HGIS.Tile.UTFGrid,initialize:function(A){HGIS.Layer.Grid.prototype.initialize.apply(this,[A.name,A.url,{},A]);this.tileOptions=HGIS.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(A){if(A==null){A=new HGIS.Layer.UTFGrid(this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getFeatureInfo:function(A){var C=null;var B=this.getTileData(A);if(B&&B.tile){C=B.tile.getFeatureInfo(B.i,B.j)}return C},getFeatureId:function(A){var C=null;var B=this.getTileData(A);if(B.tile){C=B.tile.getFeatureId(B.i,B.j)}return C},CLASS_NAME:"HGIS.Layer.UTFGrid"});HGIS.TileManager=HGIS.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(A){HGIS.Util.extend(this,A);this.maps=[];this.tileQueueId={};this.tileQueue={};this.tileCache={};this.tileCacheIndex=[]},addMap:function(B){if(this._destroyed||!HGIS.Layer.Grid){return}this.maps.push(B);this.tileQueue[B.id]=[];for(var A=0,C=B.layers.length;A<C;++A){this.addLayer({layer:B.layers[A]})}B.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})},removeMap:function(B){if(this._destroyed||!HGIS.Layer.Grid){return}window.clearTimeout(this.tileQueueId[B.id]);if(B.layers){for(var A=0,C=B.layers.length;A<C;++A){this.removeLayer({layer:B.layers[A]})}}if(B.events){B.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}delete this.tileQueue[B.id];delete this.tileQueueId[B.id];HGIS.Util.removeItem(this.maps,B)},move:function(A){this.updateTimeout(A.object,this.moveDelay,true)},zoomEnd:function(A){this.updateTimeout(A.object,this.zoomDelay)},changeLayer:function(A){if(A.property==="visibility"||A.property==="params"){this.updateTimeout(A.object,0)}},addLayer:function(B){var C=B.layer;if(C instanceof HGIS.Layer.Grid){C.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var A,E,D;for(A=C.grid.length-1;A>=0;--A){for(E=C.grid[A].length-1;E>=0;--E){D=C.grid[A][E];this.addTile({tile:D});if(D.url){this.manageTileCache({object:D})}}}}},removeLayer:function(B){var C=B.layer;if(C instanceof HGIS.Layer.Grid){this.clearTileQueue({object:C});if(C.events){C.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this})}if(C.grid){var A,E,D;for(A=C.grid.length-1;A>=0;--A){for(E=C.grid[A].length-1;E>=0;--E){D=C.grid[A][E];this.unloadTile({object:D});if(D.url){this.manageTileCache({object:D})}}}}}},updateTimeout:function(A,C,B){window.clearTimeout(this.tileQueueId[A.id]);var D=this.tileQueue[A.id];if(!B||D.length){this.tileQueueId[A.id]=window.setTimeout(HGIS.Function.bind(function(){this.drawTilesFromQueue(A);if(D.length){this.updateTimeout(A,this.frameDelay)}},this),C)}},addTile:function(A){A.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this})},unloadTile:function(A){var B=A.object;B.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this});HGIS.Util.removeItem(this.tileQueue[B.layer.map.id],B)},queueTileDraw:function(D){var E=D.object;var B=false;var A=E.layer;var C=A.getURL(E.bounds);var F=this.tileCache[C];if(F&&F.className!=="olTileImage"){delete this.tileCache[C];HGIS.Util.removeItem(this.tileCacheIndex,C);F=null}if(A.url&&(A.async||!F)){var G=this.tileQueue[A.map.id];if(!~HGIS.Util.indexOf(G,E)){G.push(E)}B=true}return !B},drawTilesFromQueue:function(A){var D=this.tileQueue[A.id];var C=this.tilesPerFrame;var B=A.zoomTween&&A.zoomTween.playing;while(!B&&D.length&&C){D.shift().draw(true);--C}},manageTileCache:function(A){var B=A.object;var C=this.tileCache[B.url];if(C&&(!C.parentNode||HGIS.Element.hasClass(C.parentNode,"olBackBuffer"))){if(B.layer.backBuffer){if(B.layer.backBuffer===C.parentNode){return}C.style.opacity=0;C.style.visibility="hidden"}C.id=null;B.setImage(C);HGIS.Util.removeItem(this.tileCacheIndex,B.url);this.tileCacheIndex.push(B.url)}},addToCache:function(A){var B=A.object;if(!this.tileCache[B.url]){if(!HGIS.Element.hasClass(B.imgDiv,"olImageLoadError")){if(this.tileCacheIndex.length>=this.cacheSize){delete this.tileCache[this.tileCacheIndex[0]];this.tileCacheIndex.shift()}this.tileCache[B.url]=B.imgDiv;this.tileCacheIndex.push(B.url)}}},clearTileQueue:function(B){var C=B.object;var D=this.tileQueue[C.map.id];for(var A=D.length-1;A>=0;--A){if(D[A].layer===C){D.splice(A,1)}}},destroy:function(){for(var A=this.maps.length-1;A>=0;--A){this.removeMap(this.maps[A])}this.maps=null;this.tileQueue=null;this.tileQueueId=null;this.tileCache=null;this.tileCacheIndex=null;this._destroyed=true}});HGIS.Layer.ArcGIS93Rest=HGIS.Class(HGIS.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(C,A,E,B){var D=[];E=HGIS.Util.upperCaseObject(E);D.push(C,A,E,B);HGIS.Layer.Grid.prototype.initialize.apply(this,D);HGIS.Util.applyDefaults(this.params,HGIS.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((B==null)||(!B.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="jpg"){this.params.FORMAT=HGIS.Util.alphaHack()?"gif":"png"}}},clone:function(A){if(A==null){A=new HGIS.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getURL:function(B){B=this.adjustBounds(B);var G=this.projection.getCode().split(":");var E=G[G.length-1];var D=this.getImageSize();var C={"BBOX":B.toBBOX(),"SIZE":D.w+","+D.h,"F":"image","BBOXSR":E,"IMAGESR":E};if(this.layerDefs){var F=[];var A;for(A in this.layerDefs){if(this.layerDefs.hasOwnProperty(A)){if(this.layerDefs[A]){F.push(A);F.push(":");F.push(this.layerDefs[A]);F.push(";")}}}if(F.length>0){C["LAYERDEFS"]=F.join("")}}var H=this.getFullRequestString(C);return H},setLayerFilter:function(B,A){if(!this.layerDefs){this.layerDefs={}}if(A){this.layerDefs[B]=A}else{delete this.layerDefs[B]}},clearLayerFilter:function(A){if(A){delete this.layerDefs[A]}else{delete this.layerDefs}},mergeNewParams:function(B){var A=HGIS.Util.upperCaseObject(B);var C=[A];return HGIS.Layer.Grid.prototype.mergeNewParams.apply(this,C)},CLASS_NAME:"HGIS.Layer.ArcGIS93Rest"});HGIS.Layer.ArcGISCache=HGIS.Class(HGIS.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new HGIS.Size(256,256),useArcGISServer:true,type:"png",useScales:false,overrideDPI:false,initialize:function(K,J,G){HGIS.Layer.XYZ.prototype.initialize.apply(this,arguments);if(this.resolutions){this.serverResolutions=this.resolutions;this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])}if(this.layerInfo){var I=this.layerInfo;var E=new HGIS.Bounds(I.fullExtent.xmin,I.fullExtent.ymin,I.fullExtent.xmax,I.fullExtent.ymax);this.projection="EPSG:"+I.spatialReference.wkid;this.sphericalMercator=(I.spatialReference.wkid==102100);this.units=(I.units=="esriFeet")?"ft":"m";if(!!I.tileInfo){this.tileSize=new HGIS.Size(I.tileInfo.width||I.tileInfo.cols,I.tileInfo.height||I.tileInfo.rows);this.tileOrigin=new HGIS.LonLat(I.tileInfo.origin.x,I.tileInfo.origin.y);var H=new HGIS.Geometry.Point(E.left,E.top);var C=new HGIS.Geometry.Point(E.right,E.bottom);if(this.useScales){this.scales=[]}else{this.resolutions=[]}this.lods=[];for(var F in I.tileInfo.lods){if(I.tileInfo.lods.hasOwnProperty(F)){var A=I.tileInfo.lods[F];if(this.useScales){this.scales.push(A.scale)}else{this.resolutions.push(A.resolution)}var B=this.getContainingTileCoords(H,A.resolution);A.startTileCol=B.x;A.startTileRow=B.y;var D=this.getContainingTileCoords(C,A.resolution);A.endTileCol=D.x;A.endTileRow=D.y;this.lods.push(A)}}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;if(this.overrideDPI&&I.tileInfo.dpi){HGIS.DOTS_PER_INCH=I.tileInfo.dpi}}}},getContainingTileCoords:function(A,B){return new HGIS.Pixel(Math.max(Math.floor((A.x-this.tileOrigin.lon)/(this.tileSize.w*B)),0),Math.max(Math.floor((this.tileOrigin.lat-A.y)/(this.tileSize.h*B)),0))},calculateMaxExtentWithLOD:function(F){var E=(F.endTileCol-F.startTileCol)+1;var G=(F.endTileRow-F.startTileRow)+1;var D=this.tileOrigin.lon+(F.startTileCol*this.tileSize.w*F.resolution);var B=D+(E*this.tileSize.w*F.resolution);var A=this.tileOrigin.lat-(F.startTileRow*this.tileSize.h*F.resolution);var C=A-(G*this.tileSize.h*F.resolution);return new HGIS.Bounds(D,C,B,A)},calculateMaxExtentWithExtent:function(C,E){var A=new HGIS.Geometry.Point(C.left,C.top);var F=new HGIS.Geometry.Point(C.right,C.bottom);var G=this.getContainingTileCoords(A,E);var D=this.getContainingTileCoords(F,E);var B={resolution:E,startTileCol:G.x,startTileRow:G.y,endTileCol:D.x,endTileRow:D.y};return this.calculateMaxExtentWithLOD(B)},getUpperLeftTileCoord:function(B){var A=new HGIS.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(A,B)},getLowerRightTileCoord:function(A){var B=new HGIS.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(B,A)},getMaxExtentForResolution:function(I){var A=this.getUpperLeftTileCoord(I);var B=this.getLowerRightTileCoord(I);var E=(B.x-A.x)+1;var C=(B.y-A.y)+1;var F=this.tileOrigin.lon+(A.x*this.tileSize.w*I);var H=F+(E*this.tileSize.w*I);var D=this.tileOrigin.lat-(A.y*this.tileSize.h*I);var G=D-(C*this.tileSize.h*I);return new HGIS.Bounds(F,G,H,D)},clone:function(A){if(A==null){A=new HGIS.Layer.ArcGISCache(this.name,this.url,this.options)}return HGIS.Layer.XYZ.prototype.clone.apply(this,[A])},initGriddedTiles:function(A){delete this._tileOrigin;HGIS.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var A=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(A)},getTileOrigin:function(){if(!this._tileOrigin){var A=this.getMaxExtent();this._tileOrigin=new HGIS.LonLat(A.left,A.bottom)}return this._tileOrigin},getURL:function(D){var F=this.getResolution();var G=(this.tileOrigin.lon+(F*this.tileSize.w/2));var H=(this.tileOrigin.lat-(F*this.tileSize.h/2));var A=D.getCenterLonLat();var M={x:A.lon,y:A.lat};var K=(Math.round(Math.abs((A.lon-G)/(F*this.tileSize.w))));var L=(Math.round(Math.abs((H-A.lat)/(F*this.tileSize.h))));var J=this.map.getZoom();if(this.lods){var I=this.lods[this.map.getZoom()];if((K<I.startTileCol||K>I.endTileCol)||(L<I.startTileRow||L>I.endTileRow)){return null}}else{var C=this.getUpperLeftTileCoord(F);var E=this.getLowerRightTileCoord(F);if((K<C.x||K>=E.x)||(L<C.y||L>=E.y)){return null}}var N=this.url;var B=""+K+L+J;if(HGIS.Util.isArray(N)){N=this.selectUrl(B,N)}if(this.useArcGISServer){N=N+"/tile/${z}/${y}/${x}"}else{K="C"+HGIS.Number.zeroPad(K,8,16);L="R"+HGIS.Number.zeroPad(L,8,16);J="L"+HGIS.Number.zeroPad(J,2,10);N=N+"/${z}/${y}/${x}."+this.type}N=HGIS.String.format(N,{"x":K,"y":L,"z":J});return HGIS.Util.urlAppend(N,HGIS.Util.getParameterString(this.params))},CLASS_NAME:"HGIS.Layer.ArcGISCache"});HGIS.Control.WMSGetFeatureInfo=HGIS.Class(HGIS.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(A){A=A||{};A.handlerOptions=A.handlerOptions||{};HGIS.Control.prototype.initialize.apply(this,[A]);if(!this.format){this.format=new HGIS.Format.WMSGetFeatureInfo(A.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new HGIS.Handler.Hover(this,{"move":this.cancelHover,"pause":this.getInfoForHover},HGIS.Util.extend(this.handlerOptions.hover||{},{"delay":250}))}else{var B={};B[this.clickCallback]=this.getInfoForClick;this.handler=new HGIS.Handler.Click(this,B,this.handlerOptions.click||{})}},getInfoForClick:function(A){this.events.triggerEvent("beforegetfeatureinfo",{xy:A.xy});HGIS.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(A.xy,{})},getInfoForHover:function(A){this.events.triggerEvent("beforegetfeatureinfo",{xy:A.xy});this.request(A.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var E=this.layers||this.map.layers;var D=[];var A,C;for(var B=E.length-1;B>=0;--B){A=E[B];if(A instanceof HGIS.Layer.WMS&&(!this.queryVisible||A.getVisibility())){C=HGIS.Util.isArray(A.url)?A.url[0]:A.url;if(this.drillDown===false&&!this.url){this.url=C}if(this.drillDown===true||this.urlMatches(C)){D.push(A)}}}return D},urlMatches:function(C){var A=HGIS.Util.isEquivalentUrl(this.url,C);if(!A&&this.layerUrls){for(var B=0,D=this.layerUrls.length;B<D;++B){if(HGIS.Util.isEquivalentUrl(this.layerUrls[B],C)){A=true;break}}}return A},buildWMSOptions:function(K,L,F,C){var J=[],G=[];for(var I=0,A=L.length;I<A;I++){if(L[I].params.LAYERS!=null){J=J.concat(L[I].params.LAYERS);G=G.concat(this.getStyleNames(L[I]))}}var B=L[0];var D=this.map.getProjection();var E=B.projection;if(E&&E.equals(this.map.getProjectionObject())){D=E.getCode()}var H=HGIS.Util.extend({service:"WMS",version:B.params.VERSION,request:"GetFeatureInfo",exceptions:B.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,B.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:C,info_format:B.params.INFO_FORMAT||this.infoFormat},(parseFloat(B.params.VERSION)>=1.3)?{crs:D,i:parseInt(F.x),j:parseInt(F.y)}:{srs:D,x:parseInt(F.x),y:parseInt(F.y)});if(J.length!=0){H=HGIS.Util.extend({layers:J,query_layers:J,styles:G},H)}HGIS.Util.applyDefaults(H,this.vendorParams);return{url:K,params:HGIS.Util.upperCaseObject(H),callback:function(M){this.handleResponse(F,M,K)},scope:this}},getStyleNames:function(A){var B;if(A.params.STYLES){B=A.params.STYLES}else{if(HGIS.Util.isArray(A.params.LAYERS)){B=new Array(A.params.LAYERS.length)}else{B=A.params.LAYERS.replace(/[^,]/g,"")}}return B},request:function(F,I){var K=this.findLayers();if(K.length==0){this.events.triggerEvent("nogetfeatureinfo");HGIS.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return}I=I||{};if(this.drillDown===false){var E=this.buildWMSOptions(this.url,K,F,K[0].params.FORMAT);var D=HGIS.Request.GET(E);if(I.hover===true){this.hoverRequest=D}}else{this._requestCount=0;this._numRequests=0;this.features=[];var C={},J;for(var G=0,A=K.length;G<A;G++){var L=K[G];var B,H=false;J=HGIS.Util.isArray(L.url)?L.url[0]:L.url;if(J in C){C[J].push(L)}else{this._numRequests++;C[J]=[L]}}var K;for(var J in C){K=C[J];var E=this.buildWMSOptions(J,K,F,K[0].params.FORMAT);HGIS.Request.GET(E)}}},triggerGetFeatureInfo:function(C,A,B){this.events.triggerEvent("getfeatureinfo",{text:C.responseText,features:B,request:C,xy:A});HGIS.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(A,D,C){var E=D.responseXML;if(!E||!E.documentElement){E=D.responseText}var B=this.format.read(E);if(this.drillDown===false){this.triggerGetFeatureInfo(D,A,B)}else{this._requestCount++;if(this.output==="object"){this._features=(this._features||[]).concat({url:C,features:B})}else{this._features=(this._features||[]).concat(B)}if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(D,A,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"HGIS.Control.WMSGetFeatureInfo"});HGIS.Format.WMSCapabilities.v1_3_0=HGIS.Class(HGIS.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"HGIS.Format.WMSCapabilities.v1_3_0"});HGIS.Format.SOSGetFeatureOfInterest=HGIS.Class(HGIS.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(G){if(typeof G=="string"){G=HGIS.Format.XML.prototype.read.apply(this,[G])}if(G&&G.nodeType==9){G=G.documentElement}var F={features:[]};this.readNode(G,F);var A=[];for(var B=0,E=F.features.length;B<E;B++){var D=F.features[B];if(this.internalProjection&&this.externalProjection&&D.components[0]){D.components[0].transform(this.externalProjection,this.internalProjection)}var C=new HGIS.Feature.Vector(D.components[0],D.attributes);A.push(C)}return A},readers:{"sa":{"SamplingPoint":function(C,B){if(!B.attributes){var A={attributes:{}};B.features.push(A);B=A}B.attributes.id=this.getAttributeNS(C,this.namespaces.gml,"id");this.readChildNodes(C,B)},"position":function(B,A){this.readChildNodes(B,A)}},"gml":HGIS.Util.applyDefaults({"FeatureCollection":function(B,A){this.readChildNodes(B,A)},"featureMember":function(C,B){var A={attributes:{}};B.features.push(A);this.readChildNodes(C,A)},"name":function(B,A){A.attributes.name=this.getChildValue(B)},"pos":function(B,A){if(!this.externalProjection){this.externalProjection=new HGIS.Projection(B.getAttribute("srsName"))}HGIS.Format.GML.v3.prototype.readers.gml.pos.apply(this,[B,A])}},HGIS.Format.GML.v3.prototype.readers.gml)},writers:{"sos":{"GetFeatureOfInterest":function(C){var B=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}});for(var A=0,D=C.fois.length;A<D;A++){this.writeNode("FeatureOfInterestId",{foi:C.fois[A]},B)}return B},"FeatureOfInterestId":function(B){var A=this.createElementNSPlus("FeatureOfInterestId",{value:B.foi});return A}}},CLASS_NAME:"HGIS.Format.SOSGetFeatureOfInterest"});HGIS.Format.SOSGetObservation=HGIS.Class(HGIS.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={measurements:[],observations:[]};this.readNode(B,A);return A},write:function(B){var A=this.writeNode("sos:GetObservation",B);A.setAttribute("xmlns:om",this.namespaces.om);A.setAttribute("xmlns:ogc",this.namespaces.ogc);this.setAttributeNS(A,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return HGIS.Format.XML.prototype.write.apply(this,[A])},readers:{"om":{"ObservationCollection":function(B,A){A.id=this.getAttributeNS(B,this.namespaces.gml,"id");this.readChildNodes(B,A)},"member":function(A,B){this.readChildNodes(A,B)},"Measurement":function(B,C){var A={};C.measurements.push(A);this.readChildNodes(B,A)},"Observation":function(B,C){var A={};C.observations.push(A);this.readChildNodes(B,A)},"samplingTime":function(B,A){var C={};A.samplingTime=C;this.readChildNodes(B,C)},"observedProperty":function(B,A){A.observedProperty=this.getAttributeNS(B,this.namespaces.xlink,"href");this.readChildNodes(B,A)},"procedure":function(B,A){A.procedure=this.getAttributeNS(B,this.namespaces.xlink,"href");this.readChildNodes(B,A)},"featureOfInterest":function(D,C){var F={features:[]};C.fois=[];C.fois.push(F);this.readChildNodes(D,F);var A=[];for(var B=0,E=F.features.length;B<E;B++){var G=F.features[B];A.push(new HGIS.Feature.Vector(G.components[0],G.attributes))}F.features=A},"result":function(C,A){var B={};A.result=B;if(this.getChildValue(C)!==""){B.value=this.getChildValue(C);B.uom=C.getAttribute("uom")}else{this.readChildNodes(C,B)}}},"sa":HGIS.Format.SOSGetFeatureOfInterest.prototype.readers.sa,"gml":HGIS.Util.applyDefaults({"TimeInstant":function(A,B){var C={};B.timeInstant=C;this.readChildNodes(A,C)},"timePosition":function(A,B){B.timePosition=this.getChildValue(A)}},HGIS.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{"sos":{"GetObservation":function(D){var C=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",D,C);if(D.eventTime){this.writeNode("eventTime",D,C)}for(var B in D.procedures){this.writeNode("procedure",D.procedures[B],C)}for(var A in D.observedProperties){this.writeNode("observedProperty",D.observedProperties[A],C)}if(D.foi){this.writeNode("featureOfInterest",D.foi,C)}this.writeNode("responseFormat",D,C);if(D.resultModel){this.writeNode("resultModel",D,C)}if(D.responseMode){this.writeNode("responseMode",D,C)}return C},"featureOfInterest":function(B){var A=this.createElementNSPlus("featureOfInterest");this.writeNode("ObjectID",B.objectId,A);return A},"ObjectID":function(A){return this.createElementNSPlus("ObjectID",{value:A})},"responseFormat":function(A){return this.createElementNSPlus("responseFormat",{value:A.responseFormat})},"procedure":function(A){return this.createElementNSPlus("procedure",{value:A})},"offering":function(A){return this.createElementNSPlus("offering",{value:A.offering})},"observedProperty":function(A){return this.createElementNSPlus("observedProperty",{value:A})},"eventTime":function(B){var A=this.createElementNSPlus("eventTime");if(B.eventTime==="latest"){this.writeNode("ogc:TM_Equals",B,A)}return A},"resultModel":function(A){return this.createElementNSPlus("resultModel",{value:A.resultModel})},"responseMode":function(A){return this.createElementNSPlus("responseMode",{value:A.responseMode})}},"ogc":{"TM_Equals":function(B){var A=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},A);if(B.eventTime==="latest"){this.writeNode("gml:TimeInstant",{value:"latest"},A)}return A},"PropertyName":function(A){return this.createElementNSPlus("ogc:PropertyName",{value:A.property})}},"gml":{"TimeInstant":function(B){var A=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",B,A);return A},"timePosition":function(B){var A=this.createElementNSPlus("gml:timePosition",{value:B.value});return A}}},CLASS_NAME:"HGIS.Format.SOSGetObservation"});HGIS.Control.UTFGrid=HGIS.Class(HGIS.Control,{autoActivate:true,layers:null,defaultHandlerOptions:{"delay":300,"pixelTolerance":4,"stopMove":false,"single":true,"double":false,"stopSingle":false,"stopDouble":false},handlerMode:"click",setHandler:function(A){this.handlerMode=A;this.resetHandler()},resetHandler:function(){if(this.handler){this.handler.deactivate();this.handler.destroy();this.handler=null}if(this.handlerMode=="hover"){this.handler=new HGIS.Handler.Hover(this,{"pause":this.handleEvent,"move":this.reset},this.handlerOptions)}else{if(this.handlerMode=="click"){this.handler=new HGIS.Handler.Click(this,{"click":this.handleEvent},this.handlerOptions)}else{if(this.handlerMode=="move"){this.handler=new HGIS.Handler.Hover(this,{"pause":this.handleEvent,"move":this.handleEvent},this.handlerOptions)}}}if(this.handler){return true}else{return false}},initialize:function(A){A=A||{};A.handlerOptions=A.handlerOptions||this.defaultHandlerOptions;HGIS.Control.prototype.initialize.apply(this,[A]);this.resetHandler()},handleEvent:function(A){if(A==null){this.reset();return}var B=this.map.getLonLatFromPixel(A.xy);if(!B){return}var H=this.findLayers();if(H.length>0){var F={};var E,C;for(var D=0,G=H.length;D<G;D++){E=H[D];C=HGIS.Util.indexOf(this.map.layers,E);F[C]=E.getFeatureInfo(B)}this.callback(F,B,A.xy)}},callback:function(A){},reset:function(A){this.callback(null)},findLayers:function(){var D=this.layers||this.map.layers;var C=[];var A;for(var B=D.length-1;B>=0;--B){A=D[B];if(A instanceof HGIS.Layer.UTFGrid){C.push(A)}}return C},CLASS_NAME:"HGIS.Control.UTFGrid"});HGIS.Format.CQL=(function(){var F=["PROPERTY","COMPARISON","VALUE","LOGICAL"],C={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(P){var N=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(P);if(N){var Q=P.length;var R=P.indexOf("(",N[0].length);if(R>-1){var O=1;while(R<Q&&O>0){R++;switch(P.charAt(R)){case"(":O++;break;case")":O--;break;default:}}}return[P.substr(0,R+1)]}},END:/^$/},M={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},J={"=":HGIS.Filter.Comparison.EQUAL_TO,"<>":HGIS.Filter.Comparison.NOT_EQUAL_TO,"<":HGIS.Filter.Comparison.LESS_THAN,"<=":HGIS.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":HGIS.Filter.Comparison.GREATER_THAN,">=":HGIS.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,"LIKE":HGIS.Filter.Comparison.LIKE,"BETWEEN":HGIS.Filter.Comparison.BETWEEN,"IS NULL":HGIS.Filter.Comparison.IS_NULL},E={},I={"AND":HGIS.Filter.Logical.AND,"OR":HGIS.Filter.Logical.OR},B={},H={"RPAREN":3,"LOGICAL":2,"COMPARISON":1};var K;for(K in J){if(J.hasOwnProperty(K)){E[J[K]]=K}}for(K in I){if(I.hasOwnProperty(K)){B[I[K]]=K}}function L(N,O){if(O instanceof RegExp){return O.exec(N)}else{return O(N)}}function D(R,P){var Q,W,U=P.length;for(Q=0;Q<U;Q++){W=P[Q];var V=C[W];var S=L(R,V);if(S){var N=S[0];var T=R.substr(N.length).replace(/^\s*/,"");return{type:W,text:N,remainder:T}}}var O="ERROR: In parsing: ["+R+"], expected one of: ";for(Q=0;Q<U;Q++){W=P[Q];O+="\n    "+W+": "+C[W]}throw new Error(O)}function A(O){var P=[];var N,Q=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{N=D(O,Q);O=N.remainder;Q=M[N.type];if(N.type!="END"&&!Q){throw new Error("No follows list for "+N.type)}P.push(N)}while(N.type!="END");return P}function G(R){var U=[],P=[];while(R.length){var Q=R.shift();switch(Q.type){case"PROPERTY":case"GEOMETRY":case"VALUE":P.push(Q);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":var O=H[Q.type];while(U.length>0&&(H[U[U.length-1].type]<=O)){P.push(U.pop())}U.push(Q);break;case"SPATIAL":case"NOT":case"LPAREN":U.push(Q);break;case"RPAREN":while(U.length>0&&(U[U.length-1].type!="LPAREN")){P.push(U.pop())}U.pop();if(U.length>0&&U[U.length-1].type=="SPATIAL"){P.push(U.pop())}case"COMMA":case"END":break;default:throw new Error("Unknown token type "+Q.type)}}while(U.length>0){P.push(U.pop())}function T(){var a=P.pop();switch(a.type){case"LOGICAL":var f=T(),h=T();return new HGIS.Filter.Logical({filters:[h,f],type:I[a.text.toUpperCase()]});case"NOT":var n=T();return new HGIS.Filter.Logical({filters:[n],type:HGIS.Filter.Logical.NOT});case"BETWEEN":var Y,Z,X;P.pop();Z=T();Y=T();X=T();return new HGIS.Filter.Comparison({property:X,lowerBoundary:Y,upperBoundary:Z,type:HGIS.Filter.Comparison.BETWEEN});case"COMPARISON":var e=T(),X=T();return new HGIS.Filter.Comparison({property:X,value:e,type:J[a.text.toUpperCase()]});case"IS_NULL":var X=T();return new HGIS.Filter.Comparison({property:X,type:J[a.text.toUpperCase()]});case"VALUE":var o=a.text.match(/^'(.*)'$/);if(o){return o[1].replace(/''/g,"'")}else{return Number(a.text)}case"SPATIAL":switch(a.text.toUpperCase()){case"BBOX":var i=T(),W=T(),g=T(),d=T(),b=T();return new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.BBOX,property:b,value:HGIS.Bounds.fromArray([d,g,W,i])});case"INTERSECTS":var e=T(),X=T();return new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.INTERSECTS,property:X,value:e});case"WITHIN":var e=T(),X=T();return new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.WITHIN,property:X,value:e});case"CONTAINS":var e=T(),X=T();return new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.CONTAINS,property:X,value:e});case"DWITHIN":var l=T(),e=T(),X=T();return new HGIS.Filter.Spatial({type:HGIS.Filter.Spatial.DWITHIN,value:e,property:X,distance:Number(l)})}case"GEOMETRY":return HGIS.Geometry.fromWKT(a.text);default:return a.text}}var N=T();if(P.length>0){var V="Remaining tokens after building AST: \n";for(var S=P.length-1;S>=0;S--){V+=P[S].type+": "+P[S].text+"\n"}throw new Error(V)}return N}return HGIS.Class(HGIS.Format,{read:function(O){var N=G(A(O));if(this.keepData){this.data=N}return N},write:function(Q){if(Q instanceof HGIS.Geometry){return Q.toString()}switch(Q.CLASS_NAME){case"HGIS.Filter.Spatial":switch(Q.type){case HGIS.Filter.Spatial.BBOX:return"BBOX("+Q.property+","+Q.value.toBBOX()+")";case HGIS.Filter.Spatial.DWITHIN:return"DWITHIN("+Q.property+", "+this.write(Q.value)+", "+Q.distance+")";case HGIS.Filter.Spatial.WITHIN:return"WITHIN("+Q.property+", "+this.write(Q.value)+")";case HGIS.Filter.Spatial.INTERSECTS:return"INTERSECTS("+Q.property+", "+this.write(Q.value)+")";case HGIS.Filter.Spatial.CONTAINS:return"CONTAINS("+Q.property+", "+this.write(Q.value)+")";default:throw new Error("Unknown spatial filter type: "+Q.type)}case"HGIS.Filter.Logical":if(Q.type==HGIS.Filter.Logical.NOT){return"NOT ("+this.write(Q.filters[0])+")"}else{var P="(";var N=true;for(var O=0;O<Q.filters.length;O++){if(N){N=false}else{P+=") "+B[Q.type]+" ("}P+=this.write(Q.filters[O])}return P+")"}case"HGIS.Filter.Comparison":if(Q.type==HGIS.Filter.Comparison.BETWEEN){return Q.property+" BETWEEN "+this.write(Q.lowerBoundary)+" AND "+this.write(Q.upperBoundary)}else{return(Q.value!==null)?Q.property+" "+E[Q.type]+" "+this.write(Q.value):Q.property+" "+E[Q.type]}case undefined:if(typeof Q==="string"){return"'"+Q.replace(/'/g,"''")+"'"}else{if(typeof Q==="number"){return String(Q)}}default:throw new Error("Can't encode: "+Q.CLASS_NAME+" "+Q)}},CLASS_NAME:"HGIS.Format.CQL"})})();HGIS.Control.Split=HGIS.Class(HGIS.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:true,deferDelete:false,mutual:true,targetFilter:null,sourceFilter:null,handler:null,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,[A]);this.options=A||{};if(this.options.source){this.setSource(this.options.source)}},setSource:function(A){if(this.active){this.deactivate();if(this.handler){this.handler.destroy();delete this.handler}this.source=A;this.activate()}else{this.source=A}},activate:function(){var A=HGIS.Control.prototype.activate.call(this);if(A){if(!this.source){if(!this.handler){this.handler=new HGIS.Handler.Path(this,{done:function(B){this.onSketchComplete({feature:new HGIS.Feature.Vector(B)})}},{layerOptions:this.sourceOptions})}this.handler.activate()}else{if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}}return A},deactivate:function(){var A=HGIS.Control.prototype.deactivate.call(this);if(A){if(this.source&&this.source.events){this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}return A},onSketchComplete:function(A){this.feature=null;return !this.considerSplit(A.feature)},afterFeatureModified:function(B){if(B.modified){var A=B.feature;if(typeof A.geometry.split==="function"){this.feature=B.feature;this.considerSplit(B.feature)}}},removeByGeometry:function(A,C){for(var B=0,D=A.length;B<D;++B){if(A[B].geometry===C){A.splice(B,1);break}}},isEligible:function(A){if(!A.geometry){return false}else{return(A.state!==HGIS.State.DELETE)&&(typeof A.geometry.split==="function")&&(this.feature!==A)&&(!this.targetFilter||this.targetFilter.evaluate(A.attributes))}},considerSplit:function(H){var M=false;var A=false;if(!this.sourceFilter||this.sourceFilter.evaluate(H.attributes)){var R=this.layer&&this.layer.features||[];var O,V,Q;var K=[],B=[];var D=(this.layer===this.source)&&this.mutual;var P={edge:this.edge,tolerance:this.tolerance,mutual:D};var L=[H.geometry];var S,E;var J,U;for(var T=0,I=R.length;T<I;++T){S=R[T];if(this.isEligible(S)){E=[S.geometry];for(var C=0;C<L.length;++C){J=L[C];for(var G=0;G<E.length;++G){O=E[G];if(J.getBounds().intersectsBounds(O.getBounds())){V=J.split(O,P);if(V){Q=this.events.triggerEvent("beforesplit",{source:H,target:S});if(Q!==false){if(D){U=V[0];if(U.length>1){U.unshift(C,1);Array.prototype.splice.apply(L,U);C+=U.length-3}V=V[1]}if(V.length>1){V.unshift(G,1);Array.prototype.splice.apply(E,V);G+=V.length-3}}}}}}if(E&&E.length>1){this.geomsToFeatures(S,E);this.events.triggerEvent("split",{original:S,features:E});Array.prototype.push.apply(K,E);B.push(S);A=true}}}if(L&&L.length>1){this.geomsToFeatures(H,L);this.events.triggerEvent("split",{original:H,features:L});Array.prototype.push.apply(K,L);B.push(H);M=true}if(M||A){if(this.deferDelete){var F,N=[];for(var T=0,I=B.length;T<I;++T){F=B[T];if(F.state===HGIS.State.INSERT){N.push(F)}else{F.state=HGIS.State.DELETE;this.layer.drawFeature(F)}}this.layer.destroyFeatures(N,{silent:true});for(var T=0,I=K.length;T<I;++T){K[T].state=HGIS.State.INSERT}}else{this.layer.destroyFeatures(B,{silent:true})}this.layer.addFeatures(K,{silent:true});this.events.triggerEvent("aftersplit",{source:H,features:K})}}return M},geomsToFeatures:function(B,E){var D=B.clone();delete D.geometry;var A;for(var C=0,F=E.length;C<F;++C){A=D.clone();A.geometry=E[C];A.state=HGIS.State.INSERT;E[C]=A}},destroy:function(){if(this.active){this.deactivate()}HGIS.Control.prototype.destroy.call(this)},CLASS_NAME:"HGIS.Control.Split"});HGIS.Layer.WMTS=HGIS.Class(HGIS.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png","png":"png","image/jpeg":"jpg","image/jpg":"jpg","jpeg":"jpg","jpg":"jpg"},matrix:null,initialize:function(B){var F={url:true,layer:true,style:true,matrixSet:true};for(var C in F){if(!(C in B)){throw new Error("Missing property '"+C+"' in layer configuration.")}}B.params=HGIS.Util.upperCaseObject(B.params);var G=[B.name,B.url,B.params,B];HGIS.Layer.Grid.prototype.initialize.apply(this,G);if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()}if(this.matrixIds){var D=this.matrixIds.length;if(D&&typeof this.matrixIds[0]==="string"){var E=this.matrixIds;this.matrixIds=new Array(D);for(var A=0;A<D;++A){this.matrixIds[A]={identifier:E[A]}}}}},setMap:function(){HGIS.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new HGIS.Size(this.matrix.tileWidth,this.matrix.tileHeight)}if(!this.tileOrigin){this.tileOrigin=new HGIS.LonLat(this.maxExtent.left,this.maxExtent.top)}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(B,A,C){if(A||!this.matrix){this.updateMatrixProperties()}return HGIS.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(A){if(A==null){A=new HGIS.Layer.WMTS(this.options)}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var A;if(!this.matrixIds||this.matrixIds.length===0){A={identifier:this.getIdentifier()}}else{if("scaleDenominator" in this.matrixIds[0]){var C=HGIS.METERS_PER_INCH*HGIS.INCHES_PER_UNIT[this.units]*this.getServerResolution()/0.00028;var F=Number.POSITIVE_INFINITY;var E;for(var B=0,D=this.matrixIds.length;B<D;++B){E=Math.abs(1-(this.matrixIds[B].scaleDenominator/C));if(E<F){F=E;A=this.matrixIds[B]}}}else{A=this.matrixIds[this.getIdentifier()]}}return A},getTileInfo:function(F){var D=this.getServerResolution();var A=(F.lon-this.tileOrigin.lon)/(D*this.tileSize.w);var C=(this.tileOrigin.lat-F.lat)/(D*this.tileSize.h);var E=Math.floor(A);var B=Math.floor(C);return{col:E,row:B,i:Math.floor((A-E)*this.tileSize.w),j:Math.floor((C-B)*this.tileSize.h)}},getURL:function(K){K=this.adjustBounds(K);var J="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(K)){var C=K.getCenterLonLat();var I=this.getTileInfo(C);var D=this.matrix.identifier;var A=this.dimensions,G;if(HGIS.Util.isArray(this.url)){J=this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,I.row,I.col].join(","),this.url)}else{J=this.url}if(this.requestEncoding.toUpperCase()==="REST"){G=this.params;if(J.indexOf("{")!==-1){var B=J.replace(/\{/g,"${");var E={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:I.row,TileCol:I.col};if(A){var L,F;for(F=A.length-1;F>=0;--F){L=A[F];E[L]=G[L.toUpperCase()]}}J=HGIS.String.format(B,E)}else{var H=this.version+"/"+this.layer+"/"+this.style+"/";if(A){for(var F=0;F<A.length;F++){if(G[A[F]]){H=H+G[A[F]]+"/"}}}H=H+this.matrixSet+"/"+this.matrix.identifier+"/"+I.row+"/"+I.col+"."+this.formatSuffix;if(!J.match(/\/$/)){J=J+"/"}J=J+H}}else{if(this.requestEncoding.toUpperCase()==="KVP"){G={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:I.row,TILECOL:I.col,FORMAT:this.format};J=HGIS.Layer.Grid.prototype.getFullRequestString.apply(this,[G])}}}return J},mergeNewParams:function(A){if(this.requestEncoding.toUpperCase()==="KVP"){return HGIS.Layer.Grid.prototype.mergeNewParams.apply(this,[HGIS.Util.upperCaseObject(A)])}},CLASS_NAME:"HGIS.Layer.WMTS"});HGIS.Protocol.SOS.v1_0_0=HGIS.Class(HGIS.Protocol,{fois:null,formatOptions:null,initialize:function(A){HGIS.Protocol.prototype.initialize.apply(this,[A]);if(!A.format){this.format=new HGIS.Format.SOSGetFeatureOfInterest(this.formatOptions)}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;HGIS.Protocol.prototype.destroy.apply(this)},read:function(B){B=HGIS.Util.extend({},B);HGIS.Util.applyDefaults(B,this.options||{});var C=new HGIS.Protocol.Response({requestType:"read"});var A=this.format;var D=HGIS.Format.XML.prototype.write.apply(A,[A.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);C.priv=HGIS.Request.POST({url:B.url,callback:this.createCallback(this.handleRead,C,B),data:D});return C},handleRead:function(C,B){if(B.callback){var A=C.priv;if(A.status>=200&&A.status<300){C.features=this.parseFeatures(A);C.code=HGIS.Protocol.Response.SUCCESS}else{C.code=HGIS.Protocol.Response.FAILURE}B.callback.call(B.scope,C)}},parseFeatures:function(A){var B=A.responseXML;if(!B||!B.documentElement){B=A.responseText}if(!B||B.length<=0){return null}return this.format.read(B)},CLASS_NAME:"HGIS.Protocol.SOS.v1_0_0"});HGIS.Layer.KaMapCache=HGIS.Class(HGIS.Layer.KaMap,{IMAGE_EXTENSIONS:{"jpeg":"jpg","gif":"gif","png":"png","png8":"png","png24":"png","dithered":"png"},DEFAULT_FORMAT:"jpeg",initialize:function(C,A,D,B){HGIS.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(A){A=this.adjustBounds(A);var I=this.map.getResolution();var B=Math.round((this.map.getScale()*10000))/10000;var F=Math.round(A.left/I);var H=-Math.round(A.top/I);var D=Math.floor(F/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;var C=Math.floor(H/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;var E=["/",this.params.map,"/",B,"/",this.params.g.replace(/\s/g,"_"),"/def/t",C,"/l",D,"/t",H,"l",F,".",this.extension];var G=this.url;if(HGIS.Util.isArray(G)){G=this.selectUrl(E.join(""),G)}return G+E.join("")},CLASS_NAME:"HGIS.Layer.KaMapCache"});HGIS.Protocol.WFS.v1_1_0=HGIS.Class(HGIS.Protocol.WFS.v1,{version:"1.1.0",initialize:function(A){HGIS.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);if(this.outputFormat&&!this.readFormat){if(this.outputFormat.toLowerCase()=="gml2"){this.readFormat=new HGIS.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName})}else{if(this.outputFormat.toLowerCase()=="json"){this.readFormat=new HGIS.Format.GeoJSON()}}}},CLASS_NAME:"HGIS.Protocol.WFS.v1_1_0"});HGIS.Format.WMSCapabilities.v1_1_1=HGIS.Class(HGIS.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{"wms":HGIS.Util.applyDefaults({"SRS":function(B,A){A.srs[this.getChildValue(B)]=true}},HGIS.Format.WMSCapabilities.v1_1.prototype.readers["wms"])},CLASS_NAME:"HGIS.Format.WMSCapabilities.v1_1_1"});HGIS.Format.WMSCapabilities.v1_1_1_WMSC=HGIS.Class(HGIS.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{"wms":HGIS.Util.applyDefaults({"VendorSpecificCapabilities":function(B,A){A.vendorSpecific={tileSets:[]};this.readChildNodes(B,A.vendorSpecific)},"TileSet":function(B,A){var C={srs:{},bbox:{},resolutions:[]};this.readChildNodes(B,C);A.tileSets.push(C)},"Resolutions":function(B,E){var C=this.getChildValue(B).split(" ");for(var A=0,D=C.length;A<D;A++){if(C[A]!=""){E.resolutions.push(parseFloat(C[A]))}}},"Width":function(A,B){B.width=parseInt(this.getChildValue(A))},"Height":function(A,B){B.height=parseInt(this.getChildValue(A))},"Layers":function(A,B){B.layers=this.getChildValue(A)},"Styles":function(A,B){B.styles=this.getChildValue(A)}},HGIS.Format.WMSCapabilities.v1_1_1.prototype.readers["wms"])},CLASS_NAME:"HGIS.Format.WMSCapabilities.v1_1_1_WMSC"});HGIS.Control.LayerSwitcher=HGIS.Class(HGIS.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);HGIS.Control.prototype.destroy.apply(this,arguments)},setMap:function(A){HGIS.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});if(this.outsideViewport){this.events.attachToElement(this.div);this.events.register("buttonclick",this,this.onButtonClick)}else{this.map.events.register("buttonclick",this,this.onButtonClick)}},draw:function(){HGIS.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},onButtonClick:function(B){var A=B.buttonElement;if(A===this.minimizeDiv){this.minimizeControl()}else{if(A===this.maximizeDiv){this.maximizeControl()}else{if(A._layerSwitcher===this.id){if(A["for"]){A=document.getElementById(A["for"])}if(!A.disabled){if(A.type=="radio"){A.checked=true;this.map.setBaseLayer(this.map.getLayer(A._layer))}else{A.checked=!A.checked;this.updateMap()}}}}}},clearLayersArray:function(A){this[A+"LayersDiv"].innerHTML="";this[A+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){return true}for(var A=0,C=this.layerStates.length;A<C;A++){var D=this.layerStates[A];var B=this.map.layers[A];if((D.name!=B.name)||(D.inRange!=B.inRange)||(D.id!=B.id)||(D.visibility!=B.visibility)){return true}}return false},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var I=false;var N=false;var J=this.map.layers.length;this.layerStates=new Array(J);for(var F=0;F<J;F++){var G=this.map.layers[F];this.layerStates[F]={"name":G.name,"visibility":G.visibility,"inRange":G.inRange,"id":G.id}}var M=this.map.layers.slice();if(!this.ascending){M.reverse()}for(var F=0,J=M.length;F<J;F++){var G=M[F];var H=G.isBaseLayer;if(G.displayInLayerSwitcher){if(H){N=true}else{I=true}var K=(H)?(G==this.map.baseLayer):G.getVisibility();var D=document.createElement("input"),E=HGIS.Util.createUniqueID(this.id+"_input_");D.id=E;D.name=(H)?this.id+"_baseLayers":G.name;D.type=(H)?"radio":"checkbox";D.value=G.name;D.checked=K;D.defaultChecked=K;D.className="olButton";D._layer=G.id;D._layerSwitcher=this.id;if(!H&&!G.inRange){D.disabled=true}var L=document.createElement("label");L["for"]=D.id;HGIS.Element.addClass(L,"labelSpan olButton");L._layer=G.id;L._layerSwitcher=this.id;if(!H&&!G.inRange){L.style.color="gray"}L.innerHTML=G.name;L.style.verticalAlign=(H)?"bottom":"baseline";var C=document.createElement("br");var A=(H)?this.baseLayers:this.dataLayers;A.push({"layer":G,"inputElem":D,"labelSpan":L});var B=(H)?this.baseLayersDiv:this.dataLayersDiv;B.appendChild(D);B.appendChild(L);B.appendChild(C)}}this.dataLbl.style.display=(I)?"":"none";this.baseLbl.style.display=(N)?"":"none";return this.div},updateMap:function(){for(var A=0,C=this.baseLayers.length;A<C;A++){var B=this.baseLayers[A];if(B.inputElem.checked){this.map.setBaseLayer(B.layer,false)}}for(var A=0,C=this.dataLayers.length;A<C;A++){var B=this.dataLayers[A];B.layer.setVisibility(B.inputElem.checked)}},maximizeControl:function(A){this.div.style.width="";this.div.style.height="";this.showControls(false);if(A!=null){HGIS.Event.stop(A)}},minimizeControl:function(A){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(A!=null){HGIS.Event.stop(A)}},showControls:function(A){this.maximizeDiv.style.display=A?"":"none";this.minimizeDiv.style.display=A?"none":"";this.layersDiv.style.display=A?"none":""},loadContents:function(){this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";HGIS.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=HGIS.i18n("Base Layer");HGIS.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");HGIS.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=HGIS.i18n("Overlays");HGIS.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");HGIS.Element.addClass(this.dataLayersDiv,"dataLayersDiv");if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);var A=HGIS.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=HGIS.Util.createAlphaImageDiv("HGIS_Control_MaximizeDiv",null,null,A,"absolute");HGIS.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);var A=HGIS.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=HGIS.Util.createAlphaImageDiv("HGIS_Control_MinimizeDiv",null,null,A,"absolute");HGIS.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"HGIS.Control.LayerSwitcher"});HGIS.Format.Atom=HGIS.Class(HGIS.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:false,read:function(A){if(typeof A=="string"){A=HGIS.Format.XML.prototype.read.apply(this,[A])}return this.parseFeatures(A)},write:function(A){var D;if(HGIS.Util.isArray(A)){D=this.createElementNSPlus("atom:feed");D.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var B=0,C=A.length;B<C;B++){D.appendChild(this.buildEntryNode(A[B]))}}else{D=this.buildEntryNode(A)}return HGIS.Format.XML.prototype.write.apply(this,[D])},buildContentNode:function(B){var A=this.createElementNSPlus("atom:content",{attributes:{type:B.type||null}});if(B.src){A.setAttribute("src",B.src)}else{if(B.type=="text"||B.type==null){A.appendChild(this.createTextNode(B.value))}else{if(B.type=="html"){if(typeof B.value!="string"){throw"HTML content must be in form of an escaped string"}A.appendChild(this.createTextNode(B.value))}else{if(B.type=="xhtml"){A.appendChild(B.value)}else{if(B.type=="xhtml"||B.type.match(/(\+|\/)xml$/)){A.appendChild(B.value)}else{A.appendChild(this.createTextNode(B.value))}}}}}return A},buildEntryNode:function(L){var D=L.attributes;var E=D.atom||{};var H=this.createElementNSPlus("atom:entry");if(E.authors){var K=HGIS.Util.isArray(E.authors)?E.authors:[E.authors];for(var J=0,G=K.length;J<G;J++){H.appendChild(this.buildPersonConstructNode("author",K[J]))}}if(E.categories){var B=HGIS.Util.isArray(E.categories)?E.categories:[E.categories];var C;for(var J=0,G=B.length;J<G;J++){C=B[J];H.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:C.term,scheme:C.scheme||null,label:C.label||null}}))}}if(E.content){H.appendChild(this.buildContentNode(E.content))}if(E.contributors){var F=HGIS.Util.isArray(E.contributors)?E.contributors:[E.contributors];for(var J=0,G=F.length;J<G;J++){H.appendChild(this.buildPersonConstructNode("contributor",F[J]))}}if(L.fid){H.appendChild(this.createElementNSPlus("atom:id",{value:L.fid}))}if(E.links){var A=HGIS.Util.isArray(E.links)?E.links:[E.links];var M;for(var J=0,G=A.length;J<G;J++){M=A[J];H.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:M.href,rel:M.rel||null,type:M.type||null,hreflang:M.hreflang||null,title:M.title||null,length:M.length||null}}))}}if(E.published){H.appendChild(this.createElementNSPlus("atom:published",{value:E.published}))}if(E.rights){H.appendChild(this.createElementNSPlus("atom:rights",{value:E.rights}))}if(E.summary||D.description){H.appendChild(this.createElementNSPlus("atom:summary",{value:E.summary||D.description}))}H.appendChild(this.createElementNSPlus("atom:title",{value:E.title||D.title||this.defaultEntryTitle}));if(E.updated){H.appendChild(this.createElementNSPlus("atom:updated",{value:E.updated}))}if(L.geometry){var I=this.createElementNSPlus("georss:where");I.appendChild(this.buildGeometryNode(L.geometry));H.appendChild(I)}return H},initGmlParser:function(){this.gmlParser=new HGIS.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(B){if(!this.gmlParser){this.initGmlParser()}var A=this.gmlParser.writeNode("feature:_geometry",B);return A.firstChild},buildPersonConstructNode:function(D,E){var C=["uri","email"];var F=this.createElementNSPlus("atom:"+D);F.appendChild(this.createElementNSPlus("atom:name",{value:E.name}));for(var A=0,B=C.length;A<B;A++){if(E[C[A]]){F.appendChild(this.createElementNSPlus("atom:"+C[A],{value:E[C[A]]}))}}return F},getFirstChildValue:function(B,D,C,F){var E;var A=this.getElementsByTagNameNS(B,D,C);if(A&&A.length>0){E=this.getChildValue(A[0],F)}else{E=F}return E},parseFeature:function(I){var D={};var G=null;var N=null;var M=null;var H=this.namespaces.atom;this.parsePersonConstructs(I,"author",D);N=this.getElementsByTagNameNS(I,H,"category");if(N.length>0){D.categories=[]}for(var J=0,E=N.length;J<E;J++){G={};G.term=N[J].getAttribute("term");M=N[J].getAttribute("scheme");if(M){G.scheme=M}M=N[J].getAttribute("label");if(M){G.label=M}D.categories.push(G)}N=this.getElementsByTagNameNS(I,H,"content");if(N.length>0){G={};M=N[0].getAttribute("type");if(M){G.type=M}M=N[0].getAttribute("src");if(M){G.src=M}else{if(G.type=="text"||G.type=="html"||G.type==null){G.value=this.getFirstChildValue(I,H,"content",null)}else{if(G.type=="xhtml"||G.type.match(/(\+|\/)xml$/)){G.value=this.getChildEl(N[0])}else{G.value=this.getFirstChildValue(I,H,"content",null)}}D.content=G}}this.parsePersonConstructs(I,"contributor",D);D.id=this.getFirstChildValue(I,H,"id",null);N=this.getElementsByTagNameNS(I,H,"link");if(N.length>0){D.links=new Array(N.length)}var B=["rel","type","hreflang","title","length"];for(var J=0,E=N.length;J<E;J++){G={};G.href=N[J].getAttribute("href");for(var F=0,L=B.length;F<L;F++){M=N[J].getAttribute(B[F]);if(M){G[B[F]]=M}}D.links[J]=G}G=this.getFirstChildValue(I,H,"published",null);if(G){D.published=G}G=this.getFirstChildValue(I,H,"rights",null);if(G){D.rights=G}G=this.getFirstChildValue(I,H,"summary",null);if(G){D.summary=G}D.title=this.getFirstChildValue(I,H,"title",null);D.updated=this.getFirstChildValue(I,H,"updated",null);var C={title:D.title,description:D.summary,atom:D};var K=this.parseLocations(I)[0];var A=new HGIS.Feature.Vector(K,C);A.fid=D.id;return A},parseFeatures:function(C){var A=[];var D=this.getElementsByTagNameNS(C,this.namespaces.atom,"entry");if(D.length==0){D=[C]}for(var B=0,E=D.length;B<E;B++){A.push(this.parseFeature(D[B]))}return A},parseLocations:function(K){var G=this.namespaces.georss;var P={components:[]};var B=this.getElementsByTagNameNS(K,G,"where");if(B&&B.length>0){if(!this.gmlParser){this.initGmlParser()}for(var L=0,E=B.length;L<E;L++){this.gmlParser.readChildNodes(B[L],P)}}var I=P.components;var N=this.getElementsByTagNameNS(K,G,"point");if(N&&N.length>0){for(var L=0,E=N.length;L<E;L++){var F=HGIS.String.trim(N[L].firstChild.nodeValue).split(/\s+/);if(F.length!=2){F=HGIS.String.trim(N[L].firstChild.nodeValue).split(/\s*,\s*/)}I.push(new HGIS.Geometry.Point(F[1],F[0]))}}var A=this.getElementsByTagNameNS(K,G,"line");if(A&&A.length>0){var M;var D;var C;for(var L=0,E=A.length;L<E;L++){M=HGIS.String.trim(A[L].firstChild.nodeValue).split(/\s+/);C=[];for(var O=0,H=M.length;O<H;O+=2){D=new HGIS.Geometry.Point(M[O+1],M[O]);C.push(D)}I.push(new HGIS.Geometry.LineString(C))}}var J=this.getElementsByTagNameNS(K,G,"polygon");if(J&&J.length>0){var M;var D;var C;for(var L=0,E=J.length;L<E;L++){M=HGIS.String.trim(J[L].firstChild.nodeValue).split(/\s+/);C=[];for(var O=0,H=M.length;O<H;O+=2){D=new HGIS.Geometry.Point(M[O+1],M[O]);C.push(D)}I.push(new HGIS.Geometry.Polygon([new HGIS.Geometry.LinearRing(C)]))}}if(this.internalProjection&&this.externalProjection){for(var L=0,E=I.length;L<E;L++){if(I[L]){I[L].transform(this.externalProjection,this.internalProjection)}}}return I},parsePersonConstructs:function(H,J,C){var A=[];var G=this.namespaces.atom;var M=this.getElementsByTagNameNS(H,G,J);var B=["uri","email"];for(var I=0,D=M.length;I<D;I++){var F={};F.name=this.getFirstChildValue(M[I],G,"name",null);for(var E=0,K=B.length;E<K;E++){var L=this.getFirstChildValue(M[I],G,B[E],null);if(L){F[B[E]]=L}}A.push(F)}if(A.length>0){C[J+"s"]=A}},CLASS_NAME:"HGIS.Format.Atom"});HGIS.Control.KeyboardDefaults=HGIS.Class(HGIS.Control,{autoActivate:true,slideFactor:75,observeElement:null,draw:function(){var A=this.observeElement||document;this.handler=new HGIS.Handler.Keyboard(this,{"keydown":this.defaultKeyPress},{observeElement:A})},defaultKeyPress:function(C){var A,B=true;var D=HGIS.Event.element(C);if(D&&(D.tagName=="INPUT"||D.tagName=="TEXTAREA"||D.tagName=="SELECT")){return}switch(C.keyCode){case HGIS.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case HGIS.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case HGIS.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case HGIS.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:A=this.map.getSize();this.map.pan(0,-0.75*A.h);break;case 34:A=this.map.getSize();this.map.pan(0,0.75*A.h);break;case 35:A=this.map.getSize();this.map.pan(0.75*A.w,0);break;case 36:A=this.map.getSize();this.map.pan(-0.75*A.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:B=false}if(B){HGIS.Event.stop(C)}},CLASS_NAME:"HGIS.Control.KeyboardDefaults"});HGIS.Format.WMTSCapabilities.v1_0_0=HGIS.Class(HGIS.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(A){HGIS.Format.XML.prototype.initialize.apply(this,[A]);this.options=A;var B=HGIS.Util.extend({},HGIS.Format.WMTSCapabilities.prototype.yx);this.yx=HGIS.Util.extend(B,this.yx)},read:function(B){if(typeof B=="string"){B=HGIS.Format.XML.prototype.read.apply(this,[B])}if(B&&B.nodeType==9){B=B.documentElement}var A={};this.readNode(B,A);A.version=this.version;return A},readers:{"wmts":{"Capabilities":function(B,A){this.readChildNodes(B,A)},"Contents":function(B,A){A.contents={};A.contents.layers=[];A.contents.tileMatrixSets={};this.readChildNodes(B,A.contents)},"Layer":function(B,A){var C={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};C.layers=[];this.readChildNodes(B,C);A.layers.push(C)},"Style":function(B,A){var C={};C.isDefault=(B.getAttribute("isDefault")==="true");this.readChildNodes(B,C);A.styles.push(C)},"Format":function(B,A){A.formats.push(this.getChildValue(B))},"TileMatrixSetLink":function(B,A){var C={};this.readChildNodes(B,C);A.tileMatrixSetLinks.push(C)},"TileMatrixSet":function(B,A){if(A.layers){var C={matrixIds:[]};this.readChildNodes(B,C);A.tileMatrixSets[C.identifier]=C}else{A.tileMatrixSet=this.getChildValue(B)}},"TileMatrix":function(C,A){var B={supportedCRS:A.supportedCRS};this.readChildNodes(C,B);A.matrixIds.push(B)},"ScaleDenominator":function(B,A){A.scaleDenominator=parseFloat(this.getChildValue(B))},"TopLeftCorner":function(D,B){var A=this.getChildValue(D);var E=A.split(" ");var F;if(B.supportedCRS){var C=B.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");F=!!this.yx[C]}if(F){B.topLeftCorner=new HGIS.LonLat(E[1],E[0])}else{B.topLeftCorner=new HGIS.LonLat(E[0],E[1])}},"TileWidth":function(B,A){A.tileWidth=parseInt(this.getChildValue(B))},"TileHeight":function(B,A){A.tileHeight=parseInt(this.getChildValue(B))},"MatrixWidth":function(B,A){A.matrixWidth=parseInt(this.getChildValue(B))},"MatrixHeight":function(B,A){A.matrixHeight=parseInt(this.getChildValue(B))},"ResourceURL":function(B,A){A.resourceUrl=A.resourceUrl||{};var D=B.getAttribute("resourceType");if(!A.resourceUrls){A.resourceUrls=[]}var C=A.resourceUrl[D]={format:B.getAttribute("format"),template:B.getAttribute("template"),resourceType:D};A.resourceUrls.push(C)},"WSDL":function(B,A){A.wsdl={};A.wsdl.href=B.getAttribute("xlink:href")},"ServiceMetadataURL":function(B,A){A.serviceMetadataUrl={};A.serviceMetadataUrl.href=B.getAttribute("xlink:href")},"LegendURL":function(B,A){A.legend={};A.legend.href=B.getAttribute("xlink:href");A.legend.format=B.getAttribute("format")},"Dimension":function(B,A){var C={values:[]};this.readChildNodes(B,C);A.dimensions.push(C)},"Default":function(B,A){A["default"]=this.getChildValue(B)},"Value":function(B,A){A.values.push(this.getChildValue(B))}},"ows":HGIS.Format.OWSCommon.v1_1_0.prototype.readers["ows"]},CLASS_NAME:"HGIS.Format.WMTSCapabilities.v1_0_0"});HGIS.Biz=HGIS.Biz||{};HGIS.Biz.BayonetTrace=function(B,E,C,D){var A=this;A._distance=0;A._map=B;A._layer=E;A._startPoint=null;A._beginPoint=null;A._endPoint=null;A._currentTempPoint=null;A._stopPoint=null;A._stopPointIndex=1;A.lastPointIndex=1;A.steepLength=0;A._timer=null;A._speed=1;A.car=null;A.status="pre";A.points=null;A._currentAngle=0;A._stopTime=1;A._stopTimer=null;A.completePath=null;A.showPath=true;A.showPoint=true;A.minTime=0;A.maxTime=0;A.curTime=0;A.timeRatio=1;A.pathSize=0;A.data=null;A._interval=60;A._step=1000;A._pauseTime=4000;A._totalTime=10000;A.tranceByDistance=true;A.showCarOnPath=true;A._style={"PointDraw":{pointRadius:3,graphicName:"circle",fillColor:"#ffffff",fillOpacity:0.8,strokeWidth:4,strokeOpacity:1,strokeColor:"red",graphicZIndex:10},"Line":{strokeWidth:5,strokeOpacity:1,strokeColor:"green",graphicZIndex:5},"CompleteLine":{strokeWidth:5,strokeOpacity:1,strokeColor:"red",graphicZIndex:5}};A.setInterval=function(F){A._interval=F};A.setTranceStep=function(F){A._step=F;A.steepLength=(A._distance/A._step)*A._speed};A.setTotalTime=function(F){A._totalTime=F;A.timeRatio=A._totalTime/(A.maxTime-A.minTime)};A.startStyle={externalGraphic:"/hgis/theme/img/startpoint.png",graphicWidth:32,graphicHeight:32,graphicXOffset:-16,graphicYOffset:-32,graphicZIndex:15};A.endStyle={externalGraphic:"/hgis/theme/img/terminal.png",graphicWidth:32,graphicHeight:32,graphicXOffset:-16,graphicYOffset:-32,graphicZIndex:15};A.moveStyle={externalGraphic:"/hgis/theme/img/rightcar.png",graphicWidth:65,graphicHeight:33,graphicXOffset:-32,graphicYOffset:-15,graphicZIndex:16,labelXOffset:0,labelYOffset:40,fontColor:"blue"};this.setStartStyle=function(F){A.startStyle=F};this.setendStyle=function(F){A.endStyle=F};this.setmoveStyle=function(F){A.moveStyle=F};this.cleanPath=function(){clearTimeout(A._timer);E.removeAllFeatures();A.status="complete"};this.setPathShow=function(F){A.showPath=(F==true)};this.setStopTime=function(F){A._stopTime=F};this.stopTime=function(F){A._stopTime=F};this.bindMap=function(F){A._map=F};this.speed=function(F){if(F<=0){return}A._speed=F;if(A.tranceByDistance){A.steepLength=(A._distance/A._step)*A._speed}};this.addTargetStyle=function(F,G){var H=new HGIS.Geometry.Point(F.x,F.y);A.car=new HGIS.Feature.Vector(H,A.data[0],HGIS.Util.extend(A.moveStyle,{label:A.data[0].label}));A._startPoint=new HGIS.Feature.Vector(F,null,A.startStyle);A._endPoint=new HGIS.Feature.Vector(G,null,A.endStyle);A._layer.addFeatures([A._endPoint,A._startPoint]);if(A.showCarOnPath){A._layer.addFeatures([A.car])}};this.setPath=function(H){if(H==null||H==""||H==undefined){alert(HGIS.language[HGIS.InitParam.language]["track_data_noEmpty"]);return}var I=H.length;if(I>1){A.pathSize=I;A.data=H;A._distance=0;if(A.points==null){A.points=new Array()}else{A.points=[]}for(var L=0;L<I;L++){var G=new HGIS.Geometry.Point(H[L].longitude,H[L].latitude);A.points.push(G);if(L>0&&A.tranceByDistance){A._distance+=A.points[L].distanceTo(A.points[L-1])}}if(A.tranceByDistance){A.steepLength=(A._distance/A._step)*A._speed}else{A.minTime=this.data[0].time;A.curTime=A.minTime;A.maxTime=this.data[A.pathSize-1].time;A.timeRatio=A._totalTime/(A.maxTime-A.minTime)}A._currentAngle=A.caculateAngle(A.points[0],A.points[1]);A._beginPoint=new HGIS.Geometry.Point(A.points[0].x,A.points[0].y);A._startPoint=new HGIS.Geometry.Point(A.points[0].x,A.points[0].y);A._stopPoint=new HGIS.Geometry.Point(A.points[1].x,A.points[1].y);A._currentTempPoint=new HGIS.Geometry.Point(A.points[0].x,A.points[0].y);A.lastPointIndex=A.points.length;var F=new HGIS.Geometry.LineString(A.points);var K=new HGIS.Geometry.MultiPoint(A.points);var N=new HGIS.Feature.Vector(F,{},A._style["Line"]);var M=new Array();M.push(N);if(A.showPoint){var O=new HGIS.Feature.Vector(K,{},A._style["PointDraw"]);M.push(O)}E.addFeatures(M);A.addTargetStyle(A.points[0],A.points[I-1]);if(A.showCarOnPath){A.changeCarStatus()}var J=F.getBounds();B.zoomToExtent(J)}else{alert(HGIS.language[HGIS.InitParam.language]["point_noTrack"]);return}};this.start=function(){if(A.status=="complete"){A.stop()}if(A.status!="start"){A.status="start";if(C!=null){C([A.data[0],0])}if(A.tranceByDistance){A.timeFn()}else{A.play()}}};this.pause=function(){clearTimeout(A._timer);clearTimeout(A._stopTimer);A.status="pause"};this.stop=function(){clearTimeout(A._timer);clearTimeout(A._stopTimer);A._stopPointIndex=1;A._currentAngle=A.caculateAngle(A.points[0],A.points[1]);A._currentTempPoint=new HGIS.Geometry.Point(A.points[0].x,A.points[0].y);A._beginPoint=new HGIS.Geometry.Point(A.points[0].x,A.points[0].y);A._stopPoint=new HGIS.Geometry.Point(A.points[1].x,A.points[1].y);if(!A.tranceByDistance){A.curTime=A.minTime}A.changeCarStatus();A.car.style.label=A.data[A._stopPointIndex-1].label;A.changePosition();E.removeFeatures(A.completePath);A.completePath=null;A.status="stop"};this.resume=function(){if(A.status=="pause"){A.status="pre";if(A.tranceByDistance){A.timeFn()}else{A.play()}}};this.restart=function(F,G){if(F!=undefined&&G!=undefined){if(isNaN(F)||isNaN(G)||F<0||G<0){alert(HGIS.language[HGIS.InitParam.language]["replay_track_point_err"]);return}if(G>A.lastPointIndex-1){throw"restart failed beacause of the endIndex is out of the range";return}}A.status="pre";A.stop();if(F==undefined||G==undefined){if(A.tranceByDistance){A.lastPointIndex=A.points.length}else{A.curTime=A.data[0].time;A.maxTime=A.maxTime=this.data[A.pathSize-1].time}A.lastPointIndex=A.points.length;A.car.style.label=A.data[0].label;A.start()}else{if(A.tranceByDistance){A.lastPointIndex=G+1}else{A.maxTime=A.data[G].time;A.curTime=A.data[F].time}A._beginPoint=new HGIS.Geometry.Point(A.points[F].x,A.points[F].y);A._startPoint=new HGIS.Geometry.Point(A.points[F].x,A.points[F].y);A._stopPoint=new HGIS.Geometry.Point(A.points[F+1].x,A.points[F+1].y);A._stopPointIndex=F+1;A._currentTempPoint=A._startPoint;A.changePosition();A._currentAngle=A.caculateAngle(A.points[F],A.points[F+1]);A.changeCarStatus();A.car.style.label=A.data[F].label;A.start()}};this.destory=function(){clearTimeout(A._timer);clearTimeout(A._stopTimer);E.removeAllFeatures();A==null};this.destroy=this.destory;this.timeFn=function(){if(A.status=="complete"){return}var F=A._stopPointIndex;if(A._beginPoint.x==A._stopPoint.x&&A._beginPoint.y==A._stopPoint.y){A._stopTimer=setTimeout(A.moveTheSamePoint,A._pauseTime/A._speed);return}A.getNextPoint();A.changePosition();A.fillPath();if(B.getExtent().left>A._currentTempPoint.x||B.getExtent().bottom>A._currentTempPoint.y||B.getExtent().right<A._currentTempPoint.x||B.getExtent().top<A._currentTempPoint.y){B.setCenter(new HGIS.LonLat(A._currentTempPoint.x,A._currentTempPoint.y))}if(A._stopPointIndex>A.lastPointIndex-1){A.status="complete";clearTimeout(A._timer);return}if(F==A._stopPointIndex){A._timer=setTimeout(A.timeFn,A._interval)}else{var G=A.data[A._stopPointIndex-1].crossTime!=undefined?A.data[A._stopPointIndex-1].crossTime:A._stopTime*1000;A._timer=setTimeout(A.timeFn,G)}};this.getNextPoint=function(){if(A._currentAngle==0){A._currentTempPoint.x+=A.steepLength}else{if(A._currentAngle<Math.PI/2){A._currentTempPoint.x+=A.steepLength*Math.cos(A._currentAngle);A._currentTempPoint.y+=A.steepLength*Math.sin(A._currentAngle)}else{if(A._currentAngle==Math.PI/2){A._currentTempPoint.y+=A.steepLength}else{if(A._currentAngle<Math.PI){A._currentTempPoint.x-=A.steepLength*Math.cos(Math.PI-A._currentAngle);A._currentTempPoint.y+=A.steepLength*Math.sin(Math.PI-A._currentAngle)}else{if(A._currentAngle==Math.PI){A._currentTempPoint.x-=A.steepLength}else{if(A._currentAngle<Math.PI*3/2){A._currentTempPoint.x-=A.steepLength*Math.cos(A._currentAngle-Math.PI);A._currentTempPoint.y-=A.steepLength*Math.sin(A._currentAngle-Math.PI)}else{if(A._currentAngle==Math.PI*3/2){A._currentTempPoint.y-=A.steepLength}else{if(A._currentAngle<Math.PI*2){A._currentTempPoint.x+=A.steepLength*Math.cos(2*Math.PI-A._currentAngle);A._currentTempPoint.y-=A.steepLength*Math.sin(2*Math.PI-A._currentAngle)}}}}}}}}var F=A._currentTempPoint.distanceTo(A._stopPoint);if(F<=A.steepLength){A._currentTempPoint.x=A._stopPoint.x;A._currentTempPoint.y=A._stopPoint.y;if(C!=null){C([A.data[A._stopPointIndex],A._stopPointIndex])}if(A._stopPointIndex<A.lastPointIndex-1){A._stopPointIndex++;A._stopPoint=A.points[A._stopPointIndex];A._beginPoint=A.points[A._stopPointIndex-1];A._currentAngle=A.caculateAngle(A._currentTempPoint,A._stopPoint);A.changeCarStatus();A.car.style.label=A.data[A._stopPointIndex-1].label}else{A._stopPointIndex++}}else{if(D!=null){D([A.data[A._stopPointIndex-1],A._currentTempPoint,A._stopPointIndex-1,A._currentAngle])}}};this.play=function(){if(A.status=="complete"){return}if(A._stopPointIndex==A.pathSize){return}if(A.curTime>A.maxTime){return}if(A._beginPoint.x==A._stopPoint.x&&A._beginPoint.y==A._stopPoint.y){A._stopTimer=setTimeout(A.moveTheSamePoint,A._pauseTime/A._speed*A.timeRatio);return}var F=A._stopPointIndex;A.execute();A.changePosition();A.fillPath();if(B.getExtent().left>A._currentTempPoint.x||B.getExtent().bottom>A._currentTempPoint.y||B.getExtent().right<A._currentTempPoint.x||B.getExtent().top<A._currentTempPoint.y){B.setCenter(new HGIS.LonLat(A._currentTempPoint.x,A._currentTempPoint.y))}if(A._stopPointIndex>A.pathSize-1){A.status="complete";clearTimeout(A._timer);return}if(F==A._stopPointIndex){A._timer=setTimeout(A.play,A._interval/A._speed*A.timeRatio)}else{var G=A.data[A._stopPointIndex-1].crossTime!=undefined?A.data[A._stopPointIndex-1].crossTime:A._stopTime*1000;A._timer=setTimeout(A.play,G*A.timeRatio)}};this.execute=function(){if(A.data[A._stopPointIndex].time===A.data[A._stopPointIndex-1].time){A._currentTempPoint.y=A._stopPoint.y;A._currentTempPoint.x=A._stopPoint.x}else{var F=(A._stopPoint.x-A._beginPoint.x)/(A.data[A._stopPointIndex].time-A.data[A._stopPointIndex-1].time);var G=(A._stopPoint.y-A._beginPoint.y)/(A.data[A._stopPointIndex].time-A.data[A._stopPointIndex-1].time);var H=parseFloat(A._beginPoint.x)+F*(A.curTime-A.data[A._stopPointIndex-1].time);var I=parseFloat(A._beginPoint.y)+G*(A.curTime-A.data[A._stopPointIndex-1].time);A._currentTempPoint.y=I;A._currentTempPoint.x=H}A.curTime=parseFloat(A.curTime)+parseFloat(A._interval);if(A.curTime>A.data[A._stopPointIndex].time){if(C!=null){C([A.data[A._stopPointIndex],A._stopPointIndex])}if(A._stopPointIndex<A.pathSize-1){A._stopPointIndex++;A._stopPoint=A.points[A._stopPointIndex];A._beginPoint=A.points[A._stopPointIndex-1];A._currentAngle=A.caculateAngle(A._beginPoint,A._stopPoint);A.changeCarStatus();A.car.style.label=A.data[A._stopPointIndex-1].label}else{A._stopPointIndex++}}else{if(D!=null){D([A.data[A._stopPointIndex-1],A._currentTempPoint,A._stopPointIndex-1,A._currentAngle])}}};this.moveTheSamePoint=function(){A._currentTempPoint.x=A._stopPoint.x;A._currentTempPoint.y=A._stopPoint.y;A._beginPoint=A._stopPoint;if(C!=null){C([A.data[A._stopPointIndex],A._stopPointIndex])}if(A._stopPointIndex==A.points.length-1){A.status="complete";return}if(A._stopPointIndex<A.points.length-1){A._stopPointIndex++;A._stopPoint=A.points[A._stopPointIndex]}A._currentAngle=A.caculateAngle(A._currentTempPoint,A._stopPoint);A.changeCarStatus();if(A.tranceByDistance){A.timeFn()}else{A.curTime=A.data[A._stopPointIndex-1].time;A.play()}};this.caculateAngle=function(L,F){var I=L.x;var K=L.y;var J=F.x;var H=F.y;if(I==J){if(H>K){return Math.PI/2}else{return Math.PI*3/2}}else{if(K==H){if(J>I){return 0}else{return Math.PI}}else{var G=Math.atan(Math.abs((H-K)/(J-I)));if(J>I&&H>K){return G}else{if(J<I&&H>K){return Math.PI-G}else{if(J<I&&H<K){return G+Math.PI}else{return 2*Math.PI-G}}}}}};this.changeCarStatus=function(){A.car.style["rotation"]=-A._currentAngle*180/Math.PI};this.changePosition=function(){var F=new HGIS.LonLat(A._currentTempPoint.x,A._currentTempPoint.y);A.car.move(F);E.drawFeature(A.car)};this.resetPosition=function(){var F=new HGIS.LonLat(A.data[0].longitude,A.data[0].latitude);A.car.move(F);E.drawFeature(A.car)};A.fillpathArr=[];this.fillPath=function(){if(!A.showPath){return}if(A.completePath!=null){E.removeFeatures(A.completePath);A.completePath=null}A.fillPathArr=[];for(var F=0;F<A._stopPointIndex;F++){A.fillPathArr.push(A.points[F])}A._currentTempPoint.calculateBounds();A.fillPathArr.push(A._currentTempPoint);var G=new HGIS.Geometry.LineString(A.fillPathArr);A.completePath=new HGIS.Feature.Vector(G,{},A._style["CompleteLine"]);E.addFeatures(A.completePath)}};HGIS.Biz=HGIS.Biz||{};HGIS.Biz.CameraNPlusOne=function(D,E,A,C){var B=this;B.centerPoint;B._radius=E;B._num=A;B.queryCameraUrl=tacticsURL.cameraNPlusOne;B.previewCameras=new Array();B.cameraArr=new Array();B.onekey=true;B.map=D.map;B.cameraDefaultStyle={externalGraphic:APIAdress+"jsapi/theme/img/res-camera.png",graphicWidth:30,graphicHeight:30,labelAlign:"cm",labelXOffset:0,labelYOffset:20,fontColor:"#333333",fontFamily:"Verdana,Arial,Helvetica,sans-serif",fontWeight:"normal",label:""};if(D.CLASS_NAME!="HGIS.Layer.Vector"){alert(HGIS.language[HGIS.InitParam.language]["vectorLayer_noExist"]);return}this.drawCenter=function(){var F=B.checkParams();if(!F){return}else{if(B.onekey){B.queryCameras()}}};this.checkParams=function(){var F=false;if(isNaN(B._radius)){alert(HGIS.language[HGIS.InitParam.language]["buff_radius_err"]);F=false}else{F=true}if(isNaN(B._num)){alert(HGIS.language[HGIS.InitParam.language]["open_camera_needParam"]);F=false;return}else{F=true}return F};this.queryCameras=function(){var F=function(J){B.centerPoint=J;var I={"centerLon":J.x,"centerLat":J.y,"radius":B._radius};var G=function(K){if(K.ReturnFlag==1){B.cameraArr=JSON.parse(K.Data);if(B.onekey){B.pasteCamerasOnMap()}}else{B.cameraArr=[]}};var H=function(K){alert(K)};HGIS.Utils.send(tacticsURL.cameraNPlusOne,JSON.stringify(I),"POST","json",G,H)};B.map.draw("point",D,"geometry",null,{"keepOn":false,"ifClear":false},F)};this.pasteCamerasOnMap=function(){for(var F=0;F<B.cameraArr.length;F=F+1){var J={name:B.cameraArr[F].name,dist:B.cameraArr[F].dist,indexCode:B.cameraArr[F].indexCode};B.cameraDefaultStyle.label=J.name;var H=C?C:B.cameraDefaultStyle;var G=new HGIS.Geometry.Point(B.cameraArr[F].lon*1,B.cameraArr[F].lat*1);var I=new HGIS.Feature.Vector(G,J,H);D.addFeatures([I])}if(B.onekey){B.previewNearstCameras()}};this.previewNearstCameras=function(){if(B._num<=B.cameraArr.length){B.previewCameras=B.cameraArr.slice(0,B._num)}else{B.previewCameras=B.cameraArr}};this.displayCenter=function(G,F){};this.displayBuffer=function(G,F){alert(G)}};HGIS.Biz=HGIS.Biz||{};HGIS.Biz.CameraRelay=function(C){var B=this;B.centerLon;B.centerLat;B.radius;B.linePoints;B.lineGeom;B.queryCameraUrl=tacticsURL.cameraRelayBufferQuery;B.cameraArr=new Array();if(C.CLASS_NAME!="HGIS.Layer.Vector"){alert(HGIS.language[HGIS.InitParam.language]["vectorLayer_noExist"]);return}var A=C.map;this.showCameras=function(I,H,F,K,J,E){if(isNaN(I)){alert(HGIS.language[HGIS.InitParam.language]["buff_radius_err"]);return}if(F){var G=C.getFeaturesByAttribute("tempLayerName",C.name);C.removeFeatures(G);A.getLayersByName("")[0].removeAllFeatures()}B.radius=I;var D=function(P){B.lineGeom=P;B.linePoints="";var N=P.getVertices();B.centerLon=N[0].x;B.centerLat=N[0].y;for(var L=0;L<N.length;L=L+1){if(L<N.length-1){B.linePoints=N[L].toShortString()+","+B.linePoints}else{B.linePoints=B.linePoints+N[L].toShortString()}}var M=function(Q){if(Q.ReturnFlag==1){B.cameraArr=JSON.parse(Q.Data);B.pasteCamerasOnMap(J);B.previewNearstCameras(H)}else{B.cameraArr=[]}if(E&&E!="default"){B.displayBuffer(E)}if(E=="default"){B.displayBuffer()}};var O={"radius":I,"linePoints":B.linePoints};HGIS.Utils.send(tacticsURL.cameraRelayBufferQuery,JSON.stringify(O),"POST","json",M)};A.draw("freeline",C,"geometry",null,{"keepOn":false,"ifClear":false},D)};this.pasteCamerasOnMap=function(F){for(var D=0;D<B.cameraArr.length;D=D+1){var H={name:B.cameraArr[D].name,indexCode:B.cameraArr[D].indexCode,tempLayerName:C.name};var E=new HGIS.Geometry.Point(B.cameraArr[D].lon*1,B.cameraArr[D].lat*1);var G=new HGIS.Feature.Vector(E,H,F);C.addFeatures([G])}};this.previewNearstCameras=function(D){var E={"centerLon":B.centerLon,"centerLat":B.centerLat,"numOfNearestCameras":D,"linePoints":B.linePoints,"radius":B.radius};HGIS.Utils.send(tacticsURL.cameraRelayPreview,JSON.stringify(E),"POST","json",function(F){if(F.ReturnFlag==1){var G=JSON.parse(F.Data);alert(HGIS.language[HGIS.InitParam.language]["this"]+D+HGIS.language[HGIS.InitParam.language]["camera_preview"]+G.toString())}else{alert(HGIS.language[HGIS.InitParam.language]["query_err"])}})};this.displayBuffer=function(F){var E=new HGIS.Geometry.GeomOperation();var G=A.degreeSpanToMeter(B.centerLon,"degrees");var D=B.radius/G;E.buffer(B.lineGeom,D,50,2,function(H){if(F){H.style=F}C.addFeatures([H])})}};HGIS.Biz=HGIS.Biz||{};HGIS.Biz.Indoor=function(){var A=this;this.listAll=function(B,C){HGIS.Utils.send("/hgis/rest/services/indoor/listAll",null,"GET","json",B,C)};this.deletePlaceById=function(D,B,C){HGIS.Utils.send("/hgis/rest/services/indoor/removePlaceById",JSON.stringify(D),"POST","text",B,C)};this.addPlace=function(D,B,C){HGIS.Utils.send("/hgis/rest/services/indoor/addPlace",JSON.stringify(D),"POST","text",B,C)}};HGIS.Biz=HGIS.Biz||{};HGIS.Biz.MobileTrack=function(D,B,F,E){var C=this;C.map=D.map;C.trackData;C.timer=0;C.count=0;C.defaultTraceStyle={strokeWidth:3,strokeOpacity:1,strokeColor:"red",strokeDashstyle:"solid"};this.play=function(G){HGIS.Utils.send(tacticsURL.foothold,JSON.stringify(params),"POST","json",function(H){C.trackData=JSON.parse(H.Data);if(C.trackData!=null){C.timer=window.setInterval(C.showTrack,G)}})};this.getDataAndPlay=function(H,K,G,J,I){HGIS.Utils.send(H,K,"POST",G,function(L){C.trackData=JSON.parse(L.Data);if(C.trackData!=null){C.timer=window.setInterval(C.showTrack,I)}if(typeof J=="function"){J(C.trackData)}})};this.destroy=function(){C.trackData=null;if(C.timer){window.clearInterval(C.timer)}D.removeAllFeatures()};this.getTraceData=function(){if(C.trackData!=null){return C.trackData}else{alert(HGIS.language[HGIS.InitParam.language]["track_data_noProducted"])}};C.traceLine=new HGIS.Geometry.LineString([]);C.traceLine.style=(E!=null)?E:C.defaultTraceStyle;var A=new HGIS.Feature.Vector(C.traceLine);A.fid="traceLine";D.addFeatures([A]);if(D.CLASS_NAME!="HGIS.Layer.Vector"){C.mobileTraceLayer=new HGIS.Layer.Vector("",{renderers:C.map.getDefaultRenderer(),isFixed:false});C.map.addLayer(C.mobileTraceLayer)}else{C.mobileTraceLayer=D}this.showTrack=function(){for(var L=0;L<C.trackData.length;L=L+1){if(C.count==L){var N=""+(L+1)+"";C.stationStyle=(B!=null)?B:C.getDefaultStationStyle(N);var K=new HGIS.Geometry.Point(C.trackData[L].lon*1,C.trackData[L].lat*1);var H=new HGIS.Feature.Vector(K,null,C.stationStyle);D.addFeatures([H]);if(C.trackData[L].footholdlat*1!=0){var N="\n"+C.trackData[L].pass_time;C.footholdStyle=(F!=null)?F:C.getDefaultFootholdStyle(N);var I=C.trackData[L].footholdlon*1;var G=C.trackData[L].footholdlat*1;var M=new HGIS.Geometry.Point(I,G);C.map.setCenter([I,G],C.map.getZoom(),null,null);C.addTracePoint(I,G);var J=new HGIS.Feature.Vector(M,null,C.footholdStyle);D.addFeatures([J])}}}C.count=C.count+1;if(C.count==C.trackData.length-1){window.clearInterval(C.timer)}};this.addTracePoint=function(H,K){var L=D.getFeatureByFid("traceLine");var J=new HGIS.Geometry.Point(H,K);var I=L.geometry.getVertices();I.push(J);var G=new HGIS.Geometry.LineString(I);G.style=C.traceLine.style;var M=new HGIS.Feature.Vector(G);M.fid="traceLine";M.sytle=C.defaultTraceStyle;D.addFeatures([M]);D.removeFeatures([L])};this.getDefaultStationStyle=function(H){var G={pointRadius:6,graphicName:"square",fillColor:"ff3300",fillOpacity:1,strokeWidth:3,strokeOpacity:1,strokeColor:"#ee9900",fontFamily:"Verdana,Arial,Helvetica,sans-serif",fontWeight:"normal",label:H,labelXOffset:0,labelYOffset:20};return G};this.getDefaultFootholdStyle=function(G){var H={pointRadius:4,graphicName:"circle",fillColor:"#0000FF",fillOpacity:1,strokeWidth:3,strokeOpacity:1,strokeColor:"#0000FF",fontFamily:"Verdana,Arial,Helvetica,sans-serif",fontWeight:"normal",fontColor:"#0000FF",label:G,labelXOffset:0,labelYOffset:30};return H}};HGIS.Biz=HGIS.Biz||{};HGIS.Biz.MultiCircleBuffer=function(){var A=this;A.encirclementNum=0;A.center=null;A.radiusArr=[];A.circleArr=[];A.bigCircleArr=null;A.setAllRadius=function(B){A.encirclementNum=B.length;function C(E,D){return E-D}A.radiusArr=B.sort(C)};this.setCenter=function(B){if(B.CLASS_NAME="HGIS.Geometry.Point"){A.center=B}else{alert(HGIS.language[HGIS.InitParam.language]["center_data_err"])}};this.createCircleBuffers=function(D){if(!A.center){alert(HGIS.language[HGIS.InitParam.language]["center_noExist"]);return}A.circleArr=new Array();A.bigCircleArr=new Array();if(D===undefined||D!=="equality"){for(var C=0;C<A.radiusArr.length;C++){if(C==0){var B=HGIS.Utils.createCircle(A.center,A.radiusArr[C]);A.circleArr.push(B);A.bigCircleArr.push(B)}else{var B=HGIS.Utils.createCircleRing(A.center,A.radiusArr[C-1],A.radiusArr[C]);A.circleArr.push(B);var E=HGIS.Utils.createCircle(A.center,A.radiusArr[C]);A.bigCircleArr.push(E)}}}else{for(var C=0;C<A.radiusArr.length;C++){if(C==0){var B=HGIS.Utils.createCircleByEquidistance(A.center,A.radiusArr[C]);A.circleArr.push(B);A.bigCircleArr.push(B)}else{var B=HGIS.Utils.createCircleRingByEquidistance(A.center,A.radiusArr[C-1],A.radiusArr[C]);A.circleArr.push(B);var E=HGIS.Utils.createCircleByEquidistance(A.center,A.radiusArr[C]);A.bigCircleArr.push(E)}}}return A.circleArr};A.getMaxCircle=function(){if(A.encirclementNum>0){var B={"geometry":A.bigCircleArr[A.encirclementNum-1],"radius":A.radiusArr[A.encirclementNum-1],"center":A.center};return B}else{return null}};A.getMinCircle=function(){if(A.encirclementNum>0){var B={"geometry":A.bigCircleArr[0],"radius":A.radiusArr[0],"center":A.center};return B}else{return null}};A.getCircleByN=function(B){if(B<0||B>A.encirclementNum||A.circleArr.length<0){return null}var C={"geometry":A.circleArr[B-1],"radius":A.radiusArr[B-1],"center":A.center};return C}};HGIS.Biz=HGIS.Biz||{};HGIS.Biz.ThreeEncirclement=function(){var A=this;A.encirclementNum;A.center;A.radiusArr;A.circleArr;A.bigCircleArr;A.setAllRadius=function(B){A.encirclementNum=B.length;function C(E,D){return E-D}A.radiusArr=B.sort(C)};this.setCenter=function(B){if(B.CLASS_NAME="HGIS.Geometry.Point"){A.center=B}else{alert(HGIS.language[HGIS.InitParam.language]["center_data_err"])}};this.createEncirclements=function(D){if(!A.center){alert(HGIS.language[HGIS.InitParam.language]["center_noExist"]);return}A.circleArr=new Array();A.bigCircleArr=new Array();if(D===undefined||D==="similar"){for(var C=0;C<A.radiusArr.length;C++){if(C==0){var B=HGIS.Utils.createCircle(A.center,A.radiusArr[C]);A.circleArr.push(B);A.bigCircleArr.push(B)}else{var B=HGIS.Utils.createCircleRing(A.center,A.radiusArr[C-1],A.radiusArr[C]);A.circleArr.push(B);var E=HGIS.Utils.createCircle(A.center,A.radiusArr[C]);A.bigCircleArr.push(E)}}}else{for(var C=0;C<A.radiusArr.length;C++){if(C==0){var B=HGIS.Utils.createCircleByEquidistance(A.center,A.radiusArr[C]);A.circleArr.push(B);A.bigCircleArr.push(B)}else{var B=HGIS.Utils.createCircleRingByEquidistance(A.center,A.radiusArr[C-1],A.radiusArr[C]);A.circleArr.push(B);var E=HGIS.Utils.createCircleByEquidistance(A.center,A.radiusArr[C]);A.bigCircleArr.push(E)}}}return A.circleArr};A.getMaxEncircle=function(){if(A.encirclementNum>0){var B={"geometry":A.bigCircleArr[A.encirclementNum-1],"radius":A.radiusArr[A.encirclementNum-1],"center":A.center};return B}else{return null}};A.getMinCircle=function(){if(A.encirclementNum>0){var B={"geometry":A.bigCircleArr[0],"radius":A.radiusArr[0],"center":A.center};return B}else{return null}};A.getNEncirclement=function(B){if(B<0){num=0}else{if(B>A.encirclementNum){B=A.encirclementNum}}if(A.circleArr.length<0){alert(HGIS.language[HGIS.InitParam.language]["Encirclement_noFound"]);return}var C={"geometry":A.circleArr[B-1],"radius":A.radiusArr[B-1],"center":A.center};return C}};HGIS.Cluster=HGIS.Cluster||{};HGIS.Cluster.Cluster=function(C,A,D){var B=this;B.map=C.map;B.clusterSize=!isNaN(D.clusterSize)?D.clusterSize:150;B.clusterRootStyle=D.clusterRootStyle?D.clusterRootStyle:clusterRootStyle={externalGraphic:APIAdress+"gisapi/theme/img/jh1.png",graphicWidth:53,graphicHeight:51};B.lineStyle=D.lineStyle?D.lineStyle:{strokeDashstyle:"dot"};B.inverseCenterStyle=D.inverseCenterStyle?D.inverseCenterStyle:{externalGraphic:APIAdress+"/gisapi/theme/img/inverseClusterCenter.gif",graphicWidth:20,graphicHeight:20};B.isCenter=D.isCenter?D.isCenter:false;B.isShowGrid=D.isShowGrid?true:false;B.startLevel=(D.startLevel>0)?D.startLevel:HGIS.InitParam.minLevel;B.endLevel=(D.endLevel>0)?D.endLevel:HGIS.InitParam.maxLevel;this.excute=function(){if(C!=null&&C.CLASS_NAME=="HGIS.Layer.Vector"){C.destroyFeatures();C.removeAllFeatures()}if(B.map.getZoom()<B.startLevel||B.map.getZoom()>B.endLevel||B.endLevel<=0||B.startLevel<0){return}var o=B.map.getSize();var R=B.map.getExtent();var V=(R.right-R.left)/o.w;var L=(R.top-R.bottom)/o.h;var q=B.clusterSize*V;var T=B.clusterSize*L;var u=Math.floor(R.left/q);var s=Math.ceil(R.right/q);var X=Math.floor(R.bottom/T);var Q=Math.ceil(R.top/T);if(B.isShowGrid==true){var Y=u*q;var G=s*q;var f=X*T;var S=Q*T;var n=new Array();for(var p=u;p<s;p++){var e=q*p;var Z=new HGIS.Geometry.Point(e,f);var J=new HGIS.Geometry.Point(e,S);var H=new HGIS.Geometry.LineString([Z,J]);n.push(H)}for(var l=X;l<Q;l++){var O=T*l;var F=new HGIS.Geometry.Point(Y,O);var b=new HGIS.Geometry.Point(G,O);var H=new HGIS.Geometry.LineString([F,b]);n.push(H)}var t=new HGIS.Geometry.MultiLineString(n);var g=new HGIS.Feature.Vector(t);C.addFeatures([g])}var M={};for(var p=0;p<A.length;p=p+1){var P=A[p].geometry;var h=Math.floor(P.x/q);var N=Math.floor(P.y/T);if(h>=u&&h<=s&&N>=X&&N<=Q){var E=h+"-"+N;if(!M[E]){M[E]=[]}M[E].push(P)}}var K=new Array();for(var E in M){var W=M[E];if(W.length==1){var d=(D.separateStyle)?D.separateStyle:null;var I={"num":1,"clusterLevel":1,"ownkey":E,"fatherkey":null,"type":"singleEntity"};var g=new HGIS.Feature.Vector(W[0],I,d);K.push(g)}else{var a={"num":W.length.toString(),"geomCollection":W,"expand":false,"clusterLevel":1,"ownkey":E,"fatherkey":null,"type":"clusterEntity"};var d=JSON.parse(JSON.stringify(B.clusterRootStyle));d.label=W.length.toString();var g;if(B.isCenter){var U=new HGIS.Geometry.MultiPoint(W).getCentroid(true);g=new HGIS.Feature.Vector(U,a,d)}else{g=new HGIS.Feature.Vector(W[0],a,d)}K.push(g)}}C.addFeatures(K)};this.activeInverseCluster=function(){var E=new HGIS.Control.SelectFeature(C,{clickout:false,toggle:false,multiple:false,hover:false,toggleKey:"ctrlKey",box:false,clickFeature:function(F){if(F.geometry.CLASS_NAME!="HGIS.Geometry.Point"){return}B.inverseCluster(F)}});B.map.addControl(E);E.activate()};this.inverseCluster=function(Q){if(Q.attributes.num*1>1){var P=B.map.getSize();var G=B.map.getExtent();var N=(G.right-G.left)/P.w;var H=(G.top-G.bottom)/P.h;var O=Q.attributes.geomCollection;if(Q.attributes.expand==false){var R=Math.ceil(B.clusterSize/(Q.attributes.clusterLevel+1));var K=R*N,I=R*H;var J={};for(var E=0;E<O.length;E=E+1){var L=O[E];var S=Math.floor(L.x/K),M=Math.floor(L.y/I);var F=S+"-"+M;if(!J[F]){J[F]=[]}J[F].push(L)}B.expandCluster(Q,J)}else{B.closeCluster(Q)}C.removeFeatures([Q]);if(Q){Q.destroy()}C.refresh()}};B.closeCluster=function(H){var L=H;var S=new Array();for(var K=0;K<C.features.length;K++){var G=C.features[K];if(G.attributes){if(G.attributes.ownkey&&G.attributes.ownkey.indexOf(H.attributes.ownkey)!=-1){S.push(G)}if(G.attributes.type=="joinedLine"){if(G.attributes.fatherkey==H.attributes.ownkey||G.attributes.ownkey==H.attributes.ownkey){S.push(G)}}}}C.removeFeatures(S);var F=L.attributes.oldCenter;var O=L.attributes.ownkey.split(",");var E=O.slice(0,O.length-1).join(",");var Q={"num":L.attributes.num,"geomCollection":L.attributes.geomCollection,"expand":false,"clusterLevel":L.attributes.clusterLevel,"ownkey":L.attributes.ownkey,"type":"clusterEntity","fatherkey":E};if(D.cluterStyle){style=D.cluterStyle}else{var T;if(L.attributes.clusterLevel>1){T=APIAdress+"gisapi/theme/img/jh1.png"}else{T=APIAdress+"gisapi/theme/img/jh1.png"}style={externalGraphic:T,graphicWidth:53,graphicHeight:51,label:L.attributes.num.toString()}}var N=new HGIS.Feature.Vector(F,Q,style);C.addFeatures([N]);if(L.attributes.clusterLevel>1){var M=C.getFeaturesByAttribute("ownkey",E);var J=null;for(var I=0;I<M.length;I++){if(M[I].attributes.type=="clusterCenter"){J=M[I].geometry}}if(J==null){return}var R=new HGIS.Geometry.LineString([F,J]);var P={"clusterLevel":L.attributes.clusterLevel+1,"ownkey":L.attributes.ownkey,"type":"joinedLine","fatherkey":E};var U=new HGIS.Feature.Vector(R,P,B.lineStyle);C.addFeatures(U)}};B.expandCluster=function(O,G){var E=[];for(var M in G){var L=O.attributes.ownkey+","+M;var N=G[M];var H,J,I,F;if(N.length==1){I=(D.separateStyle)?D.separateStyle:null;F={"num":1,"clusterLevel":O.attributes.clusterLevel+1,"ownkey":L,"type":"singleEntity","fatherkey":O.attributes.ownkey};H=new HGIS.Feature.Vector(N[0],F,I);E.push(H)}else{F={"num":N.length.toString(),"geomCollection":N,"expand":false,"clusterLevel":O.attributes.clusterLevel+1,"ownkey":L,"type":"clusterEntity","fatherkey":O.attributes.ownkey};var I=null;if(D.cluterStyle){I=D.cluterStyle}else{I={externalGraphic:APIAdress+"gisapi/theme/img/jh1.png",graphicWidth:53,graphicHeight:51,label:F.num.toString()}}H=new HGIS.Feature.Vector(N[1],F,I);E.push(H)}}C.addFeatures(E);var K=B.addInverseCenter(O,E);B.setClusterLine(O,E,K)};this.setClusterLine=function(T,F,O){var H=new Array();var S=T.attributes.ownkey.split(",");var G=S.slice(0,S.length-1).join(",");for(var N=0;N<F.length;N=N+1){var L=F[N].geometry;var J=new HGIS.Geometry.LineString([O,L]);var I={"clusterLevel":T.attributes.clusterLevel+1,"ownkey":F[N].attributes.ownkey,"type":"joinedLine","fatherkey":T.attributes.ownkey};var Q=new HGIS.Feature.Vector(J,I,B.lineStyle);H.push(Q)}C.addFeatures(H);if(T.attributes.clusterLevel>1){var K=C.getFeaturesByAttribute("type","joinedLine");for(var M=0;M<K.length;M++){if(K[M].attributes.fatherkey==G&&K[M].attributes.ownkey==T.attributes.ownkey){C.removeFeatures([K[M]])}}var P=C.getFeaturesByAttribute("type","clusterCenter");for(var R=0;R<P.length;R++){if(P[R].attributes.ownkey==G&&P[R].attributes.expand==true){var J=new HGIS.Geometry.LineString([O,P[R].geometry]);var E={"clusterLevel":T.attributes.clusterLevel,"ownkey":T.attributes.ownkey,"type":"joinedLine","fatherkey":G};var Q=new HGIS.Feature.Vector(J,E,B.lineStyle);C.addFeatures(Q)}}}};this.addInverseCenter=function(L,M){var H=0,E=0;for(var I=0;I<M.length;I=I+1){H=H+M[I].geometry.x;E=E+M[I].geometry.y}var G=H/M.length;var N=E/M.length;var J=new HGIS.Geometry.Point(G,N);var F={"num":L.attributes.geomCollection.length,"geomCollection":L.attributes.geomCollection,"expand":true,"clusterLevel":L.attributes.clusterLevel,"oldCenter":L.geometry,"ownkey":L.attributes.ownkey,"type":"clusterCenter"};var K=new HGIS.Feature.Vector(J,F,B.inverseCenterStyle);C.addFeatures(K);return K.geometry};this.reClusterFlag=function(H,F,G){var E=F?F:C.map.getExtent();var G=isNaN(G)?G:0.2};this.destory=function(){C.removeAllFeatures();B.map.removeLayer(C);B=null}};HGIS.Cluster=HGIS.Cluster||{};HGIS.Cluster.GridHeatLayer=function(C,D,B){var A=this;var F=C.map;A.gridSize=!isNaN(B.gridSize)?B.gridSize:100;A.startLevel=B.startLevel?B.startLevel:HGIS.InitParam.minLevel;A.endLevel=B.endLevel?B.endLevel:HGIS.InitParam.maxLevel;var E={fill:true,fillOpacity:0.4,stroke:true,strokeColor:"red",strokeOpacity:0.5};A.style=B.style?B.style:E;A.gradient=B.gradient||{"1":"rgb(0,0,255)","2":"rgb(0,255,255)","3":"rgb(0,255,0)","4":"yellow","5":"rgb(255,0,0)"};A.displayLabel=B.displayLabel==true?true:false;this.mesher=function(){if(F.getZoom()<A.startLevel||F.getZoom()>A.endLevel||A.endLevel<=0||A.startLevel<0){return}var V=F.getSize(),K=F.getExtent();var K=F.getExtent();var n=(K.right-K.left)/V.w;var e=(K.top-K.bottom)/V.h;var Q=A.gridSize*n;var s=A.gridSize*e;var O=Math.floor(K.left/Q);var I=Math.floor(K.right/Q);var h=Math.floor(K.bottom/s);var a=Math.ceil(K.top/s);var l={};for(var M=0;M<D.length;M=M+1){var p=Math.floor(D[M].geometry.x/Q);var X=Math.floor(D[M].geometry.y/s);if(p>=O&&p<=I&&X>=h&&X<=a){var g=p+"-"+X;if(!l[g]){l[g]=[]}l[g].push(D[M].geometry)}}var d=[];for(var g in l){d.push(l[g].length)}var H=Math.max.apply(null,d);var P=Math.min.apply(null,d);var q=H-P;var T=new Array();for(var g in l){var N=l[g];var U=N.length;if(U<=0){return}var R={};var L,G;for(L in A.style){R[L]=A.style[L]}if(q==0){R["fillColor"]=A.gradient["1"]}else{if((U-P)/q<=0.25){R["fillColor"]=A.gradient["2"]}else{if((U-P)/q<=0.5){R["fillColor"]=A.gradient["3"]}else{if((U-P)/q<=0.75){R["fillColor"]=A.gradient["4"]}else{if((U-P)/q<=1){R["fillColor"]=A.gradient["5"]}}}}}if(A.displayLabel===true){R["label"]=U.toString()}var p=g.split("-")[0],X=g.split("-")[1];var J=p*A.gridSize*n;var o=J+A.gridSize*n;var Z=X*A.gridSize*e;var S=Z+A.gridSize*e;var W=new Array();W.push(new HGIS.Geometry.Point(J,Z));W.push(new HGIS.Geometry.Point(o,Z));W.push(new HGIS.Geometry.Point(o,S));W.push(new HGIS.Geometry.Point(J,S));W.push(new HGIS.Geometry.Point(J,Z));var f=new HGIS.Geometry.LinearRing(W);var Y=new HGIS.Geometry.Polygon([f]);var b=new HGIS.Feature.Vector(Y,{},R);T.push(b)}C.addFeatures(T)}};HGIS.Control=HGIS.Control||{};HGIS.Control.CopyRight=HGIS.Class(HGIS.Control,{element:null,copyRightText:"Copyright @2016   All rights reserved.",color:"",left:"",right:"",bottom:"5px",width:"0px",height:"0px",initialize:function(A){HGIS.Control.prototype.initialize.apply(this,arguments);if(A.hasOwnProperty("copyRightText")){this.copyRightText=A.copyRightText}if(A.hasOwnProperty("color")){this.color=A.color}if(A.hasOwnProperty("left")){this.left=A.left}if(A.hasOwnProperty("right")){this.right=A.right}if(A.hasOwnProperty("bottom")){this.bottom=A.bottom}else{this.bottom="5px"}if(A.hasOwnProperty("width")){this.width=A.width}if(A.hasOwnProperty("height")){this.height=A.height}},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.element.innerHTML=this.copyRightText;if(this.color==""){this.element.style.color="#7b7777"}else{this.element.style.color=this.color}if(this.width=="0px"){this.element.style.width=this.map.div.style.width}else{this.element.style.width=this.width}if(this.height=="0px"){this.element.style.height=20+"px"}else{this.element.style.height=this.height}this.element.style.textAlign="center";this.element.style.bottom=this.bottom;if(this.left!=""||this.left===0){this.element.style.left=this.left}else{if(this.right!=""||this.right===0){this.element.style.right=this.right}else{this.element.style.left="50%";this.element.style.marginLeft=-(this.width/2)}}this.div.style.width="100%";this.div.style.height="100%";this.element.style.fontWeight="bold";this.element.style.position="absolute"}return this.element},destroy:function(){HGIS.Control.prototype.destroy.apply(this)},CLASS_NAME:"HGIS.Control.CopyRight"});HGIS.Control=HGIS.Control||{};HGIS.Control.LayerSwitch=HGIS.Class(HGIS.Control,{element:null,_m:null,_firstShowMap:null,isLayerExist:null,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,arguments)},setMap:function(A){this._m=A},setFrontMapShow:function(A){this._firstShowMap=A},getThisClassContext:function(){var A=this;return A},isLayerExist:function(){var A=this._m.getLayersByName("img");var D=this._m.getLayersByName("vec");var C=this._m.getLayersByName("Vector");var B=this._m.getLayersByName("tfw");var F=this._m.getLayersByName("mixed");var E={"hvtlayers":C.length>0,"veclayers":D.length>0&&D[0].url!==""&&D[0].url!==undefined,"imglayers":A.length>0&&A[0].url!==""&&A[0].url!==undefined,"tfwlayers":B.length>0&&B[0].url!==""&&B[0].url!==undefined,"mixedlayers":F.length!==0&&F[0].url!==""&&F[0].url!==undefined,};return E},doSwitch:function(D){var J=this._m.getLayersByName("img");var E=this._m.getLayersByName("vec");var B=this._m.getLayersByName("Vector");var A=this._m.getLayersByName("tfw");var L=this._m.getLayersByName("mixed");var H=[{"layerName":"img","layers":J},{"layerName":"vec","layers":E},{"layerName":"hvt","layers":B},{"layerName":"tfw","layers":A},{"layerName":"mix","layers":L}];var C=this._m.id+"switch";var I=document.getElementById(C);var G=this.isLayerExist();if(I.src.indexOf("gisapi/theme/image/img.png")>-1){for(j=0;j<H.length;j++){if(H[j].layerName=="img"){var F=H[j].layers;for(k=0;k<F.length;k++){if(k==0){this._m.setBaseLayer(F[k])}F[k].setVisibility(true)}}else{var K=H[j].layers;for(m=0;m<K.length;m++){K[m].setVisibility(false)}}}if(G.tfwlayers){I.src=APIAdress+"gisapi/theme/image/25.png"}else{if(G.mixedlayers){I.src=APIAdress+"gisapi/theme/image/mix.png"}else{if(G.veclayers){I.src=APIAdress+"gisapi/theme/image/vec.png"}else{if(G.hvtlayers&&this._m.enableVtMap){I.src=APIAdress+"gisapi/theme/image/vc_hvt.png"}else{I.src=APIAdress+"gisapi/theme/image/img.png"}}}}}else{if(I.src.indexOf("gisapi/theme/image/25.png")>-1){for(j=0;j<H.length;j++){if(H[j].layerName=="tfw"){var F=H[j].layers;for(k=0;k<F.length;k++){if(k==0){this._m.setBaseLayer(F[k])}F[k].setVisibility(true)}}else{var K=H[j].layers;for(m=0;m<K.length;m++){K[m].setVisibility(false)}}}if(G.mixedlayers){I.src=APIAdress+"gisapi/theme/image/mix.png"}else{if(G.veclayers){I.src=APIAdress+"gisapi/theme/image/vec.png"}else{if(G.hvtlayers&&this._m.enableVtMap){I.src=APIAdress+"gisapi/theme/image/vc_hvt.png"}else{if(G.imglayers){I.src=APIAdress+"gisapi/theme/image/img.png"}else{I.src=APIAdress+"gisapi/theme/image/25.png"}}}}}else{if(I.src.indexOf("gisapi/theme/image/mix.png")>-1){for(j=0;j<H.length;j++){if(H[j].layerName=="mix"){var F=H[j].layers;for(k=0;k<F.length;k++){if(k==0){this._m.setBaseLayer(F[k])}F[k].setVisibility(true)}}else{var K=H[j].layers;for(m=0;m<K.length;m++){K[m].setVisibility(false)}}}if(G.veclayers){I.src=APIAdress+"gisapi/theme/image/vec.png"}else{if(G.hvtlayers&&this._m.enableVtMap){I.src=APIAdress+"gisapi/theme/image/vc_hvt.png"}else{if(G.imglayers){I.src=APIAdress+"gisapi/theme/image/img.png"}else{if(G.tfwlayers){I.src=APIAdress+"gisapi/theme/image/25.png"}else{I.src=APIAdress+"gisapi/theme/image/mix.png"}}}}}else{if(I.src.indexOf("gisapi/theme/image/vec.png")>-1){for(j=0;j<H.length;j++){if(H[j].layerName=="vec"){var F=H[j].layers;for(k=0;k<F.length;k++){if(k==0){this._m.setBaseLayer(F[k])}F[k].setVisibility(true)}}else{var K=H[j].layers;for(m=0;m<K.length;m++){K[m].setVisibility(false)}}}if(G.hvtlayers&&this._m.enableVtMap){I.src=APIAdress+"gisapi/theme/image/vc_hvt.png"}else{if(G.imglayers){I.src=APIAdress+"gisapi/theme/image/img.png"}else{if(G.tfwlayers){I.src=APIAdress+"gisapi/theme/image/25.png"}else{if(G.mixedlayers){I.src=APIAdress+"gisapi/theme/image/mix.png"}else{I.src=APIAdress+"gisapi/theme/image/vec.png"}}}}}else{if(I.src.indexOf("gisapi/theme/image/vc_hvt.png")>-1){for(j=0;j<H.length;j++){if(H[j].layerName=="hvt"){var F=H[j].layers;for(k=0;k<F.length;k++){if(k==0){this._m.setBaseLayer(F[k])}F[k].setVisibility(true)}}else{var K=H[j].layers;for(m=0;m<K.length;m++){K[m].setVisibility(false)}}}if(G.imglayers){I.src=APIAdress+"gisapi/theme/image/img.png"}else{if(G.tfwlayers){I.src=APIAdress+"gisapi/theme/image/25.png"}else{if(G.mixedlayers){I.src=APIAdress+"gisapi/theme/image/mix.png"}else{if(G.veclayers){I.src=APIAdress+"gisapi/theme/image/vec.png"}else{if(this._m.enableVtMap){I.src=APIAdress+"gisapi/theme/image/vc_hvt.png"}}}}}}}}}}},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);var A=this.isLayerExist();if(!(A.imglayers||A.tfwlayers||A.mixedlayers||A.veclayers)){return}if(this.div==null){this.div=HGIS.Util.createDiv(this.id)}this.div.className=this.displayClass+"Ex";var B=document.createElement("img");var A=this.isLayerExist();if(A.imglayers){B.src=APIAdress+"gisapi/theme/image/img.png"}else{if(A.tfwlayers){B.src=APIAdress+"gisapi/theme/image/25.png"}else{if(A.mixedlayers){B.src=APIAdress+"gisapi/theme/image/mix.png"}else{if(A.veclayers){B.src=APIAdress+"gisapi/theme/image/vec.png"}else{if(A.hvtlayers&&this._m.enableVtMap){B.src=APIAdress+"gisapi/theme/image/vc_hvt.png"}}}}}B.id=this._m.id+"switch";this.attachEvt(B,"click",this.doSwitch,this);this.div.appendChild(B);return this.div},attachEvt:function(D,B,A,C){var E=A;if(C){E=function(F){A.call(C,F)}}if(window.attachEvent){D.attachEvent("on"+B,E)}else{D.addEventListener(B,E,false)}},display:function(A){if(!A){this.div.style.display="none"}else{this.div.style.display="block"}},destroy:function(){HGIS.Control.prototype.destroy.apply(this)},CLASS_NAME:"HGIS.Control.LayerSwitch"});HGIS.Control=HGIS.Control||{};HGIS.Control.LayerSwitcherEx=HGIS.Class(HGIS.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(A){HGIS.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);HGIS.Control.prototype.destroy.apply(this,arguments)},setMap:function(A){HGIS.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});if(this.outsideViewport){this.events.attachToElement(this.div);this.events.register("buttonclick",this,this.onButtonClick)}else{this.map.events.register("buttonclick",this,this.onButtonClick)}},draw:function(){HGIS.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},onButtonClick:function(B){var A=B.buttonElement;if(A===this.minimizeDiv){this.minimizeControl()}else{if(A===this.maximizeDiv){this.maximizeControl()}else{if(A._layerSwitcher===this.id){if(A["for"]){A=document.getElementById(A["for"])}if(!A.disabled){if(A.type=="radio"){A.checked=true;this.map.setBaseLayer(this.map.getLayer(A._layer))}else{A.checked=!A.checked;this.updateMap()}}}}}},clearLayersArray:function(A){this[A+"LayersDiv"].innerHTML="";this[A+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){return true}for(var A=0,C=this.layerStates.length;A<C;A++){var D=this.layerStates[A];var B=this.map.layers[A];if((D.name!=B.name)||(D.inRange!=B.inRange)||(D.id!=B.id)||(D.visibility!=B.visibility)){return true}}return false},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var J=false;var O=false;var K=this.map.layers.length;this.layerStates=new Array(K);for(var G=0;G<K;G++){var H=this.map.layers[G];this.layerStates[G]={"name":H.name,"visibility":H.visibility,"inRange":H.inRange,"id":H.id}}var N=this.map.layers.slice();if(!this.ascending){N.reverse()}for(var G=0,K=N.length;G<K;G++){var H=N[G];var I=H.isBaseLayer;if(H.displayInLayerSwitcher){if(I){O=true}else{J=true}var L=(I)?(H==this.map.baseLayer):H.getVisibility();var D=document.createElement("input"),F=HGIS.Util.createUniqueID(this.id+"_input_");D.id=F;D.name=(I)?this.id+"_baseLayers":H.name;D.type=(I)?"radio":"checkbox";D.value=H.name;D.checked=L;D.defaultChecked=L;D.className=(I)?"olButton olradio":"olcheckbox olButton";D._layer=H.id;D._layerSwitcher=this.id;if(!I&&!H.inRange){D.disabled=true}var M=document.createElement("label");M["for"]=D.id;HGIS.Element.addClass(M,"olButton labelSpan");M._layer=H.id;M._layerSwitcher=this.id;if(!I&&!H.inRange){M.style.color="#666666"}M.style.verticalAlign="bottom";M.appendChild(D);var E=document.createElement("span");E.className=(I)?"radioInput":"checkbox checkInput";M.appendChild(E);var A=document.createElement("label");A.innerHTML=H.name;A["for"]=D.id;M.appendChild(A);var B=(I)?this.baseLayers:this.dataLayers;B.push({"layer":H,"inputElem":D,"labelSpan":M});var C=(I)?this.baseLayersDiv:this.dataLayersDiv;C.appendChild(M)}}this.dataLbl.style.display=(J)?"":"none";this.baseLbl.style.display=(O)?"":"none";return this.div},updateMap:function(){for(var A=0,C=this.baseLayers.length;A<C;A++){var B=this.baseLayers[A];if(B.inputElem.checked){this.map.setBaseLayer(B.layer,false)}}for(var A=0,C=this.dataLayers.length;A<C;A++){var B=this.dataLayers[A];B.layer.setVisibility(B.inputElem.checked)}},maximizeControl:function(A){this.div.style.width="";this.div.style.height="";this.showControls(false);if(A!=null){HGIS.Event.stop(A)}},minimizeControl:function(A){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(A!=null){HGIS.Event.stop(A)}},showControls:function(A){this.maximizeDiv.style.display=A?"":"none";this.minimizeDiv.style.display=A?"none":"";this.layersDiv.style.display=A?"none":""},loadContents:function(){this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";HGIS.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=HGIS.i18n("");HGIS.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");HGIS.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=HGIS.i18n("");HGIS.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");HGIS.Element.addClass(this.dataLayersDiv,"dataLayersDiv");if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);var B=APIAdress+"gisapi/theme/image/layer-switcherEx-maximize.png";var A=new HGIS.Pixel(this.map.div.offsetWidth-50,70);this.maximizeDiv=HGIS.Util.createAlphaImageDiv("HGIS_Control_MaximizeDiv",null,null,B,"absolute");HGIS.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);var B=APIAdress+"gisapi/theme/image/layer-switcherEx-minimize.png";this.minimizeDiv=HGIS.Util.createAlphaImageDiv("HGIS_Control_MinimizeDiv",null,null,B,"absolute");HGIS.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)},setBackgroundColor:function(A){if(A){this.layersDiv.style.backgroundColor=A}},setPosition:function(A){if(A.top){this.div.style.top=A.top+"px"}if(A.right){this.div.style.right=A.right+"px"}if(A.left){this.div.style.left=A.left+"px"}if(A.bottom){this.div.style.bottom=A.bottom+"px"}},setMaximizeDiv:function(A){if(this.maximizeDiv.childNodes[0]){this.maximizeDiv.childNodes[0].src=A}},setMinimizeDiv:function(A){if(this.minimizeDiv.childNodes[0]){this.minimizeDiv.childNodes[0].src=A}},setFont:function(A){if(A.fontFamily){this.div.style.fontFamily=A.fontFamily}if(A.fontWeight){this.div.style.fontWeight=A.fontWeight}if(A.color){this.div.style.color=A.color}if(A.fontSize){this.div.style.fontSize=A.fontSize}},CLASS_NAME:"HGIS.Control.LayerSwitcherEx"});HGIS.Control=HGIS.Control||{};HGIS.Control.MouseTipControl=HGIS.Class(HGIS.Control.MousePosition,{tipContent:null,initialize:function(A){HGIS.Control.MousePosition.prototype.initialize.apply(this,arguments);this.tipContent=A.tipContent==undefined?"":A.tipContent},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(this.div==null){this.div=HGIS.Util.createDiv(this.id)}if(!this.element){this.div.left="";this.div.top="";this.element=this.div}this.div.setAttribute("style","box-sizing:content-box !important");this.div.style["max-width"]="500px";this.div.style["min-width"]="10px";this.div.style["float"]="none";this.div.style["white-space"]="nowrap";this.div.style["word-break"]="normal";this.div.style.border="1px solid #BD6060";this.div.style.position="absolute";this.div.style.backgroundColor="#FFFFFF";this.div.style.padding="2px";this.div.style["line-height"]="14px";this.div.innerHTML=this.tipContent;var A=this.computeStringWidth(this.tipContent);this.div.style["width"]=A+"px";var B=this.tipContent.split("<br>").length;this.div.style["line-height"]="14px";this.div.innerHTML=this.tipContent;return this.div},computeStringWidth:function(B){var F=B.split("<br>");var A=0;var H="";for(var G=0;G<F.length;G++){if(F[G].length>A){A=F[G].length;H=F[G]}}if(H==""){H=B}var C=0;try{var E=document.createElement("span");E.id="__getwidth";document.body.appendChild(E);E.style.visibility="hidden";E.style.whiteSpace="nowrap";E.innerHTML=H;C=E.offsetWidth;E.parentNode.removeChild(E);if(C==0){C=B.length*13+"px"}}catch(D){C=B.length*13+"px"}return C},redraw:function(A){if(A==null||A==undefined){this.reset();return}else{if(this.lastXy==null||Math.abs(A.xy.x-this.lastXy.x)>this.granularity||Math.abs(A.xy.y-this.lastXy.y)>this.granularity){this.lastXy=A.xy;return}this.lastXy=A.xy;this.div.style.top=(A.xy.y+5)+"px";this.div.style.left=(A.xy.x+5)+"px";var B=this.computeStringWidth(this.tipContent);this.div.style["width"]=B+"px"}},setTipContent:function(A){this.div.style["width"]=this.computeStringWidth(A)+"px";this.div.innerHTML=A;this.tipContent=A},hide:function(){this.div.style["display"]="none"},show:function(){this.div.style["display"]="block"},setPosition:function(A,B){this.div.style.top=(B+5)+"px";this.div.style.left=(A+5)+"px"},CLASS_NAME:"HGIS.Control.MouseTipControl"});HGIS.Control=HGIS.Control||{};HGIS.Control.OverviewMapEx=HGIS.Class(HGIS.Control.OverviewMap,{initialize:function(A){this.minRatio=10;this.maxRatio=10;this.minRectSize=10;this.size=new HGIS.Size(180,120);this.maximized=true;A=HGIS.Util.extend({mapOptions:{projection:new HGIS.Projection("EPSG:4326"),displayProjection:new HGIS.Projection("EPSG:4326"),units:"degrees",maxResolution:"auto",maxExtent:new HGIS.Bounds(-180,-90,180,90),}},A);HGIS.Control.OverviewMap.prototype.initialize.apply(this,[A])},setOvMapCenter:function(){if(this.map.getZoom()>=(this.map.minLevel+4)){this.ovmap.setCenter(this.map.getExtent().getCenterLonLat())}else{this.ovmap.zoomTo(this.map.minLevel)}},updateMapToRect:function(){HGIS.Control.OverviewMap.prototype.updateMapToRect.apply(this,arguments)},createMap:function(){HGIS.Control.OverviewMap.prototype.createMap.apply(this,arguments);this.ovmap.events.register("moveend",this,this.updateRectToMap);this.ovmap.events.register("zoomend",this,this.updateRectToMap);this.ovmap.events.register("mouseup",this,this.map_mouseup)},map_mouseup:function(){this.map.events.triggerEvent("mouseup",{map:this.map})},draw:function(){HGIS.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var B=this.map.baseLayer.clone();this.layers=[B]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=HGIS.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var D=APIAdress+"gisapi/theme/image/overviewOpen.png";this.maximizeDiv=HGIS.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new HGIS.Size(18,18),D,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";HGIS.Event.observe(this.maximizeDiv,"click",HGIS.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var D=APIAdress+"gisapi/theme/image/overviewClose.png";this.minimizeDiv=HGIS.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new HGIS.Size(18,18),D,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";HGIS.Event.observe(this.minimizeDiv,"click",HGIS.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var E=["dblclick","mousedown"];for(var A=0,C=E.length;A<C;A=A+1){HGIS.Event.observe(this.maximizeDiv,E[A],HGIS.Event.stop);HGIS.Event.observe(this.minimizeDiv,E[A],HGIS.Event.stop)}this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);this.map.events.register("zoomend",this,this.update);this.map.events.register("dragend",this,this.update);this.map.events.register("moveend",this,this.setOvMapCenter);this.map.events.register("zoomend",this,this.setOvMapCenter);this.map.events.register("dragend",this,this.setOvMapCenter);if(this.maximized){this.maximizeControl()}return this.div},showToggle:function(A){if(A==true){this.maximizeDiv.style.display="";this.minimizeDiv.style.display="none";this.element.style.display="none"}else{if(A==false){this.maximizeDiv.style.display="none";this.minimizeDiv.style.display="";this.element.style.display=""}}},CLASS_NAME:"HGIS.Control.OverviewMapEx"});HGIS.Control=HGIS.Control||{};HGIS.Control.PanZoomBarEx=HGIS.Class(HGIS.Control.PanZoom,{zoomStopWidth:12,zoomStopHeight:8,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:false,panIcons:true,forceFixedZoomLevel:false,mouseDragStart:null,deltaY:null,imgPath:APIAdress+"gisapi/theme/img/gis/navi/",zoomStart:null,fixedLeftBottom:false,directDiv:null,directImg:null,imgLocation:APIAdress+"gisapi/theme/img/gis/navi/normal.png",directDivID:"",minLevel:0,destroy:function(){this._removeZoomBar();this.map.events.un({"changebaselayer":this.redraw,"updatesize":this.redraw,scope:this});HGIS.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(A){HGIS.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({"changebaselayer":this.redraw,"updatesize":this.redraw,scope:this})},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(E){HGIS.Control.prototype.draw.apply(this,arguments);E=this.position.clone();if(this.fixedLeftBottom){var G=this.map.getSize();if(G){this.minLevel=this.map.minLevel?this.map.minLevel:this.map.getMinZoom();E=new HGIS.Pixel(4,G.h-this.zoomStopHeight*(this.map.getNumZoomLevels()-this.minLevel)-160)}}this.buttons=[];var A={w:15,h:15};if(this.panIcons){var C=new HGIS.Pixel(E.x+48/2,E.y);var B=A.w;if(this.zoomWorldIcon){C=new HGIS.Pixel(E.x+A.w,E.y)}var D={w:40,h:40};var F={w:A.w+33,h:A.h+33};this._addButton("all",this.imgLocation,E.add(A.w-7,0),F);this._addPanButton("panup",E.add(22,0),new HGIS.Size(26,13),new HGIS.Pixel(-15,0));this._addPanButton("panleft",E.add(8,17),new HGIS.Size(13,26),new HGIS.Pixel(0,-15));if(this.zoomWorldIcon){this._addButton("zoomworld",E.add(A.w,0),A,new HGIS.Pixel(0,-25));B*=2}this._addPanButton("panright",E.add(40,15),new HGIS.Size(13,26),new HGIS.Pixel(-30,-15));this._addPanButton("pandown",E.add(18,35),new HGIS.Size(26,13),new HGIS.Pixel(-15,-30));this._addButton("zoomin",this.imgPath+"zoomin.png",C.add(0,A.h*3+5),A);C=this._addZoomBar(C.add(-2,A.h*4+5));this._addButton("zoomout",this.imgPath+"zoomout.png",C.add(2,1),A)}else{this._addButton("zoomin","zoom-plus-mini.png",E,A);C=this._addZoomBar(E.add(0,A.h));this._addButton("zoomout","zoom-minus-mini.png",C,A);if(this.zoomWorldIcon){C=C.add(0,A.h+3);this._addButton("zoomworld","zoom-world-mini.png",C,A)}}return this.div},_addButton:function(E,D,A,B){var C=HGIS.Util.createAlphaImageDiv(this.id+"_"+E,A,B,D,"absolute");C.style.cursor="pointer";this.div.appendChild(C);C.action=E;C.className="olButton";this.buttons.push(C);return C},_addDirect:function(D,C,A,B){directImg=HGIS.Util.createAlphaImageDiv(this.id+"_"+D,A,B,C,"absolute");directImg.style.cursor="pointer";this.div.appendChild(directImg);directImg.action=D;directImg.className="olButton";this.buttons.push(directImg);return directImg},_changeDirectImage:function(A){this.imgLocation=this.imgPath+A;this.redraw()},_creatbtn:function(C,A,B,D){directDiv=HGIS.Util.createDiv(C,A,B,null,"absolute",null,"hidden",null);return directDiv},_creatimg:function(A,B){this.directImg.style.left=A+"px";this.directImg.style.top=B+"px"},_addPanButton:function(E,A,B,C){var D=this._creatbtn(this.id+"_"+E,A,B,C);D.style.cursor="pointer";D.style.background="url(about:blank)";this.div.appendChild(D);D.action=E;D.className="olButton";this.buttons.push(D);return D},buttonMouseOver:function(B){var A="";if(navigator.userAgent.indexOf("Firefox")>0){A=B.currentTarget.action}else{A=B.srcElement.id.split("_")[3]}switch(A){case"panup":this._changeDirectImage("panup.png");break;case"pandown":this._changeDirectImage("pandown.png");break;case"panleft":this._changeDirectImage("panleft.png");break;case"panright":this._changeDirectImage("panright.png");break;default:break}},buttonMouseOut:function(A){this._changeDirectImage("normal.png");this.redraw()},onPanBtnClick:function(A){HGIS.Control.PanZoom.prototype.onButtonClick.apply(this,arguments)},_addZoomBar:function(D){var A=this.imgPath+"bar-hover.png";var G=this.id+"_"+this.map.id;var F=(this.map.getNumZoomLevels()-1)-this.map.getZoom();var C=HGIS.Util.createAlphaImageDiv(G,D.add(-1,F*this.zoomStopHeight),{w:20,h:11},A,"absolute");C.style.cursor="pointer";C.style["line-height"]="12px";this.slider=C;this.sliderEvents=new HGIS.Events(this,C,null,true,{includeXY:true});this.sliderEvents.on({"touchstart":this.zoomBarDown,"touchmove":this.zoomBarDrag,"touchend":this.zoomBarUp,"mousedown":this.zoomBarDown,"mousemove":this.zoomBarDrag,"mouseup":this.zoomBarUp,"mouseout":this.zoomBarUp});var B={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-this.minLevel-1)+12};var A=this.imgPath+"ruler-sel.png";var E=null;if(HGIS.Util.alphaHack()){var G=this.id+"_"+this.map.id;E=HGIS.Util.createAlphaImageDiv(G,D,{w:B.w,h:this.zoomStopHeight},A,"absolute",null,"crop");E.style.height=B.h+"px"}else{E=HGIS.Util.createDiv("HGIS_Control_PanZoomBar_Zoombar"+this.map.id,D,B,A)}E.style.cursor="pointer";E.className="olButton";this.zoombarDiv=E;this.div.appendChild(E);this.startTop=parseInt(E.style.top);this.div.appendChild(C);this.map.events.register("zoomend",this,this.moveZoomBar);D=D.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-this.minLevel-1)+12);return D},_removeZoomBar:function(){if(this.sliderEvents!=undefined){this.sliderEvents.un({"touchstart":this.zoomBarDown,"touchmove":this.zoomBarDrag,"touchend":this.zoomBarUp,"mousedown":this.zoomBarDown,"mousemove":this.zoomBarDrag,"mouseup":this.zoomBarUp,"mouseout":this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)}},onButtonClick:function(B){HGIS.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(B.buttonElement===this.zoombarDiv){var A=B.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){A=Math.floor(A)}var C=(this.map.getNumZoomLevels()-1)-A;C=Math.min(Math.max(C,this.minLevel),this.map.getNumZoomLevels()-1);this.map.zoomTo(C)}},passEventToSlider:function(A){this.sliderEvents.handleBrowserEvent(A)},zoomBarDown:function(A){if(!HGIS.Event.isLeftClick(A)&&!HGIS.Event.isSingleTouch(A)){return}this.map.events.on({"touchmove":this.passEventToSlider,"touchend":this.passEventToSlider,"mousemove":this.passEventToSlider,"mouseup":this.passEventToSlider,"mouseout":this.passEventToSlider,scope:this});this.mouseDragStart=A.xy.clone();this.zoomStart=A.xy.clone();this.div.style.cursor="pointer";this.zoombarDiv.offsets=null;HGIS.Event.stop(A)},zoomBarDrag:function(A){if(this.mouseDragStart!=null){var B=this.mouseDragStart.y-A.xy.y;var C=parseInt(this.slider.style.top)-B;if(C>=this.startTop&&C<=this.startTop+parseInt(this.zoombarDiv.style.height)-12){this.slider.style.top=C+"px";this.mouseDragStart=A.xy.clone()}this.deltaY=this.zoomStart.y-A.xy.y;HGIS.Event.stop(A)}},zoomBarUp:function(B){if(!HGIS.Event.isLeftClick(B)&&B.type!=="touchend"){return}if(B.type=="mouseout"){if(B.xy.x<70&&B.xy.x>-50&&B.xy.y>-70&&B.xy.y<80){return}}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({"touchmove":this.passEventToSlider,"touchend":this.passEventToSlider,"mouseup":this.passEventToSlider,"mousemove":this.passEventToSlider,"mouseout":this.passEventToSlider,scope:this});var A=this.map.zoom+Math.round(this.deltaY/this.zoomStopHeight);A=Math.min(Math.max(A,this.minLevel),this.map.getNumZoomLevels()-1);this.map.zoomTo(A);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;HGIS.Event.stop(B)}},moveZoomBar:function(){var A=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop;this.slider.style.top=A+"px";this.slider.title=this.map.getZoom()},CLASS_NAME:"HGIS.Control.PanZoomBarEx"});HGIS.Control=HGIS.Control||{};HGIS.Control.RightMenu=function(A,D,F,E,C){var B=this;B.pixelTolerance=15;B.postion;A.events.register("mousemove",A,function(G){B.postion=this.events.getMousePosition(G)});this.popup=null;B.defaultMenuItemStyle={fontSize:"50px",height:"50px",paddingLeft:"2px",background:"#red",listStyleType:"square"};B.hide=function(){if(B.popup!=null){A.removePopup(B.popup)}};B.creatMenuHtml=function(H,I){var K=document.createElement("div");var J=document.createElement("ul");for(var L=0;L<H.length;L=L+1){var G=document.createElement("li");G.id=H[L].itemID;G.innerHTML=H[L].itemText;G.style.cssText=H[L].cssText;J.appendChild(G)}K.appendChild(J);return K.innerHTML};B.unRegister=function(){A.div.oncontextmenu=null};B.show=function(G){A.events.register("click",A,function(H){B.hide()});A.div.oncontextmenu=function(J){J=J||event;var K=this;var I;var H=null;var L=HGIS.Utils.getExploreType();var H={};var M;if(L=="MSIE"){H=B.postion;M=A.getLonLatFromPixel(H)}else{H=B.postion;M=A.getLonLatFromViewPortPx(H)}G(H);B.evtPxy=H;B.postion=new HGIS.Geometry.Point(M.lon,M.lat);this.showMapMenus=function(){if(D!=null){var P=B.creatMenuHtml(D,"font-color:red");if(B.popup!=null){A.removePopup(B.popup)}B.popup=new HGIS.Popup("tempPopue",M,null,P,false);if(E){B.popup.setSize(E)}else{B.popup.autoSize=true}A.addPopup(B.popup);for(var O=0;O<D.length;O=O+1){var N=D[O].itemID;document.getElementById(N).onclick=function(Q){for(var R=0;R<D.length;R=R+1){if(D[R].itemID==this.id){D[R].evt(Q);B.hide()}}}}}};this.showLayerMenus=function(O,W,P){var R=this;var N;var V=false;for(var Q=0;Q<O.length;Q=Q+1){var X=B.postion.distanceTo(O[Q].geometry,{edge:false});var T=Math.round(X/A.resolution);if(T<=P){V=true;var U=B.creatMenuHtml(W);if(B.popup!=null){A.removePopup(B.popup)}B.popup=new HGIS.Popup("tempPopue",M,null,U,false);if(C){B.popup.setSize(C)}else{B.popup.autoSize=V}A.addPopup(B.popup);I=O[Q];break}}if(V){for(var S=0;S<W.length;S=S+1){var Y=W[S].itemID;document.getElementById(Y).onclick=function(Z){for(var a=0;a<W.length;a=a+1){if(W[a].itemID==this.id){W[a].evt(I);B.hide()}}}}}return V};this.show=function(){B.hide();if(F&&F.length>0){for(var R=0;R<F.length;R=R+1){var Q=F[R].layer;var W=F[R].featureMenus;var N=Q.pixTolerance?Q.pixTolerance:B.pixelTolerance;if(Q.CLASS_NAME=="HGIS.Layer.Vector"||"HGIS.Layer.Markers"==Q.CLASS_NAME){var P=[];if(Q.CLASS_NAME=="HGIS.Layer.Vector"){P=Q.features}if("HGIS.Layer.Markers"==Q.CLASS_NAME){var O=Q.markers;for(var T=0;T<Q.markers.length;T=T+1){var U=Q.markers[R].lonlat;var S=new HGIS.Geometry.Point(U.lon,U.lat);var X=new HGIS.Feature.Vector(S);P.push(X)}}var V=this.showLayerMenus(P,W,N);if(!V){this.showMapMenus()}break}else{this.showMapMenus()}}}else{this.showMapMenus()}};this.show();return false}}};HGIS.Control=HGIS.Control||{};HGIS.Control.ScaleLineEx=HGIS.Class(HGIS.Control.ScaleLine,{initialize:function(){var A={topOutUnits:HGIS.language[HGIS.InitParam.language]["km"],topInUnits:HGIS.language[HGIS.InitParam.language]["m"],bottomOutUnits:"",bottomInUnits:""};HGIS.Control.ScaleLine.prototype.initialize.apply(this,[A])},draw:function(){this.displayClass="olControlScaleLine";HGIS.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var A=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},CLASS_NAME:"HGIS.Control.ScaleLineEx "});HGIS.Control=HGIS.Control||{};HGIS.Control.ZoomAnimation=HGIS.Class(HGIS.Control.Navigation,{size:null,offset:null,uricon:null,ulicon:null,bricon:null,blicon:null,imgPath:APIAdress+"gisapi/theme/img/gis/navi/",dragPanOptions:{enableKinetic:false},isCenterMouseWheel:true,isCartoonPlay:false,markers:null,marker1:null,marker2:null,marker3:null,marker4:null,initialize:function(A){if(A==undefined){if(map!==undefined){this.map=map}}else{if(A.map==undefined){if(map!==undefined){this.map=map}}else{this.map=A.map}}HGIS.Control.Navigation.prototype.initialize.apply(this,arguments);if(this.map){this.size=new HGIS.Size(7,7);this.offset=new HGIS.Pixel(-(this.size.w/2),-(this.size.h/2));this.uricon=new HGIS.Icon(this.imgPath+"ur.png",this.size,this.offset);this.ulicon=new HGIS.Icon(this.imgPath+"ul.png",this.size,this.offset);this.bricon=new HGIS.Icon(this.imgPath+"br.png",this.size,this.offset);this.blicon=new HGIS.Icon(this.imgPath+"bl.png",this.size,this.offset);this.markers=new HGIS.Layer.Markers("Zoomin",{displayInLayerSwitcher:false});this.marker1=new HGIS.Marker(this.map.getCenter(),this.bricon);this.marker2=new HGIS.Marker(this.map.getCenter(),this.blicon);this.marker3=new HGIS.Marker(this.map.getCenter(),this.uricon);this.marker4=new HGIS.Marker(this.map.getCenter(),this.ulicon);this.marker1.map=this.map;this.marker2.map=this.map;this.marker3.map=this.map;this.marker4.map=this.map;this.markers.addMarker(this.marker1);this.markers.addMarker(this.marker2);this.markers.addMarker(this.marker3);this.markers.addMarker(this.marker4);this.markers.setVisibility(false);this.map.addLayer(this.markers)}},destroy:function(){HGIS.Control.prototype.destroy.apply(this)},wheelUp:function(A){if(!(this.map&&this.markers)){return}var E=this.map.getZoom();if(E<this.map.getNumZoomLevels()-1&&!this.isCartoonPlay){this.isCartoonPlay=true;this.markers.setVisibility(true);var G=A.xy.x;var H=A.xy.y;if(this.marker1&&this.marker2&&this.marker3&&this.marker4){this.marker1.icon=this.bricon;this.marker2.icon=this.blicon;this.marker3.icon=this.uricon;this.marker4.icon=this.ulicon;this.marker1.draw(new HGIS.Pixel(G+30,H+23));this.marker2.draw(new HGIS.Pixel(G-30,H+23));this.marker3.draw(new HGIS.Pixel(G+30,H-23));this.marker4.draw(new HGIS.Pixel(G-30,H-23))}var C=0;var B;var F=this;var D=function(){C++;F.marker1.moveTo(new HGIS.Pixel(G+30+6*C,H+23+4*C));F.marker2.moveTo(new HGIS.Pixel(G-30-6*C,H+23+4*C));F.marker3.moveTo(new HGIS.Pixel(G+30+6*C,H-23-4*C));F.marker4.moveTo(new HGIS.Pixel(G-30-6*C,H-23-4*C));if(C==5){F.isCartoonPlay=false;F.markers.setVisibility(false);window.clearInterval(B)}};B=window.setInterval(function(){D()},100)}this.wheelChange(A,1)},wheelDown:function(A){if(!(this.map&&this.markers)){return}var E=this.map.getZoom();if(E>this.map.minLevel&&!this.isCartoonPlay){this.isCartoonPlay=true;this.markers.setVisibility(true);var G=A.xy.x;var H=A.xy.y;if(this.marker1&&this.marker2&&this.marker3&&this.marker4){this.marker1.icon=this.ulicon;this.marker2.icon=this.uricon;this.marker3.icon=this.blicon;this.marker4.icon=this.bricon;this.marker1.draw(new HGIS.Pixel(G+60,H+45));this.marker2.draw(new HGIS.Pixel(G-60,H+45));this.marker3.draw(new HGIS.Pixel(G+60,H-45));this.marker4.draw(new HGIS.Pixel(G-60,H-45))}var C=0;var B;var F=this;var D=function(){C++;F.marker1.moveTo(new HGIS.Pixel(G+60-6*C,H+45-4*C));F.marker2.moveTo(new HGIS.Pixel(G-60+6*C,H+45-4*C));F.marker3.moveTo(new HGIS.Pixel(G+60-6*C,H-45+4*C));F.marker4.moveTo(new HGIS.Pixel(G-60+6*C,H-45+4*C));if(C==5){F.isCartoonPlay=false;F.markers.setVisibility(false);window.clearInterval(B)}};B=window.setInterval(function(){D()},100)}this.wheelChange(A,-1)},wheelChange:function(C,E){var A=this.map.getZoom();var F=this.map.getZoom()+Math.round(E);if(HGIS.InitParam.minLevel){F=Math.max(F,HGIS.InitParam.minLevel)}else{F=Math.max(F,0)}F=Math.min(F,this.map.getNumZoomLevels());if(F===A){return}var D=this.map.getSize();var I=D.w/2-C.xy.x;var B=C.xy.y-D.h/2;var J=this.map.baseLayer.getResolutionForZoom(F);var G=this.map.getLonLatFromPixel(C.xy);var H=new HGIS.LonLat(G.lon+I*J,G.lat+B*J);if(this.isCenterMouseWheel){this.map.setCenter(H,F)}else{this.map.setCenter(this.map.getCenter(),this.map.getZoom()+Math.round(E))}},CLASS_NAME:"HGIS.Control.ZoomAnimation"});HGIS.Converter=HGIS.Converter||{};HGIS.Converter.BaiduConverter={lonlat2Merctor:function(B){var D=null;var C=B[1]>74?74:B[1];C=C<-74?-74:C;for(var A=0;A<HGIS.Converter.BaiduConverter.array1.length;A++){if(B[1]>=HGIS.Converter.BaiduConverter.array1[A]){D=HGIS.Converter.BaiduConverter.array2[A];break}}if(D==null){for(var A=HGIS.Converter.BaiduConverter.array1.length-1;A>=0;A--){if(B[1]<=-HGIS.Converter.BaiduConverter.array1[A]){D=HGIS.Converter.BaiduConverter.array2[A];break}}}var E=this.convertor(B[0],B[1],D);return E},convertor:function(C,D,B){var E=B[0]+B[1]*Math.abs(C);var F=Math.abs(D)/B[9];var A=B[2]+B[3]*F+B[4]*F*F+B[5]*F*F*F+B[6]*F*F*F*F+B[7]*F*F*F*F*F+B[8]*F*F*F*F*F*F;E*=(C<0?-1:1);A*=(D<0?-1:1);return[E,A]}};HGIS.Converter.BaiduConverter.array1=[75,60,45,30,15,0];HGIS.Converter.BaiduConverter.array3=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0];HGIS.Converter.BaiduConverter.array2=[[-0.0015702102444,111320.702061694,1.7044805245352e+15,-1.03389873760423e+16,2.61126678566039e+16,-3.51496691766537e+16,2.65957007184039e+16,-1.07250124541882e+16,1.80081991295047e+15,82.5],[0.000827782451617253,111320.702046358,647795574.667161,-4082003173.64132,10774905663.5114,-15171875531.5156,12053065338.6217,-5124939663.57747,913311935.951203,67.5],[0.00337398766765,111320.702020216,4481351.04589036,-23393751.1993166,79682215.4718646,-115964993.279725,97236711.1560214,-43661946.3375282,8477230.50113523,52.5],[0.00220636496208,111320.702020913,51751.8611284113,3796837.74947025,992013.739779101,-1221952.21711287,1340652.69700908,-620943.699098431,144416.929380624,37.5],[-0.000344196350436839,111320.702057686,278.235398077275,2485758.69003539,6070.75096324338,54821.1834535212,9540.60663330424,-2710.55326746645,1405.48384412173,22.5],[-0.000321813587861313,111320.702070162,0.00369383431289,823725.640279572,0.46104986909093,2351.34314133129,1.58060784298199,8.77738589078284,0.37238884252424,7.45]];HGIS.Converter.BaiduConverter.array4=[[1.41052617211625e-08,8.98305509648872e-06,-1.9939833816331,200.98243831068,-187.240370381555,91.6087516669843,-23.3876564960334,2.57121317296198,-0.03801003308653,17337981.2],[-7.43585638956554e-09,8.98305509772624e-06,-0.78625201886289,96.3268759975985,-1.85204757529826,-59.3693590548588,47.4003354929674,-16.5074193106389,2.28786674699375,10260144.86],[-3.03088346089883e-08,8.98305509983578e-06,0.30071316287616,59.7429361844228,7.357984074871,-25.3837100266474,13.4538052111091,-3.29883767235584,0.32710905363475,6856817.37],[-1.98198130493055e-08,8.98305509977953e-06,0.03278182852591,40.3167852770574,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-09,8.98305509681215e-06,6.995724062e-05,23.109343041449,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.89087114477688e-09,8.98305509580541e-06,-3.068298e-08,7.47137025468032,-3.53937994e-06,-0.02145144861037,-1.234426596e-05,0.00010322952773,-3.23890364e-06,826088.5]];var HGIS=HGIS||{};HGIS.Converter=HGIS.Converter||{};HGIS.Converter.encryToGCJ02=function(H){var G=H.x*3686400;var I=H.y*3686400;var D=0;var B=0;var A=0;var F=HGIS.Converter.wgtochina_lb(1,Math.floor(G),Math.floor(I),Math.floor(A),Math.floor(D),Math.floor(B));var C=F.x;var E=F.y;C/=3686400;E/=3686400;H.x=C;H.y=E;return H};HGIS.Converter.params={casm_f:0,casm_rr:0,casm_t1:0,casm_t2:0,casm_x1:0,casm_x2:0,casm_y1:0,casm_y2:0};HGIS.Converter.wgtochina_lb=function(C,D,I,K,H,O){var M=new HGIS.Geometry.Point();M.x=D;M.y=I;if(K<=5000){var J=D;J=J/3686400;var L=I;L=L/3686400;if(J<72.004){return M}if(J>137.8347){return M}if(L<0.8293){return M}if(L>55.8271){return M}if(C==0){HGIS.Converter.iniCasm(O,D,I);M=new HGIS.Geometry.Point();M.x=D;M.y=I;return M}HGIS.Converter.params.casm_t2=O;var A=(HGIS.Converter.params.casm_t2-HGIS.Converter.params.casm_t1)/1000;if(A<=0){HGIS.Converter.params.casm_t1=HGIS.Converter.params.casm_t2;HGIS.Converter.params.casm_f+=1;HGIS.Converter.params.casm_x1=HGIS.Converter.params.casm_x2;HGIS.Converter.params.casm_f+=1;HGIS.Converter.params.casm_y1=HGIS.Converter.params.casm_y2;HGIS.Converter.params.casm_f+=1}else{if(A>120){if(HGIS.Converter.params.casm_f==3){HGIS.Converter.params.casm_f=0;HGIS.Converter.params.casm_x2=D;HGIS.Converter.params.casm_y2=I;var N=HGIS.Converter.params.casm_x2-HGIS.Converter.params.casm_x1;var B=HGIS.Converter.params.casm_y2-HGIS.Converter.params.casm_y1;var P=Math.sqrt(N*N+B*B)/A;if(P>3185){return M}}HGIS.Converter.params.casm_t1=HGIS.Converter.params.casm_t2;HGIS.Converter.params.casm_f+=1;HGIS.Converter.params.casm_x1=HGIS.Converter.params.casm_x2;HGIS.Converter.params.casm_f+=1;HGIS.Converter.params.casm_y1=HGIS.Converter.params.casm_y2;HGIS.Converter.params.casm_f+=1}}var F=HGIS.Converter.transform_yj5(J-105,L-35);var G=HGIS.Converter.transform_yjy5(J-105,L-35);var E=K;F=F+E*0.001+HGIS.Converter.yj_sin2(O*0.0174532925199433)+HGIS.Converter.random_yj();G=G+E*0.001+HGIS.Converter.yj_sin2(O*0.0174532925199433)+HGIS.Converter.random_yj();M=new HGIS.Geometry.Point();M.x=(J+HGIS.Converter.transform_jy5(L,F))*3686400;M.y=(L+HGIS.Converter.transform_jyj5(L,G))*3686400}return M};HGIS.Converter.transform_jy5=function(C,E){var A=6378245;var D=0.00669342;var B=Math.sqrt(1-D*HGIS.Converter.yj_sin2(C*0.0174532925199433)*HGIS.Converter.yj_sin2(C*0.0174532925199433));return E*180/(A/B*Math.cos(C*0.0174532925199433)*3.1415926)};HGIS.Converter.transform_jyj5=function(D,B){var F=6378245;var E=0.00669342;var C=1-E*HGIS.Converter.yj_sin2(D*0.0174532925199433)*HGIS.Converter.yj_sin2(D*0.0174532925199433);var A=F*(1-E)/(C*Math.sqrt(C));return B*180/(A*3.1415926)};HGIS.Converter.transform_yj5=function(A,B){var C=300+1*A+2*B+0.1*A*A+0.1*A*B+0.1*Math.sqrt(Math.sqrt(A*A));C=C+(20*HGIS.Converter.yj_sin2(18.8495559215388*A)+20*HGIS.Converter.yj_sin2(6.28318530717959*A))*0.6667;C=C+(20*HGIS.Converter.yj_sin2(3.14159265358979*A)+40*HGIS.Converter.yj_sin2(1.0471975511966*A))*0.6667;return C+(150*HGIS.Converter.yj_sin2(0.26179938779915*A)+300*HGIS.Converter.yj_sin2(0.10471975511966*A))*0.6667};HGIS.Converter.transform_yjy5=function(A,B){var C=-100+2*A+3*B+0.2*B*B+0.1*A*B+0.2*Math.sqrt(Math.sqrt(A*A));C=C+(20*HGIS.Converter.yj_sin2(18.8495559215388*A)+20*HGIS.Converter.yj_sin2(6.28318530717959*A))*0.6667;C=C+(20*HGIS.Converter.yj_sin2(3.14159265358979*B)+40*HGIS.Converter.yj_sin2(1.0471975511966*B))*0.6667;return C+(160*HGIS.Converter.yj_sin2(0.26179938779915*B)+320*HGIS.Converter.yj_sin2(0.10471975511966*B))*0.6667};HGIS.Converter.yj_sin2=function(C){var E=0;if(C<0){C=-C;E=1}var D=Math.floor(C/6.28318530717959);var B=C-D*6.28318530717959;if(B>3.14159265358979){B-=3.14159265358979;if(E==1){E=0}else{if(E==0){E=1}}}C=B;var A=C;var F=C;B*=B;F*=B;A-=F*0.166666666666667;F*=B;A+=F*0.00833333333333333;F*=B;A-=F*0.000198412698412698;F*=B;A+=F*2.75573192239859e-06;F*=B;A-=F*2.50521083854417e-08;if(E==1){A=-A}return A};HGIS.Converter.random_yj=function(){var B=314159269;var C=453806245;HGIS.Converter.params.casm_rr=(B*HGIS.Converter.params.casm_rr+C);var A=Math.floor(HGIS.Converter.params.casm_rr/2);HGIS.Converter.params.casm_rr-=A*2;HGIS.Converter.params.casm_rr/=2;return HGIS.Converter.params.casm_rr};HGIS.Converter.iniCasm=function(D,C,A){HGIS.Converter.params.casm_t1=D;HGIS.Converter.params.casm_t2=D;var B=Math.floor(D/0.357);HGIS.Converter.casm_rr=(D-B*0.357);if(D==0){HGIS.Converter.casm_rr=0.3}HGIS.Converter.casm_x1=C;HGIS.Converter.casm_y1=A;HGIS.Converter.casm_x2=C;HGIS.Converter.casm_y2=A;HGIS.Converter.casm_f=3};HGIS.Converter=HGIS.Converter||{};HGIS.Converter.Factor=[[{"A":0.00010684326783339,"B":8.66051312220506e-07,"C":-8.7522746161639e-08,"D":0.984020466992035,"E":-6.94434128831745e-05,"F":0.594789504090841,"H":1.12121686799971e-05,"I":-1.050377312517e-06,"J":0.00010560942402843,"K":-0.00161184354311672,"L":0.996267577676818,"M":0.0938870735067212},{"A":5.75995332008361e-06,"B":2.28267807544924e-06,"C":-1.62605034992325e-08,"D":0.999568552288622,"E":-0.000183623844904446,"F":-0.0034294034485356,"H":1.1227426281929e-05,"I":-1.05048697851551e-06,"J":0.000105609067931639,"K":-0.0016590360327271,"L":0.996267891903056,"M":0.0972729732825428},{"A":-9.69569677580218e-05,"B":-3.25394859501671e-07,"C":1.75518491962734e-08,"D":1.015589076651,"E":1.866867629019e-05,"F":-0.628350797909661,"H":1.12258139563226e-05,"I":-1.05023249163949e-06,"J":0.00010560870945997,"K":-0.00170371412465897,"L":0.996268177633411,"M":0.100655113945095},{"A":0.000140457418908113,"B":-5.54610415814949e-07,"C":-7.37544391116174e-08,"D":0.977016106767849,"E":3.71436924808677e-05,"F":0.938041475330465,"H":1.12043688212382e-05,"I":-1.05031298047731e-06,"J":0.000105608346610858,"K":-0.00174510284760032,"L":0.996268490412543,"M":0.103990786438999},{"A":4.64343089319197e-05,"B":1.77163300740801e-06,"C":-6.3976003605859e-08,"D":0.992591904186156,"E":-0.000158706624702631,"F":0.29261525738184,"H":1.12226336606569e-05,"I":-1.05055677501742e-06,"J":0.000105607988284573,"K":-0.00179294339719149,"L":0.996268816750383,"M":0.107678260239481},{"A":-6.14790985853375e-05,"B":9.58673003204069e-08,"C":-3.24123734518622e-08,"D":1.0107141937761,"E":-1.9890926324706e-05,"F":-0.468463326404162,"H":1.12251828114363e-05,"I":-1.05039953224306e-06,"J":0.000105607629828891,"K":-0.00183828248899687,"L":0.99626910949323,"M":0.111356177400012},{"A":0.000160339300876444,"B":5.42548819648658e-07,"C":-7.4349872702939e-08,"D":0.971995481757688,"E":-6.06582307796089e-05,"F":1.22079281906554,"H":1.12079308412505e-05,"I":-1.05051688126245e-06,"J":0.000105607268953922,"K":-0.001880130322931,"L":0.996269426124705,"M":0.114970002066912},{"A":4.46928408801561e-05,"B":3.09395181496974e-06,"C":1.38436304641942e-08,"D":0.992544434221401,"E":-0.000293408692868979,"F":0.307635347002361,"H":1.12292942380521e-05,"I":-1.05073125489241e-06,"J":0.000105606913538503,"K":-0.00192874514735308,"L":0.996269751344748,"M":0.118970020983397},{"A":-8.49104293880742e-05,"B":1.11106528155602e-06,"C":1.2112661584851e-07,"D":1.01591298063539,"E":-0.000119403145362185,"F":-0.745993120082858,"H":1.12331172567037e-05,"I":-1.05049137189006e-06,"J":0.00010560655777353,"K":-0.00197436500518222,"L":0.996270035565619,"M":0.122932247087647},{"A":0.000121408926899491,"B":8.000137075026e-07,"C":1.20704370942804e-07,"D":0.977427186876412,"E":-9.39245522317833e-05,"F":1.04841295106962,"H":1.12152530116483e-05,"I":-1.05050149745711e-06,"J":0.00010560619807648,"K":-0.00201591888323804,"L":0.996270342850025,"M":0.126793699594145},{"A":7.71250719733274e-07,"B":2.33934424498372e-06,"C":1.93729894570893e-07,"D":1.00032724531445,"E":-0.000245260993352758,"F":-0.0386800533924543,"H":1.12347062313223e-05,"I":-1.0506191660542e-06,"J":0.000105605841615009,"K":-0.00206445390391252,"L":0.996270660157812,"M":0.131071425490063},{"A":-0.000121417738096152,"B":-6.24340718236027e-07,"C":2.21707102454616e-07,"D":1.02382777092714,"E":3.8745207092461e-05,"F":-1.16891723023218,"H":1.12370635522163e-05,"I":-1.05032728858756e-06,"J":0.000105605482117549,"K":-0.00210985327566959,"L":0.996270938052049,"M":0.135295415589098},{"A":0.000102496360687265,"B":-1.61449319602269e-06,"C":8.88040621038755e-08,"D":0.979393417242164,"E":0.000138284823009371,"F":1.03514136062586,"H":1.12218098974881e-05,"I":-1.05035035624645e-06,"J":0.000105605116616614,"K":-0.0021517132026645,"L":0.99627124705583,"M":0.139431459432672},{"A":5.74790431606687e-06,"B":-2.47249111851033e-07,"C":1.91936777582669e-09,"D":0.998918863777135,"E":1.08470842974384e-06,"F":0.0496070333374519,"H":1.1260428038451e-05,"I":-1.05054844934394e-06,"J":0.000105604752930616,"K":-0.00220434521749269,"L":0.996271573820863,"M":0.144195824069811},{"A":-9.25847458976836e-05,"B":-2.79640547318216e-06,"C":-1.22281688108572e-07,"D":1.01896572069967,"E":0.000265893550391638,"F":-0.972420492302263,"H":1.15500489913933e-05,"I":-1.05039544051611e-06,"J":0.000105604385696456,"K":-0.00230919098851246,"L":0.996271865134474,"M":0.151764885378725},{"A":0.000148326265022591,"B":-2.89820935028828e-06,"C":-3.65638660904111e-07,"D":0.968258987222839,"E":0.000282257307389955,"F":1.69534577537343,"H":1.16001581242364e-05,"I":-1.05078878420706e-06,"J":0.000105604018604599,"K":-0.00236807883423751,"L":0.996272214126009,"M":0.157238215949747},{"A":5.78574201002269e-05,"B":-3.35822291530619e-07,"C":-4.96294743967951e-07,"D":0.987583560177882,"E":1.06308808085487e-05,"F":0.662984216767654,"H":1.1237296858202e-05,"I":-1.05106780518005e-06,"J":0.000105603659015657,"K":-0.0023355613601268,"L":0.996272551452627,"M":0.157755682245806},{"A":-4.68545800211828e-05,"B":-1.68759948415698e-06,"C":-5.87421420616963e-07,"D":1.01018299067209,"E":0.000159015400413409,"F":-0.556672058515687,"H":1.12157023373916e-05,"I":-1.05100700553695e-06,"J":0.00010560329909387,"K":-0.00237566774302422,"L":0.996272852453224,"M":0.162226387607006},{"A":0.000177213085044592,"B":-8.77587181147277e-07,"C":-7.30298191919943e-07,"D":0.960310527060017,"E":7.10327504975794e-05,"F":2.21806964197458,"H":1.11908212230005e-05,"I":-1.05122163224225e-06,"J":0.000105602937338578,"K":-0.00241489465923195,"L":0.996273184336751,"M":0.166729679025138},{"A":6.33706174966164e-05,"B":2.11098381841524e-06,"C":-7.17797105309614e-07,"D":0.985996033004085,"E":-0.000269484983505208,"F":0.768898763017205,"H":1.12091361152977e-05,"I":-1.05152910101491e-06,"J":0.000105602581752767,"K":-0.00246374734072674,"L":0.996273526942936,"M":0.171858767970662},{"A":-6.52166777603824e-05,"B":6.02472448596458e-07,"C":-6.57289698446917e-07,"D":1.0153445417198,"E":-0.000100645819145484,"F":-0.905964414450864,"H":1.1211567049918e-05,"I":-1.05136575828668e-06,"J":0.000105602226812107,"K":-0.00250913396209995,"L":0.996273815974284,"M":0.17688865197033},{"A":0.000141006611576788,"B":7.43791629176371e-07,"C":-6.75285616313914e-07,"D":0.966968087685132,"E":-0.000119948562996797,"F":1.93076718828161,"H":1.11925829250348e-05,"I":-1.05143408091202e-06,"J":0.00010560186915326,"K":-0.00254947498735447,"L":0.996274132071179,"M":0.181710961052431},{"A":1.94987709793981e-05,"B":2.75667423865755e-06,"C":-5.90678884471174e-07,"D":0.995858545057558,"E":-0.00036501704758507,"F":0.213136730839324,"H":1.1210811060175e-05,"I":-1.05159559171675e-06,"J":0.000105601515796472,"K":-0.0025985629928158,"L":0.996274459141965,"M":0.187136871615166},{"A":-0.000104416813689445,"B":2.33865350640627e-07,"C":-5.22108440481617e-07,"D":1.02563506771878,"E":-6.473594066847e-05,"F":-1.57592226121051,"H":1.12105239887805e-05,"I":-1.05132342731462e-06,"J":0.000105601160615781,"K":-0.00264335044232666,"L":0.996274734060783,"M":0.192402884749754},{"A":0.000117151997303333,"B":-3.92767223189594e-07,"C":-5.8908445077499e-07,"D":0.971022128277241,"E":1.13724819925665e-05,"F":1.78901765968476,"H":1.11881937043812e-05,"I":-1.0513455570571e-06,"J":0.00010560080062394,"K":-0.00268265568947612,"L":0.996275045032291,"M":0.197417760866301},{"A":1.72574283143767e-05,"B":1.29962820549778e-06,"C":-5.88324365891069e-07,"D":0.995972997646049,"E":-0.000202602057640888,"F":0.230647191863682,"H":1.12038738165898e-05,"I":-1.05152994500646e-06,"J":0.000105600443801757,"K":-0.00273132332030457,"L":0.996275376212495,"M":0.203098754431267},{"A":-8.49188446629956e-05,"B":-1.01099769667101e-06,"C":-6.06983239670456e-07,"D":1.0217125155898,"E":8.9116533899869e-05,"F":-1.39064551311458,"H":1.12029260377067e-05,"I":-1.0513380681032e-06,"J":0.000105600085183288,"K":-0.00277592207343957,"L":0.996275660090419,"M":0.208620606698787},{"A":0.000152312009384703,"B":-9.73113938762538e-07,"C":-7.32833169259095e-07,"D":0.960390619076975,"E":8.54615241223655e-05,"F":2.57176539970169,"H":1.11819618898723e-05,"I":-1.05146888007557e-06,"J":0.000105599722983019,"K":-0.0028152850142007,"L":0.996275985659594,"M":0.21388979907897},{"A":5.79434601346573e-05,"B":1.64785806799905e-06,"C":-7.39766603530256e-07,"D":0.985078795081165,"E":-0.000260023424402789,"F":0.956706661265343,"H":1.12008709897138e-05,"I":-1.05175580589201e-06,"J":0.000105599365934073,"K":-0.00286495927818464,"L":0.996276331790661,"M":0.219915193325505},{"A":-5.09420857386367e-05,"B":2.52145929469094e-07,"C":-7.06801103422805e-07,"D":1.01381515464408,"E":-7.80454881805781e-05,"F":-0.939510699499806,"H":1.12040258905544e-05,"I":-1.05162578478701e-06,"J":0.000105599009414398,"K":-0.00291061841392093,"L":0.996276623035925,"M":0.225774595186522},{"A":0.000169342032199982,"B":9.08627796114558e-07,"C":-7.31964750588787e-07,"D":0.954211522334845,"E":-0.000169204195174189,"F":3.09197823029535,"H":1.11870603252129e-05,"I":-1.05175538334112e-06,"J":0.000105598651138905,"K":-0.002950804552043,"L":0.996276949344981,"M":0.231351434123098}],[{"A":0.000108200848075501,"B":1.05422689378187e-06,"C":-1.00720731199822e-07,"D":0.983810027460407,"E":-8.46188392813474e-05,"F":0.60296383768582,"H":1.12099707737789e-05,"I":-1.08257729031225e-06,"J":-0.000117969704782506,"K":-0.00161055449974157,"L":1.00527885309269,"M":0.00326510396598678},{"A":5.83337607529266e-06,"B":2.65422105139024e-06,"C":-2.69166277044874e-08,"D":0.999549300512228,"E":-0.000213576893116851,"F":-0.00235077644174453,"H":1.12256028531044e-05,"I":-1.08268381071586e-06,"J":-0.000117968825588011,"K":-0.00165779661688248,"L":1.00527918570107,"M":0.00665111549233188},{"A":-9.81879429370336e-05,"B":-2.91001367891397e-07,"C":7.49099438035472e-09,"D":1.01578492666556,"E":1.49155012962865e-05,"F":-0.636116086332549,"H":1.12241561511239e-05,"I":-1.08242911633916e-06,"J":-0.000117967948691372,"K":-0.00170249405389455,"L":1.00527949003342,"M":0.0100322616640369},{"A":0.000142240759470669,"B":-5.50098728790971e-07,"C":-8.97872212135553e-08,"D":0.976723237722297,"E":3.6009758957789e-05,"F":0.950086655950145,"H":1.12020049452821e-05,"I":-1.08251974617612e-06,"J":-0.000117967075757869,"K":-0.0017437601461836,"L":1.0052798222593,"M":0.0133611434871455},{"A":4.70247137632773e-05,"B":2.07705031485261e-06,"C":-8.06947243470191e-08,"D":0.992486258157783,"E":-0.000185093571190009,"F":0.297344755097583,"H":1.12206671310511e-05,"I":-1.08276747345926e-06,"J":-0.00011796619857174,"K":-0.00179165780554058,"L":1.00528016755,"M":0.0170491311127989},{"A":-6.22597578866513e-05,"B":1.84639149303223e-07,"C":-4.86548554778921e-08,"D":1.01084629080043,"E":-2.82794840984479e-05,"F":-0.474028072811052,"H":1.12234412895096e-05,"I":-1.08261212938832e-06,"J":-0.000117965321684815,"K":-0.00183702778487316,"L":1.00528047908107,"M":0.020726558314891},{"A":0.000162376219180693,"B":6.89113378804507e-07,"C":-9.39819422285382e-08,"D":0.971633753869071,"E":-7.41741048955191e-05,"F":1.23687051675734,"H":1.12055609520767e-05,"I":-1.0827373715383e-06,"J":-0.000117964446981894,"K":-0.00187875785989888,"L":1.00528081502895,"M":0.0243334040692389},{"A":4.52615182386928e-05,"B":3.57047300703073e-06,"C":-2.36783759266501e-09,"D":0.992432194821333,"E":-0.000337044982074985,"F":0.313151887392451,"H":1.12273955937547e-05,"I":-1.08295141842962e-06,"J":-0.00011796356716906,"K":-0.00192744791121413,"L":1.00528115883813,"M":0.0283348964503602},{"A":-8.59892017466279e-05,"B":1.33104337085577e-06,"C":1.09361178557421e-07,"D":1.01610666348915,"E":-0.000140572012156781,"F":-0.754657528479584,"H":1.12314922998125e-05,"I":-1.08270996795889e-06,"J":-0.000117962687913364,"K":-0.00197311065539907,"L":1.00528146152418,"M":0.0322972703002051},{"A":0.000122951525383996,"B":9.80016830798291e-07,"C":1.07728323817113e-07,"D":0.977133265870208,"E":-0.000111728343313189,"F":1.06243347509007,"H":1.12130092155271e-05,"I":-1.082728713242e-06,"J":-0.000117961812164363,"K":-0.00201454151881819,"L":1.00528178820797,"M":0.0361511452238119},{"A":7.81259193560757e-07,"B":2.71821610398071e-06,"C":1.83386452246026e-07,"D":1.00031737709762,"E":-0.000282617832766618,"F":-0.0378011052525835,"H":1.12328996869637e-05,"I":-1.08285357003357e-06,"J":-0.000117960933438049,"K":-0.00206315130279933,"L":1.00528212478808,"M":0.0404305389597539},{"A":-0.000122959058507899,"B":-6.29001801311091e-07,"C":2.11657819715327e-07,"D":1.02412952790445,"E":3.81985148578678e-05,"F":-1.18366196931674,"H":1.12354616342847e-05,"I":-1.08257729769523e-06,"J":-0.000117960057541555,"K":-0.00210858339448095,"L":1.0052824227763,"M":0.0446542893005244},{"A":0.000103797039922249,"B":-1.74668986518967e-06,"C":7.06097356140134e-08,"D":0.979135598634485,"E":0.000150823846354342,"F":1.0479368858214,"H":1.1219504593124e-05,"I":-1.08263915599149e-06,"J":-0.000117959187160371,"K":-0.00215029550709289,"L":1.00528275421621,"M":0.0487811036896346},{"A":5.82104286950269e-06,"B":-2.02933253978799e-07,"C":-2.20210709667157e-08,"D":0.998902684993766,"E":-3.88371429949075e-06,"F":0.0505148464471858,"H":1.12584779834446e-05,"I":-1.08290016676005e-06,"J":-0.000117958314900468,"K":-0.00220298946105402,"L":1.00528310594463,"M":0.0535466110713969},{"A":-9.3758766639862e-05,"B":-3.08196449316789e-06,"C":-1.53891060339362e-07,"D":1.01921520695277,"E":0.000295444598407357,"F":-0.985652882905924,"H":1.15481985832888e-05,"I":-1.08297659484613e-06,"J":-0.000117957446159334,"K":-0.00230784364602954,"L":1.00528343957786,"M":0.0611139910897691},{"A":0.000150207220866783,"B":-3.19620155053713e-06,"C":-4.11178775028276e-07,"D":0.967865868802051,"E":0.000314253665180786,"F":1.71589130530629,"H":1.15975841338822e-05,"I":-1.08245693497544e-06,"J":-0.000117956577011358,"K":-0.00236658912579202,"L":1.00528371134231,"M":0.0665788600890664},{"A":5.85921878424323e-05,"B":-3.02779552097121e-07,"C":-5.49894735080159e-07,"D":0.987423838177278,"E":7.79821394303326e-06,"F":0.67167032375437,"H":1.12351927533672e-05,"I":-1.08298842554921e-06,"J":-0.000117955701107619,"K":-0.00233415766695089,"L":1.00528409431107,"M":0.0670986610734872},{"A":-4.74490143620443e-05,"B":-1.82966088635439e-06,"C":-6.46961319183958e-07,"D":1.01031621212837,"E":0.000175613085673376,"F":-0.564129181282624,"H":1.12138342152901e-05,"I":-1.0829913446031e-06,"J":-0.000117954825577804,"K":-0.002374306353218,"L":1.0052844209722,"M":0.0715696828096952},{"A":0.000179462694001042,"B":-9.14048005506984e-07,"C":-7.98523425160624e-07,"D":0.959807037019573,"E":7.64353908380144e-05,"F":2.24624157720245,"H":1.11883360845444e-05,"I":-1.08324656250547e-06,"J":-0.000117953951723399,"K":-0.00241338671693825,"L":1.00528477610369,"M":0.0760628171583448},{"A":6.41764230189246e-05,"B":2.46058712383146e-06,"C":-7.866011753066e-07,"D":0.985804971716334,"E":-0.000307992555690362,"F":0.780207793068257,"H":1.12071384463508e-05,"I":-1.08357287054162e-06,"J":-0.000117953072194754,"K":-0.00246234008483981,"L":1.0052851395906,"M":0.0811955675949321},{"A":-6.60450299929671e-05,"B":7.56462188888918e-07,"C":-7.24085084780057e-07,"D":1.01553324203348,"E":-0.000117244013438267,"F":-0.916705657942657,"H":1.12098635261515e-05,"I":-1.08341761834163e-06,"J":-0.000117952192199039,"K":-0.00250778687179576,"L":1.00528544829977,"M":0.0862269894150813},{"A":0.000142798120483789,"B":9.17053190718775e-07,"C":-7.44216251291618e-07,"D":0.966541510672528,"E":-0.000139043563109453,"F":1.95615826857102,"H":1.11902817789833e-05,"I":-1.08349628724635e-06,"J":-0.000117951314724724,"K":-0.00254797980761623,"L":1.00528578435503,"M":0.0910386604236919},{"A":1.97469216671742e-05,"B":3.18964345913386e-06,"C":-6.56394470333055e-07,"D":0.995789968748682,"E":-0.000415748213214329,"F":0.217794199561467,"H":1.1208973007576e-05,"I":-1.08365910905794e-06,"J":-0.000117950433213304,"K":-0.00259716963003598,"L":1.00528613031801,"M":0.0964686386460016},{"A":-0.000105742888608873,"B":3.39874783872318e-07,"C":-5.85377087691796e-07,"D":1.02595609367665,"E":-7.65460964942122e-05,"F":-1.59534685330436,"H":1.12089180149266e-05,"I":-1.08338728549429e-06,"J":-0.000117949553564478,"K":-0.00264200647819735,"L":1.00528642400598,"M":0.101735740013282},{"A":0.00011863956941216,"B":-3.66492967085463e-07,"C":-6.57041770546485e-07,"D":0.970652359328028,"E":9.42326784070247e-06,"F":1.81199659835329,"H":1.11859088857691e-05,"I":-1.08341897453457e-06,"J":-0.000117948678151347,"K":-0.00268113677572046,"L":1.00528675487825,"M":0.106737875561521},{"A":1.74768886722632e-05,"B":1.54412397579407e-06,"C":-6.57455999419909e-07,"D":0.995912439168478,"E":-0.000232049782937338,"F":0.23479379631317,"H":1.12019734095636e-05,"I":-1.08360853329215e-06,"J":-0.000117947799844031,"K":-0.002729891965501,"L":1.00528710543449,"M":0.112422316638913},{"A":-8.59970527844478e-05,"B":-1.06596210991405e-06,"C":-6.78238567308753e-07,"D":1.02198922618709,"E":9.75914129526245e-05,"F":-1.40839905212488,"H":1.12012040728859e-05,"I":-1.08342210813905e-06,"J":-0.000117946923265666,"K":-0.00277452881550744,"L":1.00528740873739,"M":0.117944637866458},{"A":0.000154245492336891,"B":-1.02154076708771e-06,"C":-8.11871223804772e-07,"D":0.959888567500684,"E":9.35071085450545e-05,"F":2.60435219165447,"H":1.11795468069886e-05,"I":-1.08356600769799e-06,"J":-0.000117946049906448,"K":-0.00281370438116824,"L":1.0052877547411,"M":0.123199700603436},{"A":5.86801504123269e-05,"B":1.9377125122233e-06,"C":-8.20403714074658e-07,"D":0.984878163784401,"E":-0.000296465697203985,"F":0.970349517425348,"H":1.11988682219843e-05,"I":-1.08385777330966e-06,"J":-0.00011794517181915,"K":-0.00286347761981176,"L":1.00528812026172,"M":0.129229493412822},{"A":-5.15889325221064e-05,"B":3.60728152237755e-07,"C":-7.86870053337552e-07,"D":1.01398594491491,"E":-9.08019831058482e-05,"F":-0.950785464818182,"H":1.12022643579124e-05,"I":-1.08372790391664e-06,"J":-0.00011794429331366,"K":-0.00290919346812757,"L":1.00528843028003,"M":0.135090679286805},{"A":0.000171493779976606,"B":1.10387660456901e-06,"C":-8.1455521816487e-07,"D":0.953622038927733,"E":-0.000193862910009557,"F":3.13234364431992,"H":1.11846848663277e-05,"I":-1.08386101416169e-06,"J":-0.000117943416394706,"K":-0.00294920544159538,"L":1.00528877581702,"M":0.140653703003409}],[{"A":0.000109728496162087,"B":1.25078755131014e-06,"C":-1.19536259890474e-07,"D":0.983573177435176,"E":-0.000100147955777175,"F":0.612162334743516,"H":1.12030619368042e-05,"I":-1.06977930791619e-06,"J":-3.18230352815141e-05,"K":-0.00160948304469599,"L":1.0014338696056,"M":0.0463336831385277},{"A":5.91600099053569e-06,"B":3.04498376202389e-06,"C":-4.23694439533051e-08,"D":0.999527442295545,"E":-0.000244791833779345,"F":-0.00112489430102869,"H":1.12190908759247e-05,"I":-1.0698685958821e-06,"J":-3.18226013098777e-05,"K":-0.0016567597588093,"L":1.00143419294453,"M":0.0497197907297959},{"A":-9.9573093572225e-05,"B":-2.57285702076615e-07,"C":-7.26479454371542e-09,"D":1.01600538021466,"E":1.14466113529943e-05,"F":-0.644862824217853,"H":1.12178127972262e-05,"I":-1.06963003704275e-06,"J":-3.18221696556653e-05,"K":-0.00170145791007315,"L":1.00143449060705,"M":0.0530997258074422},{"A":0.000144247466176028,"B":-5.48048669557488e-07,"C":-1.12830376597373e-07,"D":0.976393784434435,"E":3.54341790682611e-05,"F":0.963628179772059,"H":1.11949186536453e-05,"I":-1.06972718871834e-06,"J":-3.1821741746263e-05,"K":-0.00174257664257027,"L":1.00143481542256,"M":0.0564213301413474},{"A":4.76890903360339e-05,"B":2.39777667498942e-06,"C":-1.04791101351864e-07,"D":0.992367234535948,"E":-0.00021239066015255,"F":0.302674170470709,"H":1.12140034386754e-05,"I":-1.0699556780569e-06,"J":-3.18213097227349e-05,"K":-0.00179051727766932,"L":1.00143515118262,"M":0.0601097580347414},{"A":-6.31381954784294e-05,"B":2.75942988459121e-07,"C":-7.22171652478565e-08,"D":1.01099496381747,"E":-3.65146187846221e-05,"F":-0.480296904785064,"H":1.12170103769849e-05,"I":-1.06980976088966e-06,"J":-3.18208780538676e-05,"K":-0.00183590051868521,"L":1.00143545557837,"M":0.0637864157179138},{"A":0.0001646682960601,"B":8.41590340305842e-07,"C":-1.22298082771977e-07,"D":0.971226698636741,"E":-8.77650331574387e-05,"F":1.25495827985287,"H":1.11984700285617e-05,"I":-1.06993249715526e-06,"J":-3.18204484009987e-05,"K":-0.00187748872599514,"L":1.00143578336927,"M":0.067385698615908},{"A":4.59014541773772e-05,"B":4.07240988442581e-06,"C":-2.61187351746628e-08,"D":0.992305613878784,"E":-0.000382587482420149,"F":0.319380070082843,"H":1.12208052575613e-05,"I":-1.07011878985874e-06,"J":-3.18200137792157e-05,"K":-0.00192624100570526,"L":1.00143611676061,"M":0.0713885497825686},{"A":-8.72031123304584e-05,"B":1.5613010095894e-06,"C":9.1575972027691e-08,"D":1.01632453534876,"E":-0.000162390711381022,"F":-0.764404218676646,"H":1.12251851245304e-05,"I":-1.06988194120694e-06,"J":-3.18195798482135e-05,"K":-0.001971929488775,"L":1.00143641190689,"M":0.0753507063727739},{"A":0.000124687366201748,"B":1.16791379589642e-06,"C":8.81705011224199e-08,"D":0.976802483658616,"E":-0.000129948554047132,"F":1.0782102750818,"H":1.1206050206658e-05,"I":-1.06989863712936e-06,"J":-3.18191492119091e-05,"K":-0.00201321262633769,"L":1.00143673043309,"M":0.0791962650400819},{"A":7.92523258574818e-07,"B":3.1167409995092e-06,"C":1.67315474253193e-07,"D":1.00030607236613,"E":-0.000321583899903999,"F":-0.0367963215103373,"H":1.122640296225e-05,"I":-1.07000153171111e-06,"J":-3.18187156147232e-05,"K":-0.00206188375471328,"L":1.00143705695092,"M":0.0834770999226748},{"A":-0.000124693419088828,"B":-6.36635423933996e-07,"C":1.95872035257949e-07,"D":1.02446918285511,"E":3.82194375561085e-05,"F":-1.20026713948755,"H":1.12291723171065e-05,"I":-1.06973901009555e-06,"J":-3.18182849072535e-05,"K":-0.0021073303685597,"L":1.00143734829939,"M":0.0877000930604481},{"A":0.000105260612444535,"B":-1.88941638601392e-06,"C":4.35629086137368e-08,"D":0.978845698440409,"E":0.000164862656163223,"F":1.06230892591338,"H":1.12124704833017e-05,"I":-1.06980696101822e-06,"J":-3.18178594641005e-05,"K":-0.00214886827600935,"L":1.00143767238244,"M":0.0918167458626158},{"A":5.90334818451055e-06,"B":-1.58717554432641e-07,"C":-5.70449989467647e-08,"D":0.998884544875068,"E":-8.27311492912486e-06,"F":0.0515230964956572,"H":1.12518104575798e-05,"I":-1.07004469623861e-06,"J":-3.18174321441433e-05,"K":-0.00220160934736668,"L":1.00143801381701,"M":0.0965830574828033},{"A":-9.50797813548121e-05,"B":-3.3870523761248e-06,"C":-1.99527008026834e-07,"D":1.01949625857532,"E":0.000327756214403507,"F":-1.0005844501502,"H":1.1541508670998e-05,"I":-1.07007384742008e-06,"J":-3.18170082688751e-05,"K":-0.00230643338584002,"L":1.00143833464341,"M":0.10414735410086},{"A":0.000152323705706392,"B":-3.5145342383025e-06,"C":-4.75992983028917e-07,"D":0.967423864318221,"E":0.000349423885666056,"F":1.73896221721225,"H":1.15901032418098e-05,"I":-1.06990762049897e-06,"J":-3.18165838879003e-05,"K":-0.00236497657236612,"L":1.00143863563668,"M":0.109599485513172},{"A":5.94189938674106e-05,"B":-2.70525772005925e-07,"C":-6.25849251978394e-07,"D":0.987244184843007,"E":6.23751265038663e-06,"F":0.681423190075293,"H":1.12283706285021e-05,"I":-1.07034205742984e-06,"J":-3.18161530708239e-05,"K":-0.00233265953542627,"L":1.00143900037049,"M":0.110123770729388},{"A":-4.81178810076699e-05,"B":-1.98279597030115e-06,"C":-7.31162361544691e-07,"D":1.01046632917769,"E":0.000194741465719517,"F":-0.572558048537758,"H":1.12072674919861e-05,"I":-1.07034309093645e-06,"J":-3.18157228042237e-05,"K":-0.00237283725425641,"L":1.00143931897293,"M":0.114594705869422},{"A":0.000181994059357704,"B":-9.55464959817576e-07,"C":-8.94723034106093e-07,"D":0.959240618270996,"E":8.38873152702035e-05,"F":2.27791083573538,"H":1.11811255788519e-05,"I":-1.07059219839334e-06,"J":-3.18152940725069e-05,"K":-0.00241174723144866,"L":1.00143966558617,"M":0.119076641187348},{"A":6.50831913722172e-05,"B":2.82807969131937e-06,"C":-8.83702509613116e-07,"D":0.985589795656267,"E":-0.000347028397357008,"F":0.792937292957504,"H":1.12004483387995e-05,"I":-1.07088980905168e-06,"J":-3.18148596819556e-05,"K":-0.00246079090138096,"L":1.00144001798578,"M":0.124212734559478},{"A":-6.69771404286923e-05,"B":9.16857510357971e-07,"C":-8.18557793991204e-07,"D":1.0157455571524,"E":-0.000133109749583582,"F":-0.9288059995597,"H":1.12034803190775e-05,"I":-1.07073757271703e-06,"J":-3.18144250240626e-05,"K":-0.00250628214828907,"L":1.00144031919545,"M":0.129244993168868},{"A":0.000144814053132158,"B":1.09774920931116e-06,"C":-8.41726420119926e-07,"D":0.966061460812625,"E":-0.000157491782687202,"F":1.98471758319647,"H":1.1183271005355e-05,"I":-1.07081200939607e-06,"J":-3.18139926731853e-05,"K":-0.00254630150813284,"L":1.0014406469019,"M":0.134044729518791},{"A":2.00261679834668e-05,"B":3.64544914766007e-06,"C":-7.49617706130579e-07,"D":0.995712556704689,"E":-0.000467755830072747,"F":0.223048344523704,"H":1.12024538668765e-05,"I":-1.07095102402921e-06,"J":-3.18135564477684e-05,"K":-0.00259558171616447,"L":1.00144098217144,"M":0.139478284888355},{"A":-0.000107235061827193,"B":4.49478269715087e-07,"C":-6.75373647673894e-07,"D":1.02631734621781,"E":-8.73753396604116e-05,"F":-1.61722205463593,"H":1.12026378564778e-05,"I":-1.07069088184364e-06,"J":-3.18131221022089e-05,"K":-0.00264045067623897,"L":1.00144126940579,"M":0.14474555637571},{"A":0.00012031346724628,"B":-3.41448217922036e-07,"C":-7.5357080486782e-07,"D":0.970236356559781,"E":9.14628185455513e-06,"F":1.83782700381926,"H":1.11789140145868e-05,"I":-1.0707289859746e-06,"J":-3.18126917985273e-05,"K":-0.00267937848539646,"L":1.00144159320273,"M":0.149733380891121},{"A":1.77238467966578e-05,"B":1.80032488694692e-06,"C":-7.55704298915916e-07,"D":0.995844200228134,"E":-0.000261423567621932,"F":0.239454672693682,"H":1.11953866162584e-05,"I":-1.07090457079906e-06,"J":-3.18122587129044e-05,"K":-0.00272820877025026,"L":1.0014419341552,"M":0.155420616321862},{"A":-8.72102890219217e-05,"B":-1.12683505504307e-06,"C":-7.79513645188246e-07,"D":1.02230073473856,"E":0.000108419678213068,"F":-1.42841188926104,"H":1.11948001684237e-05,"I":-1.07073590549511e-06,"J":-3.18118273132662e-05,"K":-0.0027728658293853,"L":1.00144223185947,"M":0.160942337412052},{"A":0.000156421135774298,"B":-1.07563690532331e-06,"C":-9.23911188444038e-07,"D":0.959323777616532,"E":0.000104050053892024,"F":2.64098275359356,"H":1.11724143184166e-05,"I":-1.07088677797629e-06,"J":-3.18113989799529e-05,"K":-0.00281182617565889,"L":1.00144257092118,"M":0.166181543751009},{"A":5.95091390209745e-05,"B":2.24192206732532e-06,"C":-9.34741281266582e-07,"D":0.984652267533534,"E":-0.000333004901051481,"F":0.985699000106251,"H":1.11921747578125e-05,"I":-1.07115925651602e-06,"J":-3.18109659794563e-05,"K":-0.00286168710361778,"L":1.00144292607629,"M":0.172215071997016},{"A":-5.23167974146865e-05,"B":4.73035234316299e-07,"C":-9.00550096050168e-07,"D":1.01417814139688,"E":-0.0001022659893124,"F":-0.963493884366471,"H":1.1195821576826e-05,"I":-1.07103738944403e-06,"J":-3.18105326872764e-05,"K":-0.00290744325826608,"L":1.00144322931914,"M":0.178076967122252},{"A":0.000173915082936738,"B":1.30781800899982e-06,"C":-9.3180025562134e-07,"D":0.952958657294005,"E":-0.00021785580776168,"F":3.1777526915248,"H":1.11775978937079e-05,"I":-1.0711659767515e-06,"J":-3.18101008904836e-05,"K":-0.00294725428594234,"L":1.00144356640341,"M":0.183624385352232}],[{"A":0.000111437416224547,"B":1.45871485313087e-06,"C":-1.42652880397165e-07,"D":0.983308108652381,"E":-0.000116282489130981,"F":0.62245755656113,"H":1.12028174737433e-05,"I":-1.05781195924859e-06,"J":6.19782072175945e-05,"K":-0.00160941293748351,"L":0.997130256567516,"M":0.0958085395091075},{"A":6.00843671794138e-06,"B":3.46158357689141e-06,"C":-6.12928321430672e-08,"D":0.999502646628429,"E":-0.000277816333621672,"F":0.000270369462668896,"H":1.12192844612391e-05,"I":-1.05788163484721e-06,"J":6.19781533705566e-05,"K":-0.00165675740571203,"L":0.997130574158618,"M":0.0991970061818392},{"A":-0.000101122567657486,"B":-2.24310997998245e-07,"C":-2.51558590624867e-08,"D":1.01625206415446,"E":8.22338499517628e-06,"F":-0.654656037750101,"H":1.12181772844999e-05,"I":-1.057657866399e-06,"J":6.19780971323758e-05,"K":-0.0017014834647,"L":0.997130868749515,"M":0.102577818321151},{"A":0.000146492241561491,"B":-5.49118902792856e-07,"C":-1.40349212918167e-07,"D":0.976025361111112,"E":3.539694567678e-05,"F":0.978763125298428,"H":1.11944758022231e-05,"I":-1.05776504261135e-06,"J":6.19780373326828e-05,"K":-0.00174247101981706,"L":0.997131190146,"M":0.105893832088441},{"A":4.84323156315636e-05,"B":2.73911817361139e-06,"C":-1.333559830341e-07,"D":0.992233825150549,"E":-0.000241132971581237,"F":0.308654234293499,"H":1.12140305471575e-05,"I":-1.05797428240351e-06,"J":6.19779816016519e-05,"K":-0.00179048918275271,"L":0.997131520081702,"M":0.109585196145872},{"A":-6.41208483943556e-05,"B":3.70793787674017e-07,"C":-9.99434314197245e-08,"D":1.01116128464076,"E":-4.47854196750086e-05,"F":-0.487313771674962,"H":1.12172821535306e-05,"I":-1.0578364815772e-06,"J":6.19779254603658e-05,"K":-0.00183591450613108,"L":0.997131820937256,"M":0.113263402156917},{"A":0.000167232337271672,"B":1.00213273879213e-06,"C":-1.55460119888318e-07,"D":0.970771282895839,"E":-0.000101745359131655,"F":1.27519363695319,"H":1.1198027565551e-05,"I":-1.05795838784006e-06,"J":6.19778673565108e-05,"K":-0.00187737807312516,"L":0.997132144428797,"M":0.116856985559025},{"A":4.6617350880851e-05,"B":4.60846003802473e-06,"C":-5.36602441369993e-08,"D":0.992163534487815,"E":-0.000430947751141275,"F":0.326386850683775,"H":1.1220918603505e-05,"I":-1.05811402884015e-06,"J":6.19778141713878e-05,"K":-0.00192622922727281,"L":0.997132470851923,"M":0.120863972803818},{"A":-8.85610627361366e-05,"B":1.80545343408944e-06,"C":7.13168789578944e-08,"D":1.01656810544591,"E":-0.000185321949686568,"F":-0.775295593415649,"H":1.12255968571229e-05,"I":-1.05787761561782e-06,"J":6.1977760259263e-05,"K":-0.00197197314751918,"L":0.997132761775923,"M":0.124828442968465},{"A":0.000126629179728832,"B":1.36652164384188e-06,"C":6.60128558482853e-08,"D":0.976432347686512,"E":-0.000148997122181527,"F":1.09586641388159,"H":1.12057538430577e-05,"I":-1.05789209936535e-06,"J":6.19777031774793e-05,"K":-0.00201312486166216,"L":0.997133075825779,"M":0.128667642537948},{"A":8.05127824410334e-07,"B":3.54168184069081e-06,"C":1.494987873496e-07,"D":1.00029307359335,"E":-0.000362961713136656,"F":-0.0356403441910516,"H":1.12266175039122e-05,"I":-1.05797035560018e-06,"J":6.19776489818036e-05,"K":-0.0020618934009633,"L":0.997133395724326,"M":0.132952861071317},{"A":-0.000126633524176967,"B":-6.4807455135707e-07,"C":1.78597967748217e-07,"D":1.02484925651652,"E":3.87233537821885e-05,"F":-1.2188561826988,"H":1.12296006661294e-05,"I":-1.05771981473435e-06,"J":6.19775918886678e-05,"K":-0.00210738265256794,"L":0.997133683952725,"M":0.137177717958366},{"A":0.000106897793749727,"B":-2.04604029585553e-06,"C":1.31327978492024e-08,"D":0.978521696043686,"E":0.000180535296777862,"F":1.07835408530445,"H":1.12120913147162e-05,"I":-1.05779786896409e-06,"J":6.19775297303615e-05,"K":-0.00214876058082325,"L":0.997134004772349,"M":0.141286185595163},{"A":5.99542488277649e-06,"B":-1.14468122980327e-07,"C":-9.67351769798341e-08,"D":0.998864316687673,"E":-1.23294383627126e-05,"F":0.0526402575615066,"H":1.12518516867666e-05,"I":-1.05801395566818e-06,"J":6.19774693839947e-05,"K":-0.00220158634542145,"L":0.997134339785553,"M":0.146056501681869},{"A":-9.65574525129131e-05,"B":-3.71806144761067e-06,"C":-2.51603300860381e-07,"D":1.01981111563782,"E":0.000363225657821431,"F":-1.01734168186886,"H":1.15417020591924e-05,"I":-1.05799317590138e-06,"J":6.19774056290767e-05,"K":-0.0023064434232225,"L":0.997134651247826,"M":0.153622325738979},{"A":0.000154691200958013,"B":-3.85986445272657e-06,"C":-5.50618076800014e-07,"D":0.966929932270773,"E":0.000388153435608274,"F":1.76470903087466,"H":1.15894839053388e-05,"I":-1.05822159562896e-06,"J":6.19773425772352e-05,"K":-0.00236480607784983,"L":0.997134989525982,"M":0.159064197519911},{"A":6.03438974353665e-05,"B":-2.39154762216032e-07,"C":-7.13487148917835e-07,"D":0.987043296191473,"E":5.60279787009677e-06,"F":0.692315158237761,"H":1.12282317722423e-05,"I":-1.05855576953973e-06,"J":6.19772855099399e-05,"K":-0.00233259254753193,"L":0.99713533943293,"M":0.159593793081513},{"A":-4.88660757753667e-05,"B":-2.150556279501e-06,"C":-8.28379714157279e-07,"D":1.01063454750022,"E":0.000216404722607422,"F":-0.582029709454218,"H":1.12073830762505e-05,"I":-1.05855646709285e-06,"J":6.19772279703557e-05,"K":-0.00237282576753728,"L":0.997135653892876,"M":0.164067491134119},{"A":0.000184825722899351,"B":-1.00332504304745e-06,"C":-1.00597123076085e-06,"D":0.95860717265532,"E":9.31307343421395e-05,"F":2.31330627795978,"H":1.11805404076071e-05,"I":-1.05880417111681e-06,"J":6.19771689919224e-05,"K":-0.0024115792134296,"L":0.997135996266906,"M":0.16854041994884},{"A":6.60975789084084e-05,"B":3.21963814076121e-06,"C":-9.95816329840693e-07,"D":0.985348767075948,"E":-0.00038773589639618,"F":0.807201460447686,"H":1.12004393610921e-05,"I":-1.05907251013448e-06,"J":6.19771155728477e-05,"K":-0.00246075246700173,"L":0.99713634128144,"M":0.17368353421989},{"A":-6.80198423805845e-05,"B":1.0859735164459e-06,"C":-9.27348486223778e-07,"D":1.01598299048362,"E":-0.000148959006367022,"F":-0.942345117509831,"H":1.12037955743438e-05,"I":-1.05892078994252e-06,"J":6.19770622626858e-05,"K":-0.00250631895869446,"L":0.997136638468149,"M":0.178719894014648},{"A":0.000147069192513616,"B":1.28855041880982e-06,"C":-9.53916292401047e-07,"D":0.965524355290199,"E":-0.000176075385070362,"F":2.016664980114,"H":1.11829046382517e-05,"I":-1.05899168090229e-06,"J":6.19770068349679e-05,"K":-0.00254617877287444,"L":0.997136961668488,"M":0.183510028798992},{"A":2.03385619426122e-05,"B":4.13192582482402e-06,"C":-8.56516861214018e-07,"D":0.995625536770376,"E":-0.000522451494418874,"F":0.228965352187515,"H":1.12026302869772e-05,"I":-1.05910395076236e-06,"J":6.19769551300775e-05,"K":-0.00259558831760387,"L":0.997137289657218,"M":0.188951025344977},{"A":-0.000108904270160526,"B":5.64045967710314e-07,"C":-7.78240828225307e-07,"D":1.02672144583454,"E":-9.7869297832176e-05,"F":-1.64170152509178,"H":1.1203061403342e-05,"I":-1.05885280948792e-06,"J":6.19769016298732e-05,"K":-0.00264051820118993,"L":0.997137573864698,"M":0.194221786704475},{"A":0.000122185955610199,"B":-3.17871873045661e-07,"C":-8.63983918852895e-07,"D":0.969771088470736,"E":1.0065893150113e-05,"F":1.86669957887716,"H":1.11785586230373e-05,"I":-1.05889973389672e-06,"J":6.19768440880408e-05,"K":-0.00267925433595906,"L":0.997137894642947,"M":0.199197555072715},{"A":1.80001157177312e-05,"B":2.07233036997323e-06,"C":-8.67952462124677e-07,"D":0.995767678406196,"E":-0.000291761936978219,"F":0.244680492200132,"H":1.11954822181182e-05,"I":-1.0590614569761e-06,"J":6.19767895077283e-05,"K":-0.00272819710770023,"L":0.997138229754711,"M":0.204891540902281},{"A":-8.85674387152147e-05,"B":-1.19543589649496e-06,"C":-8.95149475876877e-07,"D":1.02264938227188,"E":0.000121292451808586,"F":-1.45083440435701,"H":1.11950831764851e-05,"I":-1.05891121693347e-06,"J":6.19767330578558e-05,"K":-0.00277290222312843,"L":0.997138525706099,"M":0.210416077548871},{"A":0.000158854874774406,"B":-1.13712798066601e-06,"C":-1.05211392154025e-06,"D":0.958692169906215,"E":0.000116737531925537,"F":2.68192192362403,"H":1.1171906334595e-05,"I":-1.05907373165737e-06,"J":6.19766736943139e-05,"K":-0.00281165775105308,"L":0.99713886219439,"M":0.215641759944447},{"A":6.04365095098203e-05,"B":2.56547862309553e-06,"C":-1.06546498157556e-06,"D":0.984399322667855,"E":-0.000370894941681854,"F":1.00288850774086,"H":1.11921555829286e-05,"I":-1.05932758598382e-06,"J":6.19766189097481e-05,"K":-0.00286164601010341,"L":0.997139210844423,"M":0.221683315975497},{"A":-5.31310155778009e-05,"B":5.90483442142187e-07,"C":-1.03028986075948e-06,"D":1.01439312429034,"E":-0.000113234439993448,"F":-0.977720990646048,"H":1.11960673429001e-05,"I":-1.05921275128651e-06,"J":6.19765643816161e-05,"K":-0.00290747299368377,"L":0.997139510952223,"M":0.227549680754237},{"A":0.000176623698334044,"B":1.52354850313507e-06,"C":-1.06556449552819e-06,"D":0.95221643819491,"E":-0.000242231812478622,"F":3.22855293572502,"H":1.11771470302502e-05,"I":-1.05933786676005e-06,"J":6.19765084252932e-05,"K":-0.00294709554893302,"L":0.99713984349561,"M":0.233084085268274}],[{"A":0.000113340581855192,"B":1.678712040043e-06,"C":-1.65754327374756e-07,"D":0.983012785497181,"E":-0.000133264774092368,"F":0.633931240452512,"H":1.11980772939946e-05,"I":-1.08657146424829e-06,"J":-0.000160050552608315,"K":-0.00160763471089354,"L":1.00873914919021,"M":-0.0557739633986785},{"A":6.11138772821374e-06,"B":3.90501558045209e-06,"C":-8.00554155189204e-08,"D":0.999474674613964,"E":-0.00031288833964993,"F":0.00185107244124083,"H":1.12150101853614e-05,"I":-1.08663729847525e-06,"J":-0.000160049389220263,"K":-0.00165503292510039,"L":1.00873946914303,"M":-0.0523856334630182},{"A":-0.000102848114804877,"B":-1.91606849053727e-07,"C":-4.26187507507336e-08,"D":1.01652684809312,"E":5.04881901974841e-06,"F":-0.665568356538643,"H":1.12140783463666e-05,"I":-1.08641286733491e-06,"J":-0.000160048228117604,"K":-0.00169977009993261,"L":1.00873976632851,"M":-0.0490065505400707},{"A":0.000148992109990975,"B":-5.5289396239111e-07,"C":-1.6678654413127e-07,"D":0.975615177205782,"E":3.56135588219786e-05,"F":0.995608544471907,"H":1.11895231870163e-05,"I":-1.08653191255303e-06,"J":-0.000160047070076552,"K":-0.00174060095257289,"L":1.00874009133022,"M":-0.0456991426781315},{"A":4.92600368156015e-05,"B":3.10196423702891e-06,"C":-1.60504132540318e-07,"D":0.992084975851469,"E":-0.000271662304186293,"F":0.31533655264866,"H":1.12095791914846e-05,"I":-1.08674561744015e-06,"J":-0.000160045908312589,"K":-0.00178868328897153,"L":1.00874042429282,"M":-0.0420074187227328},{"A":-6.52151694340297e-05,"B":4.69746206821497e-07,"C":-1.25979150666922e-07,"D":1.01134650575887,"E":-5.34073719791195e-05,"F":-0.495128314043541,"H":1.12130857350401e-05,"I":-1.08660960074225e-06,"J":-0.000160044747094301,"K":-0.00183413470136173,"L":1.00874072795775,"M":-0.0383303504709147},{"A":0.000170087803453844,"B":1.17137819488633e-06,"C":-1.8643233345994e-07,"D":0.970264032965446,"E":-0.000116493754319436,"F":1.2977351096979,"H":1.11930769370883e-05,"I":-1.08674044074775e-06,"J":-0.000160043587543901,"K":-0.00187544846848198,"L":1.00874105488089,"M":-0.0347456050367327},{"A":4.74146528670616e-05,"B":5.17978373304473e-06,"C":-7.89196881179066e-08,"D":0.992004810669982,"E":-0.000482511784781536,"F":0.334234421448855,"H":1.12165602661474e-05,"I":-1.08689500044612e-06,"J":-0.000160042423463791,"K":-0.00192438632799963,"L":1.00874138385915,"M":-0.030737105422304},{"A":-9.00733606190585e-05,"B":2.06426004445426e-06,"C":5.33787509748862e-08,"D":1.01683919444861,"E":-0.000209662184261106,"F":-0.787409282960652,"H":1.12215494217915e-05,"I":-1.08665538778308e-06,"J":-0.000160041260327537,"K":-0.00197017020769863,"L":1.00874167713403,"M":-0.0267730866185047},{"A":0.000128791706663467,"B":1.57653377952371e-06,"C":4.65470301191928e-08,"D":0.976020026047848,"E":-0.000169190046250378,"F":1.11554074494416,"H":1.12009570567562e-05,"I":-1.08667857690037e-06,"J":-0.000160040099952297,"K":-0.00201116462298501,"L":1.00874199461782,"M":-0.0229435475002902},{"A":8.19170738575181e-07,"B":3.99404550255333e-06,"C":1.34515286021042e-07,"D":1.00027823033986,"E":-0.000407068956008061,"F":-0.034317001589443,"H":1.12223630073793e-05,"I":-1.0867632045386e-06,"J":-0.000160038936850682,"K":-0.00206001785423382,"L":1.00874231773617,"M":-0.0186566897023113},{"A":-0.000128794082913775,"B":-6.62912180260378e-07,"C":1.6444042461039e-07,"D":1.02527263517732,"E":3.9446136895549e-05,"F":-1.23956798222207,"H":1.12255646840809e-05,"I":-1.08652764341244e-06,"J":-0.00016003777668272,"K":-0.00210553268405533,"L":1.0087426100316,"M":-0.014432919319006},{"A":0.000108720991770284,"B":-2.21635437158696e-06,"C":-1.33982163141866e-08,"D":0.978161159362969,"E":0.000197475210143239,"F":1.09619547559851,"H":1.12071970462813e-05,"I":-1.08664659581592e-06,"J":-0.000160036620820481,"K":-0.00214672180308639,"L":1.00874293750886,"M":-0.0103362452227884},{"A":6.09797395045852e-06,"B":-6.97025770435289e-08,"C":-1.31888977517036e-07,"D":0.998841844068352,"E":-1.653548420677e-05,"F":0.0538799050154921,"H":1.12473950854564e-05,"I":-1.08692696415558e-06,"J":-0.000160035463208419,"K":-0.00219961554651604,"L":1.00874328164628,"M":-0.00556504078849684},{"A":-9.82029654115202e-05,"B":-4.07501674160038e-06,"C":-2.98384995378598e-07,"D":1.02016220713489,"E":0.000401306793548883,"F":-1.03605006896396,"H":1.15372856774876e-05,"I":-1.08713585905695e-06,"J":-0.000160034309009849,"K":-0.0023044572808999,"L":1.00874361948033,"M":0.00199726061327965},{"A":0.000157327632783311,"B":-4.23224651813214e-06,"C":-6.18821403008951e-07,"D":0.966380380585065,"E":0.000429696467477925,"F":1.79332993942808,"H":1.15841802521555e-05,"I":-1.08646680840874e-06,"J":-0.000160033153718209,"K":-0.00236263766961997,"L":1.00874386618914,"M":0.00742826200621494},{"A":6.13739160466587e-05,"B":-2.08204497642583e-07,"C":-7.93934439746735e-07,"D":0.98681964748215,"E":4.97264113619167e-06,"F":0.704438577107794,"H":1.12235919873527e-05,"I":-1.08705311707702e-06,"J":-0.000160031993351129,"K":-0.0023305396253761,"L":1.00874424575811,"M":0.00796109992734273},{"A":-4.96992652165851e-05,"B":-2.33274366090441e-06,"C":-9.17749845896765e-07,"D":1.01082216576413,"E":0.000239618620071269,"F":-0.592607960134046,"H":1.12030190422274e-05,"I":-1.08711891344537e-06,"J":-0.000160030833615543,"K":-0.00237081334105937,"L":1.00874457009519,"M":0.0124344192599892},{"A":0.000187979155431783,"B":-1.05728315036302e-06,"C":-1.10856111912305e-06,"D":0.957901906980737,"E":0.000103035579343214,"F":2.35270725381633,"H":1.11754404930609e-05,"I":-1.08740962939669e-06,"J":-0.000160029674837359,"K":-0.00240938331972984,"L":1.00874492003727,"M":0.0168945327113761},{"A":6.72272949542307e-05,"B":3.63622091636984e-06,"C":-1.09895150046668e-06,"D":0.985080007376666,"E":-0.000431330388778406,"F":0.823126298990246,"H":1.11959558927732e-05,"I":-1.08769745466031e-06,"J":-0.000160028511211052,"K":-0.0024586760691534,"L":1.00874527007858,"M":0.0220417615655606},{"A":-6.91810468329557e-05,"B":1.26447198400825e-06,"C":-1.02697385107042e-06,"D":1.0162473247176,"E":-0.00016595403434394,"F":-0.957411494178814,"H":1.1199652409366e-05,"I":-1.08755303840358e-06,"J":-0.000160027347687552,"K":-0.00250430346972053,"L":1.00874557093155,"M":0.0270791079310584},{"A":0.000149580657380355,"B":1.49013375838614e-06,"C":-1.05651601356449e-06,"D":0.96492609596794,"E":-0.000195996893808115,"F":2.05225794009311,"H":1.1178041929738e-05,"I":-1.08763468975592e-06,"J":-0.000160026185911932,"K":-0.00254397658798666,"L":1.00874589820447,"M":0.0318557318232706},{"A":2.06864803264928e-05,"B":4.65016730366585e-06,"C":-9.53725389329918e-07,"D":0.995528187780565,"E":-0.000581050770449565,"F":0.235609443669091,"H":1.11983457267151e-05,"I":-1.0877475480342e-06,"J":-0.000160025020780719,"K":-0.00259350532880376,"L":1.00874622907497,"M":0.0373012082891364},{"A":-0.000110763175943607,"B":6.84165585962404e-07,"C":-8.7125384240494e-07,"D":1.02717144621931,"E":-0.000109157423537454,"F":-1.66895767201277,"H":1.11990332375966e-05,"I":-1.08749558491716e-06,"J":-0.000160023857464664,"K":-0.0026384807855635,"L":1.00874651598402,"M":0.0425722140262224},{"A":0.000124271238381768,"B":-2.95313732578961e-07,"C":-9.63964333466905e-07,"D":0.969253026363958,"E":1.09953880382818e-05,"F":1.89884594684918,"H":1.11737063280271e-05,"I":-1.08755324179644e-06,"J":-0.000160022697682005,"K":-0.0026769961684181,"L":1.0087468408749,"M":0.0475317806231033},{"A":1.83077955098199e-05,"B":2.3609374935063e-06,"C":-9.69406488415814e-07,"D":0.995682260304079,"E":-0.00032431951677836,"F":0.250527919204615,"H":1.11911102390061e-05,"I":-1.08772083545761e-06,"J":-0.000160021535129729,"K":-0.00272604034249468,"L":1.00874717951963,"M":0.0532294203039783},{"A":-9.00787869282382e-05,"B":-1.27142807437863e-06,"C":-9.99557679959295e-07,"D":1.02303782280131,"E":0.000134974902493923,"F":-1.47582464589505,"H":1.11909046761616e-05,"I":-1.08757657885095e-06,"J":-0.000160020374411318,"K":-0.00277077747762178,"L":1.00874747903443,"M":0.0587533860207259},{"A":0.000161565161913568,"B":-1.20568370887142e-06,"C":-1.16832889762719e-06,"D":0.95798896713427,"E":0.00013021841294858,"F":2.72749327724887,"H":1.11668921373154e-05,"I":-1.08775451584942e-06,"J":-0.000160019216233431,"K":-0.00280929860363699,"L":1.00874782032638,"M":0.0639612191316701},{"A":6.14693075768891e-05,"B":2.90924754287047e-06,"C":-1.18381899349984e-06,"D":0.984117369369073,"E":-0.000411587242354017,"F":1.02206868684152,"H":1.1187663259582e-05,"I":-1.08801425618976e-06,"J":-0.000160018053805666,"K":-0.00285940429762377,"L":1.00874817257582,"M":0.0700076863577124},{"A":-5.40377619315802e-05,"B":7.13662960283301e-07,"C":-1.14738812406756e-06,"D":1.01463251196253,"E":-0.000125123253724269,"F":-0.993558018948534,"H":1.11918521254473e-05,"I":-1.08789937580678e-06,"J":-0.000160016891484094,"K":-0.00290528765317788,"L":1.0087484755192,"M":0.0758751292614761},{"A":0.000179640189585495,"B":1.75177913108726e-06,"C":-1.18624191181027e-06,"D":0.951389722794033,"E":-0.000268466887973773,"F":3.28514883879689,"H":1.11721968091283e-05,"I":-1.08802875087299e-06,"J":-0.000160015730192309,"K":-0.00294469326449587,"L":1.00874881146607,"M":0.0813921234348527}],[{"A":0.000115452996949927,"B":1.91262931514835e-06,"C":-1.98037604870471e-07,"D":0.982684826418136,"E":-0.000150720869214638,"F":0.646670420061128,"H":1.11890100821244e-05,"I":-1.07236679619538e-06,"J":-6.09348238893026e-05,"K":-0.00160635156326805,"L":1.00313196750781,"M":0.0236831437841829},{"A":6.22566873198505e-06,"B":4.37928621854766e-06,"C":-1.06604762017959e-07,"D":0.999443177521528,"E":-0.000349877200832793,"F":0.00363321325676225,"H":1.12064396048939e-05,"I":-1.07241444807782e-06,"J":-6.09341828251564e-05,"K":-0.00165379143216171,"L":1.0031322825077,"M":0.0270716412323964},{"A":-0.000104763322992252,"B":-1.591199163542e-07,"C":-6.75454496779082e-08,"D":1.01683190455719,"E":2.3563342494981e-06,"F":-0.677692742798172,"H":1.12056882150546e-05,"I":-1.0722057754986e-06,"J":-6.09335442026682e-05,"K":-0.00169852290208894,"L":1.00313257739008,"M":0.0304490519934006},{"A":0.000151766758994976,"B":-5.59679730782747e-07,"C":-2.03979047208591e-07,"D":0.975160023476803,"E":3.67628242941009e-05,"F":1.0142860423548,"H":1.1180228100649e-05,"I":-1.07233278090479e-06,"J":-6.09329084202415e-05,"K":-0.00173917156431003,"L":1.00313289949089,"M":0.0337475436067507},{"A":5.01787855067271e-05,"B":3.48954254447698e-06,"C":-1.98788383865001e-07,"D":0.991919411345407,"E":-0.000303558630093903,"F":0.322772495921527,"H":1.12008198023261e-05,"I":-1.07252732994834e-06,"J":-6.09322689322234e-05,"K":-0.00178730714222297,"L":1.00313322732071,"M":0.0374399007996544},{"A":-6.64297778495415e-05,"B":5.73489841393382e-07,"C":-1.62894121191748e-07,"D":1.01155207279692,"E":-6.17500475925681e-05,"F":-0.503810713125858,"H":1.12045927952997e-05,"I":-1.07240033786482e-06,"J":-6.09316301775076e-05,"K":-0.00183276918501463,"L":1.00313352821593,"M":0.0411158520000754},{"A":0.000173257199832522,"B":1.35068419004902e-06,"C":-2.30153631819441e-07,"D":0.969700914663008,"E":-0.000131311094435205,"F":1.32275200714867,"H":1.11837855650831e-05,"I":-1.07252925596324e-06,"J":-6.09309929235913e-05,"K":-0.00187390847708002,"L":1.00313385143048,"M":0.0446913650675924},{"A":4.82996577630956e-05,"B":5.79161860869704e-06,"C":-1.15048874427259e-07,"D":0.991828018705974,"E":-0.000537033512728158,"F":0.342989966517052,"H":1.12079013411814e-05,"I":-1.07265486759545e-06,"J":-6.09303511387993e-05,"K":-0.00192292368960523,"L":1.00313417427778,"M":0.0487016446695634},{"A":-9.17519267247258e-05,"B":2.33995029197409e-06,"C":2.70122699763675e-08,"D":1.01713987287036,"E":-0.000235034416533608,"F":-0.800842841999838,"H":1.12132155213329e-05,"I":-1.07241819363724e-06,"J":-6.09297104169348e-05,"K":-0.00196873275388043,"L":1.00313446425388,"M":0.0526651694272005},{"A":0.000131191994824587,"B":1.79970390168371e-06,"C":1.79822472468061e-08,"D":0.975562218325763,"E":-0.000190054728193445,"F":1.13738414436011,"H":1.11918281117673e-05,"I":-1.07243890873354e-06,"J":-6.09290723233014e-05,"K":-0.00200954445219281,"L":1.00313477793204,"M":0.0564844962500501},{"A":8.34765437218721e-07,"B":4.47792451363505e-06,"C":1.11877982544861e-07,"D":1.00026129437586,"E":-0.000453735478458839,"F":-0.0328111359613104,"H":1.12138111388327e-05,"I":-1.07249992792324e-06,"J":-6.09284315419845e-05,"K":-0.00205847255142544,"L":1.00313509522545,"M":0.0607731644886371},{"A":-0.000131192105624844,"B":-6.81552843495581e-07,"C":1.42785899548414e-07,"D":1.02574267666512,"E":4.09950750963617e-05,"F":-1.2625758848917,"H":1.12172370745345e-05,"I":-1.0722768811755e-06,"J":-6.09277937317909e-05,"K":-0.00210399694795171,"L":1.0031353851524,"M":0.064995658080079},{"A":0.000110744554523645,"B":-2.40226580494607e-06,"C":-5.19137475230025e-08,"D":0.977761327548251,"E":0.00021673013588952,"F":1.11595396172561,"H":1.11979553349961e-05,"I":-1.07240229740846e-06,"J":-6.09271601191286e-05,"K":-0.00214496981234902,"L":1.00313570970446,"M":0.0690797868837763},{"A":6.21180568005641e-06,"B":-2.42563054086986e-08,"C":-1.82193145459308e-07,"D":0.998816954386712,"E":-1.9842756955768e-05,"F":0.055236547235836,"H":1.12386112383067e-05,"I":-1.07265777476995e-06,"J":-6.09265246971358e-05,"K":-0.00219792064157787,"L":1.00313604778083,"M":0.0738519910337345},{"A":-0.000100029254143319,"B":-4.46161136657963e-06,"C":-3.64544768594044e-07,"D":1.02055243091047,"E":0.000443722583071349,"F":-1.05688961422857,"H":1.15284317540043e-05,"I":-1.07280897565509e-06,"J":-6.09258925178269e-05,"K":-0.00230271443180641,"L":1.00313637612431,"M":0.0814100016832526},{"A":0.000160253728927806,"B":-4.63554056051585e-06,"C":-7.14075641616851e-07,"D":0.965771032648377,"E":0.000476285818677979,"F":1.82500936606084,"H":1.15743596587614e-05,"I":-1.07255442649556e-06,"J":-6.09252593841703e-05,"K":-0.00236064280034043,"L":1.00313666288896,"M":0.0868250995417839},{"A":6.2517164739706e-05,"B":-1.77650296251386e-07,"C":-9.05868902556506e-07,"D":0.986571486387447,"E":6.45395908804858e-06,"F":0.71785860055752,"H":1.12146204589436e-05,"I":-1.07303090857158e-06,"J":-6.09246215800829e-05,"K":-0.00232869185342111,"L":1.00313702729256,"M":0.0873638578887039},{"A":-5.06240027502436e-05,"B":-2.53137405037407e-06,"C":-1.04188383565074e-06,"D":1.0110307398723,"E":0.000266929853694364,"F":-0.604417116970581,"H":1.11943459270014e-05,"I":-1.0730934466574e-06,"J":-6.09239841456999e-05,"K":-0.00236899552416503,"L":1.00313734783485,"M":0.0918367986432713},{"A":0.000191479185102539,"B":-1.11814879932837e-06,"C":-1.25069791856447e-06,"D":0.957119306944037,"E":0.000116324842792892,"F":2.39638310197915,"H":1.11659922603646e-05,"I":-1.07337888322068e-06,"J":-6.09233479108573e-05,"K":-0.00240735728570485,"L":1.00313769378671,"M":0.0962832500199511},{"A":6.84812550026948e-05,"B":4.08156295650386e-06,"C":-1.24194957473733e-06,"D":0.984781277257298,"E":-0.000475572270602243,"F":0.840813969618466,"H":1.11871680467113e-05,"I":-1.07363726964405e-06,"J":-6.09227065836992e-05,"K":-0.00245676349501878,"L":1.00313803708379,"M":0.101434768888794},{"A":-7.04699031111033e-05,"B":1.45380941818374e-06,"C":-1.1653648548382e-06,"D":1.01654060289718,"E":-0.000181651167935115,"F":-0.974155461095506,"H":1.11912228508704e-05,"I":-1.07349472444618e-06,"J":-6.09220655006792e-05,"K":-0.00250243889148294,"L":1.00313833473309,"M":0.106472798535833},{"A":0.00015236824560394,"B":1.70415348943465e-06,"C":-1.19906046913698e-06,"D":0.964261920366766,"E":-0.000214752400950147,"F":2.09174511622768,"H":1.11688506955754e-05,"I":-1.0735719720989e-06,"J":-6.09214262544122e-05,"K":-0.00254189863917986,"L":1.00313865807685,"M":0.111234784756562},{"A":2.10726719536147e-05,"B":5.20489430710924e-06,"C":-1.08910884200064e-06,"D":0.99541958846703,"E":-0.000641515641802926,"F":0.24301531715173,"H":1.11897715422971e-05,"I":-1.07365979562513e-06,"J":-6.09207834426084e-05,"K":-0.00259153931277467,"L":1.00313898253066,"M":0.116684745373277},{"A":-0.000112826423528833,"B":8.10735624856562e-07,"C":-1.00110552869737e-06,"D":1.02767087191074,"E":-0.000118812152265946,"F":-1.69923779508099,"H":1.11907259142674e-05,"I":-1.07341844712838e-06,"J":-6.09201426766681e-05,"K":-0.00263654543763892,"L":1.0031392672896,"M":0.121955455996613},{"A":0.000126585739926632,"B":-2.73839831699263e-07,"C":-1.10336920466914e-06,"D":0.968678102569925,"E":1.4652970151019e-05,"F":1.93448024531972,"H":1.11645248761505e-05,"I":-1.07348326572332e-06,"J":-6.09195051888833e-05,"K":-0.00267481062269326,"L":1.0031395896229,"M":0.126897374593682},{"A":1.86493148215394e-05,"B":2.66865313669484e-06,"C":-1.1109314341784e-06,"D":0.995587195888334,"E":-0.000356648587342079,"F":0.257014478222118,"H":1.11824413980832e-05,"I":-1.07363692136708e-06,"J":-6.09188650024795e-05,"K":-0.00272394756717631,"L":1.00313992309488,"M":0.132598503123518},{"A":-9.1756228987272e-05,"B":-1.35580221827247e-06,"C":-1.14521557836866e-06,"D":1.02346915827309,"E":0.000152444262198514,"F":-1.50362439942546,"H":1.11824362507007e-05,"I":-1.07351093392438e-06,"J":-6.09182267114483e-05,"K":-0.00276870095493109,"L":1.0031402215086,"M":0.138121201962349},{"A":0.000164573335236007,"B":-1.28225464179899e-06,"C":-1.33008128355705e-06,"D":0.957208676380446,"E":0.000147743817592527,"F":2.77800672985904,"H":1.11575385048912e-05,"I":-1.0736977609227e-06,"J":-6.09175907561044e-05,"K":-0.00280695779537155,"L":1.00314056053526,"M":0.143309572864382},{"A":6.26156818688273e-05,"B":3.27626090701472e-06,"C":-1.34858714617714e-06,"D":0.983804088989245,"E":-0.000452286996051043,"F":1.04335914077819,"H":1.117886787666e-05,"I":-1.07393873527428e-06,"J":-6.09169506525231e-05,"K":-0.00285717385547457,"L":1.00314090692447,"M":0.149360818748391},{"A":-5.50441787501299e-05,"B":8.4349574969167e-07,"C":-1.31059669516986e-06,"D":1.01489816870276,"E":-0.000134865069242096,"F":-1.01117090822663,"H":1.11833473508405e-05,"I":-1.0738317799408e-06,"J":-6.09163107180288e-05,"K":-0.00290309977154379,"L":1.0031412075187,"M":0.155228682088818},{"A":0.000182988337992906,"B":1.99441275139378e-06,"C":-1.35441984339124e-06,"D":0.950471938409748,"E":-0.00029352957909623,"F":3.34794867146411,"H":1.11629146699599e-05,"I":-1.07395706833158e-06,"J":-6.0915671729278e-05,"K":-0.0029422599745601,"L":1.00314153950697,"M":0.160726614299165}],[{"A":0.000117792013195395,"B":2.16504076844259e-06,"C":-2.37096681843241e-07,"D":0.982321400986223,"E":-0.000169079145607043,"F":0.660790218151305,"H":1.11874280269153e-05,"I":-1.058267796894e-06,"J":5.4537882671124e-05,"K":-0.00160621545812489,"L":0.996401012218577,"M":0.121898871821486},{"A":6.35222325096052e-06,"B":4.89437560546868e-06,"C":-1.38693473594742e-07,"D":0.999407584955009,"E":-0.000389642694386794,"F":0.00565596480919339,"H":1.12054069744127e-05,"I":-1.05829373536759e-06,"J":5.45379120588385e-05,"K":-0.00165373527806878,"L":0.996401327149606,"M":0.125290128252345},{"A":-0.000106883904926525,"B":-1.26798691546526e-07,"C":-9.75428656735389e-08,"D":1.01716974559034,"E":4.91336322738789e-08,"F":-0.691128952781582,"H":1.12048412096999e-05,"I":-1.05809996653328e-06,"J":5.45379389172984e-05,"K":-0.00169849201731154,"L":0.996401624809359,"M":0.128668236509839},{"A":0.000154838954120606,"B":-5.70312972403286e-07,"C":-2.48376249456506e-07,"D":0.974656203421858,"E":3.87749520029956e-05,"F":1.03494657190095,"H":1.11783916517672e-05,"I":-1.05823940654837e-06,"J":5.45379629320886e-05,"K":-0.00173897466528672,"L":0.996401949535979,"M":0.131959631027712},{"A":5.11961158786711e-05,"B":3.90988308396345e-06,"C":-2.44319969144868e-07,"D":0.991735522357772,"E":-0.000337652364549967,"F":0.331045074299254,"H":1.11995792997921e-05,"I":-1.05841406750073e-06,"J":5.45379908526988e-05,"K":-0.00178720348904449,"L":0.996402277328606,"M":0.135655481901267},{"A":-6.77746405288726e-05,"B":6.83678335722249e-07,"C":-2.06635562660651e-07,"D":1.01177963019967,"E":-7.01234621658386e-05,"F":-0.513427317651804,"H":1.12036358597689e-05,"I":-1.05829524188472e-06,"J":5.45380178553212e-05,"K":-0.00183270919269773,"L":0.996402580536994,"M":0.139332954645397},{"A":0.000176766552337337,"B":1.54339284907934e-06,"C":-2.81813221647553e-07,"D":0.969077207068949,"E":-0.000146691305474178,"F":1.3504598253603,"H":1.11819584588391e-05,"I":-1.05842411823875e-06,"J":5.45380434792131e-05,"K":-0.00187369147157312,"L":0.99640290536594,"M":0.142901252344018},{"A":4.92796500659587e-05,"B":6.45703656276808e-06,"C":-1.57532003552951e-07,"D":0.991631293036363,"E":-0.000595885063034984,"F":0.352764159413709,"H":1.12067771248503e-05,"I":-1.05851610021634e-06,"J":5.45380736459156e-05,"K":-0.00192282675322986,"L":0.996403226823091,"M":0.146916510338997},{"A":-9.36105464157677e-05,"B":2.6380424718031e-06,"C":-3.71503061646905e-09,"D":1.01747244299696,"E":-0.000262132992475017,"F":-0.815689442984876,"H":1.12124379059164e-05,"I":-1.05827744412146e-06,"J":5.45381026457736e-05,"K":-0.00196869525296961,"L":0.996403518201461,"M":0.150882433797051},{"A":0.000133849758863214,"B":2.04036222717363e-06,"C":-1.51917325386108e-08,"D":0.97505503567146,"E":-0.000212205471797233,"F":1.16159014701225,"H":1.11901816622906e-05,"I":-1.0582954120264e-06,"J":5.45381290814606e-05,"K":-0.00200934057949098,"L":0.996403833195998,"M":0.154693662754653},{"A":8.52043894994381e-07,"B":5.00351538201826e-06,"C":8.59046807022423e-08,"D":1.00024180792428,"E":-0.000504147543466615,"F":-0.0310776483020163,"H":1.1212804020666e-05,"I":-1.05832860275434e-06,"J":5.4538158239581e-05,"K":-0.0020583855924059,"L":0.996404149404228,"M":0.158987528795478},{"A":-0.000133847262461906,"B":-7.0509040273059e-07,"C":1.18143290372963e-07,"D":1.02626328281258,"E":4.32570571717861e-05,"F":-1.28807075925579,"H":1.1216464584185e-05,"I":-1.05811636025299e-06,"J":5.45381843207737e-05,"K":-0.00210395178768863,"L":0.996404441938004,"M":0.163211730367948},{"A":0.0001129850716306,"B":-2.60863600853867e-06,"C":-9.64123116897753e-08,"D":0.97731909049088,"E":0.000238508675664662,"F":1.13777754846706,"H":1.11961861357091e-05,"I":-1.05825305413143e-06,"J":5.45382063396604e-05,"K":-0.00214472194461734,"L":0.996404769186455,"M":0.167285418929168},{"A":6.33785662040864e-06,"B":2.22134275418284e-08,"C":-2.40525794947821e-07,"D":0.998789442762643,"E":-2.26080706511311e-05,"F":0.056724505546299,"H":1.12373666342758e-05,"I":-1.0584839583716e-06,"J":5.45382301710973e-05,"K":-0.00219777338304539,"L":0.996405106392601,"M":0.172062292816918},{"A":-0.000102051275470361,"B":-4.88719979907515e-06,"C":-4.41538737572245e-07,"D":1.02098529561084,"E":0.000491069065901684,"F":-1.08005996376232,"H":1.15273155850693e-05,"I":-1.05856885634914e-06,"J":5.45382506288994e-05,"K":-0.00230259093423513,"L":0.996405429543586,"M":0.17962124737187},{"A":0.000163493454066188,"B":-5.07949901473737e-06,"C":-8.25449979369175e-07,"D":0.965097223675116,"E":0.000528490665203663,"F":1.85997634577507,"H":1.15722400982343e-05,"I":-1.05880839235128e-06,"J":5.45382723715626e-05,"K":-0.00236028777194974,"L":0.996405769902132,"M":0.18502295210601},{"A":6.37830262726347e-05,"B":-1.47490082813562e-07,"C":-1.03688626174048e-06,"D":0.986296787133824,"E":9.52571127754709e-06,"F":0.732688706426416,"H":1.12131569034446e-05,"I":-1.05916351800239e-06,"J":5.45382983608844e-05,"K":-0.00232847347582776,"L":0.996406123112699,"M":0.185568676122784},{"A":-5.16478673227017e-05,"B":-2.75158101192829e-06,"C":-1.1872215437414e-06,"D":1.01126215584947,"E":0.000298336499213292,"F":-0.617568511337595,"H":1.11931834803625e-05,"I":-1.0592237631446e-06,"J":5.4538323838893e-05,"K":-0.00236883767966845,"L":0.996406445200321,"M":0.190044492343077},{"A":0.000195354521167923,"B":-1.18799446591211e-06,"C":-1.41724794078257e-06,"D":0.956253031132974,"E":0.000132604183420426,"F":2.44468864930968,"H":1.1163980103035e-05,"I":-1.05950891754469e-06,"J":5.4538348380595e-05,"K":-0.00240700441287345,"L":0.996406792934195,"M":0.194479617659454},{"A":6.98697702687934e-05,"B":4.56498657896987e-06,"C":-1.40936128101288e-06,"D":0.984449830730796,"E":-0.000522167340193391,"F":0.860448445098882,"H":1.11858878148463e-05,"I":-1.05973600306175e-06,"J":5.4538377952551e-05,"K":-0.0024565702251067,"L":0.996407134519345,"M":0.199639679678512},{"A":-7.1896992371201e-05,"B":1.6575730161783e-06,"C":-1.32714170919535e-06,"D":1.01686512792253,"E":-0.00019711352697982,"F":-0.992696635163156,"H":1.11903251631684e-05,"I":-1.05959226259777e-06,"J":5.45384071979904e-05,"K":-0.00250232936863881,"L":0.996407433848475,"M":0.204682134331051},{"A":0.000155454850174763,"B":1.93471819520674e-06,"C":-1.3656056279121e-06,"D":0.963526252368808,"E":-0.000233499134793647,"F":2.13547109028877,"H":1.11671203479879e-05,"I":-1.0596656562778e-06,"J":5.45384348079603e-05,"K":-0.00254158910342994,"L":0.996407758545459,"M":0.209431970787591},{"A":2.15003157877369e-05,"B":5.80789494408762e-06,"C":-1.2469898611478e-06,"D":0.995298475884852,"E":-0.000705929904938785,"F":0.251294297770073,"H":1.11887238531949e-05,"I":-1.05972380837205e-06,"J":5.4538465864562e-05,"K":-0.00259138747640009,"L":0.996408081266509,"M":0.214890884230954},{"A":-0.000115110947866537,"B":9.45938526175638e-07,"C":-1.15225331431823e-06,"D":1.02822376265328,"E":-0.000127770778817649,"F":-1.73277692772535,"H":1.11899579677832e-05,"I":-1.05949034945318e-06,"J":5.4538494921319e-05,"K":-0.00263645755448749,"L":0.996408368758026,"M":0.220165093460309},{"A":0.000129148452326255,"B":-2.53664952598598e-07,"C":-1.26569625713557e-06,"D":0.968041617446772,"E":2.03552378366112e-05,"F":1.97389922473667,"H":1.11627988774732e-05,"I":-1.05956559559584e-06,"J":5.45385207089688e-05,"K":-0.00267448179866392,"L":0.99640869416244,"M":0.225091723336845},{"A":1.90274819318326e-05,"B":3.00171313094566e-06,"C":-1.27561325280467e-06,"D":0.995481513335108,"E":-0.000390264937095708,"F":0.264224272890715,"H":1.11812830507207e-05,"I":-1.05970501401709e-06,"J":5.45385492132788e-05,"K":-0.0027237552391739,"L":0.996409027650429,"M":0.230800898132657},{"A":-9.3613520635305e-05,"B":-1.45111622718019e-06,"C":-1.31463996932979e-06,"D":1.02394701932167,"E":0.000173272032839122,"F":-1.53446650744809,"H":1.11814862093773e-05,"I":-1.059598757569e-06,"J":5.45385756540728e-05,"K":-0.00276855686733768,"L":0.996409330383585,"M":0.236326218358045},{"A":0.00016790406753886,"B":-1.36926713234509e-06,"C":-1.51845167839504e-06,"D":0.956344987142529,"E":0.000168818035490403,"F":2.83387246496568,"H":1.1155621268133e-05,"I":-1.05980052278465e-06,"J":5.45385999313197e-05,"K":-0.00280655798542284,"L":0.99640967316833,"M":0.241497548765437},{"A":6.38850550478409e-05,"B":3.67407899259931e-06,"C":-1.54037675859087e-06,"D":0.983456673760088,"E":-0.000494825311989189,"F":1.06697332831391,"H":1.11775720158525e-05,"I":-1.0600227736135e-06,"J":5.45386284431792e-05,"K":-0.00285693084852312,"L":0.996410018942598,"M":0.247558525368731},{"A":-5.61585265561604e-05,"B":9.82231807000744e-07,"C":-1.50037014523541e-06,"D":1.01519221332512,"E":-0.000143606071844715,"F":-1.03068801788322,"H":1.11823622382934e-05,"I":-1.05992294485713e-06,"J":5.45386567035178e-05,"K":-0.00290293472440339,"L":0.996410322323143,"M":0.253431114029809},{"A":0.000186695643676016,"B":2.25618982119258e-06,"C":-1.54993030410111e-06,"D":0.949455404954108,"E":-0.000318936631060751,"F":3.41749574182904,"H":1.11610827270292e-05,"I":-1.06004542566041e-06,"J":5.45386839903572e-05,"K":-0.00294186067786484,"L":0.996410655772792,"M":0.258912708530261}],[{"A":0.000120377715487452,"B":2.43710730041258e-06,"C":-2.76627485362724e-07,"D":0.981919345393095,"E":-0.000188774397514635,"F":0.676419626192001,"H":1.11824734911337e-05,"I":-1.08138841325989e-06,"J":-0.000142238548303808,"K":-0.00160441315379956,"L":1.00905908313282,"M":-0.0815012379002837},{"A":6.49214246806196e-06,"B":5.45236904492263e-06,"C":-1.71015817951314e-07,"D":0.999367496884418,"E":-0.000432640806394602,"F":0.00794780183787225,"H":1.12010419457409e-05,"I":-1.08140786786448e-06,"J":-0.000142237449223703,"K":-0.00165200524955367,"L":1.0090593870408,"M":-0.0781092907332095},{"A":-0.00010922804701452,"B":-9.42374280832325e-08,"C":-1.27503703817311e-07,"D":1.01754326719114,"E":-2.18969819343329e-06,"F":-0.705988425634132,"H":1.1200668907474e-05,"I":-1.08121433406438e-06,"J":-0.000142236352745684,"K":-0.00169677550786673,"L":1.00905967419303,"M":-0.0747326965201864},{"A":0.000158235046288646,"B":-5.84551592019977e-07,"C":-2.92393504741639e-07,"D":0.974099402992749,"E":4.12065503496706e-05,"F":1.05777237402981,"H":1.11731628055223e-05,"I":-1.08136818655069e-06,"J":-0.000142235258484114,"K":-0.00173706774694438,"L":1.00905998954362,"M":-0.071451173364494},{"A":5.23207723195362e-05,"B":4.3647369167843e-06,"C":-2.89197995440027e-07,"D":0.991531653001118,"E":-0.000374533595504545,"F":0.340237650707422,"H":1.11949913057519e-05,"I":-1.08154577094233e-06,"J":-0.000142234160736943,"K":-0.00178538310204601,"L":1.0090603070615,"M":-0.0677539347252605},{"A":-6.92612939430237e-05,"B":8.009874243875e-07,"C":-2.49453006473388e-07,"D":1.01203111373329,"E":-7.90224864886113e-05,"F":-0.524053343669948,"H":1.11993467264981e-05,"I":-1.08142907101483e-06,"J":-0.000142233064009234,"K":-0.00183092187964462,"L":1.00906059993527,"M":-0.0640771892267367},{"A":0.000180645986869621,"B":1.75045371841875e-06,"C":-3.32237642175492e-07,"D":0.968387524441312,"E":-0.000163235447530496,"F":1.3811062225468,"H":1.11767413937258e-05,"I":-1.08156763917178e-06,"J":-0.000142231968451922,"K":-0.0018717233416794,"L":1.00906091508991,"M":-0.0605189797879575},{"A":5.03630616819351e-05,"B":7.17864854582473e-06,"C":-1.9855459865159e-07,"D":0.991412818775245,"E":-0.000659745707139336,"F":0.363658146619855,"H":1.12023153100993e-05,"I":-1.08165443835073e-06,"J":-0.000142230868656779,"K":-0.00192097372057276,"L":1.00906122556689,"M":-0.0565008398489226},{"A":-9.56651771311101e-05,"B":2.95986719445196e-06,"C":-3.2757872081568e-08,"D":1.01783970794497,"E":-0.000291428835879515,"F":-0.832066986866266,"H":1.12083415600983e-05,"I":-1.0814106551349e-06,"J":-0.000142229770152047,"K":-0.00196689188564392,"L":1.00906150594289,"M":-0.0525348021774334},{"A":0.000136787819538631,"B":2.29963136866296e-06,"C":-4.63945586393066e-08,"D":0.974494082278824,"E":-0.000236127951438903,"F":1.18837567317132,"H":1.11851570768762e-05,"I":-1.08143674437677e-06,"J":-0.000142228673928435,"K":-0.00200734605896002,"L":1.00906181113869,"M":-0.0487347010348458},{"A":8.71158116755311e-07,"B":5.57294037228928e-06,"C":6.21406616163611e-08,"D":1.00021950720651,"E":-0.000558833778370627,"F":-0.0290879258991481,"H":1.12084645275679e-05,"I":-1.08147232491529e-06,"J":-0.000142227575149811,"K":-0.00205650234480004,"L":1.0090621170132,"M":-0.0444378248457724},{"A":-0.000136782319796858,"B":-7.33315961509717e-07,"C":9.59813346579352e-08,"D":1.02683892689356,"E":4.5888868385191e-05,"F":-1.31626762011365,"H":1.12123683405629e-05,"I":-1.08127452735918e-06,"J":-0.000142226479351804,"K":-0.00210209857050359,"L":1.0090624003758,"M":-0.0402143771798364},{"A":0.000115461746148293,"B":-2.8358977599563e-06,"C":-1.38059638388199e-07,"D":0.976830702542884,"E":0.000262343125797315,"F":1.16185594920171,"H":1.11910220182976e-05,"I":-1.08145321864317e-06,"J":-0.0001422253870344,"K":-0.00214263749151655,"L":1.00906272120719,"M":-0.0361544938268707},{"A":6.47721244884103e-06,"B":7.0155794729132e-08,"C":-2.9567045722878e-07,"D":0.998759068490358,"E":-2.55219941891482e-05,"F":0.0583659948824788,"H":1.12327585142236e-05,"I":-1.08174414070739e-06,"J":-0.000142224292898119,"K":-0.00219577971742524,"L":1.00906305392752,"M":-0.0313755012994079},{"A":-0.000104286335949499,"B":-5.35296215575798e-06,"C":-5.14973532483864e-07,"D":1.02146459239771,"E":0.00054264636452217,"F":-1.10575690151745,"H":1.15227553147967e-05,"I":-1.08203970494714e-06,"J":-0.000142223202081015,"K":-0.0023005821484503,"L":1.0090633883087,"M":-0.0238199934819932},{"A":0.00016707454596121,"B":-5.5653893178409e-06,"C":-9.32823566834884e-07,"D":0.964353275273652,"E":0.000585303839670814,"F":1.89853658320135,"H":1.15665883680949e-05,"I":-1.081497293276e-06,"J":-0.000142222109716705,"K":-0.00235805456306082,"L":1.00906363606968,"M":-0.0184312020519428},{"A":6.51823633166515e-05,"B":-1.17337772387316e-07,"C":-1.16354775725469e-06,"D":0.985993191980924,"E":1.2819213907278e-05,"F":0.749074724819366,"H":1.12083201952995e-05,"I":-1.08207848492636e-06,"J":-0.000142221014017729,"K":-0.00232638632195403,"L":1.00906400302739,"M":-0.0178805626919711},{"A":-5.2779627745192e-05,"B":-2.99383181134871e-06,"C":-1.32785199102869e-06,"D":1.0115184425058,"E":0.000332424103589801,"F":-0.632159469590988,"H":1.11886722618526e-05,"I":-1.08220155120575e-06,"J":-0.000142219918885966,"K":-0.00236680087064656,"L":1.00906432161089,"M":-0.0134045108479768},{"A":0.000199638395089297,"B":-1.2668024385043e-06,"C":-1.57871986550262e-06,"D":0.955295670550925,"E":0.00015020570674551,"F":2.49805920641666,"H":1.11585658871816e-05,"I":-1.08253008018755e-06,"J":-0.000142218824455864,"K":-0.00240474584641959,"L":1.00906466383643,"M":-0.00898426091680449},{"A":7.14047775840498e-05,"B":5.08845848368189e-06,"C":-1.57143789336622e-06,"D":0.984082731220781,"E":-0.000573021814716412,"F":0.882231969553686,"H":1.11812618995843e-05,"I":-1.08277328436657e-06,"J":-0.000142217725326133,"K":-0.00245446905888969,"L":1.00906499694167,"M":-0.00381786446359911},{"A":-7.34745611308263e-05,"B":1.87677395224739e-06,"C":-1.48332451166411e-06,"D":1.0172236502026,"E":-0.000214100011646678,"F":-1.01316713535198,"H":1.11861049294504e-05,"I":-1.08263548276311e-06,"J":-0.000142216626837777,"K":-0.00250030371172727,"L":1.00906528666221,"M":0.00122652253412525},{"A":0.000158866973482663,"B":2.18289943432204e-06,"C":-1.5262606289923e-06,"D":0.962712737017114,"E":-0.000254057568213284,"F":2.18383957487094,"H":1.11620120247791e-05,"I":-1.08271906257285e-06,"J":-0.000142215529709389,"K":-0.00253933662705208,"L":1.00906560224752,"M":0.00596059107192559},{"A":2.19730928923134e-05,"B":6.4615631860665e-06,"C":-1.39876019922269e-06,"D":0.995163697252281,"E":-0.000776205834199573,"F":0.260553706655628,"H":1.11843487515251e-05,"I":-1.08277415400426e-06,"J":-0.000142214429436238,"K":-0.00258929051759083,"L":1.00906591430004,"M":0.0114262438291917},{"A":-0.0001176363498121,"B":1.09055093089339e-06,"C":-1.29703173246121e-06,"D":1.02883484062505,"E":-0.000137703067423445,"F":-1.76983802850737,"H":1.11858763583994e-05,"I":-1.08253932140645e-06,"J":-0.000142213331255747,"K":-0.00263441490363903,"L":1.00906619131183,"M":0.0167013406962724},{"A":0.000131981360391054,"B":-2.3444557117891e-07,"C":-1.42132277392015e-06,"D":0.96733811250806,"E":2.63742367110353e-05,"F":2.01746456031469,"H":1.11576937480984e-05,"I":-1.08262701348227e-06,"J":-0.000142212235851646,"K":-0.00267216861379893,"L":1.00906650791806,"M":0.0216087945218533},{"A":1.94455486903777e-05,"B":3.36156630131867e-06,"C":-1.43332080226877e-06,"D":0.995364245273606,"E":-0.000427066534712139,"F":0.272250859554333,"H":1.11767875163316e-05,"I":-1.08277141741553e-06,"J":-0.000142211137808879,"K":-0.00272157501360937,"L":1.00906683170624,"M":0.0273236788598297},{"A":-9.56665807101409e-05,"B":-1.55739706464431e-06,"C":-1.47677795925283e-06,"D":1.02447552430556,"E":0.000195693098362426,"F":-1.56859327945858,"H":1.11772083035699e-05,"I":-1.08267317566746e-06,"J":-0.000142210041879198,"K":-0.0027664142574082,"L":1.00906712514593,"M":0.0328488801333151},{"A":0.000171585918621098,"B":-1.46675892898074e-06,"C":-1.69917109293927e-06,"D":0.955390516177204,"E":0.000191497457535661,"F":2.89559402376472,"H":1.11503112263378e-05,"I":-1.08289352124258e-06,"J":-0.000142208947694678,"K":-0.00280412931090268,"L":1.00906746002087,"M":0.0379990965757315},{"A":6.52883364598011e-05,"B":4.1043703107313e-06,"C":-1.72424488154022e-06,"D":0.983072067071589,"E":-0.000541410105711293,"F":1.09315156780212,"H":1.1172930700909e-05,"I":-1.08312077801154e-06,"J":-0.000142207849680664,"K":-0.00285465718252453,"L":1.00906779617438,"M":0.0440675170320901},{"A":-5.7390364147647e-05,"B":1.13065508267063e-06,"C":-1.68194622984785e-06,"D":1.01551714605364,"E":-0.000153431106696189,"F":-1.05224586043914,"H":1.11780494906899e-05,"I":-1.08302141416106e-06,"J":-0.000142206752112906,"K":-0.00290073061994178,"L":1.00906808934802,"M":0.049942157786063},{"A":0.000190793941740264,"B":2.53828489027441e-06,"C":-1.73694670579927e-06,"D":0.948331349293483,"E":-0.000346888457272598,"F":3.49442206992535,"H":1.11558674529832e-05,"I":-1.08314843549895e-06,"J":-0.000142205655292937,"K":-0.00293939362950368,"L":1.00906841313476,"M":0.0554033160569816}],[{"A":0.000123233396772671,"B":2.73192483291052e-06,"C":-3.30678541216045e-07,"D":0.981474934160701,"E":-0.000209083620617889,"F":0.69369070013272,"H":1.11743017712218e-05,"I":-1.06593261128829e-06,"J":-2.19924413873973e-05,"K":-0.00160339377701746,"L":1.00082813920955,"M":0.0595169706166416},{"A":6.64669275829421e-06,"B":6.05996799118991e-06,"C":-2.15595727937057e-07,"D":0.999322313393805,"E":-0.000478575834108597,"F":0.0105337472341489,"H":1.11935043191069e-05,"I":-1.065931596822e-06,"J":-2.19919855891648e-05,"K":-0.00165105272870392,"L":1.00082844639504,"M":0.0629102808961761},{"A":-0.000111816838420098,"B":-6.13416806238831e-08,"C":-1.69064666044605e-07,"D":1.01795583787268,"E":-3.57806405304473e-06,"F":-0.722419181583973,"H":1.1193332094761e-05,"I":-1.06575422503807e-06,"J":-2.19915325434528e-05,"K":-0.00169582457165518,"L":1.00082873968186,"M":0.0662857216957491},{"A":0.000161985592203262,"B":-6.02903488022832e-07,"C":-3.52779672585513e-07,"D":0.973484642854118,"E":4.52342917753867e-05,"F":1.08294680949439,"H":1.11646946970856e-05,"I":-1.06591828397118e-06,"J":-2.19910818471947e-05,"K":-0.00173590159980108,"L":1.00082906074154,"M":0.0695572084405285},{"A":5.35628964829504e-05,"B":4.85950339079722e-06,"C":-3.50848639918411e-07,"D":0.991305775616695,"E":-0.000413476914815192,"F":0.35042878904278,"H":1.11872138519042e-05,"I":-1.0660757495673e-06,"J":-2.1990627290247e-05,"K":-0.0017842996766575,"L":1.00082938145264,"M":0.0732565294974847},{"A":-7.0903115793497e-05,"B":9.26575887127967e-07,"C":-3.08485054167917e-07,"D":1.01230875487903,"E":-8.73897605231377e-05,"F":-0.535801518048174,"H":1.11918855050241e-05,"I":-1.06596831250805e-06,"J":-2.19901739913486e-05,"K":-0.00182986151861542,"L":1.00082967998876,"M":0.0769329248932991},{"A":0.00018493043955381,"B":1.97413878821884e-06,"C":-4.01512967318496e-07,"D":0.967625582900837,"E":-0.000179788240700418,"F":1.41495045534248,"H":1.11682875595376e-05,"I":-1.06610556360742e-06,"J":-2.19897217477172e-05,"K":-0.00187045845018474,"L":1.00082999990116,"M":0.0804808264992971},{"A":5.15596732415524e-05,"B":7.96521423929164e-06,"C":-2.55439382534917e-07,"D":0.991170309587375,"E":-0.000728238656051872,"F":0.375778642837759,"H":1.11946750240843e-05,"I":-1.06616025080664e-06,"J":-2.1989265129585e-05,"K":-0.00191982239283561,"L":1.00083031237121,"M":0.0845026049046282},{"A":-9.79343241898079e-05,"B":3.30915699731094e-06,"C":-7.38260197419294e-08,"D":1.01824484822191,"E":-0.000322348285692442,"F":-0.850126920751791,"H":1.12010881841984e-05,"I":-1.0659173252936e-06,"J":-2.19888100579935e-05,"K":-0.0019657812583489,"L":1.00083059767201,"M":0.088469117553359},{"A":0.00014003264183815,"B":2.58044644052546e-06,"C":-9.04585730765461e-08,"D":0.973874207630246,"E":-0.000261106965467661,"F":1.21797429724575,"H":1.11769089982117e-05,"I":-1.06594014426253e-06,"J":-2.19883571785928e-05,"K":-0.00200601955009461,"L":1.00083090739916,"M":0.0922577186420313},{"A":8.92285215270405e-07,"B":6.19304518600927e-06,"C":2.78538556663932e-08,"D":1.00019394717654,"E":-0.000617605290642587,"F":-0.0268150355004764,"H":1.12009526368473e-05,"I":-1.06594887333555e-06,"J":-2.19879015647129e-05,"K":-0.00205528502095831,"L":1.00083121553669,"M":0.0965582996541343},{"A":-0.000140023677460688,"B":-7.66899191706472e-07,"C":6.37040766804375e-08,"D":1.02747482315033,"E":4.97905233487472e-05,"F":-1.34743782095757,"H":1.12051098111188e-05,"I":-1.06576267733249e-06,"J":-2.19874491150795e-05,"K":-0.00210090063448831,"L":1.00083150484687,"M":0.100781220167846},{"A":0.000118196843700957,"B":-3.08723387942855e-06,"C":-1.96386253703551e-07,"D":0.976291903275865,"E":0.000289855427695329,"F":1.1883705349901,"H":1.11826165446471e-05,"I":-1.06594905013857e-06,"J":-2.19870003132505e-05,"K":-0.00214118095109939,"L":1.00083183129661,"M":0.104826716742537},{"A":6.63113164733886e-06,"B":1.19851806257287e-07,"C":-3.72076424004497e-07,"D":0.998725558492993,"E":-2.69772066303631e-05,"F":0.0601480336117675,"H":1.12249448644963e-05,"I":-1.06621187967448e-06,"J":-2.198654943808e-05,"K":-0.002194411198019,"L":1.00083216604877,"M":0.109608536600717},{"A":-0.000106754503081063,"B":-5.86506153821276e-06,"C":-6.15841117990179e-07,"D":1.02199486597755,"E":0.000601173939912769,"F":-1.13427140096974,"H":1.15149108122492e-05,"I":-1.06643414887753e-06,"J":-2.19861019352674e-05,"K":-0.00229917861483386,"L":1.00083249776232,"M":0.117160738582243},{"A":0.000171029164134584,"B":-6.09965895259634e-06,"C":-1.07897350887232e-06,"D":0.963532758469967,"E":0.000650286463951488,"F":1.94096097997317,"H":1.15575565518e-05,"I":-1.06640329722296e-06,"J":-2.19856528272944e-05,"K":-0.00235635050539429,"L":1.0008328042103,"M":0.122531035049178},{"A":6.67277717094628e-05,"B":-8.71477841002388e-08,"C":-1.33547748037977e-06,"D":0.985657978095787,"E":1.96707929660533e-05,"F":0.767106571460317,"H":1.1200266463951e-05,"I":-1.0668535292413e-06,"J":-2.19852006380084e-05,"K":-0.00232486176192026,"L":1.00083316219214,"M":0.123089651920964},{"A":-5.4029453182558e-05,"B":-3.26148647511459e-06,"C":-1.51849458585041e-06,"D":1.01180203945614,"E":0.000373247657933007,"F":-0.648398452467518,"H":1.11809704338994e-05,"I":-1.06697148433144e-06,"J":-2.19847492050063e-05,"K":-0.0023653218009656,"L":1.00083348525723,"M":0.127566450139966},{"A":0.000204369340418786,"B":-1.35592610694957e-06,"C":-1.79721341186934e-06,"D":0.954238675738452,"E":0.000173466083566609,"F":2.55689713930769,"H":1.11499012116489e-05,"I":-1.06729560372942e-06,"J":-2.19842982341345e-05,"K":-0.00240302039715345,"L":1.00083383204215,"M":0.131971183215683},{"A":7.31001212033178e-05,"B":5.65822651132919e-06,"C":-1.7908467835337e-06,"D":0.983676447094354,"E":-0.000624626277726748,"F":0.906314835436206,"H":1.11734480023884e-05,"I":-1.06750697664859e-06,"J":-2.19838424526109e-05,"K":-0.00245290385925045,"L":1.00083416659858,"M":0.13714479320879},{"A":-7.52168113167251e-05,"B":2.11385756632154e-06,"C":-1.69501836233543e-06,"D":1.01761931781687,"E":-0.000228781257305855,"F":-1.03581149706588,"H":1.11787225985371e-05,"I":-1.06736961075216e-06,"J":-2.19833874613995e-05,"K":-0.00249880745117537,"L":1.00083446141772,"M":0.142191369602187},{"A":0.000162635348635032,"B":2.45146351773862e-06,"C":-1.7440261679269e-06,"D":0.961813955629395,"E":-0.000272514447487993,"F":2.23722542080577,"H":1.1153679757625e-05,"I":-1.06744845723705e-06,"J":-2.19829337975153e-05,"K":-0.00253758679127714,"L":1.00083478149455,"M":0.146908741427978},{"A":2.24952726071148e-05,"B":7.17379690984288e-06,"C":-1.60481873012763e-06,"D":0.995013753590229,"E":-0.000849230560447722,"F":0.270842476806138,"H":1.11768057187711e-05,"I":-1.0674753955775e-06,"J":-2.19824767624943e-05,"K":-0.00258769762004363,"L":1.0008350952148,"M":0.152381863113987},{"A":-0.000120425359765086,"B":1.24608667206871e-06,"C":-1.49391659243214e-06,"D":1.02950956114637,"E":-0.000144866344498951,"F":-1.8108154259462,"H":1.11786425839311e-05,"I":-1.06725040677214e-06,"J":-2.19820220375144e-05,"K":-0.0026328671031024,"L":1.0008353784379,"M":0.157657858482708},{"A":0.000135109957390744,"B":-2.16289085308574e-07,"C":-1.63276543396762e-06,"D":0.966561272506169,"E":3.69231416357252e-05,"F":2.06549554951562,"H":1.11493633668802e-05,"I":-1.06734662058683e-06,"J":-2.19815700815973e-05,"K":-0.00267031965880449,"L":1.00083570112194,"M":0.162544829388935},{"A":1.99072863968919e-05,"B":3.75241046635111e-06,"C":-1.64764776489079e-06,"D":0.995234189374514,"E":-0.000463311333874117,"F":0.281112867985939,"H":1.11691133275471e-05,"I":-1.06747649442074e-06,"J":-2.19811153938654e-05,"K":-0.00271985851567536,"L":1.00083602812398,"M":0.168265987373161},{"A":-9.79338688833487e-05,"B":-1.67628777969497e-06,"C":-1.69712912345688e-06,"D":1.02505949798319,"E":0.000224315900993588,"F":-1.60639498478122,"H":1.1169762382468e-05,"I":-1.06739821575941e-06,"J":-2.19806628798391e-05,"K":-0.00276472496739189,"L":1.00083632913953,"M":0.173790930584801},{"A":0.00017565200472891,"B":-1.57631784514223e-06,"C":-1.94436837119838e-06,"D":0.95433674928438,"E":0.000220835203833758,"F":2.96363567501248,"H":1.11417606732389e-05,"I":-1.06763025764511e-06,"J":-2.19802122045643e-05,"K":-0.00280212263847091,"L":1.00083667059521,"M":0.1789185540365},{"A":6.68381778312632e-05,"B":4.57220760474719e-06,"C":-1.97374269217399e-06,"D":0.982646624286758,"E":-0.000587769594631027,"F":1.12207000404305,"H":1.11651012991709e-05,"I":-1.06783843112357e-06,"J":-2.19797573699498e-05,"K":-0.00285280720973446,"L":1.00083700930834,"M":0.184995094605256},{"A":-5.87507773208706e-05,"B":1.29031765849774e-06,"C":-1.92852147606892e-06,"D":1.01587584487589,"E":-0.000159633278599358,"F":-1.07611502465443,"H":1.11705688286001e-05,"I":-1.06774731106762e-06,"J":-2.19793033188198e-05,"K":-0.00289894258685308,"L":1.0008373086571,"M":0.19087177291658},{"A":0.000195320150445433,"B":2.84387814586395e-06,"C":-1.99087978480783e-06,"D":0.947089538971625,"E":-0.000372754321233515,"F":3.57934988618945,"H":1.1147421934754e-05,"I":-1.06787056908253e-06,"J":-2.19788497833884e-05,"K":-0.00293731331586855,"L":1.00083763699996,"M":0.196311023773887}],[{"A":0.000126386140154588,"B":3.05646824516614e-06,"C":-3.95733861902059e-07,"D":0.980983708582926,"E":-0.000230687624394932,"F":0.712786651520219,"H":1.11744089307253e-05,"I":-1.05206556544335e-06,"J":0.000105739763174295,"K":-0.0016035919101256,"L":0.991831582968231,"M":0.218075418058106},{"A":6.81734777807641e-06,"B":6.73223664593436e-06,"C":-2.69249788797943e-07,"D":0.999271063353603,"E":-0.000528766095584388,"F":0.0134815792225709,"H":1.1194315773233e-05,"I":-1.05203973138623e-06,"J":0.000105739534202121,"K":-0.001651361959631,"L":0.991831899490705,"M":0.221472947265283},{"A":-0.000114674798155079,"B":-2.78935468056574e-08,"C":-2.18983181365928e-07,"D":1.01841136966283,"E":-4.28613378744558e-06,"F":-0.740575976777109,"H":1.11943535578973e-05,"I":-1.05187722354572e-06,"J":0.000105739302338537,"K":-0.00169617026730862,"L":0.991832205198548,"M":0.224849798683863},{"A":0.000166126117269627,"B":-6.26486632571144e-07,"C":-4.2493228957774e-07,"D":0.972806153592273,"E":5.07339916566707e-05,"F":1.11070579346415,"H":1.11644705880209e-05,"I":-1.05205793810015e-06,"J":0.000105739068137267,"K":-0.00173604654403903,"L":0.991832538874817,"M":0.228113034999296},{"A":5.493428186365e-05,"B":5.40632778656125e-06,"C":-4.24363392093063e-07,"D":0.991055311757094,"E":-0.000455737349710716,"F":0.361753847591899,"H":1.11877599631161e-05,"I":-1.05219500801113e-06,"J":0.000105738837917202,"K":-0.00178457371764296,"L":0.99183286916427,"M":0.231817604566459},{"A":-7.27156598605561e-05,"B":1.06305628477799e-06,"C":-3.78740744766404e-07,"D":1.01261510024418,"E":-9.5695066704593e-05,"F":-0.548773546099255,"H":1.11927724130156e-05,"I":-1.05209565331998e-06,"J":0.000105738606393957,"K":-0.00183019616423508,"L":0.991833179656197,"M":0.235496528784097},{"A":0.000189660530808489,"B":2.21957861290534e-06,"C":-4.83801693151875e-07,"D":0.966783982462573,"E":-0.000197087991040235,"F":1.45233177068803,"H":1.11680844491202e-05,"I":-1.05223486518424e-06,"J":0.000105738373756104,"K":-0.00187060470426559,"L":0.991833511020275,"M":0.239036128452426},{"A":5.28808595803287e-05,"B":8.83642190485645e-06,"C":-3.22857617973682e-07,"D":0.99090074933568,"E":-0.000803407780608723,"F":0.389307758550785,"H":1.11953783735741e-05,"I":-1.05225177643442e-06,"J":0.000105738145746159,"K":-0.00192013218351406,"L":0.991833831376766,"M":0.243065121672771},{"A":-0.000100439504069572,"B":3.69430398183823e-06,"C":-1.22295882976076e-07,"D":1.01869140934943,"E":-0.000355912958411864,"F":-0.870010330043442,"H":1.12022092451092e-05,"I":-1.0520034179895e-06,"J":0.000105737916053728,"K":-0.00196617101212837,"L":0.991834127408467,"M":0.247035292880355},{"A":0.000143614997497821,"B":2.88941863590964e-06,"C":-1.42345628617591e-07,"D":0.973189302746533,"E":-0.000288037377600858,"F":1.25069164768502,"H":1.11769356367919e-05,"I":-1.05202350486611e-06,"J":0.000105737684204521,"K":-0.00200620813917851,"L":0.99183444809357,"M":0.250814492141217},{"A":9.15632208275952e-07,"B":6.87921755893051e-06,"C":-1.22675753999602e-08,"D":1.00016433084164,"E":-0.000682204582346913,"F":-0.0241808833816322,"H":1.12017978430856e-05,"I":-1.05200051347953e-06,"J":0.000105737455165567,"K":-0.00205563191448732,"L":0.991834764411308,"M":0.255122566542923},{"A":-0.000143602028265244,"B":-8.07336430597161e-07,"C":2.61172617976868e-08,"D":1.02817706052474,"E":5.48315183550585e-05,"F":-1.38187950983411,"H":1.12062243485256e-05,"I":-1.05182458315367e-06,"J":0.000105737222698576,"K":-0.00210130351317162,"L":0.991835065920355,"M":0.259348224712085},{"A":0.000121216248722522,"B":-3.36977758808032e-06,"C":-2.64794224880127e-07,"D":0.97569786850562,"E":0.00032140058033292,"F":1.21754914046687,"H":1.1182471884752e-05,"I":-1.05202686090378e-06,"J":0.000105736986605209,"K":-0.0021413359596778,"L":0.991835405180851,"M":0.263381363095505},{"A":6.80107728268098e-06,"B":1.71950949034994e-07,"C":-4.61833617904084e-07,"D":0.998688582902105,"E":-2.74591701554527e-05,"F":0.0620937274979951,"H":1.12254770910925e-05,"I":-1.05226594016017e-06,"J":0.000105736752786467,"K":-0.00219470448435288,"L":0.991835748797129,"M":0.268170084802478},{"A":-0.000109479105785848,"B":-6.43734196659196e-06,"C":-7.34529330914668e-07,"D":1.02258165038148,"E":0.000667594661308613,"F":-1.16592149311327,"H":1.15156348303169e-05,"I":-1.05241729542183e-06,"J":0.000105736515221277,"K":-0.00229951654614524,"L":0.991836084520941,"M":0.275724687840921},{"A":0.00017539469118244,"B":-6.69676022369003e-06,"C":-1.25134522188652e-06,"D":0.962628461419115,"E":0.000724344694333467,"F":1.98759975959547,"H":1.15570319431102e-05,"I":-1.05294588115257e-06,"J":0.000105736279568447,"K":-0.00235640699250439,"L":0.99183646112661,"M":0.281079031476111},{"A":6.84338951453256e-05,"B":-5.67839955056826e-08,"C":-1.53835591643059e-06,"D":0.985287976702352,"E":2.93605346541881e-05,"F":0.786961941026675,"H":1.12005192831055e-05,"I":-1.05326547317208e-06,"J":0.000105736046565663,"K":-0.00232508856581148,"L":0.991836816651954,"M":0.281646803482545},{"A":-5.5409166713094e-05,"B":-3.56207956375698e-06,"C":-1.74347031700606e-06,"D":1.0121159191217,"E":0.000420867403363445,"F":-0.666462655724899,"H":1.1181584195108e-05,"I":-1.0533833694204e-06,"J":0.000105735812956476,"K":-0.00236562912269278,"L":0.991837151222924,"M":0.286127920579929},{"A":0.00020959215530425,"B":-1.4583429068793e-06,"C":-2.05515471840556e-06,"D":0.95307216001595,"E":0.000201865084306974,"F":2.62175499933073,"H":1.11494519347555e-05,"I":-1.05371196179593e-06,"J":0.000105735578930344,"K":-0.00240309184857779,"L":0.991837510057181,"M":0.290519398806282},{"A":7.49718990977755e-05,"B":6.28836441274316e-06,"C":-2.04974076334352e-06,"D":0.98322661578527,"E":-0.000679456139266676,"F":0.932992624417238,"H":1.11739442676395e-05,"I":-1.05389079269047e-06,"J":0.000105735349906877,"K":-0.00245319009492562,"L":0.991837852490946,"M":0.295705035247011},{"A":-7.71402564541113e-05,"B":2.37433061123227e-06,"C":-1.94459238356259e-06,"D":1.01805569099429,"E":-0.000242665019356991,"F":-1.0608127823798,"H":1.11796851546275e-05,"I":-1.05375052816825e-06,"J":0.000105735120070172,"K":-0.0024992040269467,"L":0.991838158520281,"M":0.300757965043886},{"A":0.000166795709029444,"B":2.74667999944356e-06,"C":-2.00067446676222e-06,"D":0.960821167629547,"E":-0.00029050991031454,"F":2.29617049123772,"H":1.11535963623899e-05,"I":-1.05382593618142e-06,"J":0.000105734888803832,"K":-0.0025377404754181,"L":0.991838489743316,"M":0.305461065298005},{"A":2.30718194584867e-05,"B":7.96236271627393e-06,"C":-1.84741184150461e-06,"D":0.994846579049636,"E":-0.000928022887592306,"F":0.282345228137274,"H":1.1177598765455e-05,"I":-1.05381952958394e-06,"J":0.000105734661113799,"K":-0.00258806238915099,"L":0.991838811014759,"M":0.310946724915993},{"A":-0.000123504406820629,"B":1.4159541885661e-06,"C":-1.72545374077515e-06,"D":1.03025420503479,"E":-0.000150557961660525,"F":-1.85607354811145,"H":1.11797645021006e-05,"I":-1.05360066926519e-06,"J":0.000105734430941584,"K":-0.00263331520960719,"L":0.99183910648884,"M":0.316227821709617},{"A":0.000138563881350029,"B":-1.99388873411976e-07,"C":-1.8814626456809e-06,"D":0.965703757935444,"E":5.10916780740445e-05,"F":2.11845542666561,"H":1.11492758141374e-05,"I":-1.05371012193434e-06,"J":0.000105734197968776,"K":-0.00267047187132619,"L":0.991839442324988,"M":0.321096524501627},{"A":2.04170796620495e-05,"B":4.1837063218253e-06,"C":-1.8996342272537e-06,"D":0.995089775472877,"E":-0.000501148415423813,"F":0.29094767778588,"H":1.11697550204681e-05,"I":-1.05382588488911e-06,"J":0.000105733967925237,"K":-0.00272019457028705,"L":0.991839779084017,"M":0.326829099381939},{"A":-0.000100436847964236,"B":-1.81146948641242e-06,"C":-1.95612704811943e-06,"D":1.02570461626385,"E":0.000258622320075119,"F":-1.64823697706015,"H":1.11706449892335e-05,"I":-1.05376955994441e-06,"J":0.000105733735430213,"K":-0.00276512462347966,"L":0.991840094439993,"M":0.33235806473931},{"A":0.000180140825210895,"B":-1.70144923217208e-06,"C":-2.23275760791175e-06,"D":0.953173850621965,"E":0.000256219638686161,"F":3.03863541714236,"H":1.11414278091693e-05,"I":-1.05402201194815e-06,"J":0.000105733501220673,"K":-0.00280220908169326,"L":0.991840450106395,"M":0.337465338026959},{"A":6.85492896361772e-05,"B":5.08902933438193e-06,"C":-2.26710802286867e-06,"D":0.982175899353592,"E":-0.0006365067648062,"F":1.15406946132862,"H":1.1165572888272e-05,"I":-1.05421201479494e-06,"J":0.000105733271383746,"K":-0.00285310520439452,"L":0.991840798021585,"M":0.343555615729201},{"A":-6.02526564066341e-05,"B":1.46472595319302e-06,"C":-2.21826438040473e-06,"D":1.01627159205316,"E":-0.000163785368158642,"F":-1.10249332337116,"H":1.1171417566791e-05,"I":-1.05412797074544e-06,"J":0.000105733040652867,"K":-0.00289934337888553,"L":0.991841109897948,"M":0.349439122119293},{"A":0.000200317194406052,"B":3.18018020761812e-06,"C":-2.28922739320403e-06,"D":0.94571794474075,"E":-0.000398652091632812,"F":3.67313210120483,"H":1.11472115070788e-05,"I":-1.05424939866872e-06,"J":0.000105732809190795,"K":-0.00293742941641995,"L":0.991841449597189,"M":0.354859070825114}],[{"A":0.000129867542524975,"B":3.41294464845099e-06,"C":-4.63068777767361e-07,"D":0.980440663731713,"E":-0.000254324825135654,"F":0.73391426082344,"H":1.11714797639273e-05,"I":-1.07345886535271e-06,"J":-9.07991461467361e-05,"K":-0.00160202473719551,"L":1.00683732404893,"M":-0.0681700987979639},{"A":7.00582614121537e-06,"B":7.47359538921799e-06,"C":-3.24640297755252e-07,"D":0.999213052480059,"E":-0.000584038265515119,"F":0.0168425989249954,"H":1.11921480259736e-05,"I":-1.07342370359031e-06,"J":-9.07983179155303e-05,"K":-0.0016499021160854,"L":1.00683761819087,"M":-0.064770143617352},{"A":-0.000117830527498253,"B":6.49582121425851e-09,"C":-2.70277621505777e-07,"D":1.01891441971358,"E":-4.80586194839816e-06,"F":-0.760632986921337,"H":1.11924069761682e-05,"I":-1.07326149778597e-06,"J":-9.07974926717681e-05,"K":-0.00169473728652747,"L":1.00683790225749,"M":-0.0613938745709675},{"A":0.000170698064348329,"B":-6.5529763770833e-07,"C":-4.98776782320576e-07,"D":0.972057159408052,"E":5.70397664603206e-05,"F":1.14133680557643,"H":1.11611820133306e-05,"I":-1.07346090860716e-06,"J":-9.07966692555995e-05,"K":-0.00173438500780776,"L":1.00683821577016,"M":-0.0581416719578556},{"A":5.64486878198434e-05,"B":6.00883048962331e-06,"C":-4.99360509387259e-07,"D":0.990777604568166,"E":-0.000502306734574631,"F":0.374349835839894,"H":1.11853053800237e-05,"I":-1.07360079693031e-06,"J":-9.07958420509614e-05,"K":-0.00178303889329356,"L":1.00683852463439,"M":-0.0544336548591673},{"A":-7.4717069989072e-05,"B":1.21146638587533e-06,"C":-4.50132253027036e-07,"D":1.01295318613717,"E":-0.000104698374286727,"F":-0.563085630108617,"H":1.11906814480589e-05,"I":-1.07350374578541e-06,"J":-9.07950164010241e-05,"K":-0.00182871407398011,"L":1.0068388136775,"M":-0.050754200479787},{"A":0.000194883649554889,"B":2.48847213946135e-06,"C":-5.67282809615932e-07,"D":0.965854231941876,"E":-0.000216070572520266,"F":1.49364294474071,"H":1.11648199866421e-05,"I":-1.0736546611767e-06,"J":-9.07941914657928e-05,"K":-0.00186890724251043,"L":1.00683912439804,"M":-0.0472257814908517},{"A":5.43398917844939e-05,"B":9.79795150257701e-06,"C":-3.90839943409382e-07,"D":0.990601196159645,"E":-0.000886431347538519,"F":0.404413523730909,"H":1.11930951161021e-05,"I":-1.07366274360032e-06,"J":-9.07933623697788e-05,"K":-0.00191859844224496,"L":1.00683942232079,"M":-0.0431913133234048},{"A":-0.000103205819034224,"B":4.11791750054569e-06,"C":-1.70578074998318e-07,"D":1.01918376640879,"E":-0.000392876359484262,"F":-0.891898792833672,"H":1.12003717763765e-05,"I":-1.07340602473194e-06,"J":-9.07925350827066e-05,"K":-0.00196471057509484,"L":1.00683969592147,"M":-0.0392194865326019},{"A":0.000147570786017015,"B":3.22865954283103e-06,"C":-1.93876899867718e-07,"D":0.972432426396551,"E":-0.000317671891366444,"F":1.28687211490615,"H":1.11739183531467e-05,"I":-1.07343446142938e-06,"J":-9.07917096661937e-05,"K":-0.00200451824804304,"L":1.00683999568768,"M":-0.0354527467006847},{"A":9.41439947332867e-07,"B":7.63596655062315e-06,"C":-5.14789955108341e-08,"D":1.00013017680459,"E":-0.000753526859455178,"F":-0.0211337014152377,"H":1.11996649897472e-05,"I":-1.07341096389213e-06,"J":-9.07908814664626e-05,"K":-0.00205409968057779,"L":1.00684029024426,"M":-0.0311389992111799},{"A":-0.000147553175147142,"B":-8.54707616682049e-07,"C":-1.02329787976529e-08,"D":1.02895268420275,"E":6.05680760941141e-05,"F":-1.41993158738478,"H":1.12043747749757e-05,"I":-1.07324972509204e-06,"J":-9.07900568392073e-05,"K":-0.00209981788681546,"L":1.00684057146768,"M":-0.0269128073168758},{"A":0.000124550155996328,"B":-3.68515023585481e-06,"C":-3.3250000663898e-07,"D":0.975042744859195,"E":0.000356409342003872,"F":1.24968716932926,"H":1.11792622127238e-05,"I":-1.07350003797357e-06,"J":-9.07892351217354e-05,"K":-0.00213956918223346,"L":1.00684089375839,"M":-0.0228954968515609},{"A":6.98875758775586e-06,"B":2.26949210313521e-07,"C":-5.51188649722256e-07,"D":0.998647763763188,"E":-2.79464467780599e-05,"F":0.0642389505592291,"H":1.12229929140062e-05,"I":-1.07380316305417e-06,"J":-9.07884112122392e-05,"K":-0.00219307038247507,"L":1.00684122216217,"M":-0.0181021006173978},{"A":-0.000112487350151902,"B":-7.07322106463515e-06,"C":-8.53289771063359e-07,"D":1.02323097173627,"E":0.000741071968974438,"F":-1.20102040805068,"H":1.15132741824731e-05,"I":-1.07417172956481e-06,"J":-9.07875909966771e-05,"K":-0.00229789006522196,"L":1.00684155866776,"M":-0.0105493501869205},{"A":0.000180214732003137,"B":-7.36031571291207e-06,"C":-1.42490836219089e-06,"D":0.961631527245345,"E":0.000806191331321315,"F":2.03892842362256,"H":1.15533072872487e-05,"I":-1.07393623027807e-06,"J":-9.0786768382034e-05,"K":-0.00235451116159879,"L":1.00684183343125,"M":-0.00520957878416084},{"A":7.03178186505227e-05,"B":-2.59010075609467e-08,"C":-1.74297788091415e-06,"D":0.984879482765223,"E":3.99045708832091e-05,"F":0.808872592242551,"H":1.11977388950191e-05,"I":-1.07448527231213e-06,"J":-9.07859441264258e-05,"K":-0.00232337292798945,"L":1.00684219198354,"M":-0.00463466628843889},{"A":-5.69325552908229e-05,"B":-3.89731939032245e-06,"C":-1.97048756600537e-06,"D":1.01246330920651,"E":0.000473320215149897,"F":-0.686506183563324,"H":1.11791964096941e-05,"I":-1.07467114207616e-06,"J":-9.07851207034849e-05,"K":-0.00236398624788592,"L":1.00684251255348,"M":-0.000151614825881552},{"A":0.000215359100083079,"B":-1.57458873895067e-06,"C":-2.3157387216699e-06,"D":0.95178448990049,"E":0.000233013974025198,"F":2.69331889699242,"H":1.11459227408739e-05,"I":-1.07504940893843e-06,"J":-9.07842973025264e-05,"K":-0.00240118183671711,"L":1.00684285551475,"M":0.00422293756855652},{"A":7.7038894575665e-05,"B":6.98300719381706e-06,"C":-2.31108506820732e-06,"D":0.982728556671418,"E":-0.000740448364126678,"F":0.962593845706579,"H":1.11714402550311e-05,"I":-1.07524427062078e-06,"J":-9.07834692649434e-05,"K":-0.00245149891864571,"L":1.00684317840997,"M":0.00941887736007629},{"A":-7.92641592031185e-05,"B":2.6600323776993e-06,"C":-2.19610198426423e-06,"D":1.01853707428484,"E":-0.000258361153498754,"F":-1.08837308752118,"H":1.11776809117448e-05,"I":-1.07510875868577e-06,"J":-9.07826425547431e-05,"K":-0.00249761868127507,"L":1.00684346366423,"M":0.0144760321982176},{"A":0.00017138974421238,"B":3.07053759263098e-06,"C":-2.25918724461316e-06,"D":0.959724352287481,"E":-0.000310747589310267,"F":2.36131592656602,"H":1.11504661077788e-05,"I":-1.07519525571753e-06,"J":-9.07818167408814e-05,"K":-0.00253588093144685,"L":1.00684377482682,"M":0.0191611292466405},{"A":2.37085270800019e-05,"B":8.83241720961436e-06,"C":-2.09127583050694e-06,"D":0.99466028270399,"E":-0.00101555754923766,"F":0.295242949883686,"H":1.11754167422262e-05,"I":-1.07518242897786e-06,"J":-9.07809876679044e-05,"K":-0.00258641801178783,"L":1.00684407397839,"M":0.0246576316294522},{"A":-0.000126904319889043,"B":1.60142985161649e-06,"C":-1.95769253408251e-06,"D":1.03107618735339,"E":-0.000157206003166266,"F":-1.90602188207413,"H":1.11779320841054e-05,"I":-1.07496076595659e-06,"J":-9.07801613078685e-05,"K":-0.00263174766661223,"L":1.00684434775478,"M":0.0299415712179325},{"A":0.000142377709349661,"B":-1.83504096362697e-07,"C":-2.13104139334952e-06,"D":0.964756989077159,"E":6.64167303625618e-05,"F":2.17691522325913,"H":1.11461396776757e-05,"I":-1.0750856632713e-06,"J":-9.07793370639176e-05,"K":-0.00266857312942648,"L":1.00684466409751,"M":0.034787926095305},{"A":2.09800454500364e-05,"B":4.65834515495089e-06,"C":-2.15235283240744e-06,"D":0.994929442290868,"E":-0.000543413579009666,"F":0.301910205933382,"H":1.11674078466795e-05,"I":-1.07520679004658e-06,"J":-9.07785100720537e-05,"K":-0.00271848181228052,"L":1.00684498015229,"M":0.0405300865822937},{"A":-0.000103200549914195,"B":-1.96359346649189e-06,"C":-2.21575430447984e-06,"D":1.02641737522742,"E":0.000296150386304816,"F":-1.69449999588687,"H":1.11685529208261e-05,"I":-1.0751609569315e-06,"J":-9.07776856673426e-05,"K":-0.00276346753736334,"L":1.00684527548654,"M":0.0460606725700927},{"A":0.000185097292937808,"B":-1.84282632265109e-06,"C":-2.52227750241474e-06,"D":0.951890229823107,"E":0.000294925915113708,"F":3.12138574410346,"H":1.11380267510119e-05,"I":-1.07543764715778e-06,"J":-9.07768625131311e-05,"K":-0.00280020237318013,"L":1.00684561292954,"M":0.051143291148037},{"A":7.04388367618325e-05,"B":5.65825305187673e-06,"C":-2.56151333855037e-06,"D":0.981655035213521,"E":-0.000690937092258537,"F":1.18953761865851,"H":1.11630432964027e-05,"I":-1.07563340379091e-06,"J":-9.07760353993647e-05,"K":-0.0028513146043565,"L":1.00684594029127,"M":0.0572455860510672},{"A":-6.19110360040587e-05,"B":1.65517327244125e-06,"C":-2.50867920237319e-06,"D":1.01670830777078,"E":-0.000168905637735861,"F":-1.1315906933014,"H":1.11692914466222e-05,"I":-1.07554995931736e-06,"J":-9.07752093606273e-05,"K":-0.00289765084124838,"L":1.00684623095067,"M":0.0631336618807836},{"A":0.000205835154348133,"B":3.54942462488239e-06,"C":-2.58822242948931e-06,"D":0.944202737297019,"E":-0.000427815833631939,"F":3.77676995013462,"H":1.11439457020079e-05,"I":-1.07567725160518e-06,"J":-9.07743835829034e-05,"K":-0.0029354181023109,"L":1.00684655011804,"M":0.0685300086861389}],[{"A":0.000133714616416425,"B":3.80657993725997e-06,"C":-5.53316722107233e-07,"D":0.979839835696538,"E":-0.000278724576901368,"F":0.757278944265636,"H":1.11651076801778e-05,"I":-1.06101874819409e-06,"J":1.71041175630604e-05,"K":-0.00160125086945584,"L":0.998153145632045,"M":0.106731149354346},{"A":7.21414234305939e-06,"B":8.29535089397204e-06,"C":-3.99345196910872e-07,"D":0.999147234155373,"E":-0.000643855606085708,"F":0.0206573020805081,"H":1.11866007236339e-05,"I":-1.06096079766083e-06,"J":1.71043615028177e-05,"K":-0.00164923223894675,"L":0.99815345040642,"M":0.110134057964387},{"A":-0.000121317526917908,"B":4.20006351919966e-08,"C":-3.39727596165851e-07,"D":1.01947033503797,"E":-3.79965325691956e-06,"F":-0.782830999960424,"H":1.11870936368996e-05,"I":-1.06081428885574e-06,"J":1.71046020901455e-05,"K":-0.00169408218994249,"L":0.998153748120245,"M":0.113509869839618},{"A":0.000175749974478223,"B":-6.90184590368403e-07,"C":-5.97894691867218e-07,"D":0.97122975489674,"E":6.6120096960276e-05,"F":1.17512304838601,"H":1.11544194721924e-05,"I":-1.06102795616181e-06,"J":1.71048409284835e-05,"K":-0.00173347045898709,"L":0.9981540752093,"M":0.116750398393378},{"A":5.81222336524245e-05,"B":6.67612163840481e-06,"C":-6.00099893444117e-07,"D":0.990469356097833,"E":-0.000551998652497332,"F":0.388340361447263,"H":1.11794473600102e-05,"I":-1.06114841580407e-06,"J":1.71050838034259e-05,"K":-0.00178224988965781,"L":0.998154394871548,"M":0.12046244004523},{"A":-7.69285984030255e-05,"B":1.3737735662378e-06,"C":-5.46259731226684e-07,"D":1.01332653920457,"E":-0.000112673047112821,"F":-0.578922345519459,"H":1.11852126847833e-05,"I":-1.06106061481537e-06,"J":1.71053248467778e-05,"K":-0.00182796832453391,"L":0.998154697130246,"M":0.124142593003853},{"A":0.000200655305925057,"B":2.78465479119916e-06,"C":-6.79367789579999e-07,"D":0.964826313936896,"E":-0.000234871915381518,"F":1.53929091913415,"H":1.11580850150617e-05,"I":-1.06121254783709e-06,"J":1.71055652975483e-05,"K":-0.00186791670449793,"L":0.998155020365431,"M":0.127659132414919},{"A":5.5952319488739e-05,"B":1.08645790177775e-05,"C":-4.8272297492602e-07,"D":0.990267894713782,"E":-0.000976769046957315,"F":0.421270105240183,"H":1.1187423863801e-05,"I":-1.06118613674155e-06,"J":1.71058102783617e-05,"K":-0.00191777363906454,"L":0.998155327602049,"M":0.131699761257551},{"A":-0.000106262673386315,"B":4.58630185118381e-06,"C":-2.36755633653551e-07,"D":1.01972692010477,"E":-0.000432375504090032,"F":-0.916032506802367,"H":1.11951778420383e-05,"I":-1.06092717500061e-06,"J":1.71060530496092e-05,"K":-0.00196395110407366,"L":0.998155613386785,"M":0.135673416727514},{"A":0.000151942060234944,"B":3.60312463509871e-06,"C":-2.64425714768812e-07,"D":0.971595352510406,"E":-0.000348931428078458,"F":1.32688629714357,"H":1.11674498379788e-05,"I":-1.06095301777298e-06,"J":1.71062939419153e-05,"K":-0.00200349850217663,"L":0.998155925291599,"M":0.139426810274017},{"A":9.69991594157449e-07,"B":8.4748422448655e-06,"C":-1.0599331168315e-07,"D":1.00009068254496,"E":-0.000831393672541481,"F":-0.0176247844901809,"H":1.11941534934323e-05,"I":-1.06090085327804e-06,"J":1.71065379527824e-05,"K":-0.00205323885919029,"L":0.998156229466474,"M":0.143746855755126},{"A":-0.000151919052481242,"B":-9.10125993680566e-07,"C":-6.11097401570504e-08,"D":1.02980998314769,"E":6.83575804600878e-05,"F":-1.46202847897803,"H":1.11991627576025e-05,"I":-1.06075181349752e-06,"J":1.71067780441181e-05,"K":-0.00209899341093944,"L":0.9981565242351,"M":0.14797359293334},{"A":0.000128233928888832,"B":-4.03870369147796e-06,"C":-4.2458549320834e-07,"D":0.974319806221729,"E":0.000397415942757107,"F":1.28506335717975,"H":1.11725779619043e-05,"I":-1.06101657548763e-06,"J":1.710701501767e-05,"K":-0.00213842894672212,"L":0.998156860366038,"M":0.151973906603416},{"A":7.19617376621073e-06,"B":2.85333630944962e-07,"C":-6.71759578518838e-07,"D":0.998602660507345,"E":-2.59635677934966e-05,"F":0.0665568307304056,"H":1.12170874106421e-05,"I":-1.06129857435633e-06,"J":1.71072546136797e-05,"K":-0.00219206307372133,"L":0.998157199046901,"M":0.156772619675394},{"A":-0.000115811098129859,"B":-7.78306121862471e-06,"C":-1.01251552853121e-06,"D":1.02395012643194,"E":0.000825915328903193,"F":-1.24004778906965,"H":1.15074118238745e-05,"I":-1.06161187618525e-06,"J":1.71074901293977e-05,"K":-0.00229687050486405,"L":0.998157542325856,"M":0.164323483736553},{"A":0.000185540350349234,"B":-8.10118298932849e-06,"C":-1.65607490765218e-06,"D":0.960531832978518,"E":0.000901501421623152,"F":2.0953542994248,"H":1.15459513456706e-05,"I":-1.06185235637657e-06,"J":1.71077283450116e-05,"K":-0.00235313246001567,"L":0.998157879620337,"M":0.169641840398981},{"A":7.2399553548097e-05,"B":5.58727974997453e-09,"C":-2.01495827889531e-06,"D":0.984428167543683,"E":5.6559574431958e-05,"F":0.832965480869461,"H":1.11915187666067e-05,"I":-1.0622874093702e-06,"J":1.71079677347419e-05,"K":-0.00232221461791937,"L":0.99815823863031,"M":0.17022715688654},{"A":-5.86157674766774e-05,"B":-4.27284635207137e-06,"C":-2.27193602242437e-06,"D":1.01284812628364,"E":0.00053703756844925,"F":-0.708882743023423,"H":1.11734047305578e-05,"I":-1.06247584907848e-06,"J":1.71082063630257e-05,"K":-0.0023628973405323,"L":0.998158572129839,"M":0.174712509306119},{"A":0.000221731383868384,"B":-1.70694773604652e-06,"C":-2.66129165549245e-06,"D":0.950362101469125,"E":0.000273780516749866,"F":2.77220548539481,"H":1.11389026610231e-05,"I":-1.06285720280486e-06,"J":1.7108445013847e-05,"K":-0.00239979444967275,"L":0.998158928117675,"M":0.179068889858172},{"A":7.93231128586314e-05,"B":7.75269285968605e-06,"C":-2.65773725072194e-06,"D":0.982176569765784,"E":-0.000802151293100906,"F":0.99534682452213,"H":1.11655333842053e-05,"I":-1.0630221858321e-06,"J":1.71086886156524e-05,"K":-0.00245033828332453,"L":0.998159260308228,"M":0.184276063551806},{"A":-8.16110835271111e-05,"B":2.97510537006218e-06,"C":-2.52998206828892e-06,"D":1.01906843344864,"E":-0.000269895574092516,"F":-1.11889616577173,"H":1.117231136194e-05,"I":-1.06288646861685e-06,"J":1.71089308184658e-05,"K":-0.00249655917281189,"L":0.998159558204975,"M":0.189337567890107},{"A":0.000176466288702937,"B":3.4276983478243e-06,"C":-2.60235814253384e-06,"D":0.958511682088897,"E":-0.000327134653218764,"F":2.43324221397052,"H":1.11438815065812e-05,"I":-1.06296936508432e-06,"J":1.71091719268768e-05,"K":-0.00253451332338273,"L":0.998159881628254,"M":0.194003073514978},{"A":2.44121837362776e-05,"B":9.79728495487109e-06,"C":-2.41535415379524e-06,"D":0.994452372312026,"E":-0.00110710378606882,"F":0.309608260362438,"H":1.11698600192556e-05,"I":-1.06292645740691e-06,"J":1.7109416737604e-05,"K":-0.00258527182523949,"L":0.998160189831836,"M":0.199511196704407},{"A":-0.000130661210923755,"B":1.80509007030594e-06,"C":-2.26665455782538e-06,"D":1.03198415151394,"E":-0.000159033943816667,"F":-1.96130114766856,"H":1.11727483314006e-05,"I":-1.06271286315351e-06,"J":1.71096584926644e-05,"K":-0.00263067008026496,"L":0.998160477227501,"M":0.20479780326059},{"A":0.000146591940508145,"B":-1.68812727796563e-07,"C":-2.46284392813045e-06,"D":0.963710932807487,"E":8.94388394385714e-05,"F":2.24136385569,"H":1.1139547574035e-05,"I":-1.062849044553e-06,"J":1.71098980386586e-05,"K":-0.00266712514795131,"L":0.998160807617325,"M":0.209619729819678},{"A":2.16021785108822e-05,"B":5.18341478494833e-06,"C":-2.48837746763542e-06,"D":0.994751219619161,"E":-0.000584383948876166,"F":0.314019117344287,"H":1.11616708013962e-05,"I":-1.06295680613044e-06,"J":1.71101405710417e-05,"K":-0.00271722337663505,"L":0.998161134652889,"M":0.215372050266524},{"A":-0.000106254294537589,"B":-2.13540307081317e-06,"C":-2.56095321993222e-06,"D":1.02720545732564,"E":0.00034405595778253,"F":-1.74582522841229,"H":1.11630871365009e-05,"I":-1.06293271939784e-06,"J":1.71103803499606e-05,"K":-0.00276225488374848,"L":0.998161445423605,"M":0.220903900713893},{"A":0.000190574011063704,"B":-2.00312662790303e-06,"C":-2.90676710390514e-06,"D":0.950472382251917,"E":0.000344823581144738,"F":3.21260033993167,"H":1.11311480229803e-05,"I":-1.06322637805079e-06,"J":1.71106188414649e-05,"K":-0.00279859983791653,"L":0.998161797764311,"M":0.225959559296825},{"A":7.25269269872264e-05,"B":6.2884368268179e-06,"C":-2.95250907966782e-06,"D":0.981078168593967,"E":-0.000744532363000872,"F":1.22874239652447,"H":1.11571101497621e-05,"I":-1.0634047185043e-06,"J":1.71108616236482e-05,"K":-0.00284993473891859,"L":0.998162135541534,"M":0.232074621675565},{"A":-6.37435273929121e-05,"B":1.86429758430862e-06,"C":-2.89456233559804e-06,"D":1.017190540044,"E":-0.000167753193125009,"F":-1.16385465360509,"H":1.11637912335594e-05,"I":-1.06332970439826e-06,"J":1.71111031596061e-05,"K":-0.0028963630109331,"L":0.998162440033042,"M":0.237967104159907},{"A":0.00021193269380082,"B":3.95696522392797e-06,"C":-2.98546161170421e-06,"D":0.942527612497543,"E":-0.000453155174568565,"F":3.8912368717065,"H":1.11372161874512e-05,"I":-1.06345440464839e-06,"J":1.71113444142335e-05,"K":-0.0029337739583184,"L":0.998162771563244,"M":0.243337574949692}],[{"A":0.000137970925556119,"B":4.24824628475484e-06,"C":-6.62404823770224e-07,"D":0.979173997843816,"E":-0.000304890877629305,"F":0.783178374244017,"H":1.11662833092718e-05,"I":-1.05094108460158e-06,"J":0.000123507646452081,"K":-0.00160153676834796,"L":0.989416295720829,"M":0.286209284158758},{"A":7.44466959590184e-06,"B":9.22089497401579e-06,"C":-4.89712167262013e-07,"D":0.999071933678664,"E":-0.000710211600789989,"F":0.0250424052828748,"H":1.1188694732045e-05,"I":-1.05085472146271e-06,"J":0.000123507312312143,"K":-0.00164966719039228,"L":0.989416615694452,"M":0.289617872381314},{"A":-0.000125175221573182,"B":7.90561371921683e-08,"C":-4.23677664840305e-07,"D":1.02008539826954,"E":-1.48057569049342e-06,"F":-0.807419349494012,"H":1.11894366534582e-05,"I":-1.05072227241099e-06,"J":0.000123506974523679,"K":-0.00169456493934206,"L":0.98941693191496,"M":0.292995553661058},{"A":0.000181338972344181,"B":-7.32793162594447e-07,"C":-7.17229353686122e-07,"D":0.970314665317886,"E":7.78665160225955e-05,"F":1.21244200435831,"H":1.1155158542886e-05,"I":-1.05095952851464e-06,"J":0.000123506634840731,"K":-0.00173369859041372,"L":0.989417278349777,"M":0.296225626691921},{"A":5.99738946374107e-05,"B":7.42707463774472e-06,"C":-7.2125951433577e-07,"D":0.990126326564337,"E":-0.000606660473238207,"F":0.403949054900295,"H":1.11811962790753e-05,"I":-1.05106061520921e-06,"J":0.000123506299691822,"K":-0.00178265129613919,"L":0.989417613817679,"M":0.299944739747843},{"A":-7.93752560648286e-05,"B":1.55411476665535e-06,"C":-6.6177309665516e-07,"D":1.01373922998167,"E":-0.000120247015928499,"F":-0.596446985995499,"H":1.11873858299472e-05,"I":-1.05098067537668e-06,"J":0.000123505962467796,"K":-0.00182844946843375,"L":0.989417934171726,"M":0.303628251353075},{"A":0.000207040832442384,"B":3.11614094883339e-06,"C":-8.13858994641592e-07,"D":0.963688285054445,"E":-0.000254512048911693,"F":1.58982276247843,"H":1.11588591934497e-05,"I":-1.05113841342153e-06,"J":0.000123505624570475,"K":-0.00186816005451362,"L":0.989418275357707,"M":0.307134336399031},{"A":5.7736449379675e-05,"B":1.20668484311359e-05,"C":-5.92919975450634e-07,"D":0.989895846861032,"E":-0.00107746781765172,"F":0.440181514122742,"H":1.1189385102417e-05,"I":-1.05107019920947e-06,"J":0.000123505291607595,"K":-0.00191823531011437,"L":0.989418596269573,"M":0.311184640507236},{"A":-0.000109644674675558,"B":5.11253272383883e-06,"C":-3.160600579033e-07,"D":1.02032650789988,"E":-0.000475887455422708,"F":-0.942634161103342,"H":1.11976601058217e-05,"I":-1.05080062762219e-06,"J":0.000123504956224985,"K":-0.00196451701893352,"L":0.989418898456634,"M":0.315163116252734},{"A":0.000156778315759443,"B":4.0231253310985e-06,"C":-3.48839441888238e-07,"D":0.97066820260261,"E":-0.000383083477032642,"F":1.37122875345085,"H":1.11685217669133e-05,"I":-1.05082488344177e-06,"J":0.000123504618931958,"K":-0.00200380929794619,"L":0.989419227570991,"M":0.318904628901691},{"A":1.00162269722759e-06,"B":9.41973729995382e-06,"C":-1.71096785184233e-07,"D":1.00004445115383,"E":-0.000918387421194211,"F":-0.0135193319219979,"H":1.11962921036102e-05,"I":-1.05073831191405e-06,"J":0.00012350428494895,"K":-0.00205376005348512,"L":0.989419545799677,"M":0.323234686627984},{"A":-0.000156749009636803,"B":-9.7580828306576e-07,"C":-1.21733284563774e-07,"D":1.03075875187142,"E":7.81166897638741e-05,"F":-1.50865188865282,"H":1.12016241702317e-05,"I":-1.0506003227384e-06,"J":0.000123503946660386,"K":-0.00209958616115102,"L":0.989419858981336,"M":0.32746497660537},{"A":0.000132309180529422,"B":-4.44137980659676e-06,"C":-5.34404362317886e-07,"D":0.973521341909759,"E":0.00044512987062717,"F":1.3240368830011,"H":1.11734131583718e-05,"I":-1.05089290525218e-06,"J":0.000123503605203412,"K":-0.00213870524748927,"L":0.989420215255436,"M":0.331449546496515},{"A":7.42568089218132e-06,"B":3.48199766797563e-07,"C":-8.15551830068983e-07,"D":0.998552731840164,"E":-2.20695309565144e-05,"F":0.0690824492339743,"H":1.12188073721486e-05,"I":-1.05116318327436e-06,"J":0.000123503266512226,"K":-0.00219252363086753,"L":0.989420570188386,"M":0.336257490693242},{"A":-0.000119487840320787,"B":-8.58816227111703e-06,"C":-1.20243941836851e-06,"D":1.02474809983005,"E":0.000923811782968187,"F":-1.28352812118828,"H":1.15093836998148e-05,"I":-1.05143592521451e-06,"J":0.00012350292339236,"K":-0.00229739213015989,"L":0.98942092680025,"M":0.3438116153593},{"A":0.00019143162690205,"B":-8.94163187137309e-06,"C":-1.93197324094285e-06,"D":0.959317885317091,"E":0.00101197342922887,"F":2.15742490511911,"H":1.15463230775381e-05,"I":-1.05217071200148e-06,"J":0.000123502583496804,"K":-0.00235330253215693,"L":0.989421333614786,"M":0.349110336905142},{"A":7.47026496641379e-05,"B":3.79731290856e-08,"C":-2.33959450768317e-06,"D":0.983928928625232,"E":7.85504608415977e-05,"F":0.859521290542034,"H":1.11928769216396e-05,"I":-1.05250560100689e-06,"J":0.000123502244237683,"K":-0.00232260323443256,"L":0.989421699669549,"M":0.349707378607491},{"A":-6.04778069828171e-05,"B":-4.70020896914392e-06,"C":-2.63170922676359e-06,"D":1.01327519536255,"E":0.000612480458727305,"F":-0.733888644965191,"H":1.11752131506382e-05,"I":-1.05270676264979e-06,"J":0.000123501904124912,"K":-0.00236339002805153,"L":0.989422052347635,"M":0.354198356868437},{"A":0.000228781036449854,"B":-1.85996923107723e-06,"C":-3.07373299324176e-06,"D":0.948789115002569,"E":0.000323777057332109,"F":2.85929421945548,"H":1.11393488206879e-05,"I":-1.05310549769477e-06,"J":0.000123501564219475,"K":-0.00239998846302569,"L":0.989422428104405,"M":0.358537998426982},{"A":8.18504558313116e-05,"B":8.61926660444823e-06,"C":-3.07139439370552e-06,"D":0.981563531458789,"E":-0.000867968440218192,"F":1.03173178694851,"H":1.11672194106349e-05,"I":-1.05324065902135e-06,"J":0.000123501229656542,"K":-0.00245081783194223,"L":0.989422774756349,"M":0.363761235768834},{"A":-8.42075865239433e-05,"B":3.32817063175561e-06,"C":-2.92821961211942e-06,"D":1.01965544871183,"E":-0.000279179126437157,"F":-1.15267832515383,"H":1.11745840947752e-05,"I":-1.0531008025616e-06,"J":0.000123500893542683,"K":-0.00249718184531389,"L":0.989423090007392,"M":0.368831069108637},{"A":0.000182082817784313,"B":3.8279201075575e-06,"C":-3.01159454929589e-06,"D":0.957169049626714,"E":-0.000341765180849052,"F":2.51281923722854,"H":1.11448093739752e-05,"I":-1.0531826124538e-06,"J":0.000123500556308276,"K":-0.00253482771606173,"L":0.989423431133019,"M":0.373478545621765},{"A":2.51907802297779e-05,"B":1.08845347455144e-05,"C":-2.80163180166326e-06,"D":0.994219392592186,"E":-0.0012068967668597,"F":0.325746670634544,"H":1.11719322313797e-05,"I":-1.05310287334959e-06,"J":0.000123500223069617,"K":-0.00258586596777377,"L":0.98942375274045,"M":0.379003385858596},{"A":-0.000134817580783597,"B":2.03231710171892e-06,"C":-2.6347009116634e-06,"D":1.03298816697315,"E":-0.000157619964397782,"F":-2.02250076409837,"H":1.1175223101012e-05,"I":-1.05289249552332e-06,"J":0.000123499886410194,"K":-0.00263137075270947,"L":0.989424058313432,"M":0.384296620188252},{"A":0.00015125423469442,"B":-1.5554481658242e-07,"C":-2.85810060396408e-06,"D":0.962553783263559,"E":0.000119210542607107,"F":2.31253906913116,"H":1.11404615882882e-05,"I":-1.05304684239194e-06,"J":0.00012349954750418,"K":-0.0026674479400981,"L":0.989424408742437,"M":0.389095310691118},{"A":2.22905342079915e-05,"B":5.77363431220057e-06,"C":-2.88857739505488e-06,"D":0.994552508737002,"E":-0.000626912371444632,"F":0.327496759229689,"H":1.11635372737617e-05,"I":-1.05314223630693e-06,"J":0.000123499211833078,"K":-0.00271779027275443,"L":0.989424752032974,"M":0.39486289294473},{"A":-0.000109632586314135,"B":-2.33248030712119e-06,"C":-2.97199451648744e-06,"D":1.02807800670161,"E":0.000402021429749766,"F":-1.80281054605439,"H":1.11652445435872e-05,"I":-1.05314310316906e-06,"J":0.000123498873122407,"K":-0.00276290285370351,"L":0.989425083812577,"M":0.400399976904737},{"A":0.000196632880407721,"B":-2.18771307824994e-06,"C":-3.36471056994192e-06,"D":0.94890451383128,"E":0.00040549711144422,"F":3.31329361718963,"H":1.11317421271906e-05,"I":-1.05346611622981e-06,"J":0.000123498533071809,"K":-0.00279884877346603,"L":0.989425457831047,"M":0.405429801710852},{"A":7.48372279195664e-05,"B":6.99734870091007e-06,"C":-3.41813832216431e-06,"D":0.980438060607412,"E":-0.000800775573338797,"F":1.27223449254234,"H":1.11587602887875e-05,"I":-1.05362903202177e-06,"J":0.000123498197883931,"K":-0.00285046532604838,"L":0.989425811461132,"M":0.411563266357916},{"A":-6.57708588647221e-05,"B":2.09762408109881e-06,"C":-3.35393932160422e-06,"D":1.01772353594254,"E":-0.000162216047726815,"F":-1.19960812247882,"H":1.11659144483856e-05,"I":-1.05356065704942e-06,"J":0.000123497860997024,"K":-0.00289702680368009,"L":0.989426134743468,"M":0.417464722895602},{"A":0.000218678857748067,"B":4.41400569650696e-06,"C":-3.4583130930077e-06,"D":0.940673166226475,"E":-0.000477376171602373,"F":4.01790296852414,"H":1.11379815134205e-05,"I":-1.05368592373534e-06,"J":0.000123497524034732,"K":-0.00293407681135704,"L":0.989426484246877,"M":0.422810841699174}],[{"A":0.000142688023748172,"B":4.74265698735543e-06,"C":-7.79253718885542e-07,"D":0.978434915553265,"E":-0.000333999718691302,"F":0.811954791133758,"H":1.11634264110538e-05,"I":-1.07257602710575e-06,"J":-9.77443226131691e-05,"K":-0.00159984224080745,"L":1.00895484023512,"M":-0.144975377179435},{"A":7.70021597418236e-06,"B":1.02601486939857e-05,"C":-5.86426222359826e-07,"D":0.998985862126858,"E":-0.000784569708571325,"F":0.0300934259703354,"H":1.11868378182001e-05,"I":-1.072476432884e-06,"J":-9.77434779395048e-05,"K":-0.00164811769626283,"L":1.00895512141069,"M":-0.141562789607633},{"A":-0.00012945026028488,"B":1.18089056755366e-07,"C":-5.13321663175859e-07,"D":1.02076704519081,"E":1.46250366128697e-06,"F":-0.834682775037436,"H":1.11878459018167e-05,"I":-1.07234398949441e-06,"J":-9.77426371524537e-05,"K":-0.00169305076931892,"L":1.00895539985834,"M":-0.138185218772378},{"A":0.000187532653545985,"B":-7.83597913001088e-07,"C":-8.44289469670301e-07,"D":0.969300857061626,"E":9.13885573083917e-05,"F":1.25376021943339,"H":1.11518252138287e-05,"I":-1.07260679849119e-06,"J":-9.77417976012473e-05,"K":-0.00173189120775419,"L":1.00895571056536,"M":-0.134968704523999},{"A":6.20261275781075e-05,"B":8.26972797751679e-06,"C":-8.50053365253345e-07,"D":0.989744055831778,"E":-0.000667920611533646,"F":0.421408888614678,"H":1.1178963477354e-05,"I":-1.07271148053201e-06,"J":-9.77409537532559e-05,"K":-0.00178101515355422,"L":1.00895600856387,"M":-0.131244200534638},{"A":-8.20866377740925e-05,"B":1.75444511718581e-06,"C":-7.84319582169957e-07,"D":1.0141961885289,"E":-0.000128512209329301,"F":-0.615848279900092,"H":1.11856109272779e-05,"I":-1.07263408088976e-06,"J":-9.77401123298804e-05,"K":-0.00182688314191637,"L":1.00895629139272,"M":-0.12755930413914},{"A":0.000214117543094083,"B":3.48644786729579e-06,"C":-9.56372474547607e-07,"D":0.962426243576544,"E":-0.000276376648372434,"F":1.64588211735463,"H":1.11555652121398e-05,"I":-1.07280736305615e-06,"J":-9.77392711518643e-05,"K":-0.00186631857218345,"L":1.00895659616876,"M":-0.12406690293119},{"A":5.97139486495646e-05,"B":1.34176447286194e-05,"C":-7.09378089269741e-07,"D":0.989480045138151,"E":-0.00119059327701621,"F":0.461439086166138,"H":1.11873844038657e-05,"I":-1.07272596538976e-06,"J":-9.773842525862e-05,"K":-0.00191661381592212,"L":1.00895687814007,"M":-0.12000850350887},{"A":-0.000113392778039678,"B":5.70226597540469e-06,"C":-3.99409077478374e-07,"D":1.02098958359278,"E":-0.000524621715811691,"F":-0.971993501862016,"H":1.11962217133055e-05,"I":-1.07244324543121e-06,"J":-9.77375823547622e-05,"K":-0.00196299166341873,"L":1.00895714137188,"M":-0.116027175641648},{"A":0.000162138125852973,"B":4.49314688899527e-06,"C":-4.37395762720172e-07,"D":0.969639586834035,"E":-0.000421288513422269,"F":1.42046602452319,"H":1.11655505434793e-05,"I":-1.07247707881175e-06,"J":-9.773674072866e-05,"K":-0.00200198962369313,"L":1.00895743355316,"M":-0.112301017428763},{"A":1.0367291463087e-06,"B":1.04807812855157e-05,"C":-2.38889147907706e-07,"D":0.999990537596432,"E":-0.00101608698648192,"F":-0.00871900920174085,"H":1.11944813728782e-05,"I":-1.07238704027957e-06,"J":-9.77358959475816e-05,"K":-0.00205215133377123,"L":1.00895771361763,"M":-0.107962629394024},{"A":-0.000162101437888973,"B":-1.05242846104581e-06,"C":-1.84520403845312e-07,"D":1.03181050183809,"E":8.93257403049574e-05,"F":-1.56035813843846,"H":1.1200157838509e-05,"I":-1.07226550705164e-06,"J":-9.77350556377043e-05,"K":-0.00209803717757495,"L":1.00895799056249,"M":-0.10373102352969},{"A":0.000136825148292274,"B":-4.89748302134885e-06,"C":-6.49295385457549e-07,"D":0.972637889222199,"E":0.000499018190851075,"F":1.36707915814259,"H":1.11701761557059e-05,"I":-1.07261856219232e-06,"J":-9.77342177934659e-05,"K":-0.00213679371529452,"L":1.00895831497878,"M":-0.0997662304434925},{"A":7.6800682129452e-06,"B":4.16230000244155e-07,"C":-9.66369886890028e-07,"D":0.998497359431155,"E":-1.75605917149824e-05,"F":0.0718719568903907,"H":1.1216525034774e-05,"I":-1.07296552420699e-06,"J":-9.7733377149134e-05,"K":-0.0021907904656473,"L":1.00895863986314,"M":-0.0949512497609248},{"A":-0.00012356192463292,"B":-9.49706128361427e-06,"C":-1.40208036936151e-06,"D":1.02563486801739,"E":0.00103406616088364,"F":-1.33199095032614,"H":1.15072643989134e-05,"I":-1.07348966871257e-06,"J":-9.77325408415552e-05,"K":-0.00229567285100529,"L":1.00895898468444,"M":-0.087398670566472},{"A":0.00019795964353575,"B":-9.89067915080355e-06,"C":-2.22284045703347e-06,"D":0.957975407635331,"E":0.00113632881294734,"F":2.22589436364069,"H":1.15424398900998e-05,"I":-1.07338321198025e-06,"J":-9.77317008633571e-05,"K":-0.0023512381096964,"L":1.00895926548338,"M":-0.0821179904378369},{"A":7.72549768517372e-05,"B":7.15837880083114e-08,"C":-2.68212737686291e-06,"D":0.983375727060206,"E":0.00010323665622991,"F":0.888913039059844,"H":1.11902080237591e-05,"I":-1.07398058724062e-06,"J":-9.77308613964167e-05,"K":-0.00232077386405649,"L":1.00895962207962,"M":-0.0815109500472317},{"A":-6.25411529164843e-05,"B":-5.18392137038859e-06,"C":-3.01136801428292e-06,"D":1.01374986465635,"E":0.000697265597324304,"F":-0.761789514297561,"H":1.11730400524923e-05,"I":-1.07426368212149e-06,"J":-9.77300228407474e-05,"K":-0.00236165556995616,"L":1.00895994626708,"M":-0.0770167710961687},{"A":0.000236593290076748,"B":-2.03539824150667e-06,"C":-3.50921256742076e-06,"D":0.947046596866244,"E":0.000379917262591789,"F":2.9556940983457,"H":1.11357002835488e-05,"I":-1.07472510424422e-06,"J":-9.77291837812033e-05,"K":-0.002397912035633,"L":1.00896029160782,"M":-0.0726981687221269},{"A":8.46515814969528e-05,"B":9.59197611649643e-06,"C":-3.50801139181733e-06,"D":0.980881658237934,"E":-0.000942251700223551,"F":1.072295538459,"H":1.1164923777951e-05,"I":-1.07487903777681e-06,"J":-9.77283397382012e-05,"K":-0.00244903424862741,"L":1.00896060305668,"M":-0.0674603731858952},{"A":-8.70850921068644e-05,"B":3.72306564599967e-06,"C":-3.348168605255e-06,"D":1.0203050883942,"E":-0.000289854082268448,"F":-1.19004875057726,"H":1.1172924013314e-05,"I":-1.07474319077649e-06,"J":-9.7727497813338e-05,"K":-0.00249553642865408,"L":1.00896088148147,"M":-0.0623843143112026},{"A":0.00018830735046782,"B":4.27540004510618e-06,"C":-3.4430219602033e-06,"D":0.955680045693839,"E":-0.000358424651153655,"F":2.60109410404766,"H":1.11416892499827e-05,"I":-1.07483826439214e-06,"J":-9.77266564338164e-05,"K":-0.00253283048976982,"L":1.00896118682498,"M":-0.0577592734662176},{"A":2.60537762879487e-05,"B":1.21058161952625e-05,"C":-3.20845042001139e-06,"D":0.993958072412966,"E":-0.001319462745073,"F":0.343969729081437,"H":1.11700586656882e-05,"I":-1.074748380403e-06,"J":-9.77258114333024e-05,"K":-0.00258415573495085,"L":1.00896146989736,"M":-0.0522191919699253},{"A":-0.000139423719382581,"B":2.28562321069603e-06,"C":-3.02184140243966e-06,"D":1.03410029779343,"E":-0.000156278691292755,"F":-2.09029074510909,"H":1.11737829282532e-05,"I":-1.07453294129201e-06,"J":-9.77249700855887e-05,"K":-0.00262975914833419,"L":1.00896173752434,"M":-0.046921626686526},{"A":0.00015642099142843,"B":-1.43621181836195e-07,"C":-3.27395016541665e-06,"D":0.961271554827078,"E":0.000152499236264703,"F":2.39136488093209,"H":1.11373254618741e-05,"I":-1.07470762611417e-06,"J":-9.77241302935195e-05,"K":-0.00266540914361713,"L":1.00896205307873,"M":-0.0421510806827428},{"A":2.30534649843239e-05,"B":6.43532225819143e-06,"C":-3.30949795745994e-06,"D":0.994330666207986,"E":-0.000675063477444837,"F":0.342601451360679,"H":1.11614386442138e-05,"I":-1.07481014066657e-06,"J":-9.7723287408702e-05,"K":-0.0027159999692401,"L":1.00896235990564,"M":-0.0363699048320996},{"A":-0.000113376246751562,"B":-2.55685207406486e-06,"C":-3.40416987310022e-06,"D":1.02904566125062,"E":0.000466942092771205,"F":-1.86608917784906,"H":1.11634583276343e-05,"I":-1.07482515221413e-06,"J":-9.77224477554106e-05,"K":-0.00276118367997924,"L":1.00896265615978,"M":-0.0308300857632275},{"A":0.000203347148879818,"B":-2.39865846096698e-06,"C":-3.84655700380598e-06,"D":0.947167767113001,"E":0.000473491674085835,"F":3.4247449303366,"H":1.1128258151083e-05,"I":-1.07518121428285e-06,"J":-9.77216088658972e-05,"K":-0.00279667960990082,"L":1.00896299712112,"M":-0.0258313181984704},{"A":7.73977524972658e-05,"B":7.79254578353594e-06,"C":-3.90800268590397e-06,"D":0.979726668884723,"E":-0.000864452701250684,"F":1.32065434446849,"H":1.11564274685172e-05,"I":-1.07535223603517e-06,"J":-9.77207654155876e-05,"K":-0.00284858562619661,"L":1.00896331453959,"M":-0.0196809504868725},{"A":-6.80175542480121e-05,"B":2.35770538292712e-06,"C":-3.83688824845407e-06,"D":1.01831365738894,"E":-0.000156392317308018,"F":-1.23919676341029,"H":1.11640931486079e-05,"I":-1.07528462822692e-06,"J":-9.77199240154158e-05,"K":-0.00289527489977104,"L":1.00896360068023,"M":-0.0137728058034554},{"A":0.000226155357768931,"B":4.92531600082557e-06,"C":-3.95538845321397e-06,"D":0.938616765438667,"E":-0.000504994111565793,"F":4.15840340069553,"H":1.11346862825545e-05,"I":-1.07541757721208e-06,"J":-9.77190824085206e-05,"K":-0.00293191634315804,"L":1.00896391396101,"M":-0.00845624659814348}],[{"A":0.000147927299560591,"B":5.29948755567666e-06,"C":-9.34816162034835e-07,"D":0.977612600225228,"E":-0.00036387806392213,"F":0.843943837015104,"H":1.11561175709651e-05,"I":-1.06308332681326e-06,"J":-1.17830478573167e-05,"K":-0.00159886519818997,"L":1.0009919040827,"M":0.0395965629159036},{"A":7.98412801816806e-06,"B":1.14340562384907e-05,"C":-7.15776818482894e-07,"D":0.998887074137087,"E":-0.000866096018029339,"F":0.0358833985374076,"H":1.11806208482612e-05,"I":-1.06295703472536e-06,"J":-1.17826780626218e-05,"K":-0.00164728286802074,"L":1.0009921985487,"M":0.0430133238523922},{"A":-0.000134198183019407,"B":1.5943301834298e-07,"C":-6.33539494643287e-07,"D":1.0215241353724,"E":7.33496978000403e-06,"F":-0.865029608165059,"H":1.11819149906101e-05,"I":-1.06284063583484e-06,"J":-1.17823126885019e-05,"K":-0.00169223627747783,"L":1.00099249364594,"M":0.0463904119505969},{"A":0.000194411496138747,"B":-8.44172108660501e-07,"C":-1.01353470682852e-06,"D":0.968175237765593,"E":0.000110045972377293,"F":1.29953372564887,"H":1.11439952251713e-05,"I":-1.06312388969965e-06,"J":-1.17819484844461e-05,"K":-0.00173074066213985,"L":1.00099282141025,"M":0.0495918586075277},{"A":6.43056769921158e-05,"B":9.22095498756548e-06,"C":-1.02167635429584e-06,"D":0.989316904140139,"E":-0.000733898484043038,"F":0.440926946597756,"H":1.11723360973759e-05,"I":-1.06320936243964e-06,"J":-1.17815795145915e-05,"K":-0.00178003605664401,"L":1.00099313318836,"M":0.0533220034112674},{"A":-8.50979796256368e-05,"B":1.97841817217714e-06,"C":-9.4788607962748e-07,"D":1.01470322401997,"E":-0.00013460126604059,"F":-0.637440295036868,"H":1.11794796795461e-05,"I":-1.06314200720714e-06,"J":-1.17812133857975e-05,"K":-0.00182596250454026,"L":1.00099343228023,"M":0.0570079796179925},{"A":0.000221977496444481,"B":3.90267068617334e-06,"C":-1.14615444202215e-06,"D":0.961023505323141,"E":-0.000297416124880101,"F":1.70813749429726,"H":1.11477789946912e-05,"I":-1.06331946303495e-06,"J":-1.17808473247827e-05,"K":-0.00186508194327928,"L":1.00099375282126,"M":0.0604851084481197},{"A":6.19106253394452e-05,"B":1.49443373262947e-05,"C":-8.65208539480022e-07,"D":0.989013985571262,"E":-0.00131551374400374,"F":0.485346188666881,"H":1.11810111139699e-05,"I":-1.06319893866669e-06,"J":-1.17804761312623e-05,"K":-0.00191560196722662,"L":1.00099404665893,"M":0.0645520175430647},{"A":-0.000117555750341447,"B":6.36718513358225e-06,"C":-5.12065489788327e-07,"D":1.0217243235362,"E":-0.000577299329847847,"F":-1.00450518748949,"H":1.11904578221633e-05,"I":-1.06291017432092e-06,"J":-1.17801082760716e-05,"K":-0.00196206682903721,"L":1.00099432468308,"M":0.0685359138515196},{"A":0.000168091236884216,"B":5.02236485022678e-06,"C":-5.56971374243709e-07,"D":0.968495769860283,"E":-0.000461905856752765,"F":1.47521422593491,"H":1.11581153594553e-05,"I":-1.06294244661687e-06,"J":-1.17797417960031e-05,"K":-0.00200072762831383,"L":1.0009946320567,"M":0.0722448679262016},{"A":1.07578533681263e-06,"B":1.16793696891548e-05,"C":-3.3143093292054e-07,"D":0.99992739679999,"E":-0.0011244983436427,"F":-0.00312767819559667,"H":1.1188312434296e-05,"I":-1.06282062573015e-06,"J":-1.17793718674708e-05,"K":-0.00205110405761388,"L":1.00099492439782,"M":0.0765919246478006},{"A":-0.000168045854608945,"B":-1.14203598822193e-06,"C":-2.70627764975551e-07,"D":1.03297899266033,"E":0.000104145606883321,"F":-1.61787364196061,"H":1.11943583747109e-05,"I":-1.0627134544583e-06,"J":-1.17790068789869e-05,"K":-0.00209703717888488,"L":1.00099521806374,"M":0.0808243388655683},{"A":0.000141840447311026,"B":-5.41691962352431e-06,"C":-8.0363163679209e-07,"D":0.97165839634971,"E":0.000563272191612896,"F":1.41463407177434,"H":1.11624429190993e-05,"I":-1.06309222558387e-06,"J":-1.17786444506773e-05,"K":-0.0021353827291648,"L":1.00099556040108,"M":0.0847670915645722},{"A":7.96265749292147e-06,"B":4.90332935587645e-07,"C":-1.16778581848997e-06,"D":0.998435801379458,"E":-8.46558293687849e-06,"F":0.0748708343380713,"H":1.12098249789305e-05,"I":-1.06342924444114e-06,"J":-1.17782788895959e-05,"K":-0.00218955973389257,"L":1.00099589967725,"M":0.0895894323111861},{"A":-0.000128086140326111,"B":-1.05289188434554e-05,"C":-1.66743540974679e-06,"D":1.02662270774044,"E":0.00116390084420459,"F":-1.38626538922472,"H":1.15006268883722e-05,"I":-1.06392993381998e-06,"J":-1.17779183143041e-05,"K":-0.00229442961912696,"L":1.00099625758386,"M":0.097139752622752},{"A":0.000205209008946605,"B":-1.0968432893943e-05,"C":-2.60757214709528e-06,"D":0.956487825551903,"E":0.00128408023829252,"F":2.30139437470643,"H":1.15338530057851e-05,"I":-1.06423101198239e-06,"J":-1.17775532306186e-05,"K":-0.00234953633591317,"L":1.00099659673602,"M":0.102393463535918},{"A":8.00897169701553e-05,"B":1.06577992875501e-07,"C":-3.13451268585396e-06,"D":0.982761382160447,"E":0.000139208985586947,"F":0.921325531751791,"H":1.11830936453394e-05,"I":-1.06474314276461e-06,"J":-1.17771893841656e-05,"K":-0.00231935964021091,"L":1.00099695992542,"M":0.103014094860555},{"A":-6.48325664847071e-05,"B":-5.73440482409815e-06,"C":-3.51240188312119e-06,"D":1.01427872599868,"E":0.00080204135312556,"F":-0.793211524563958,"H":1.11664731324845e-05,"I":-1.06504207475489e-06,"J":-1.17768264860096e-05,"K":-0.00236033275220393,"L":1.0009973015765,"M":0.107511412221356},{"A":0.000245269616788946,"B":-2.2374925499058e-06,"C":-4.08333411039408e-06,"D":0.945112102896189,"E":0.000453505533357657,"F":3.06238956729067,"H":1.11275299227165e-05,"I":-1.06551808864985e-06,"J":-1.17764629308237e-05,"K":-0.00239620309812949,"L":1.0009976643161,"M":0.111806589031403},{"A":8.77630007498631e-05,"B":1.069033208978e-05,"C":-4.08372686688807e-06,"D":0.980121299019231,"E":-0.00101634901920988,"F":1.11740626323081,"H":1.1158233441444e-05,"I":-1.0656442366308e-06,"J":-1.17760938611045e-05,"K":-0.00244763116674562,"L":1.00099798837758,"M":0.117059726297157},{"A":-9.02810165057666e-05,"B":4.16748575826631e-06,"C":-3.90220637735972e-06,"D":1.02102550833547,"E":-0.000292293475808947,"F":-1.23169900056382,"H":1.11669248321622e-05,"I":-1.0655079969446e-06,"J":-1.17757272398711e-05,"K":-0.00249426703879863,"L":1.00099828252786,"M":0.122141697593179},{"A":0.000195220878723479,"B":4.77874800575151e-06,"C":-4.01217736900605e-06,"D":0.95402496897907,"E":-0.000367314548839204,"F":2.6990078920935,"H":1.1134099554444e-05,"I":-1.0656011587562e-06,"J":-1.17753611519333e-05,"K":-0.00253116183063185,"L":1.00099860341618,"M":0.126741473010043},{"A":2.701243908243e-05,"B":1.34858117992742e-05,"C":-3.74554273530059e-06,"D":0.993664030456557,"E":-0.00143749700782791,"F":0.364398098510719,"H":1.1163831000971e-05,"I":-1.06547735923002e-06,"J":-1.17749909974707e-05,"K":-0.00258278500109554,"L":1.00099889816184,"M":0.132297402065888},{"A":-0.000144539504776997,"B":2.56981026058867e-06,"C":-3.53332135505369e-06,"D":1.03533482554042,"E":-0.000145754557706823,"F":-2.16575483789347,"H":1.11680239958112e-05,"I":-1.0652685841217e-06,"J":-1.17746249209683e-05,"K":-0.00262847772341956,"L":1.00099918231933,"M":0.137598592136783},{"A":0.000162159358768399,"B":-1.33386273137859e-07,"C":-3.82307454094288e-06,"D":0.959847615166098,"E":0.000199886005987082,"F":2.47862203543627,"H":1.1129717858438e-05,"I":-1.06545886446874e-06,"J":-1.17742606096649e-05,"K":-0.00266364557182897,"L":1.00099951554755,"M":0.142337479293928},{"A":2.39009173990112e-05,"B":7.18160923263156e-06,"C":-3.86536074481469e-06,"D":0.994082291875202,"E":-0.000719810448686076,"F":0.359351175422489,"H":1.11549643464492e-05,"I":-1.06554917456148e-06,"J":-1.17738926808664e-05,"K":-0.00271449202267604,"L":1.00099983657161,"M":0.14813258047252},{"A":-0.000117533875545028,"B":-2.81356600018157e-06,"C":-3.97485981906698e-06,"D":1.03012120232069,"E":0.000550439430583083,"F":-1.93676031728683,"H":1.11573209361504e-05,"I":-1.06558973611559e-06,"J":-1.17735285983245e-05,"K":-0.00275973508854577,"L":1.00100015186389,"M":0.153674182358372},{"A":0.000210804019352473,"B":-2.64094580648688e-06,"C":-4.48229551475166e-06,"D":0.945239803974232,"E":0.000561614126809218,"F":3.54809691078844,"H":1.11202710317837e-05,"I":-1.06597071936054e-06,"J":-1.17731651164688e-05,"K":-0.00279472443264694,"L":1.00100051186043,"M":0.158638056078416},{"A":8.02418602576793e-05,"B":8.68987201885219e-06,"C":-4.55433065615907e-06,"D":0.978934108559315,"E":-0.000925287047380152,"F":1.37443296487618,"H":1.11496987429405e-05,"I":-1.06612610650814e-06,"J":-1.17727965915915e-05,"K":-0.00284693125951208,"L":1.00100084303082,"M":0.16480591299478},{"A":-7.05128146720746e-05,"B":2.6494494691498e-06,"C":-4.4742885600968e-06,"D":1.01896839459312,"E":-0.000138701296805266,"F":-1.28338928722951,"H":1.11579197004108e-05,"I":-1.06606748062621e-06,"J":-1.17724304140032e-05,"K":-0.00289374212752591,"L":1.0010011461943,"M":0.170720081379841},{"A":0.000234459492027161,"B":5.50077713068475e-06,"C":-4.61136707885501e-06,"D":0.93633127095211,"E":-0.000524759173686107,"F":4.3143316710848,"H":1.11269076630283e-05,"I":-1.06619925421825e-06,"J":-1.17720640459007e-05,"K":-0.00292992226206934,"L":1.00100147514901,"M":0.176003294323891}],[{"A":0.000153762362111287,"B":5.93724443587185e-06,"C":-1.1264343542372e-06,"D":0.976694725879042,"E":-0.000395904090339627,"F":0.879649207712646,"H":1.11555995545576e-05,"I":-1.05487880530664e-06,"J":8.14278064005802e-05,"K":-0.00159886582076751,"L":0.992241472669036,"M":0.245074250189646},{"A":8.30042190602676e-06,"B":1.27824237161622e-05,"C":-8.75295092406247e-07,"D":0.998772492884825,"E":-0.000957894332600517,"F":0.0426218444627011,"H":1.11813264089822e-05,"I":-1.05471657585454e-06,"J":8.14276607451481e-05,"K":-0.00164747388913611,"L":0.992241785703058,"M":0.248497940285233},{"A":-0.000139485575182619,"B":2.03883461002974e-07,"C":-7.81793370041584e-07,"D":1.02236727098474,"E":1.60514174467608e-05,"F":-0.898886899680292,"H":1.11829305220468e-05,"I":-1.05461502064585e-06,"J":8.14275100186057e-05,"K":-0.00169247919049553,"L":0.992242103346499,"M":0.251876715326944},{"A":0.000202071983471441,"B":-9.17290163826578e-07,"C":-1.2215545708294e-06,"D":0.966922157211144,"E":0.000134047733865827,"F":1.35038962913313,"H":1.11428916009793e-05,"I":-1.05493261082223e-06,"J":8.14273579896607e-05,"K":-0.00173063852824384,"L":0.992242455316756,"M":0.255063635807346},{"A":6.68446163485381e-05,"B":1.03128716468781e-05,"C":-1.23251419514858e-06,"D":0.988837506952649,"E":-0.000807324642892127,"F":0.462888302377905,"H":1.11725824121223e-05,"I":-1.05499777736107e-06,"J":8.14272114634806e-05,"K":-0.00178015709286683,"L":0.992242786792445,"M":0.258802525524516},{"A":-8.84515266992292e-05,"B":2.23311710634277e-06,"C":-1.14877616874676e-06,"D":1.0152671649804,"E":-0.000139178112590344,"F":-0.661504144591163,"H":1.11802735512923e-05,"I":-1.05493920665722e-06,"J":8.14270616323332e-05,"K":-0.00182617840982857,"L":0.992243108051127,"M":0.262492128053964},{"A":0.00023073107270033,"B":4.37844687262157e-06,"C":-1.37895954055445e-06,"D":0.959459806620771,"E":-0.000318891134440946,"F":1.77750985133025,"H":1.11467285257572e-05,"I":-1.05512764680959e-06,"J":8.14269117718203e-05,"K":-0.00186497587156964,"L":0.992243450982016,"M":0.265954723487084},{"A":6.43574352858778e-05,"B":1.66988901706411e-05,"C":-1.0564696591997e-06,"D":0.988488898387288,"E":-0.00145699612713202,"F":0.512436190994777,"H":1.11815462455755e-05,"I":-1.0549559277262e-06,"J":8.14267676840785e-05,"K":-0.00191577931963138,"L":0.992243761614787,"M":0.270033820237586},{"A":-0.000122192064059501,"B":7.12956690107625e-06,"C":-6.50495326270928e-07,"D":1.02254011321867,"E":-0.000636096917617124,"F":-1.04053999696407,"H":1.11916662155487e-05,"I":-1.05464926203336e-06,"J":8.14266198170266e-05,"K":-0.00196237114838027,"L":0.99224405934217,"M":0.274023218922594},{"A":0.000174721279071255,"B":5.62833488437775e-06,"C":-7.03749617469995e-07,"D":0.967219950902177,"E":-0.000506727380411576,"F":1.53631141150254,"H":1.11574592314145e-05,"I":-1.05468115152441e-06,"J":8.14264704196987e-05,"K":-0.0020006863073263,"L":0.992244388006355,"M":0.277715676880689},{"A":1.11936299296289e-06,"B":1.30561607722957e-05,"C":-4.45104026636223e-07,"D":0.999852416118642,"E":-0.00124769401941194,"F":0.00349987498702831,"H":1.11890760912114e-05,"I":-1.05451777154819e-06,"J":8.14263250283886e-05,"K":-0.00205133454366546,"L":0.992244697645248,"M":0.282075269708002},{"A":-0.000174665601328172,"B":-1.24834422088327e-06,"C":-3.76333768148385e-07,"D":1.03428078437162,"E":0.000122749292728486,"F":-1.6820203384159,"H":1.11955263245589e-05,"I":-1.0544241493271e-06,"J":8.14261738911193e-05,"K":-0.00209734952545659,"L":0.992245013928823,"M":0.286311345600552},{"A":0.000147425341479712,"B":-6.01824929247208e-06,"C":-9.9254584340347e-07,"D":0.970569954527377,"E":0.000639567667434449,"F":1.46728689185693,"H":1.11614561861817e-05,"I":-1.05484793377908e-06,"J":8.14260199172301e-05,"K":-0.00213526681346821,"L":0.992245382112401,"M":0.290232338342321},{"A":8.27743177511664e-06,"B":5.72411629429226e-07,"C":-1.41409620213473e-06,"D":0.998367127610209,"E":4.84492568375572e-06,"F":0.0781272455060389,"H":1.12100121445469e-05,"I":-1.05518610538091e-06,"J":8.14258695869263e-05,"K":-0.00218967921770741,"L":0.992245742929825,"M":0.295066000522638},{"A":-0.000133123761032028,"B":-1.17198531648377e-05,"C":-1.99169949621769e-06,"D":1.0277270010273,"E":0.00131690273903473,"F":-1.44727519088337,"H":1.15010734806908e-05,"I":-1.05567802211048e-06,"J":8.14257137122798e-05,"K":-0.00229460436719364,"L":0.99224612148852,"M":0.302618775143856},{"A":0.000213281131017595,"B":-1.22127273463057e-05,"C":-3.07749629990806e-06,"D":0.954835970656063,"E":0.00145910083637091,"F":2.38480255543618,"H":1.15321738107799e-05,"I":-1.05645236925245e-06,"J":8.14255630051108e-05,"K":-0.00234924007398263,"L":0.992246532023486,"M":0.307845971867209},{"A":8.32466516469399e-05,"B":1.434722944893e-07,"C":-3.68697824426611e-06,"D":0.982077269395745,"E":0.000186289191844935,"F":0.957207854189619,"H":1.11828059143892e-05,"I":-1.05688891782751e-06,"J":8.14254105367951e-05,"K":-0.0023193606337486,"L":0.992246909008529,"M":0.308481978696364},{"A":-6.73841285094845e-05,"B":-6.37121745272751e-06,"C":-4.12415066164407e-06,"D":1.01487004021561,"E":0.000928837597484744,"F":-0.828695813841478,"H":1.11667740880783e-05,"I":-1.05721749810161e-06,"J":8.14252568682727e-05,"K":-0.00236046082278563,"L":0.992247275848342,"M":0.31298565007819},{"A":0.000254931662773572,"B":-2.47402372943739e-06,"C":-4.78424102579034e-06,"D":0.942958863090041,"E":0.000545305593050216,"F":3.18082846764082,"H":1.11260391890688e-05,"I":-1.0577277693713e-06,"J":8.1425104173416e-05,"K":-0.00239592938842748,"L":0.992247664409092,"M":0.317257794955367},{"A":9.12284983378697e-05,"B":1.19514793390785e-05,"C":-4.78653211044566e-06,"D":0.979270184578695,"E":-0.00109461243965825,"F":1.16786934313132,"H":1.11584013988697e-05,"I":-1.05782436921054e-06,"J":8.14249576607806e-05,"K":-0.00244773087285921,"L":0.992248007127188,"M":0.32253144221977},{"A":-9.38402231627222e-05,"B":4.67615380261854e-06,"C":-4.57841480616672e-06,"D":1.02182620986025,"E":-0.000288351927167696,"F":-1.27815008885955,"H":1.11678565707374e-05,"I":-1.05768220803881e-06,"J":8.14248082422475e-05,"K":-0.00249454498126056,"L":0.992248322617883,"M":0.327623301935091},{"A":0.000202920514468241,"B":5.35452511618573e-06,"C":-4.70674899655243e-06,"D":0.9521798820291,"E":-0.000370546409840244,"F":2.80800997029291,"H":1.11332565988498e-05,"I":-1.05777667369633e-06,"J":8.14246583772382e-05,"K":-0.00253102459015508,"L":0.992248665667034,"M":0.332198286490893},{"A":2.8080282922005e-05,"B":1.50714219322445e-05,"C":-4.40089472819594e-06,"D":0.993331136385166,"E":-0.00156681207010934,"F":0.387551913911011,"H":1.1164513991524e-05,"I":-1.05760781043962e-06,"J":8.14245130013047e-05,"K":-0.00258301260871008,"L":0.992248976995427,"M":0.337775517768023},{"A":-0.000150236729223874,"B":2.89411067244671e-06,"C":-4.15725775537723e-06,"D":1.03670869811822,"E":-0.000127390882198597,"F":-2.24991101495834,"H":1.11692205180258e-05,"I":-1.05739942446448e-06,"J":8.14243630027911e-05,"K":-0.0026288335071456,"L":0.99224928315445,"M":0.343084193489631},{"A":0.000168549838941434,"B":-1.25240996684539e-07,"C":-4.49286917869607e-06,"D":0.95826202481544,"E":0.000261201213959339,"F":2.57552458051941,"H":1.11288496986717e-05,"I":-1.05761560109663e-06,"J":8.1424211175074e-05,"K":-0.00266349291857182,"L":0.992249641546309,"M":0.347791274731208},{"A":2.48448191788597e-05,"B":8.03754636491405e-06,"C":-4.54331202504044e-06,"D":0.993802837718135,"E":-0.00076454031426465,"F":0.378108912045718,"H":1.11553663973973e-05,"I":-1.05769452474203e-06,"J":8.14240633953411e-05,"K":-0.00271465643407964,"L":0.992249983110213,"M":0.353605655776846},{"A":-0.000122163735871705,"B":-3.11202556391166e-06,"C":-4.67077802834837e-06,"D":1.03132012320435,"E":0.000653471329371769,"F":-2.01587353007926,"H":1.11580904247344e-05,"I":-1.05776662362445e-06,"J":8.14239113026138e-05,"K":-0.00275999386727221,"L":0.99225032443573,"M":0.3591528067318},{"A":0.00021910803029046,"B":-2.92372383881023e-06,"C":-5.25754378610799e-06,"D":0.943094007506375,"E":0.000670818202934242,"F":3.68501868208114,"H":1.11189770515274e-05,"I":-1.05819064621926e-06,"J":8.14237585371469e-05,"K":-0.00279444777476101,"L":0.992250712087582,"M":0.364081435203843},{"A":8.34095536754731e-05,"B":9.71953930051228e-06,"C":-5.34245947059198e-06,"D":0.978047959076889,"E":-0.000987509534411402,"F":1.43448817486933,"H":1.11498174335534e-05,"I":-1.05833205099604e-06,"J":8.14236114922151e-05,"K":-0.00284702287672189,"L":0.992251063508405,"M":0.370272781496169},{"A":-7.32916513874748e-05,"B":2.98231468032206e-06,"C":-5.25138947282677e-06,"D":1.01969654790702,"E":-0.000110677211239363,"F":-1.33275994558062,"H":1.11586525048946e-05,"I":-1.0582808707138e-06,"J":8.14234616046128e-05,"K":-0.0028939985217562,"L":0.992251389792301,"M":0.376197490666527},{"A":0.000243707924995951,"B":6.15938301073982e-06,"C":-5.41106731177798e-06,"D":0.933783780991689,"E":-0.00053952929317802,"F":4.48798017491208,"H":1.11258516668489e-05,"I":-1.05841567266118e-06,"J":8.14233121608221e-05,"K":-0.00292969484524974,"L":0.992251741268149,"M":0.381447475690948}],[{"A":0.000160282164151759,"B":6.66725745168684e-06,"C":-1.34188864575613e-06,"D":0.975666883054828,"E":-0.000431863260786258,"F":0.919667237723843,"H":1.11507709656955e-05,"I":-1.07365586188291e-06,"J":-0.000141057060105698,"K":-0.00159688561788585,"L":1.01455377521467,"M":-0.314172954793321},{"A":8.65395226945509e-06,"B":1.43295625751882e-05,"C":-1.05470375666439e-06,"D":0.998639448287292,"E":-0.00106264054468852,"F":0.0505002966274333,"H":1.11778459970235e-05,"I":-1.0734719411154e-06,"J":-0.000141056031883524,"K":-0.00164568563579337,"L":1.01455403434386,"M":-0.31074341923977},{"A":-0.000145392886289786,"B":2.52077158702235e-07,"C":-9.48388121368993e-07,"D":1.02330927487827,"E":2.68213628373815e-05,"F":-0.936753252808558,"H":1.11797871298336e-05,"I":-1.0733724526979e-06,"J":-0.00014105500918471,"K":-0.00169073101562844,"L":1.01455429993983,"M":-0.307364522784155},{"A":0.000210630692852654,"B":-1.0045557130578e-06,"C":-1.45472398038748e-06,"D":0.965522627884809,"E":0.000162483917534928,"F":1.40711829899374,"H":1.11374167399703e-05,"I":-1.07372636648506e-06,"J":-0.000141053987053108,"K":-0.00172849369135974,"L":1.01455460261174,"M":-0.304195379540943},{"A":6.96817095464652e-05,"B":1.15650969985115e-05,"C":-1.46867083850033e-06,"D":0.988297809281391,"E":-0.000890911382953163,"F":0.487713784434163,"H":1.11685958504859e-05,"I":-1.0737929896365e-06,"J":-0.00014105295933009,"K":-0.00177824013368877,"L":1.01455488197887,"M":-0.300448770591174},{"A":-9.21983216154443e-05,"B":2.52299043768112e-06,"C":-1.37359541496629e-06,"D":1.01589644204785,"E":-0.000143655437625512,"F":-0.688369996078109,"H":1.11768867310236e-05,"I":-1.07373854885129e-06,"J":-0.000141051935602599,"K":-0.00182434855634028,"L":1.01455515142473,"M":-0.296757040941884},{"A":0.000240511655419384,"B":4.9221238389574e-06,"C":-1.63924732932141e-06,"D":0.957711018811551,"E":-0.000342732443755267,"F":1.85510966682341,"H":1.11413130772231e-05,"I":-1.07394705051167e-06,"J":-0.000141050911442453,"K":-0.00186277443563654,"L":1.01455544390954,"M":-0.293312365001839},{"A":6.70917952176886e-05,"B":1.87130029329907e-05,"C":-1.27017743234426e-06,"D":0.987895554634264,"E":-0.00161889768472179,"F":0.5432537174147,"H":1.11778786853201e-05,"I":-1.07375082758487e-06,"J":-0.000141049881463795,"K":-0.00191387182221092,"L":1.01455570013924,"M":-0.289221894941875},{"A":-0.000127372379704394,"B":8.00308718718057e-06,"C":-8.04946694854536e-07,"D":1.02344887743629,"E":-0.000703035496911752,"F":-1.08058353808156,"H":1.11887360425555e-05,"I":-1.07342438426805e-06,"J":-0.000141048856062809,"K":-0.0019605857320073,"L":1.0145559438638,"M":-0.28522843380415},{"A":0.000182129314137747,"B":6.32181577597812e-06,"C":-8.67328457498928e-07,"D":0.96579228770122,"E":-0.00055757998285344,"F":1.60474409339076,"H":1.11524768948712e-05,"I":-1.07346651145868e-06,"J":-0.000141047831639374,"K":-0.00199850290726999,"L":1.01455622120332,"M":-0.281556181455016},{"A":1.16815349926469e-06,"B":1.46359858415046e-05,"C":-5.7151021271018e-07,"D":0.999763508987144,"E":-0.00138872395518774,"F":0.0113696303160395,"H":1.11856572896363e-05,"I":-1.07329085463626e-06,"J":-0.0001410468030974,"K":-0.00204943186506057,"L":1.01455647735858,"M":-0.277184968043002},{"A":-0.000182061368644071,"B":-1.37345680961687e-06,"C":-4.93616588936874e-07,"D":1.03573577822061,"E":0.000144701272631664,"F":-1.75376966980548,"H":1.11925463878171e-05,"I":-1.07321688203044e-06,"J":-0.000141045780869153,"K":-0.00209551842112887,"L":1.01455674326677,"M":-0.2729470166596},{"A":0.000153664719729329,"B":-6.71262943141571e-06,"C":-1.20258443547794e-06,"D":0.969356470476896,"E":0.0007279624171872,"F":1.52581667369668,"H":1.11561017928086e-05,"I":-1.07371746116414e-06,"J":-0.000141044760623155,"K":-0.00213294523121021,"L":1.0145570667527,"M":-0.269052250821915},{"A":8.62920806721235e-06,"B":6.63744915030406e-07,"C":-1.68808469847015e-06,"D":0.998290257614485,"E":2.08940151367187e-05,"F":0.0817246666701976,"H":1.1205942267889e-05,"I":-1.07414202332734e-06,"J":-0.000141043736455626,"K":-0.00218759387706768,"L":1.01455738404802,"M":-0.264208773325663},{"A":-0.000138751208899723,"B":-1.30915789642305e-05,"C":-2.35253114033718e-06,"D":1.02896535884668,"E":0.00149358982048398,"F":-1.51599540512689,"H":1.14971753454318e-05,"I":-1.07490785727915e-06,"J":-0.000141042718426299,"K":-0.00229252497607035,"L":1.01455773877845,"M":-0.256658160040388},{"A":0.000222298508227858,"B":-1.36464690512206e-05,"C":-3.6008488086825e-06,"D":0.952995682051437,"E":0.00166135890393093,"F":2.47734511923045,"H":1.15259106234777e-05,"I":-1.07487072908974e-06,"J":-0.000141041693838218,"K":-0.0023466845759117,"L":1.01455801202171,"M":-0.251455833687942},{"A":8.67738532019935e-05,"B":1.8265848678034e-07,"C":-4.302435385517e-06,"D":0.981312976373829,"E":0.000241569131787855,"F":0.997171985953173,"H":1.11782203067179e-05,"I":-1.07558017359288e-06,"J":-0.000141040672506865,"K":-0.00231712864729161,"L":1.01455836635202,"M":-0.250805377441793},{"A":-7.02345875116528e-05,"B":-7.10604562259576e-06,"C":-4.80559146431858e-06,"D":1.01553325742634,"E":0.00107577081149657,"F":-0.868759816061356,"H":1.11628431700428e-05,"I":-1.07600583376666e-06,"J":-0.000141039652740593,"K":-0.00235834982112237,"L":1.01455869210041,"M":-0.24629726481362},{"A":0.00026572640595024,"B":-2.74976474035071e-06,"C":-5.56512901361828e-06,"D":0.94055432910676,"E":0.000652241153204614,"F":3.3128728817901,"H":1.11201417112294e-05,"I":-1.0765939228996e-06,"J":-0.000141038631526924,"K":-0.00239335826029219,"L":1.01455903767842,"M":-0.242052936800974},{"A":9.51009966638772e-05,"B":1.33980473382422e-05,"C":-5.56948111318789e-06,"D":0.978314466633037,"E":-0.00118324393690727,"F":1.22463628639525,"H":1.11543342371512e-05,"I":-1.07670709059704e-06,"J":-0.000141037604223959,"K":-0.00244555241232547,"L":1.014559330693,"M":-0.236759261917541},{"A":-9.78169186800493e-05,"B":5.25820678576316e-06,"C":-5.33137923031113e-06,"D":1.02271905322129,"E":-0.000282599828267394,"F":-1.32998940713878,"H":1.11646281912847e-05,"I":-1.07656748860041e-06,"J":-0.000141036580632581,"K":-0.00249254481335015,"L":1.01455959496737,"M":-0.23165896604587},{"A":0.000211523613150799,"B":6.0127697656398e-06,"C":-5.48004094591548e-06,"D":0.950116297218301,"E":-0.000372915698676479,"F":2.92988849005633,"H":1.11280765286992e-05,"I":-1.07667666227051e-06,"J":-0.000141035556973979,"K":-0.00252855016677245,"L":1.0145598881771,"M":-0.227113728509721},{"A":2.92736449292175e-05,"B":1.68912612210637e-05,"C":-5.13025413551027e-06,"D":0.992953217147772,"E":-0.00171426858003088,"F":0.413994472990453,"H":1.11610160375974e-05,"I":-1.07648810532268e-06,"J":-0.000141034528835848,"K":-0.00258092196759208,"L":1.01456014556953,"M":-0.221515618017293},{"A":-0.000156602136470063,"B":3.26435772013411e-06,"C":-4.85121123250387e-06,"D":1.0382426260511,"E":-0.000105193875583609,"F":-2.34393896929396,"H":1.11662839792359e-05,"I":-1.07627291645596e-06,"J":-0.000141033505877575,"K":-0.00262686636671106,"L":1.01456039933075,"M":-0.216201190043648},{"A":0.000175689705026905,"B":-1.19414749200075e-07,"C":-5.23783747841122e-06,"D":0.956490678461932,"E":0.000332942757381716,"F":2.68362566459837,"H":1.11236412141391e-05,"I":-1.07651692338173e-06,"J":-0.00014103248421915,"K":-0.00266094928980465,"L":1.01456070954032,"M":-0.211531618717345},{"A":2.58995888224867e-05,"B":9.01845916345678e-06,"C":-5.29727177256412e-06,"D":0.993487464977534,"E":-0.000814760713751639,"F":0.399316043884028,"H":1.11515579115373e-05,"I":-1.0766028624154e-06,"J":-0.000141031458259722,"K":-0.00271244430848583,"L":1.01456100036725,"M":-0.205698645648226},{"A":-0.000127336212006224,"B":-3.4577150873627e-06,"C":-5.44451196371476e-06,"D":1.03266087977721,"E":0.000773056675598127,"F":-2.10457544492965,"H":1.11546828516218e-05,"I":-1.07669694182633e-06,"J":-0.000141030437215528,"K":-0.00275786821862312,"L":1.01456129295454,"M":-0.200147950919927},{"A":0.000228385489279948,"B":-3.25258742672752e-06,"C":-6.11971428199354e-06,"D":0.940697977340108,"E":0.000797751757886545,"F":3.83765667078114,"H":1.11132998291685e-05,"I":-1.07716766684085e-06,"J":-0.000141029416055705,"K":-0.00279171611930451,"L":1.01456163509221,"M":-0.19526070723623},{"A":8.69491828670022e-05,"B":1.08999605883398e-05,"C":-6.21895712948906e-06,"D":0.977054006135404,"E":-0.00105769499941744,"F":1.50192387249263,"H":1.11456981291003e-05,"I":-1.07731739640293e-06,"J":-0.000141028389360198,"K":-0.00284467920872089,"L":1.01456193612077,"M":-0.189046247409351},{"A":-7.63963638714671e-05,"B":3.36223294583604e-06,"C":-6.11529622251972e-06,"D":1.02050899050482,"E":-7.72230862366996e-05,"F":-1.38793653838366,"H":1.11552065285014e-05,"I":-1.07726858789015e-06,"J":-0.00014102736597682,"K":-0.00289181880290812,"L":1.01456221128473,"M":-0.183112622238696},{"A":0.000254041643731107,"B":6.9125982791185e-06,"C":-6.30006196722377e-06,"D":0.93093504114114,"E":-0.00055509080613092,"F":4.68215144205169,"H":1.11204388842934e-05,"I":-1.07741258648097e-06,"J":-0.000141026341801798,"K":-0.00292696586470242,"L":1.01456251254535,"M":-0.177901923660102}],[{"A":0.000167595142166355,"B":7.50967750529075e-06,"C":-1.6301199614599e-06,"D":0.974511170446561,"E":-0.000468008342920712,"F":0.964588846527477,"H":1.1141761233846e-05,"I":-1.06373589525699e-06,"J":-4.44273468869216e-05,"K":-0.0015957294583302,"L":1.00444711074805,"M":-0.049751053734326},{"A":9.0506424224035e-06,"B":1.61190918421816e-05,"C":-1.29548458727147e-06,"D":0.99848394510667,"E":-0.00117926621177844,"F":0.0596731951263791,"H":1.11703296391541e-05,"I":-1.06351576445451e-06,"J":-4.44268585108043e-05,"K":-0.00164472813565908,"L":1.004447390781,"M":-0.0463154483650214},{"A":-0.000152018166884371,"B":3.04756933022787e-07,"C":-1.17235583196873e-06,"D":1.02436577578175,"E":4.37879091066407e-05,"F":-0.979365145376505,"H":1.11726396899714e-05,"I":-1.06343633854422e-06,"J":-4.44263765780883e-05,"K":-0.00168980162868593,"L":1.00444768172984,"M":-0.0429370087458665},{"A":0.000220229707957875,"B":-1.10922740459429e-06,"C":-1.76662141637696e-06,"D":0.963953575858682,"E":0.000201393289586349,"F":1.47049995778798,"H":1.11276904115609e-05,"I":-1.06382038822517e-06,"J":-4.44258953508081e-05,"K":-0.00172711131767755,"L":1.0044480106603,"M":-0.0397880169948621},{"A":7.2864219041735e-05,"B":1.30127704942584e-05,"C":-1.78461616939796e-06,"D":0.987687396810941,"E":-0.000981744199691548,"F":0.515785728863193,"H":1.1160518834652e-05,"I":-1.06386379328249e-06,"J":-4.4425407587978e-05,"K":-0.00177709696043848,"L":1.00444831184413,"M":-0.0360332917007327},{"A":-9.64005767689624e-05,"B":2.85568605495889e-06,"C":-1.67467766643004e-06,"D":1.01660121194658,"E":-0.000143058738814261,"F":-0.718603683220863,"H":1.11694703301968e-05,"I":-1.06382235653957e-06,"J":-4.44249244632156e-05,"K":-0.00182328614062044,"L":1.00444860620232,"M":-0.0323398479977186},{"A":0.000251481835022771,"B":5.54847064404562e-06,"C":-1.98722424271658e-06,"D":0.955747486349679,"E":-0.000363759292810073,"F":1.9421119208364,"H":1.1131653470442e-05,"I":-1.06403854094328e-06,"J":-4.44244408694949e-05,"K":-0.00186128716131861,"L":1.00444892317411,"M":-0.028915535829583},{"A":7.01593345573404e-05,"B":2.10436658143465e-05,"C":-1.55681040570066e-06,"D":0.98722173085477,"E":-0.0018009197461879,"F":0.578382432664512,"H":1.11701556718691e-05,"I":-1.06379030995196e-06,"J":-4.44239503470945e-05,"K":-0.00191269693604568,"L":1.00444919845744,"M":-0.0248129752308159},{"A":-0.000133182831913548,"B":9.0121015849931e-06,"C":-1.01349731862488e-06,"D":1.02446474537112,"E":-0.000776271221695879,"F":-1.12531675417267,"H":1.11818254319163e-05,"I":-1.06345290173948e-06,"J":-4.44234652753339e-05,"K":-0.00195953010887706,"L":1.00444946490266,"M":-0.0208157636043325},{"A":0.000190438538324456,"B":7.12191945728691e-06,"C":-1.08802029430422e-06,"D":0.964188274451772,"E":-0.000611936858092577,"F":1.68161065007735,"H":1.11432956576563e-05,"I":-1.06349337314349e-06,"J":-4.44229813145736e-05,"K":-0.00199699289876776,"L":1.00444976580089,"M":-0.0171665046073031},{"A":1.22300468730074e-06,"B":1.64634040871192e-05,"C":-7.43264756297712e-07,"D":0.999657375195966,"E":-0.00154837616290138,"F":0.0206967980921036,"H":1.11782070134625e-05,"I":-1.06327567372944e-06,"J":-4.44224925105763e-05,"K":-0.00204821949648704,"L":1.00445004157555,"M":-0.0127830061173881},{"A":-0.000190355873227244,"B":-1.52158885469156e-06,"C":-6.53426231123078e-07,"D":1.03736831464755,"E":0.000173720732192351,"F":-1.83441707241582,"H":1.11855760015489e-05,"I":-1.06322056214747e-06,"J":-4.4422011073797e-05,"K":-0.00209436955753972,"L":1.00445033301993,"M":-0.00854378272197209},{"A":0.0001606620303507,"B":-7.52064129194707e-06,"C":-1.48486071438469e-06,"D":0.967998700056455,"E":0.000835996317732679,"F":1.59096541984036,"H":1.11465014414058e-05,"I":-1.06376107533723e-06,"J":-4.44215320090091e-05,"K":-0.00213124062071302,"L":1.00445068426234,"M":-0.00467863684389158},{"A":9.02385988110765e-06,"B":7.66259662610125e-07,"C":-2.05483143123075e-06,"D":0.998203853154791,"E":4.64739767949141e-05,"F":0.0855495686628274,"H":1.11977565052657e-05,"I":-1.06418104139916e-06,"J":-4.44210484035201e-05,"K":-0.0021861396421059,"L":1.00445102490755,"M":0.000175320827111136},{"A":-0.000145061598662011,"B":-1.46838768748658e-05,"C":-2.83393472022553e-06,"D":1.0303599409541,"E":0.00170712919367588,"F":-1.59396791691688,"H":1.1489078079463e-05,"I":-1.06493659590701e-06,"J":-4.44205719137836e-05,"K":-0.00229105723127532,"L":1.00445140256794,"M":0.00772321886324789},{"A":0.000232410394027216,"B":-1.53114852241565e-05,"C":-4.29675812274599e-06,"D":0.950938255954156,"E":0.00190811043069061,"F":2.58003988843484,"H":1.15151739682462e-05,"I":-1.06538204192042e-06,"J":-4.44200875904244e-05,"K":-0.00234459988561753,"L":1.00445175053123,"M":0.0128894726003637},{"A":9.07299143078077e-05,"B":2.24483954980315e-07,"C":-5.119967853906e-06,"D":0.980455817872212,"E":0.000319988415355965,"F":1.0414980721107,"H":1.11694700746234e-05,"I":-1.06600134763823e-06,"J":-4.44196073254854e-05,"K":-0.00231543467450024,"L":1.00445211947917,"M":0.0135585957359581},{"A":-7.34311625119055e-05,"B":-7.96049891116368e-06,"C":-5.71026387352624e-06,"D":1.01628028111224,"E":0.00126175387043759,"F":-0.914590353571839,"H":1.11548232306635e-05,"I":-1.06645579056597e-06,"J":-4.44191288345719e-05,"K":-0.00235678019092234,"L":1.00445247268814,"M":0.0180711833290843},{"A":0.000277832972892966,"B":-3.07362287332857e-06,"C":-6.60110434380634e-06,"D":0.937858996152158,"E":0.000794173756730743,"F":3.46018812993134,"H":1.1109950638577e-05,"I":-1.06707032843101e-06,"J":-4.4418648619704e-05,"K":-0.00239126887311159,"L":1.00445284558063,"M":0.0222841617778613},{"A":9.94450209814701e-05,"B":1.50706449033589e-05,"C":-6.60829675047658e-06,"D":0.977236572742072,"E":-0.00126794325916535,"F":1.2883578007386,"H":1.11461729317419e-05,"I":-1.06715102343724e-06,"J":-4.44181612833106e-05,"K":-0.00244388650673955,"L":1.00445315923048,"M":0.0275993694303907},{"A":-0.000102277177584487,"B":5.92973015756115e-06,"C":-6.33072537659096e-06,"D":1.02371823254964,"E":-0.00025863560892958,"F":-1.38847017670196,"H":1.11573931036446e-05,"I":-1.06701067026371e-06,"J":-4.4417678242481e-05,"K":-0.00249106127728282,"L":1.0044534477706,"M":0.0327079840553779},{"A":0.000221173230248617,"B":6.77136355298202e-06,"C":-6.50630598064694e-06,"D":0.947799189843352,"E":-0.000357767476998561,"F":3.06627509828832,"H":1.11186832938426e-05,"I":-1.06711812319915e-06,"J":-4.44171951887729e-05,"K":-0.00252652845858847,"L":1.00445376513491,"M":0.0372193916427932},{"A":3.0612448438383e-05,"B":1.89967285895154e-05,"C":-6.09867401291098e-06,"D":0.992521872608336,"E":-0.0018682649274524,"F":0.443964748061262,"H":1.11534867186514e-05,"I":-1.06688484269313e-06,"J":-4.44167067893408e-05,"K":-0.00257931217248597,"L":1.00445404144543,"M":0.0428397239902552},{"A":-0.000163741457609445,"B":3.6906332439024e-06,"C":-5.77300260484748e-06,"D":1.03996169458799,"E":-6.3409387792035e-05,"F":-2.44978600458126,"H":1.11593722053049e-05,"I":-1.06667642374436e-06,"J":-4.44162245702984e-05,"K":-0.00262537694942466,"L":1.00445432033536,"M":0.0481592739924963},{"A":0.000183697514538839,"B":-1.16641057701372e-07,"C":-6.22702680819209e-06,"D":0.954504219852424,"E":0.000433395879156251,"F":2.80424895204487,"H":1.11142160688082e-05,"I":-1.06694252588468e-06,"J":-4.44157437551329e-05,"K":-0.00265880785900663,"L":1.00445465759859,"M":0.0527862671642652},{"A":2.70828061368356e-05,"B":1.01517020554276e-05,"C":-6.29843477173431e-06,"D":0.993129815202622,"E":-0.00085549360181858,"F":0.422994847642258,"H":1.11436838911017e-05,"I":-1.0670149169778e-06,"J":-4.44152579868184e-05,"K":-0.00271065665202741,"L":1.00445497102359,"M":0.0586388238116342},{"A":-0.000133137081959722,"B":-3.86104542604571e-06,"C":-6.47184448965277e-06,"D":1.034166159444,"E":0.000929444687187697,"F":-2.20487772431807,"H":1.11472488242281e-05,"I":-1.06714396974628e-06,"J":-4.44147778145831e-05,"K":-0.00275616008980251,"L":1.00445529243629,"M":0.0641921162405197},{"A":0.000238790329340155,"B":-3.63794656887961e-06,"C":-7.26381835147727e-06,"D":0.938012415869707,"E":0.00096475982843458,"F":4.00794848136138,"H":1.11033559178075e-05,"I":-1.06765139074039e-06,"J":-4.44142977314987e-05,"K":-0.00278932384819086,"L":1.00445566377388,"M":0.0690324621973559},{"A":9.09196939651302e-05,"B":1.22641126267808e-05,"C":-7.38208304040811e-06,"D":0.975934363458805,"E":-0.00111885468214723,"F":1.5774948618855,"H":1.11374809284026e-05,"I":-1.06778405539742e-06,"J":-4.44138109393366e-05,"K":-0.00284270371093953,"L":1.00445598694969,"M":0.0752714811096666},{"A":-7.98785107916089e-05,"B":3.7994897961191e-06,"C":-7.26189951061329e-06,"D":1.02141881284354,"E":-1.86347947419563e-05,"F":-1.4503193104465,"H":1.11477320667852e-05,"I":-1.06774702746115e-06,"J":-4.44133281415349e-05,"K":-0.00289000899249459,"L":1.00445628813674,"M":0.0812135939850123},{"A":0.000265632513526182,"B":7.78092214748227e-06,"C":-7.47986866134198e-06,"D":0.927736855014473,"E":-0.00055254337507904,"F":4.89963292333414,"H":1.11107899039009e-05,"I":-1.06789032439103e-06,"J":-4.44128444381242e-05,"K":-0.00292453466892084,"L":1.00445661375261,"M":0.0863796248086146}]];HGIS.Converter.minLon=75;HGIS.Converter.minLat=18;HGIS.Converter.maxLon=135;HGIS.Converter.maxLat=54;HGIS.Converter.per=2;HGIS.Converter.getFactor=function(A){var B,E;if(typeof(A.lon)=="undefined"){B=A.x;E=A.y}else{B=A.lon;E=A.lat}var C=Math.floor((E-HGIS.Converter.minLat)/HGIS.Converter.per);var D=Math.floor((B-HGIS.Converter.minLon)/HGIS.Converter.per);if(C<0){C=0}if(C>HGIS.Converter.Factor.length-1){C=HGIS.Converter.Factor.length-1}if(D<0){D=0}if(D>HGIS.Converter.Factor[0].length-1){D=HGIS.Converter.Factor[0].length-1}return HGIS.Converter.Factor[C][D]};HGIS.Converter=HGIS.Converter||{};HGIS.Converter.decrylon=function(A,B){var C=300+A+2*B+0.1*A*A+0.1*A*B+0.2*Math.sqrt(Math.abs(A));C+=(20*Math.sin(6*A*Math.PI)+20*Math.sin(2*A*Math.PI))*2/3;C+=(20*Math.sin(B*Math.PI)+40*Math.sin(B/3*Math.PI))*2/3;C+=(160*Math.sin(B/12*Math.PI)+320*Math.sin(B*Math.PI/30))*2/3;return C};HGIS.Converter.decrylat=function(A,B){var C=300+A+2*B+0.1*A*A+0.1*A*B+0.1*Math.sqrt(Math.abs(A));C+=(20*Math.sin(6*A*Math.PI)+20*Math.sin(2*A*Math.PI))*2/3;C+=(20*Math.sin(A*Math.PI)+40*Math.sin(A/3*Math.PI))*2/3;C+=(150*Math.sin(A/12*Math.PI)+300*Math.sin(A/30*Math.PI))*2/3;return C};HGIS.Converter.decry=function(D){var A=0.00669342162296594;var G=6378245;var F=HGIS.Converter.decrylat(D.x-105,D.y-35);var H=HGIS.Converter.decrylon(D.x-105,D.x-35);var E=D.y/180*Math.PI;var B=Math.sin(E);B=1-A*B*B;var C=Math.sqrt(B);F=(F*180)/((G*(1-A))/(B*C)*Math.PI);H=(H*180)/(G/C*Math.cos(E)*Math.PI);D.x=D.x+F;D.y=D.y+H};HGIS.Converter.encry=function(D){var A=0.00669342162296594;var G=6378245;var F=HGIS.Converter.decrylat(D.x-105,D.y-35);var H=HGIS.Converter.decrylon(D.x-105,D.x-35);var E=D.y/180*Math.PI;var B=Math.sin(E);B=1-A*B*B;var C=Math.sqrt(B);F=(F*180)/((G*(1-A))/(B*C)*Math.PI);H=(H*180)/(G/C*Math.cos(E)*Math.PI);D.x=D.x-F;D.y=D.y-H};HGIS.Data=HGIS.Data||{};HGIS.Data.FeatureType=function(){var A=this;A.superType=["poi","district","road","railway","resArea","area"];A.poi=["airport_pt","association_pt","border_port_pt","bridge_a_pt","bridge_b_pt","building_pt","car_maintenance_pt","car_rental_pt","car_seconde_pt","carpark_pt","carservice_pt","carstation_pt","commodity_pt","entrance_pt","exhcenter_pt","farmers_pt","high_speed_pt","hotel_a_pt","hotel_b_pt","industrial_pt","logistics_a_pt","logistics_b_pt","logistics_b_pt","logistics_c_pt","mall_a_pt","mall_b_pt","motorway_service_pt","oil_pt","park_a_pt","place_a_pt","post_pt","resarea_pt","school_university_a_pt","sight_a_pt","sight_b_pt","stores_a_pt","stores_b_pt","supermarket_pt","toll_pt","town_a_pt","town_b_pt","town_c_pt","town_d_pt","trastation_a_pt","trastation_b_pt","vehicle_detection_pt","business_pt","antique_pt","atm_pt","baby_pt","bank_pt","barber_pt","bicycle_pt","bread_pt","buspark_pt","clothing_pt","coffee_pt_pt","community_hospital_pt","company_pt","computer_pt","convenience_pt","cosmetics_pt","county_pt","cultural_pt","dental_pt","epidemic_pt","flowers_pt","food_bar_pt","food_china_pt","food_fast_pt","food_west_pt","garden_pt","government_pt","handicraft_pt","home_improvement_pt","hospital_a_pt","hospital_b_pt","hotel_c_pt","insurance_pt","ktv_pt","laundry_pt","library_pt","light_pt","lotterystation_pt","mobile_pt","mountain_pt","museum_a_pt","museum_b_pt","other_pt","other_rental_pt","paper_pt","park_b_pt","pet_hospital_pt","pet_pt","pill_pt","police_pt","retail_pt","school_pt","scientific_pt","securities_pt","sports_pt","square_pt","stadium_a_pt","stadium_b_pt","tea_pt","ticket_pt","training_pt","travel_pt","tv_station_pt","video_pt","village_committee_pt","wc_pt","wharf_pt","zoo_pt"];A.road=["oneroad_ln","tworoad_ln","threeroad_a_ln","threeroad_ln","ringroad_one_ln","ringroad_two_ln","ferry_ln","Ic_Oneroad_Ln","IC_TwoRoad_ln"];A.railway=["Railway_A_ln","Railway_B_ln"];A.district=["town_pg"];A.resArea=["Vegetation_A_pg","Vegetation_B_pg","School_University_pg","Hospital_pg","Sight_pg","Traffic_Hub_pg","House_pg"];A.area=["resarea_pg"];this.getAllSuperType=function(){return A.superType};this.getSuperTypeBySubType=function(B){if(this.contains(A.poi,B)){return"poi"}else{if(this.contains(A.district,B)){return"district"}else{if(this.contains(A.road,B)){return"road"}else{if(this.contains(A.resArea,B)){return"resArea"}else{if(this.contains(A.area,B)){return"area"}else{if(this.contains(A.railway,B)){return"railway"}else{return null}}}}}}};this.getSubTypeBySuperType=function(B){if(B=="poi"){return A.poi}else{if(B=="district"){return A.district}else{if(B=="road"){return A.road}else{if(B=="resArea"){return A.resArea}else{if(B=="railway"){return A.railway}else{if(B=="area"){return A.area}else{return null}}}}}}};this.buildQueryFeatureType=function(B){var C=[];if(B=="all"){C=[{"superType":"poi"},{"superType":"road"},{"superType":"railway"},{"superType":"district"},{"superType":"resArea"},{"superType":"area"}]}else{if(B=="poi"){C=[{"superType":"poi"}]}else{if(B=="road"){C=[{"superType":"road"}]}else{if(B=="railway"){C=[{"superType":"railway"}]}else{if(B=="district"){C=[{"superType":"district"}]}else{if(B=="resArea"){C=[{"superType":"resArea"}]}else{if(B=="area"){C=[{"superType":"area"}]}else{C=[]}}}}}}}return C};this.contains=function(D,C){var B=D.length;while(B--){if(D[B]===C){return true}}return false}};HGIS.Feature=HGIS.Feature||{};HGIS.Feature.Graphic=HGIS.Class({id:null,layer:null,attributes:null,geometry:null,infoTemplate:null,symbol:null,visible:true,events:null,_olObject:null,mouseOverStats:false,initialize:function(C,A,B,D){this.attributes=B;this.geometry=C;this.infoTemplate=D;this.symbol=A;this.events={click:[],mouseOver:[],mouseOut:[],doubleClick:[]}},getLayer:function(){},destroyOlObject:function(){if(this._olObject!==null){this._olObject.destroy();this._olObject=null}},hide:function(){},refresh:function(){if(this.layer===null||this.layer.map===null){return}thisMovie(this.layer.map.id).updateGraphic(this.toJson(),this.layer.toJson())},updateLevel:function(A){if(this.layer===null||this.layer.map===null){return}if(A==null||A==undefined){A=-1}thisMovie(this.layer.map.id).updateLevel(this.toJson(),this.layer.toJson(),A)},setAttributes:function(A){this.attributes=A},setGeometry:function(A){this.geometry=A},setInfoTemplate:function(A){},setSymbol:function(A){this.symbol=A},show:function(){this.visible=true},addEventListener:function(B,D){if(this.events[B]===null){return 0}for(var A=0;A<this.events[B].length;A++){if(this.events[B][A]===D){return 0}}this.events[B].push(D);if(this.layer==null||this.layer.map==null){return}var C={type:"graphic",id:this.id,layerId:this.layer.id,eventType:B};thisMovie(this.layer.map.id).addJSEventListener(C)},toJson:function(){var B={id:this.id,visible:this.visible};if(this.geometry){B.geometry=this.geometry.toJson()}if(this.attributes){B.attributes=HGIS.Util.extend({},this.attributes)}if(this.symbol){B.symbol=this.symbol.toJson()}if(this.infoTemplate){B.infoTemplate=this.infoTemplate.toJson()}var A=[];for(var C in this.events){if(this.events[C].length>0){A.push(C)}}B.events=A;return B},getOlObject:function(){if(this._olObject==null){this._olObject=new HGIS.Feature.Vector(this.geometry,this.attributes);this._olObject.style=this._getStyleBySymbol();this._olObject.events=this.events}return this._olObject},_getStyleBySymbol:function(B){B=B?B:this.symbol;var C=new Object();if(B.type=="simplelinesymbol"){C["stroke"]=true;C["strokeColor"]=this._getColor(B.color)||"#0000ff";C["strokeOpacity"]=B.color.a;C["strokeWidth"]=B.width||1;C["strokeDashstyle"]=B.style||"solid";C["cursor"]=B.cursor||"";if(B.endArrow){C["endArrow"]=true}}else{if(B.type=="picturemarkersymbol"){C["externalGraphic"]=B.url;C["graphicWidth"]=B.width||28;C["graphicHeight"]=B.height||30;C["rotation"]=B.angle||0;C["graphicXOffset"]=B.xoffset||0;C["graphicYOffset"]=B.yoffset||0;C["stroke"]=false;if(typeof(B.outline)==="object"){C["stroke"]=true;C["strokeColor"]=this._getColor(B.outline.color)||"#000000";C["strokeOpacity"]=B.outline.color.a;C["strokeWidth"]=B.outline.width;C["strokeDashstyle"]=B.outline.style||"solid"}}else{if(B.type=="compositesymbol"){for(var A in B.symbols){HGIS.Util.extend(C,this._getStyleBySymbol(B.symbols[A]))}}else{if(B.type=="textsymbol"){C["fill"]=false;C["label"]=B.text||"";C["rotation"]=B.angle||0;C["labelXOffset"]=B.xoffset||0;C["labelYOffset"]=B.yoffset||0;C["labelAlign"]={"middle":"cm","start":"lm","above":"ct","below":"cb","end":"rm"}[B.placement]||"cm";if(B.borderLineColor){C["labelOutlineColor"]=this._getColor(B.borderLineColor)}if(B.color){C["fontColor"]=this._getColor(B.color)||"#000000"}if(B.font){C["fontSize"]=B.font.size;C["fontWeight"]=B.font.weight;C["fontStyle"]=B.font.style;C["fontFamily"]=B.font.family}if(B.backgroundColor){C["backgroundColor"]=this._getColor(B.backgroundColor)||"#FFFFFF"}}else{if(B.type=="simplemarkersymbol"||B.type=="simplefillsymbol"){C["fillColor"]=this._getColor(B.color);C["fillOpacity"]=B.color.a;C["rotation"]=B.angle||0;C["pointRadius"]=B.size||12;C["labelXOffset"]=B.xoffset||0;C["labelYOffset"]=B.yoffset||0;C["graphicName"]=B.style;C["stroke"]=false;C["cursor"]=B.cursor||"";if(typeof(B.outline)==="object"&&B.outline!=null){C["stroke"]=true;C["strokeColor"]=this._getColor(B.outline.color)||"#000000";C["strokeOpacity"]=B.outline.color.a;C["strokeWidth"]=B.outline.width;C["strokeDashstyle"]=B.outline.style||"solid"}}}}}}return C},_getColor:function(A){return"#"+this.toString16(A.r)+this.toString16(A.g)+this.toString16(A.b)},toString16:function(B){var A=B.toString(16);while(A.length<2){A="0"+A}return A},CLASS_NAME:"HGIS.Feature.Graphic"});var xhrSendOrig=HGIS.Request.XMLHttpRequest.prototype.send;HGIS.Request.XMLHttpRequest.prototype.send=function(A){this._object.responseType="arraybuffer";xhrSendOrig.apply(this,arguments)};var httpParseFeaturesOrig=HGIS.Protocol.HTTP.prototype.parseFeatures;HGIS.Protocol.HTTP.prototype.parseFeatures=function(A){if(!A._object.response){return httpParseFeaturesOrig.apply(this,arguments)}else{return this.format.read(A._object.response)}};var httpHandleResponseOrig=HGIS.Protocol.HTTP.prototype.handleResponse;HGIS.Protocol.HTTP.prototype.handleResponse=function(B,A){if(B.priv.status===0){B.priv.status=200;B.priv._object.status=200}httpHandleResponseOrig.apply(this,arguments)};HGIS.Geometry.PbfPoint=HGIS.Class(HGIS.Geometry.Point,{initialize:function(A,B){HGIS.Util.lastSeqID+=1;this.id="HGIS_Geometry_Point_"+HGIS.Util.lastSeqID;if(typeof A==="number"){this.x=A;this.y=B}else{this.x=parseFloat(A);this.y=parseFloat(B)}}});HGIS.Format.PBF=HGIS.Class(HGIS.Format.OSM,{initialize:function(A){A=A||{};HGIS.Format.OSM.prototype.initialize.apply(this,arguments)},read:function(B){var H=new Pbf(B);var A=Tile.read(H);var D=[];if(A!=null&&A.layers!=null){var F=A.layers.length;for(var E=0;E<F;E++){var G=A.layers[E].features;for(var C=0;C<G.length;C++){this.d(G[C],A.layers[E]);D.push(G[C])}}}return D},d:function(B,F){var D=B.tags;var C={};for(var G=0;G<D.length/2;G++){var A=F.keys[D[2*G]];var E=F.values[D[2*G+1]].string_value;C[A]=E}B["attributes"]=C;B["origin"]=F.geolt;B.destroy=function(){};this.decode(B)},formatFeatureId:function(A){var E=A["origin"].split("-")[0];var B=A["origin"].split("-")[1];var D=E.length;var G=B.length;if(D<6){for(var C=0;C<6-D;C++){E="0"+E}}else{if(D>6){E=E.substring(D-6)}}if(G<6){for(var F=0;F<6-G;F++){B="0"+B}}else{if(G>6){B=B.substring(G-6)}}A["id"]="1"+E+B+A["id"]},decodeCommandType:function(A){return A&7},decodeCount:function(A){return A>>3},decodeParameterInteger:function(A){return((A>>1)^(-(A&1)))},decode:function(A){if(A.type==3){this.decodePolygon(A)}else{if(A.type==2){this.decodePolyLine(A)}else{if(A.type==1){this.decodePoint(A)}else{return}}}},clone:function(B){var C=[],A=0,D=B.length;for(;A<D;A++){if(B[A] instanceof Array){C[A]=deepcopy(B[A])}else{C[A]=B[A]}}return C},decodePoint:function(L){var H=0,I=0,E=1,C=0,A=0;var J=[];var G=L.geometry;var B=G.length;HGIS.Matrix.init();while(H<B){var D=G[H];var K=this.decodeCommandType(D);var E=this.decodeCount(D);for(var F=H+1;F<H+1+E*2;F=F+2){C=this.decodeParameterInteger(G[F]);A=this.decodeParameterInteger(G[F+1]);J.push(C);J.push(A);HGIS.Matrix.move(C,A)}H=H+1+2*E}L["attributes"]["hashcode"]=HGIS.Matrix.m;L.geometry=J},decodePolyLine:function(K){var Q=K.geometry;var G=0,H=0,P=1,N=0,S=0;var L=0;var B=0;var M=Q.length;var J=[];HGIS.Matrix.init();while(G<M){var C=Q[G];var R=this.decodeCommandType(C);var P=this.decodeCount(C);if(R==1){if(J.lentgh>0){J.push("|");J.push("|")}for(j=0;j<P;j=j+2){var D=j+G+1;var A=this.decodeParameterInteger(Q[D])+L;var E=this.decodeParameterInteger(Q[D+1])+B;L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}else{if(R==2){var I=P*2+G,O=G+1;for(var F=O;F<I;F=F+2){var A=this.decodeParameterInteger(Q[F])+L;var E=this.decodeParameterInteger(Q[F+1])+B;HGIS.Matrix.line(L,B,A,E);L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}}}K["attributes"]["hashcode"]=HGIS.Matrix.m;K.geometry=J},decodePolygon:function(K){var Q=K.geometry;var G=0,H=0,P=1,N=0,S=0;var L=0;var B=0;var M=Q.length;var J=[];HGIS.Matrix.init();while(G<M){var C=Q[G];var R=this.decodeCommandType(C);var P=this.decodeCount(C);if(R==1){if(J.lentgh>0){J.push("|");J.push("|")}for(j=0;j<P;j=j+2){var D=j+G+1;var A=this.decodeParameterInteger(Q[D])+L;var E=this.decodeParameterInteger(Q[D+1])+B;L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}else{if(R==2){var I=P*2+G,O=G+1;for(var F=O;F<I;F=F+2){var A=this.decodeParameterInteger(Q[F])+L;var E=this.decodeParameterInteger(Q[F+1])+B;HGIS.Matrix.line(L,B,A,E);L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}else{if(R==7){P=0;HGIS.Matrix.fill();G=G+P*2+1}}}}K["attributes"]["hashcode"]=HGIS.Matrix.m;K.geometry=J},CLASS_NAME:"HGIS.Format.PBF"});(function(A){var C={};function B(E){if(C[E]){return C[E].exports}var D=C[E]={i:E,l:false,exports:{}};A[E].call(D.exports,D,D.exports,B);D.l=true;return D.exports}B.m=A;B.c=C;B.d=function(F,D,E){if(!B.o(F,D)){Object.defineProperty(F,D,{configurable:false,enumerable:true,get:E})}};B.n=function(D){var E=D&&D.__esModule?function F(){return D["default"]}:function G(){return D};B.d(E,"a",E);return E};B.o=function(D,E){return Object.prototype.hasOwnProperty.call(D,E)};B.p="";return B(B.s=0)})([(function(D,E,C){var B=C(1);var A=C(3);window.Pbf=B;window.Tile=A.Tile}),(function(S,H,U){S.exports=Y;var E=U(2);function Y(d){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(d)?d:new Uint8Array(d||0);this.pos=0;this.type=0;this.length=this.buf.length}Y.Varint=0;Y.Fixed64=1;Y.Bytes=2;Y.Fixed32=5;var P=(1<<16)*(1<<16),Q=1/P;Y.prototype={destroy:function(){this.buf=null},readFields:function(e,f,h){h=h||this.length;while(this.pos<h){var i=this.readVarint(),d=i>>3,g=this.pos;this.type=i&7;e(d,f,this);if(this.pos===g){this.skip(i)}}return f},readMessage:function(d,e){return this.readFields(d,e,this.readVarint()+this.pos)},readFixed32:function(){var d=A(this.buf,this.pos);this.pos+=4;return d},readSFixed32:function(){var d=G(this.buf,this.pos);this.pos+=4;return d},readFixed64:function(){var d=A(this.buf,this.pos)+A(this.buf,this.pos+4)*P;this.pos+=8;return d},readSFixed64:function(){var d=A(this.buf,this.pos)+G(this.buf,this.pos+4)*P;this.pos+=8;return d},readFloat:function(){var d=E.read(this.buf,this.pos,true,23,4);this.pos+=4;return d},readDouble:function(){var d=E.read(this.buf,this.pos,true,52,8);this.pos+=8;return d},readVarint:function(d){var f=this.buf,g,e;e=f[this.pos++];g=e&127;if(e<128){return g}e=f[this.pos++];g|=(e&127)<<7;if(e<128){return g}e=f[this.pos++];g|=(e&127)<<14;if(e<128){return g}e=f[this.pos++];g|=(e&127)<<21;if(e<128){return g}e=f[this.pos];g|=(e&15)<<28;return V(g,d,this)},readVarint64:function(){return this.readVarint(true)},readSVarint:function(){var d=this.readVarint();return d%2===1?(d+1)/-2:d/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,d=X(this.buf,this.pos,e);this.pos=e;return d},readBytes:function(){var e=this.readVarint()+this.pos,d=this.buf.subarray(this.pos,e);this.pos=e;return d},readPackedVarint:function(f,d){var e=F(this);f=f||[];while(this.pos<e){f.push(this.readVarint(d))}return f},readPackedSVarint:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readSVarint())}return e},readPackedBoolean:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readBoolean())}return e},readPackedFloat:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readFloat())}return e},readPackedDouble:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readDouble())}return e},readPackedFixed32:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readFixed32())}return e},readPackedSFixed32:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readSFixed32())}return e},readPackedFixed64:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readFixed64())}return e},readPackedSFixed64:function(e){var d=F(this);e=e||[];while(this.pos<d){e.push(this.readSFixed64())}return e},skip:function(e){var d=e&7;if(d===Y.Varint){while(this.buf[this.pos++]>127){}}else{if(d===Y.Bytes){this.pos=this.readVarint()+this.pos}else{if(d===Y.Fixed32){this.pos+=4}else{if(d===Y.Fixed64){this.pos+=8}else{throw new Error("Unimplemented type: "+d)}}}}},writeTag:function(d,e){this.writeVarint((d<<3)|e)},realloc:function(d){var e=this.length||16;while(e<this.pos+d){e*=2}if(e!==this.length){var f=new Uint8Array(e);f.set(this.buf);this.buf=f;this.length=e}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,this.length)},writeFixed32:function(d){this.realloc(4);J(this.buf,d,this.pos);this.pos+=4},writeSFixed32:function(d){this.realloc(4);J(this.buf,d,this.pos);this.pos+=4},writeFixed64:function(d){this.realloc(8);J(this.buf,d&-1,this.pos);J(this.buf,Math.floor(d*Q),this.pos+4);this.pos+=8},writeSFixed64:function(d){this.realloc(8);J(this.buf,d&-1,this.pos);J(this.buf,Math.floor(d*Q),this.pos+4);this.pos+=8},writeVarint:function(d){d=+d||0;if(d>268435455||d<0){C(d,this);return}this.realloc(4);this.buf[this.pos++]=d&127|(d>127?128:0);if(d<=127){return}this.buf[this.pos++]=((d>>>=7)&127)|(d>127?128:0);if(d<=127){return}this.buf[this.pos++]=((d>>>=7)&127)|(d>127?128:0);if(d<=127){return}this.buf[this.pos++]=(d>>>7)&127},writeSVarint:function(d){this.writeVarint(d<0?-d*2-1:d*2)},writeBoolean:function(d){this.writeVarint(Boolean(d))},writeString:function(d){d=String(d);this.realloc(d.length*4);this.pos++;var f=this.pos;this.pos=M(this.buf,d,this.pos);var e=this.pos-f;if(e>=128){W(f,e,this)}this.pos=f-1;this.writeVarint(e);this.pos+=e},writeFloat:function(d){this.realloc(4);E.write(this.buf,d,this.pos,true,23,4);this.pos+=4},writeDouble:function(d){this.realloc(8);E.write(this.buf,d,this.pos,true,52,8);this.pos+=8},writeBytes:function(e){var f=e.length;this.writeVarint(f);this.realloc(f);for(var d=0;d<f;d++){this.buf[this.pos++]=e[d]}},writeRawMessage:function(e,d){this.pos++;var g=this.pos;e(d,this);var f=this.pos-g;if(f>=128){W(g,f,this)}this.pos=g-1;this.writeVarint(f);this.pos+=f},writeMessage:function(d,f,e){this.writeTag(d,Y.Bytes);this.writeRawMessage(f,e)},writePackedVarint:function(d,e){this.writeMessage(d,Z,e)},writePackedSVarint:function(d,e){this.writeMessage(d,D,e)},writePackedBoolean:function(d,e){this.writeMessage(d,I,e)},writePackedFloat:function(d,e){this.writeMessage(d,a,e)},writePackedDouble:function(d,e){this.writeMessage(d,B,e)},writePackedFixed32:function(d,e){this.writeMessage(d,K,e)},writePackedSFixed32:function(d,e){this.writeMessage(d,O,e)},writePackedFixed64:function(d,e){this.writeMessage(d,N,e)},writePackedSFixed64:function(d,e){this.writeMessage(d,R,e)},writeBytesField:function(d,e){this.writeTag(d,Y.Bytes);this.writeBytes(e)},writeFixed32Field:function(d,e){this.writeTag(d,Y.Fixed32);this.writeFixed32(e)},writeSFixed32Field:function(d,e){this.writeTag(d,Y.Fixed32);this.writeSFixed32(e)},writeFixed64Field:function(d,e){this.writeTag(d,Y.Fixed64);this.writeFixed64(e)},writeSFixed64Field:function(d,e){this.writeTag(d,Y.Fixed64);this.writeSFixed64(e)},writeVarintField:function(d,e){this.writeTag(d,Y.Varint);this.writeVarint(e)},writeSVarintField:function(d,e){this.writeTag(d,Y.Varint);this.writeSVarint(e)},writeStringField:function(d,e){this.writeTag(d,Y.Bytes);this.writeString(e)},writeFloatField:function(d,e){this.writeTag(d,Y.Fixed32);this.writeFloat(e)},writeDoubleField:function(d,e){this.writeTag(d,Y.Fixed64);this.writeDouble(e)},writeBooleanField:function(d,e){this.writeVarintField(d,Boolean(e))}};function V(g,e,f){var n=f.buf,d,i;i=n[f.pos++];d=(i&112)>>4;if(i<128){return L(g,d,e)}i=n[f.pos++];d|=(i&127)<<3;if(i<128){return L(g,d,e)}i=n[f.pos++];d|=(i&127)<<10;if(i<128){return L(g,d,e)}i=n[f.pos++];d|=(i&127)<<17;if(i<128){return L(g,d,e)}i=n[f.pos++];d|=(i&127)<<24;if(i<128){return L(g,d,e)}i=n[f.pos++];d|=(i&1)<<31;if(i<128){return L(g,d,e)}throw new Error("Expected varint not more than 10 bytes")}function F(d){return d.type===Y.Bytes?d.readVarint()+d.pos:d.pos+1}function L(e,f,d){if(d){return f*4294967296+(e>>>0)}return((f>>>0)*4294967296)+(e>>>0)}function C(f,g){var d,e;if(f>=0){d=(f%4294967296)|0;e=(f/4294967296)|0}else{d=~(-f%4294967296);e=~(-f/4294967296);if(d^4294967295){d=(d+1)|0}else{d=0;e=(e+1)|0}}if(f>=1.84467440737096e+19||f<-1.84467440737096e+19){throw new Error("Given varint doesn't fit into 10 bytes")}g.realloc(10);T(d,e,g);b(e,g)}function T(d,f,e){e.buf[e.pos++]=d&127|128;d>>>=7;e.buf[e.pos++]=d&127|128;d>>>=7;e.buf[e.pos++]=d&127|128;d>>>=7;e.buf[e.pos++]=d&127|128;d>>>=7;e.buf[e.pos]=d&127}function b(f,e){var d=(f&7)<<4;e.buf[e.pos++]|=d|((f>>>=3)?128:0);if(!f){return}e.buf[e.pos++]=f&127|((f>>>=7)?128:0);if(!f){return}e.buf[e.pos++]=f&127|((f>>>=7)?128:0);if(!f){return}e.buf[e.pos++]=f&127|((f>>>=7)?128:0);if(!f){return}e.buf[e.pos++]=f&127|((f>>>=7)?128:0);if(!f){return}e.buf[e.pos++]=f&127}function W(g,f,h){var e=f<=16383?1:f<=2097151?2:f<=268435455?3:Math.ceil(Math.log(f)/(Math.LN2*7));h.realloc(e);for(var d=h.pos-1;d>=g;d--){h.buf[d+e]=h.buf[d]}}function Z(e,f){for(var d=0;d<e.length;d++){f.writeVarint(e[d])}}function D(e,f){for(var d=0;d<e.length;d++){f.writeSVarint(e[d])}}function a(e,f){for(var d=0;d<e.length;d++){f.writeFloat(e[d])}}function B(e,f){for(var d=0;d<e.length;d++){f.writeDouble(e[d])}}function I(e,f){for(var d=0;d<e.length;d++){f.writeBoolean(e[d])}}function K(e,f){for(var d=0;d<e.length;d++){f.writeFixed32(e[d])}}function O(e,f){for(var d=0;d<e.length;d++){f.writeSFixed32(e[d])}}function N(e,f){for(var d=0;d<e.length;d++){f.writeFixed64(e[d])}}function R(e,f){for(var d=0;d<e.length;d++){f.writeSFixed64(e[d])}}function A(e,d){return((e[d])|(e[d+1]<<8)|(e[d+2]<<16))+(e[d+3]*16777216)}function J(e,f,d){e[d]=f;e[d+1]=(f>>>8);e[d+2]=(f>>>16);e[d+3]=(f>>>24)}function G(e,d){return((e[d])|(e[d+1]<<8)|(e[d+2]<<16))+(e[d+3]<<24)}function X(e,l,s){var f="";var h=l;while(h<s){var n=e[h];var p=null;var g=n>239?4:n>223?3:n>191?2:1;if(h+g>s){break}var d,o,q;if(g===1){if(n<128){p=n}}else{if(g===2){d=e[h+1];if((d&192)===128){p=(n&31)<<6|(d&63);if(p<=127){p=null}}}else{if(g===3){d=e[h+1];o=e[h+2];if((d&192)===128&&(o&192)===128){p=(n&15)<<12|(d&63)<<6|(o&63);if(p<=2047||(p>=55296&&p<=57343)){p=null}}}else{if(g===4){d=e[h+1];o=e[h+2];q=e[h+3];if((d&192)===128&&(o&192)===128&&(q&192)===128){p=(n&15)<<18|(d&63)<<12|(o&63)<<6|(q&63);if(p<=65535||p>=1114112){p=null}}}}}}if(p===null){p=65533;g=1}else{if(p>65535){p-=65536;f+=String.fromCharCode(p>>>10&1023|55296);p=56320|p&1023}}f+=String.fromCharCode(p);h+=g}return f}function M(h,g,e){for(var d=0,l,f;d<g.length;d++){l=g.charCodeAt(d);if(l>55295&&l<57344){if(f){if(l<56320){h[e++]=239;h[e++]=191;h[e++]=189;f=l;continue}else{l=f-55296<<10|l-56320|65536;f=null}}else{if(l>56319||(d+1===g.length)){h[e++]=239;h[e++]=191;h[e++]=189}else{f=l}continue}}else{if(f){h[e++]=239;h[e++]=191;h[e++]=189;f=null}}if(l<128){h[e++]=l}else{if(l<2048){h[e++]=l>>6|192}else{if(l<65536){h[e++]=l>>12|224}else{h[e++]=l>>18|240;h[e++]=l>>12&63|128}h[e++]=l>>6&63|128}h[e++]=l&63|128}}return e}}),(function(A,B){B.read=function(M,E,F,O,H){var C,K;var L=H*8-O-1;var J=(1<<L)-1;var G=J>>1;var N=-7;var I=F?(H-1):0;var P=F?-1:1;var D=M[E+I];I+=P;C=D&((1<<(-N))-1);D>>=(-N);N+=L;for(;N>0;C=C*256+M[E+I],I+=P,N-=8){}K=C&((1<<(-N))-1);C>>=(-N);N+=O;for(;N>0;K=K*256+M[E+I],I+=P,N-=8){}if(C===0){C=1-G}else{if(C===J){return K?NaN:((D?-1:1)*Infinity)}else{K=K+Math.pow(2,O);C=C-G}}return(D?-1:1)*K*Math.pow(2,C-O)};B.write=function(O,J,E,F,P,I){var C,M,Q;var N=I*8-P-1;var L=(1<<N)-1;var G=L>>1;var R=(P===23?Math.pow(2,-24)-Math.pow(2,-77):0);var K=F?0:(I-1);var H=F?1:-1;var D=J<0||(J===0&&1/J<0)?1:0;J=Math.abs(J);if(isNaN(J)||J===Infinity){M=isNaN(J)?1:0;C=L}else{C=Math.floor(Math.log(J)/Math.LN2);if(J*(Q=Math.pow(2,-C))<1){C--;Q*=2}if(C+G>=1){J+=R/Q}else{J+=R*Math.pow(2,1-G)}if(J*Q>=2){C++;Q/=2}if(C+G>=L){M=0;C=L}else{if(C+G>=1){M=(J*Q-1)*Math.pow(2,P);C=C+G}else{M=J*Math.pow(2,G-1)*Math.pow(2,P);C=0}}}for(;P>=8;O[E+K]=M&255,K+=H,M/=256,P-=8){}C=(C<<P)|M;N+=P;for(;N>0;O[E+K]=C&255,K+=H,C/=256,N-=8){}O[E+K-H]|=D*128}}),(function(B,C){var A=C.Tile={};A.read=function(E,D){return E.readFields(A._readField,{layers:[]},D)};A._readField=function(D,E,F){if(D===3){E.layers.push(A.Layer.read(F,F.readVarint()+F.pos))}};A.write=function(E,F){if(E.layers){for(var D=0;D<E.layers.length;D++){F.writeMessage(3,A.Layer.write,E.layers[D])}}};A.GeomType={"UNKNOWN":0,"POINT":1,"LINESTRING":2,"POLYGON":3};A.Value={};A.Value.read=function(E,D){return E.readFields(A.Value._readField,{string_value:"",float_value:0,double_value:0,int_value:0,uint_value:0,sint_value:0,bool_value:false},D)};A.Value._readField=function(D,E,F){if(D===1){E.string_value=F.readString()}else{if(D===2){E.float_value=F.readFloat()}else{if(D===3){E.double_value=F.readDouble()}else{if(D===4){E.int_value=F.readVarint(true)}else{if(D===5){E.uint_value=F.readVarint()}else{if(D===6){E.sint_value=F.readSVarint()}else{if(D===7){E.bool_value=F.readBoolean()}}}}}}}};A.Value.write=function(D,E){if(D.string_value){E.writeStringField(1,D.string_value)}if(D.float_value){E.writeFloatField(2,D.float_value)}if(D.double_value){E.writeDoubleField(3,D.double_value)}if(D.int_value){E.writeVarintField(4,D.int_value)}if(D.uint_value){E.writeVarintField(5,D.uint_value)}if(D.sint_value){E.writeSVarintField(6,D.sint_value)}if(D.bool_value){E.writeBooleanField(7,D.bool_value)}};A.Feature={};A.Feature.read=function(E,D){return E.readFields(A.Feature._readField,{id:0,tags:[],type:0,geometry:[]},D)};A.Feature._readField=function(D,E,F){if(D===1){E.id=F.readVarint()}else{if(D===2){F.readPackedVarint(E.tags)}else{if(D===3){E.type=F.readVarint()}else{if(D===4){F.readPackedVarint(E.geometry)}}}}};A.Feature.write=function(D,E){if(D.id){E.writeVarintField(1,D.id)}if(D.tags){E.writePackedVarint(2,D.tags)}if(D.type){E.writeVarintField(3,D.type)}if(D.geometry){E.writePackedVarint(4,D.geometry)}};A.Layer={};A.Layer.read=function(E,D){return E.readFields(A.Layer._readField,{version:1,name:"",features:[],keys:[],values:[],extent:4096},D)};A.Layer._readField=function(D,E,F){if(D===15){E.version=F.readVarint()}else{if(D===1){E.name=F.readString()}else{if(D===2){E.features.push(A.Feature.read(F,F.readVarint()+F.pos))}else{if(D===3){E.keys.push(F.readString())}else{if(D===4){E.values.push(A.Value.read(F,F.readVarint()+F.pos))}else{if(D===5){E.extent=F.readVarint()}else{if(D===8){E.geolt=F.readString()}}}}}}}};A.Layer.write=function(E,F){if(E.version!=undefined&&E.version!==1){F.writeVarintField(15,E.version)}if(E.name){F.writeStringField(1,E.name)}if(E.features){for(var D=0;D<E.features.length;D++){F.writeMessage(2,A.Feature.write,E.features[D])}}if(E.keys){for(D=0;D<E.keys.length;D++){F.writeStringField(3,E.keys[D])}}if(E.values){for(D=0;D<E.values.length;D++){F.writeMessage(4,A.Value.write,E.values[D])}}if(E.extent!=undefined&&E.extent!==4096){F.writeVarintField(5,E.extent)}if(E.geolt){F.writeStringField(8,E.geolt)}}})]);function decodeCommandType(A){return A&7}function decodeCount(A){return A>>3}function decodeParameterInteger(A){return((A>>1)^(-(A&1)))}function decode(A){if(A.type==3){decodePolygon(A)}else{if(A.type==2){decodePolyLine(A)}else{if(A.type==1){decodePoint(A)}else{return}}}}function decodePoint(L){var H=0,I=0,E=1,C=0,A=0;var J=[];var G=L.geometry;var B=G.length;while(H<B){var D=G[H];var K=decodeCommandType(D);var E=decodeCount(D);for(var F=H+1;F<H+1+E*2;F=F+2){C=decodeParameterInteger(G[F]);A=decodeParameterInteger(G[F+1]);J.push(C);J.push(A)}H=H+1+2*E}L.geoStr=J}function decodePolyLine(K){var Q=K.geometry;var G=0,H=0,P=1,N=0,S=0;var L=0;var B=0;var M=Q.length;var J=[];while(G<M){var C=Q[G];var R=decodeCommandType(C);var P=decodeCount(C);if(R==1){if(J.lentgh>0){J.push("|");J.push("|")}for(j=0;j<P;j=j+2){var D=j+G+1;var A=decodeParameterInteger(Q[D])+L;var E=decodeParameterInteger(Q[D+1])+B;L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}else{if(R==2){var I=P*2+G,O=G+1;for(var F=O;F<I;F=F+2){var A=decodeParameterInteger(Q[F])+L;var E=decodeParameterInteger(Q[F+1])+B;L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}}}K.geoStr=J}function decodePolygon(K){var Q=K.geometry;var G=0,H=0,P=1,N=0,S=0;var L=0;var B=0;var M=Q.length;var J=[];while(G<M){var C=Q[G];var R=decodeCommandType(C);var P=decodeCount(C);if(R==1){if(J.lentgh>0){J.push("|");J.push("|")}for(j=0;j<P;j=j+2){var D=j+G+1;var A=decodeParameterInteger(Q[D])+L;var E=decodeParameterInteger(Q[D+1])+B;L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}else{if(R==2){var I=P*2+G,O=G+1;for(var F=O;F<I;F=F+2){var A=decodeParameterInteger(Q[F])+L;var E=decodeParameterInteger(Q[F+1])+B;L=A;B=E;J.push(A);J.push(E)}G=G+P*2+1}else{if(R==7){P=0;G=G+P*2+1}}}}K.geoStr=J}HGIS.Geometry=HGIS.Geometry||{};HGIS.Geometry.GeomRelation=function(){var A=this;A.wkt=new HGIS.Format.WKT();this.intersect=function(D,C){if(D.length<2){alert(HGIS.language[HGIS.InitParam.language]["need_twoSet_AND"]);return}var B=new Array();for(var E=0;E<D.length;E=E+1){var H=A.wkt.extractGeometry(D[E]);B.push(H)}var F={"wktStr":B.join("-")};var I=function(J){var K=A.wkt.read(J);C(K)};var G=function(J){C(J)};HGIS.Utils.send(geomTopologyURL.intersect,F,"POST","text",I,G)};this.union=function(D,C){if(D.length<2){alert(HGIS.language[HGIS.InitParam.language]["need_twoSet_Udlte"]);return}var B=new Array();for(var E=0;E<D.length;E=E+1){var H=A.wkt.extractGeometry(D[E]);B.push(H)}var F={"wktStr":B.join("-")};var I=function(J){var K=A.wkt.read(J);C(K)};var G=function(J){C(J)};HGIS.Utils.send(geomTopologyURL.union,F,"POST","text",I,G)};this.difference=function(D,C){if(D.length<2){alert(HGIS.language[HGIS.InitParam.language]["need_twoSet_SU"]);return}var B=new Array();for(var E=0;E<D.length;E=E+1){var H=A.wkt.extractGeometry(D[E]);B.push(H)}var F={"wktStr":B.join("-")};var I=function(J){var K=A.wkt.read(J);C(K)};var G=function(J){C(J)};HGIS.Utils.send(geomTopologyURL.difference,F,"POST","text",I,G)};this.convexHull=function(F,B){var E={"wktStr":A.wkt.extractGeometry(F)};var C=function(G){var H=A.wkt.read(G);B(H)};var D=function(G){B(G)};HGIS.Utils.send(geomTopologyURL.convexHull,E,"POST","text",C,D)};this.buffer=function(E,G,I,C,B){if(HGIS.InitParam.mapUnit=="degrees"){var H=HGIS.MapEx.prototype.degreeSpanToMeter.apply(this,[E.getBounds().top,"degrees"]);G=G/H}var D={"wktStr":A.wkt.extractGeometry(E),"distance":G,"quadrantSegments":I,"endCapStyle":C};var J=function(K){var L=A.wkt.read(K);B(L)};var F=function(K){B(K)};HGIS.Utils.send(geomTopologyURL.buffer,D,"POST","text",J,F)};this.is8poly=function(D,B){var C={"wktStr":A.wkt.extractGeometry(D)};HGIS.Utils.send(geomTopologyURL.is8poly,C,"POST","text",function(E){B(E)},function(E){B(E)})};this.getArea=function(F,B){var E={"wktStr":A.wkt.extractGeometry(F)};var C=function(G){B(G)};var D=function(G){B(G)};HGIS.Utils.send(geomTopologyURL.getArea,E,"POST","text",C,D)};this.isContain=function(F,B){if(F.length>2){alert(HGIS.language[HGIS.InitParam.language]["only_twoElement_inArr"]);return}if(F.length<2){alert(HGIS.language[HGIS.InitParam.language]["need_twoElement_inArr"]);return}var H=A.wkt.extractGeometry(F[0]);var E=A.wkt.extractGeometry(F[1]);var G={"sourceWkt":H,"targetWkt":E};var C=function(I){B(I)};var D=function(I){B(I)};HGIS.Utils.send(geomTopologyURL.isContain,G,"POST","text",C,D)};this.reverseGeometry=function(G,B){var D=A.wkt.extractGeometry(G);var F={"wktStr":D};var C=function(H){var I=A.wkt.read(H);B(I)};var E=function(H){B(H)};HGIS.Utils.send(geomTopologyURL.reverseGeometry,F,"POST","text",C,E)};this.getRes=function(D,H,C){var B=new Array();for(var E=0;E<D.length;E=E+1){var I=A.wkt.extractGeometry(D[E]);B.push(I)}var F={"wktStr":B.join("-")};var J=function(K){C(K)};var G=function(K){C(K)};HGIS.Utils.send(H,F,"POST","text",J,G)}};HGIS.INCHES_PER_UNIT[""]=HGIS.INCHES_PER_UNIT["km"];HGIS.INCHES_PER_UNIT[""]=HGIS.INCHES_PER_UNIT["m"];HGIS.INCHES_PER_UNIT[""]=HGIS.INCHES_PER_UNIT["mi"];HGIS.INCHES_PER_UNIT[""]=HGIS.INCHES_PER_UNIT["ft"];HGIS.InitParam={version:1.4,isFrontConfig:false,reloadFactor:false,isShowTipRegister:false,basePath:APIAdress,center:new HGIS.LonLat(120,30),extent:null,language:"zh_CN",maxLevel:20,minLevel:0,initLevel:12,mapType:"HikMap",tileOrigin:new HGIS.LonLat(-180,90),userProxy:false,resolutions:[],tileSize:256,srid:4326,layer:"",matrixSet:"",style:"default",levelSequence:"",zoomOffset:"",vecUrl:"",imgUrl:"",hvtUrl:"",enableVtMap:"",tfwUrl:"",mixedUrl:"",vecUrl_w:"",imgUrl_w:"",map:null,mapUnit:"m",netDomain:"n",factor:"",geodesic:false,init:function(B,A){B=HGIS.Utils.getUrlByExpolreType(B);if(B.indexOf("jsonp")!=-1){HgisAjax({url:B,jsonp:"jsonp",data:{},success:function(C){HGIS.InitParam.successCallback(C,A)},error:function(C){}})}else{HGIS.Utils.send(B,"","get","json",function(C){HGIS.InitParam.successCallback(C,A)},function(C){})}},successCallback:function(F,C){F=F.data;var A=F.center.split(",");HGIS.InitParam.center=new HGIS.LonLat(A[0],A[1]);var D=F.extent.split(",");HGIS.InitParam.extent=new HGIS.Bounds(D[0],D[1],D[2],D[3]);HGIS.InitParam.maxLevel=F.maxLevel;HGIS.InitParam.minLevel=F.minLevel;HGIS.InitParam.initLevel=F.initLevel;HGIS.InitParam.mapType=F.mapType;HGIS.InitParam.enableVtMap=F.enableVtMap;HGIS.InitParam.imageFormat=F.imageFormat;if(HGIS.InitParam.mapType.toLowerCase()=="wmtsmap"){var E=F.tileOrigin.split(",");HGIS.InitParam.tileOrigin=new HGIS.LonLat(E[0],E[1]);HGIS.InitParam.layer=F.layer;HGIS.InitParam.matrixSet=F.matrixSet;HGIS.InitParam.style=F.style}if(HGIS.InitParam.mapType.toLowerCase()=="ezmap"){HGIS.InitParam.levelSequence=F.levelSequence;HGIS.InitParam.zoomOffset=F.zoomOffset}HGIS.InitParam.resolutions=F.resolutions;HGIS.InitParam.tileSize=F.tileSize?F.tileSize:256;HGIS.InitParam.srid=F.srid;if(HGIS.InitParam.netDomain.toLowerCase()=="w"){HGIS.InitParam.vecUrl=F.vecUrl_w;HGIS.InitParam.imgUrl=F.imgUrl_w}else{if(HGIS.InitParam.netDomain.toLowerCase()=="ww"){HGIS.InitParam.vecUrl=F.vecUrl_ww;HGIS.InitParam.imgUrl=F.imgUrl_ww}else{HGIS.InitParam.vecUrl=HGIS.InitParam.netDomainUrl(HGIS.InitParam.mapType,F.vecUrl);HGIS.InitParam.imgUrl=HGIS.InitParam.netDomainUrl(HGIS.InitParam.mapType,F.imgUrl);if(F.tfwUrl){HGIS.InitParam.tfwUrl=HGIS.InitParam.netDomainUrl(HGIS.InitParam.mapType,F.tfwUrl)}if(F.mixedUrl){HGIS.InitParam.mixedUrl=HGIS.InitParam.netDomainUrl(HGIS.InitParam.mapType,F.mixedUrl)}}}HGIS.InitParam.hvtUrl=F.hvtUrl;HGIS.InitParam.isInit=true;HGIS.InitParam.factor=F.factor;if(HGIS.InitParam.srid=="900913"){HGIS.InitParam.extent.transform("EPSG:4326","EPSG:900913");HGIS.InitParam.center.transform("EPSG:4326","EPSG:900913");HGIS.InitParam.geodesic=false}else{if(HGIS.InitParam.srid=="4326"){HGIS.InitParam.geodesic=true}}var H=window.document.location.href;var J=window.document.location.pathname;var G=H.indexOf(J);var K=H.substring(0,G);var I=J.substring(0,J.substr(1).indexOf("/")+1);var B=K+I;if(C){C()}},netDomainUrl:function(C,B){if(C.toLowerCase()==="googlemap"||C.toLowerCase()==="gaodemap"||C.toLowerCase()==="hikmap"||C.toLowerCase()==="spiritmap"||C.toLowerCase()==="arcgismap"){var D=RegExp("http");if(D.test(B)){return B}else{var E=B.split("|");for(var A=0;A<E.length;A++){E[A]=window.location.protocol+"//"+window.location.host+E[A]}for(var A=0;A<E.length;A++){B=E[A]+"|"}B=B.substring(0,B.length-1);return B}}else{return B}},};HGIS.language=HGIS.language||{};HGIS.language.en_US={"m":"m","km":"km","m2":"m","km2":"km","clear":"clear","close":"close","length":"Length","area":"area","start":"start","escmeasure":"Single click to determine position.<br>double click to end drawing.<br>press Esc to exit.","track_data_noEmpty":"Race data cannot be empty.","point_noTrack":"A point cannot be a Track","replay_track_point_err":"Replay the track point error","vectorLayer_noExist":"Vector layer does not exist","buff_radius_err":"Buffer radius error, please enter positive integer","open_camera_needParam":"To open the nearest N camera, enter a positive integer","vectorLayer_noExist.":"The vector layer does not exist","this":"This","camera_preview.":"Camera will be previewed","query_err":"Query error","track_data_noProducted":"Track data is not producted","center_data_err":"Center point data type error","center_noExist":"Center doesn't exist","Encirclement_noFound":"No encirclement was found.","need_twoSet_AND":"At least two geometry to AND set","need_twoSet_Udlte":"At least two geometry to Udlte set","need_twoSet_SU":"At least two set geometry to SU set","only_twoElement_inArr":"array is too large to contain ,only two elements","need_twoElement_inArr":"array length does not meet the requirements, should contain two elements","HGIS_noKnow":"HGIS It's not clear what you're looking for","err_msg":"error message","nonsupport_idxDB":"nonsupport IndexedDB","DB_fail":"Database creation/connection failed","del_DB_success":"[delete database success]","del_DB_err":"[delete database error]","no_instant":"Database not instantiate","insert_err":"Insert failed, and the tag may already exist in the database","brows_noSupport_AJAX":"Your browser does not support AJAX.","no_supportType":"The type of operation that is not supported","only_supportType":"Only textjson and XML are supported, please check resultType parameter is correct","Tolerance_val_noReasonable":"Tolerance value is not reasonable","least_twoPoint":"At least give a starting point and end point","can_noFind":"Can't find","map_noInit":"The map is not initialized.",};HGIS.language=HGIS.language||{};HGIS.language.zh_CN={"m":"","km":"","m2":"","km2":"","clear":"","close":"","length":"","area":"","start":"","escmeasure":".<br>.<br>ESC.","track_data_noEmpty":"","point_noTrack":"","replay_track_point_err":"","vectorLayer_noExist":"","buff_radius_err":"","open_camera_needParam":"N","vectorLayer_noExist.":"","this":" ","camera_preview.":"","query_err":"","track_data_noProducted":"","center_data_err":"","center_noExist":"","Encirclement_noFound":"","need_twoSet_AND":"","need_twoSet_Udlte":"","need_twoSet_SU":"","only_twoElement_inArr":"","need_twoElement_inArr":"","HGIS_noKnow":"HGIS","err_msg":"","noSupport_idxDB":"IndexedDB","DB_fail":"/","del_DB_success":"","del_DB_err":"","no_instant":"database","insert_err":"","brows_noSupport_AJAX":"AJAX","no_supportType":"","only_supportType":" text json  xmlresultType","Tolerance_val_noReasonable":"","least_twoPoint":"","can_noFind":"","map_noInit":"",};HGIS.language=HGIS.language||{};HGIS.language.uk_UA={"m":"m","km":"km","m2":"m","km2":"km","clear":"clear","close":"close","length":"Length","area":"area","start":"start","escmeasure":"Single click to determine position.<br>double click to end drawing.<br>press Esc to exit.","track_data_noEmpty":"Race data cannot be empty.","point_noTrack":"A point cannot be a Track","replay_track_point_err":"Replay the track point error","vectorLayer_noExist":"Vector layer does not exist","buff_radius_err":"Buffer radius error, please enter positive integer","open_camera_needParam":"To open the nearest N camera, enter a positive integer","vectorLayer_noExist.":"The vector layer does not exist","this":"This","camera_preview.":"Camera will be previewed","query_err":"Query error","track_data_noProducted":"Track data is not producted","center_data_err":"Center point data type error","center_noExist":"Center doesn't exist","Encirclement_noFound":"No encirclement was found.","need_twoSet_AND":"At least two geometry to AND set","need_twoSet_Udlte":"At least two geometry to Udlte set","need_twoSet_SU":"At least two set geometry to SU set","only_twoElement_inArr":"array is too large to contain ,only two elements","need_twoElement_inArr":"array length does not meet the requirements, should contain two elements","HGIS_noKnow":"HGIS It's not clear what you're looking for","err_msg":"error message","nonsupport_idxDB":"nonsupport IndexedDB","DB_fail":"Database creation/connection failed","del_DB_success":"[delete database success]","del_DB_err":"[delete database error]","no_instant":"Database not instantiate","insert_err":"Insert failed, and the tag may already exist in the database","brows_noSupport_AJAX":"Your browser does not support AJAX.","no_supportType":"The type of operation that is not supported","only_supportType":"Only textjson and XML are supported, please check resultType parameter is correct","Tolerance_val_noReasonable":"Tolerance value is not reasonable","least_twoPoint":"At least give a starting point and end point","can_noFind":"Can't find","map_noInit":"The map is not initialized.",};HGIS.Layer=HGIS.Layer||{};HGIS.Layer.AgsOffLayer=function(H,K,E,A,J,D,C){var F=this;F.resolutions=J;F.name=C;F.tileOrigin=D;var G={projection:new HGIS.Projection("EPSG:4326"),maxExtent:new HGIS.Bounds(-180,-90,180,90)};function B(L,M){if(L.bottom>M.top||L.top<M.bottom||L.right<M.left||L.left>M.right){return false}else{return true}}this.getTileUrl=function(M,N,Q){M=Q.adjustBounds(M);var T=Q.map.getResolution();var L=M.getCenterLonLat();var U=Math.floor((L.lon-Q.tileOrigin.lon)/(T*Q.tileSize.w));var P=Math.floor((Q.tileOrigin.lat-L.lat)/(T*Q.tileSize.h));var R=Q.map.getZoom();var S=(Q.url.split("^")[1]!=undefined)?Q.url.split("^")[1]:"png";if(B(K,M)&&R>=E&&R<=A){U="C"+HGIS.Number.zeroPad(U,8,16);P="R"+HGIS.Number.zeroPad(P,8,16);R="L"+HGIS.Number.zeroPad(R,2,10);var O="";if(HGIS.InitParam.useProxy=="true"){O=tileCacheProxyURL+"?mapType="+HGIS.InitParam.mapType+"&tileType="+N+"&tileURL="+Q.url+"&level="+R+"&col="+U+"&row="+P+"&type="+S}else{O=Q.url.split("^")[0]+"/"+R+"/"+P+"/"+U+"."+S}return HGIS.Utils.getSafeAddress(O)}else{return HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png")}};var I=new HGIS.Layer.TMS(F.name,H,{serviceVersion:".",layername:".",alpha:true,tileOrigin:F.tileOrigin,tileOriginCorner:"tl",tileSize:new HGIS.Size(HGIS.InitParam.tileSize,HGIS.InitParam.tileSize),createBackBuffer:function(){return null},getURL:function(M){var L=F.getTileUrl(M,F.name,this);return L},isBaseLayer:true,displayInLayerSwitcher:true,resolutions:F.resolutions,serverResolutions:F.resolutions,tileOptions:{blankImageUrl:HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png"),onImageError:function(){var L=this.imgDiv;this.createBackBuffer=function(){return null};if(L.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");L.src=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png");this.onImageLoad()}}}}});return I};HGIS.Layer.AgsOnLayer=function(H,K,E,A,B,D,C){var F=this;F.resolutions=B;F.name=C;F.tileOrigin=D;var G={projection:new HGIS.Projection("EPSG:900913"),maxExtent:new HGIS.Bounds(-180,-90,180,90)};function J(L,M){if(L.bottom>M.top||L.top<M.bottom||L.right<M.left||L.left>M.right){return false}else{return true}}this.getTileUrl=function(M,N,Q){M=Q.adjustBounds(M);var S=Q.map.getResolution();var L=M.getCenterLonLat();var T=Math.floor((L.lon-Q.tileOrigin.lon)/(S*Q.tileSize.w));var P=Math.floor((Q.tileOrigin.lat-L.lat)/(S*Q.tileSize.h));var R=Q.map.getZoom();if(J(K,M)&&R>=E&&R<=A){var O="";if(HGIS.InitParam.useProxy=="true"){O=tileCacheProxyURL+"?mapType="+HGIS.InitParam.mapType+"&tileType="+N+"&tileURL="+Q.url.split("^")[0]+"&level="+R+"&col="+T+"&row="+P+"&type="+Q.type}else{O=Q.url.split("^")[0]+"/tile/"+R+"/"+P+"/"+T}O=HGIS.Utils.getSafeAddress(O);return O}else{return HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png")}};var I=new HGIS.Layer.TMS(F.name,H,{serviceVersion:".",layername:".",alpha:true,type:F.url!=undefined?(F.url.split("^")[1]!=undefined?F.url.split("^")[1]:"png"):"png",tileOrigin:F.tileOrigin,tileOriginCorner:"tl",tileSize:new HGIS.Size(HGIS.InitParam.tileSize,HGIS.InitParam.tileSize),getURL:function(M){var L=F.getTileUrl(M,F.name,this);return L},createBackBuffer:function(){return null},isBaseLayer:true,displayInLayerSwitcher:true,resolutions:F.resolutions,serverResolutions:F.resolutions,tileOptions:{blankImageUrl:HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png"),onImageError:function(){var L=this.imgDiv;this.createBackBuffer=function(){return null};if(L.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");L.src=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png");this.onImageLoad()}}}}});return I};HGIS.Layer=HGIS.Layer||{};HGIS.Layer.EzLayer=HGIS.Class(HGIS.Layer.TMS,{type:"EzLayer",options:null,url:null,cacheTileUrl:null,isBaseLayer:true,levelSequence:1,levelMax:22,ezZoomOffset:0,minLevel:0,maxLevel:22,mapBounds:null,tileOptions:{blankImageUrl:"/gisapi/theme/image/none.png",onImageError:function(){var A=this.imgDiv;this.createBackBuffer=function(){return null};if(A.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");A.src="jsapi/theme/img/none.png";this.onImageLoad()}}}},initialize:function(C,A,B){HGIS.Layer.TMS.prototype.initialize.apply(this,arguments);this.tileOrigin=B.tileOrigin?B.tileOrigin:new HGIS.LonLat(0,0)},getURL:function(B){B=this.adjustBounds(B);var D=this.getServerResolution();var E=Math.round((B.left-this.tileOrigin.lon)/(D*this.tileSize.w));var F=Math.round((this.tileOrigin.lat-B.bottom)/(D*this.tileSize.h));var C=this.serverResolutions!=null?HGIS.Util.indexOf(this.serverResolutions,D):this.getServerZoom();if(this.levelSequence===0){C=this.levelMax-C}var G="?Service=getImage&Type=RGB&Col="+E+"&Row="+F+"&Zoom="+C;if(this.ezZoomOffset!=0){G=G+"&ZoomOffset="+this.ezZoomOffset}var A=this.url.split("^")[0];if(HGIS.Util.isArray(A)){A=this.selectUrl(G,A)}return A+G},createBackBuffer:function(){return null},clone:function(A){if(A==null){A=new HGIS.Layer.EzLayer(this.name,this.url,this.getOptions())}A=HGIS.Layer.Grid.prototype.clone.apply(this,[A]);return A},hide:function(){this.setVisibility(false)},refresh:function(){this.redraw()},show:function(){this.setVisibility(true)},CLASS_NAME:"HGIS.Layer.EzLayer"});HGIS.Layer=HGIS.Layer||{};HGIS.Layer.GraphicLayer=HGIS.Class({graphicLayer:null,markerLayer:null,markers:null,features:null,id:null,initialize:function(A){if(!A){this.id="hgis_layer_"+HGIS.Util.createUniqueID()}this.markers={};this.features={}},getFeatureFromEvent:function(A){return this.graphicLayer.getFeatureFromEvent(A)},add:function(A){var B=this;if(!A.id){A.id="hgis_graphic_"+HGIS.Util.createUniqueID()}if(A.CLASS_NAME=="HGIS.Marker"||A.CLASS_NAME=="HGIS.Marker.MarkerEx"){B.markerLayer.addMarker(A);A.layer=B.markerLayer;B.markers[A.id]=A}else{if(A.CLASS_NAME=="HGIS.Feature.Vector"){B.graphicLayer.addFeatures([A]);B.features[A.id]=A}}},addMarker:function(A){if(!A.id){A.id="hgis_graphic_"+HGIS.Util.createUniqueID()}if(A.CLASS_NAME=="HGIS.Marker"||A.CLASS_NAME=="HGIS.Marker.MarkerEx"){this.markerLayer.addMarker(A);A.layer=this.markerLayer;this.markers[A.id]=A}},removeMarker:function(A){if(A.CLASS_NAME=="HGIS.Marker"||A.CLASS_NAME=="HGIS.Marker.MarkerEx"){this.markerLayer.removeMarker(A);delete this.markers[A.id]}},clearMarkers:function(){for(var A in this.markers){this.markerLayer.removeMarker(this.markers[A]);delete this.markers[A]}},remove:function(A){if(A.CLASS_NAME=="HGIS.Marker"||A.CLASS_NAME=="HGIS.Marker.MarkerEx"){this.markerLayer.removeMarker(A);delete this.markers[A.id]}else{if(A.CLASS_NAME=="HGIS.Feature.Vector"){this.graphicLayer.removeFeatures([A]);delete this.features[A.id]}}},clear:function(){for(var A in this.markers){this.markerLayer.removeMarker(this.markers[A]);delete this.markers[A]}for(var A in this.features){this.graphicLayer.removeFeatures(this.features[A]);delete this.features[A]}},setMap:function(A){this.graphicLayer=A.graphicLayer;this.markerLayer=A.markerLayer;this.map=A},addFeatures:function(B){for(var A=0;A<B.length;A++){var C=B[A];if(!C.id){C.id="hgis_graphic_"+HGIS.Util.createUniqueID()}this.features[C.id]=C}this.graphicLayer.addFeatures(B)},removeFeatures:function(B){for(var A=0;A<B.length;A++){var C=B[A];this.graphicLayer.removeFeatures([C]);delete this.features[C.id]}},removeAllFeatures:function(){for(var A in this.features){this.graphicLayer.removeFeatures(this.features[A]);delete this.features[A]}},getFeatureBy:function(A,B){return this.graphicLayer.getFeatureBy(A,B)},getFeatureById:function(A){return this.graphicLayer.getFeatureById(A)},getFeatureByFid:function(A){return this.graphicLayer.getFeatureByFid(A)},getFeaturesByAttribute:function(A,B){return this.graphicLayer.getFeaturesByAttribute(A,B)},clearFeaturesByAttribute:function(A,D){var B=this.graphicLayer.getFeaturesByAttribute(A,D);for(var C in B){var E=B[C];this.graphicLayer.removeFeatures(E);delete this.features[E.id]}},setVisibility:function(B){this.visible=B?true:false;for(var A in this.features){var D=this.features[A];var C=D.style;if(!this.visible){C["display"]="none"}else{if(C.hasOwnProperty("display")){delete C["display"]}}this.features[A].style=C;this.features[A].layer.drawFeature(D,C)}for(var A in this.markers){this.markers[A].icon.display(this.visible)}},getMarkers:function(){var B=[];for(var A in this.markers){B.push(this.markers[A])}return B},getMarkersByAttribute:function(A,C){var D=[];for(var B in this.markers){if(this.markers[B].attributes[A]==C){D.push(this.markers[B])}}return D},redraw:function(){for(var A in this.features){this.graphicLayer.drawFeature(this.features[A])}},getFeatures:function(){var B=[];for(var A in this.features){B.push(this.features[A])}return B},hide:function(){this.setVisibility(false)},show:function(){this.setVisibility(true)},CLASS_NAME:"HGIS.Layer.GraphicLayer"});HGIS.Layer=HGIS.Layer||{};HGIS.Layer.HeatLayer=function(A){var B={};if(A){B.FORMAT=A.FORMAT?A.FORMAT:"image/png";B.SERVICE=A.SERVICE?A.SERVICE:"WMS";B.VERSION=A.VERSION?A.VERSION:"1.1.1";B.REQUEST=A.REQUEST?A.REQUEST:"GetMap"}else{B={FORMAT:"image/png",SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetMap"}}B.LAYERS=HGIS.InitParam.map.size.h+"~"+HGIS.InitParam.map.size.w;B.BBOX=HGIS.InitParam.map.getExtent();this.getLayer=function(E,D){var C=new HGIS.Layer.WMS(E,D,B,{opacity:1,singleTile:false,isBaseLayer:false,noMagic:false,transitionEffect:"map-resize",TRANSPARENT:true});return C};this.getConfig=function(){return B}};HGIS.Layer.Heatmap=HGIS.Class(HGIS.Layer,{isBaseLayer:false,heatmap:null,mapLayer:null,handler:null,tmpData:{},initialize:function(D,B,E,C,F){var A=document.createElement("div");HGIS.Layer.prototype.initialize.apply(this,[D,F]);A.style.cssText="position:absolute;width:"+B.size.w+"px;height:"+B.size.h+"px;";this.div.appendChild(A);C.element=A;this.mapLayer=E;this.map=B;this.heatmap=h337.create(C);this.handler=function(){if(this.tmpData.max){this.updateLayer()}};B.events.register("zoomend",this,this.handler);B.events.register("moveend",this,this.handler)},updateLayer:function(){var B=this.getPixelOffset(),A=this.heatmap.get("element");A.style.top=((B.y>0)?("-"+B.y):(Math.abs(B.y)))+"px";A.style.left=((B.x>0)?("-"+B.x):(Math.abs(B.x)))+"px";this.setDataSet(this.tmpData)},getPixelOffset:function(){var B=this.mapLayer.map.layerContainerOrigin,C=new HGIS.LonLat(B.lon,B.lat),F=this.mapLayer.getViewPortPxFromLonLat(C),E=this.mapLayer.map.center,D=new HGIS.LonLat(E.lon,E.lat),A=this.mapLayer.getViewPortPxFromLonLat(D);return{x:F.x-A.x,y:F.y-A.y}},setDataSet:function(C){var F={},A=C.data,E=A.length,D,B,G;F.max=C.max;F.data=[];while(E--){D=A[E];B=D.lonlat;G=this.roundPixels(this.getViewPortPxFromLonLat(B));if(G){F.data.push({x:G.x,y:G.y,count:D.count})}}this.tmpData=C;this.heatmap.store.setDataSet(F)},roundPixels:function(A){if(A.x<0||A.y<0){return false}A.x=(A.x>>0);A.y=(A.y>>0);return A},addDataPoint:function(B){var A=this.roundPixels(this.mapLayer.getViewPortPxFromLonLat(B)),C={lonlat:B},D;if(arguments.length==2){C.count=arguments[1]}this.tmpData.data.push(C);if(A){D=[A.x,A.y];if(arguments.length==2){D.push(arguments[1])}this.heatmap.store.addDataPoint.apply(this.heatmap.store,D)}},toggle:function(){this.heatmap.toggleDisplay()},destroy:function(){map.events.unregister("zoomend",this,this.handler);map.events.unregister("moveend",this,this.handler);HGIS.Layer.prototype.destroy.apply(this,arguments)},CLASS_NAME:"HGIS.Layer.Heatmap"});(function(B){var A=(function(){var D=function D(F){var G={data:[],heatmap:F};this.max=1;this.get=function(H){return G[H]};this.set=function(H,I){G[H]=I}};D.prototype={addDataPoint:function(H,I){if(H<0||I<0){return}var G=this,F=G.get("heatmap"),J=G.get("data");if(!J[H]){J[H]=[]}if(!J[H][I]){J[H][I]=0}J[H][I]+=(arguments.length<3)?1:arguments[2];G.set("data",J);if(G.max<J[H][I]){F.get("actx").clearRect(0,0,F.get("width"),F.get("height"));G.setDataSet({max:J[H][I],data:J},true);return}F.drawAlpha(H,I,J[H][I],true)},setDataSet:function(M,G){var F=this,N=F.get("heatmap"),H=[],O=M.data,K=O.length;N.clear();this.max=M.max;N.get("legend")&&N.get("legend").update(M.max);if(G!=null&&G){for(var I in O){if(I===undefined){continue}for(var J in O[I]){if(J===undefined){continue}N.drawAlpha(I,J,O[I][J],false)}}}else{while(K--){var L=O[K];N.drawAlpha(L.x,L.y,L.count,false);if(!H[L.x]){H[L.x]=[]}if(!H[L.x][L.y]){H[L.x][L.y]=0}H[L.x][L.y]=L.count}}N.colorize();this.set("data",O)},exportDataSet:function(){var H=this,J=H.get("data"),I=[];for(var F in J){if(F===undefined){continue}for(var G in J[F]){if(G===undefined){continue}I.push({x:parseInt(F,10),y:parseInt(G,10),count:J[F][G]})}}return{max:H.max,data:I}},generateRandomDataSet:function(J){var G=this.get("heatmap"),K=G.get("width"),F=G.get("height");var I={},L=Math.floor(Math.random()*1000+1);I.max=L;var H=[];while(J--){H.push({x:Math.floor(Math.random()*K+1),y:Math.floor(Math.random()*F+1),count:Math.floor(Math.random()*L+1)})}I.data=H;this.setDataSet(I)}};var E=function E(F){this.config=F;var G={element:null,labelsEl:null,gradientCfg:null,ctx:null};this.get=function(H){return G[H]};this.set=function(H,I){G[H]=I};this.init()};E.prototype={init:function(){var F=this,J=F.config,P=J.title||"Legend",O=J.position,I=J.offset||10,L=J.gradient,G=document.createElement("ul"),Q="",K,H,N,M="";F.processGradientObject();if(O.indexOf("t")>-1){M+="top:"+I+"px;"}else{M+="bottom:"+I+"px;"}if(O.indexOf("l")>-1){M+="left:"+I+"px;"}else{M+="right:"+I+"px;"}H=document.createElement("div");H.style.cssText="border-radius:5px;position:absolute;"+M+"font-family:Helvetica; width:256px;z-index:10000000000; background:rgba(255,255,255,1);padding:10px;border:1px solid black;margin:0;";H.innerHTML="<h3 style='padding:0;margin:0;text-align:center;font-size:16px;'>"+P+"</h3>";G.style.cssText="position:relative;font-size:12px;display:block;list-style:none;list-style-type:none;margin:0;height:15px;";N=document.createElement("div");N.style.cssText=["position:relative;display:block;width:256px;height:15px;border-bottom:1px solid black; background-image:url(",F.createGradientImage(),");"].join("");H.appendChild(G);H.appendChild(N);F.set("element",H);F.set("labelsEl",G);F.update(1)},processGradientObject:function(){var G=this,I=this.config.gradient,H=[];for(var F in I){if(I.hasOwnProperty(F)){H.push({stop:F,value:I[F]})}}H.sort(function(K,J){return(K.stop-J.stop)});H.unshift({stop:0,value:"rgba(0,0,0,0)"});G.set("gradientArr",H)},createGradientImage:function(){var J=this,I=J.get("gradientArr"),G=I.length,F=document.createElement("canvas"),L=F.getContext("2d"),K;F.width="256";F.height="15";K=L.createLinearGradient(0,5,256,10);for(var H=0;H<G;H++){K.addColorStop(1/(G-1)*H,I[H].value)}L.fillStyle=K;L.fillRect(0,5,256,10);L.strokeStyle="black";L.beginPath();for(var H=0;H<G;H++){L.moveTo(((1/(G-1)*H*256)>>0)+0.5,0);L.lineTo(((1/(G-1)*H*256)>>0)+0.5,(H==0)?15:5)}L.moveTo(255.5,0);L.lineTo(255.5,15);L.moveTo(255.5,4.5);L.lineTo(0,4.5);L.stroke();J.set("ctx",L);return F.toDataURL()},getElement:function(){return this.get("element")},update:function(H){var L=this,J=L.get("gradientArr"),I=L.get("ctx"),N=L.get("labelsEl"),G,M="",F;for(var K=0;K<J.length;K++){G=H*J[K].stop>>0;F=(I.measureText(G).width/2)>>0;if(K==0){F=0}if(K==J.length-1){F*=2}M+='<li style="position:absolute;left:'+(((((1/(J.length-1)*K*256)||0))>>0)-F+0.5)+'px">'+G+"</li>"}N.innerHTML=M}};var C=function C(F){var G={radius:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},legend:null,visible:true,width:0,height:0,max:false,gradient:false,opacity:180,premultiplyAlpha:false,bounds:{l:1000,r:0,t:1000,b:0},debug:false};this.store=new D(this);this.get=function(H){return G[H]};this.set=function(H,I){G[H]=I};this.configure(F);this.init()};C.prototype={configure:function(G){var H=this,F,J;H.set("radius",G["radius"]||40);H.set("element",(G.element instanceof Object)?G.element:document.getElementById(G.element));H.set("visible",(G.visible!=null)?G.visible:true);H.set("max",G.max||false);H.set("gradient",G.gradient||{"0.45":"rgb(0,0,255)","0.55":"rgb(0,255,255)","0.65":"rgb(0,255,0)","0.95":"yellow","1.0":"rgb(255,0,0)"});H.set("opacity",parseInt(255/(100/G.opacity),10)||180);H.set("width",G.width||0);H.set("height",G.height||0);H.set("debug",G.debug);if(G.legend){var I=G.legend;I.gradient=H.get("gradient");H.set("legend",new E(I))}},resize:function(){var G=this,I=G.get("element"),F=G.get("canvas"),H=G.get("acanvas");F.width=H.width=G.get("width")||I.style.width.replace(/px/,"")||G.getWidth(I);this.set("width",F.width);F.height=H.height=G.get("height")||I.style.height.replace(/px/,"")||G.getHeight(I);this.set("height",F.height)},init:function(){var H=this,F=document.createElement("canvas"),I=document.createElement("canvas"),K=F.getContext("2d"),J=I.getContext("2d"),G=H.get("element");H.initColorPalette();H.set("canvas",F);H.set("ctx",K);H.set("acanvas",I);H.set("actx",J);H.resize();F.style.cssText=I.style.cssText="position:absolute;top:0;left:0;z-index:10000000;";if(!H.get("visible")){F.style.display="none"}G.appendChild(F);if(H.get("legend")){G.appendChild(H.get("legend").getElement())}if(H.get("debug")){document.body.appendChild(I)}J.shadowOffsetX=15000;J.shadowOffsetY=15000;J.shadowBlur=15},initColorPalette:function(){var H=this,F=document.createElement("canvas"),I=H.get("gradient"),K,J,G;F.width="1";F.height="256";K=F.getContext("2d");J=K.createLinearGradient(0,0,1,256);G=K.getImageData(0,0,1,1);G.data[0]=G.data[3]=64;G.data[1]=G.data[2]=0;K.putImageData(G,0,0);G=K.getImageData(0,0,1,1);H.set("premultiplyAlpha",(G.data[0]<60||G.data[0]>70));for(var L in I){J.addColorStop(L,I[L])}K.fillStyle=J;K.fillRect(0,0,1,256);H.set("gradient",K.getImageData(0,0,1,256).data)},getWidth:function(G){var F=G.offsetWidth;if(G.style.paddingLeft){F+=G.style.paddingLeft}if(G.style.paddingRight){F+=G.style.paddingRight}return F},getHeight:function(G){var F=G.offsetHeight;if(G.style.paddingTop){F+=G.style.paddingTop}if(G.style.paddingBottom){F+=G.style.paddingBottom}return F},colorize:function(Y,Z){var L=this,S=L.get("width"),K=L.get("radius"),a=L.get("height"),Q=L.get("actx"),M=L.get("ctx"),b=K*3,N=L.get("premultiplyAlpha"),P=L.get("gradient"),I=L.get("opacity"),V=L.get("bounds"),X,W,O,H,T,U,F,R,G,d;if(Y!=null&&Z!=null){if(Y+b>S){Y=S-b}if(Y<0){Y=0}if(Z<0){Z=0}if(Z+b>a){Z=a-b}X=Y;W=Z;H=Y+b;O=Z+b}else{if(V["l"]<0){X=0}else{X=V["l"]}if(V["r"]>S){H=S}else{H=V["r"]}if(V["t"]<0){W=0}else{W=V["t"]}if(V["b"]>a){O=a}else{O=V["b"]}}T=Q.getImageData(X,W,H-X,O-W);U=T.data;F=U.length;for(var J=3;J<F;J+=4){R=U[J],G=R*4;if(!G){continue}d=(R<I)?R:I;U[J-3]=P[G];U[J-2]=P[G+1];U[J-1]=P[G+2];if(N){U[J-3]/=255/d;U[J-2]/=255/d;U[J-1]/=255/d}U[J]=d}T.data=U;M.putImageData(T,X,W)},drawAlpha:function(Q,R,I,L){var P=this,N=P.get("radius"),M=P.get("actx"),J=P.get("max"),F=P.get("bounds"),G=Q-(1.5*N)>>0,O=R-(1.5*N)>>0,K=Q+(1.5*N)>>0,H=R+(1.5*N)>>0;M.shadowColor=("rgba(0,0,0,"+((I)?(I/P.store.max):"0.1")+")");M.shadowOffsetX=15000;M.shadowOffsetY=15000;M.shadowBlur=15;M.beginPath();M.arc(Q-15000,R-15000,N,0,Math.PI*2,true);M.closePath();M.fill();if(L){P.colorize(G,O)}else{if(G<F["l"]){F["l"]=G}if(O<F["t"]){F["t"]=O}if(K>F["r"]){F["r"]=K}if(H>F["b"]){F["b"]=H}}},toggleDisplay:function(){var H=this,G=H.get("visible"),F=H.get("canvas");if(!G){F.style.display="block"}else{F.style.display="none"}H.set("visible",!G)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var G=this,H=G.get("width"),F=G.get("height");G.store.set("data",[]);G.get("ctx").clearRect(0,0,H,F);G.get("actx").clearRect(0,0,H,F)},cleanup:function(){var F=this;F.get("element").removeChild(F.get("canvas"))}};return{create:function(F){return new C(F)},util:{mousePosition:function(H){var F,G;if(H.layerX){F=H.layerX;G=H.layerY}else{if(H.offsetX){F=H.offsetX;G=H.offsetY}}if(typeof(F)=="undefined"){return}return[F,G]}}}})();B.h337=B.heatmapFactory=A})(window);HGIS.Layer=HGIS.Layer||{};HGIS.Layer.MsTile=HGIS.Class(HGIS.Layer.TMS,{initialize:function(C,A,D){var B=[];B.push(C,A,{},D);HGIS.Layer.TMS.prototype.initialize.apply(this,B);this.url=A;this.layername=C;if(D!=null){this.tileOrigin.lon=D.extra.originX;this.tileOrigin.lat=D.extra.originY;this.resolutions=D.extra.resInfo;this.minLevel=D.minLevel;this.maxLevel=D.maxLevel}},minLevel:0,maxLevel:20,url:"",layername:".",alpha:true,type:"png",tileOrigin:new HGIS.LonLat(-180,90),tileOriginCorner:"tl",getURL:function(C){C=this.adjustBounds(C);var E=this.map.getResolution();var B=C.getCenterLonLat();var F=Math.floor((B.lon-this.tileOrigin.lon)/(E*this.tileSize.w));var D=Math.floor((this.tileOrigin.lat-B.lat)/(E*this.tileSize.h));var A=this.map.getZoom()*1+1;if(isBoundIntersect(HGIS.InitParam.initBound,C)&&A>=HGIS.InitParam.minLevel&&A<=HGIS.InitParam.maxLevel){var G=msTiledLayerUrl+"?registerLayerName="+registerLayerName+"&level="+A+"&col="+F+"&row="+D+"&imgType="+this.type;return G}else{return APIAdress+"gisapi/theme/image/none.png"}},isBaseLayer:true,createBackBuffer:function(){return null},displayInLayerSwitcher:true,resolutions:null,tileOptions:{blankImageUrl:APIAdress+"/gisapi/theme/image/none.png",onImageError:function(){var A=this.imgDiv;if(A.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");A.src=APIAdress+"gisapi/theme/image/none.png";this.onImageLoad()}}}},CLASS_NAME:"HGIS.Layer.MsTile"});HGIS.Layer=HGIS.Layer||{};HGIS.Layer.StaticLayer=HGIS.Class(HGIS.Layer.XYZ,{type:"jpg",isBaseLayer:true,tileOrigin:new HGIS.LonLat(0,0),tileSize:new HGIS.Size(256,256),useScales:false,transitionEffect:"",resolutions:[],overrideDPI:false,projection:"EPSG:4326",tileOptions:{blankImageUrl:APIAdress+"gisapi/theme/image/none.png",onImageError:function(){var A=this.imgDiv;if(A.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");A.src=APIAdress+"/gisapi/theme/image/none.png";this.onImageLoad()}}}},initialize:function(E,B,D){HGIS.Util.extend(this,D);if(D.srid){this.projection="EPSG:"+D.srid}if(D.rows&&D.cols){this.tileSize=new HGIS.Size(D.rows,D.cols)}this.sphericalMercator=false;this.units="m";this.resolutions=[];var C=D.lods.length;for(var A=0;A<C;A++){this.resolutions.push(D.lods[A].resolution)}this.serverResolutions=this.resolutions;this.maxExtent=new HGIS.Bounds(D.fullExtent.xmin,D.fullExtent.ymin,D.fullExtent.xmax,D.fullExtent.ymax);HGIS.Layer.XYZ.prototype.initialize.apply(this,[E,B,HGIS.Util.extend({maxExtent:this.maxExtent,resolutions:this.resolutions,projection:this.projection},D)])},getURL:function(B){var G=this.getXYZ(B);var E=G.x;var F=G.y;var C=G.z;var A=this.url;var D=""+E+F+C;if(HGIS.Util.isArray(A)){A=this.selectUrl(D,A)}A=A+"/TileGroup0/${z}-${x}-${y}."+this.type;A=HGIS.String.format(A,{"x":E,"y":F,"z":C});return HGIS.Util.urlAppend(A,HGIS.Util.getParameterString(this.params))},CLASS_NAME:"HGIS.StaticLayer.StaticLayer"});HGIS.Layer=HGIS.Layer||{};HGIS.Layer.TMSLayer=function(C,A,D){var B=this;B.name=C;B.url=A;B.params=D;this.getTileUrl=function(G,H,L){var K="";G=L.adjustBounds(G);var O=L.map.getResolution();var F=G.getCenterLonLat();var P=Math.floor((F.lon-L.tileOrigin.lon)/(O*L.tileSize.w));var J=Math.floor((L.tileOrigin.lat-F.lat)/(O*L.tileSize.h));var M=L.map.getZoom();if(M>=L.minLevel&&M<=L.maxLevel){var I="";var N=B.url.split("^")[1]!=undefined?B.url.split("^")[1]:"";if(N===""){I=L.url.split("^")[0].replace("{x}",P).replace("{y}",J).replace("{z}",M)}else{I=L.url.split("^")[0].replace("{x}",P).replace("{y}",J).replace("{z}",M)+"."+N}K=HGIS.Utils.getSafeAddress(I)}else{K=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png")}if(HGIS.Strategy.Parameters.isCache&&HGIS.Strategy.Parameters.isConnected){return new Promise(function(R,Q){var T=function(U){R(URL.createObjectURL(U))};var S=function(U){B.takeUrlToIndexedDB(K,M);R(K)};HGIS.Strategy.Parameters.wtc.query(K.hashCode(),M,T,S)})}else{return K}};this.getTileUrl_test=function(G,H,F){if(HGIS.Strategy.Parameters.isCache&&HGIS.Strategy.Parameters.isConnected){B.getTileUrl_promise(G,H,F)}else{B.getTileUrl_origin(G,H,F)}};this.getTileUrl_origin=function(G,H,L){var K="";G=L.adjustBounds(G);var O=L.map.getResolution();var F=G.getCenterLonLat();var P=Math.floor((F.lon-L.tileOrigin.lon)/(O*L.tileSize.w));var J=Math.floor((L.tileOrigin.lat-F.lat)/(O*L.tileSize.h));var M=L.map.getZoom();if(M>=L.minLevel&&M<=L.maxLevel){var I="";var N=B.url.split("^")[1]!=undefined?B.url.split("^")[1]:"";if(N===""){I=L.url.split("^")[0].replace("{x}",P).replace("{y}",J).replace("{z}",M)}else{I=L.url.split("^")[0].replace("{x}",P).replace("{y}",J).replace("{z}",M)+"."+N}K=HGIS.Utils.getSafeAddress(I)}else{K=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png")}return K};this.getTileUrl_promise=function(G,H,L){var K="";G=L.adjustBounds(G);var O=L.map.getResolution();var F=G.getCenterLonLat();var P=Math.floor((F.lon-L.tileOrigin.lon)/(O*L.tileSize.w));var J=Math.floor((L.tileOrigin.lat-F.lat)/(O*L.tileSize.h));var M=L.map.getZoom();if(M>=L.minLevel&&M<=L.maxLevel){var I="";var N=B.url.split("^")[1]!=undefined?B.url.split("^")[1]:"";if(N===""){I=L.url.split("^")[0].replace("{x}",P).replace("{y}",J).replace("{z}",M)}else{I=L.url.split("^")[0].replace("{x}",P).replace("{y}",J).replace("{z}",M)+"."+N}K=HGIS.Utils.getSafeAddress(I)}else{K=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png")}return new Promise(function(R,Q){var T=function(U){R(URL.createObjectURL(U))};var S=function(U){B.takeUrlToIndexedDB(K,M);R(K)};HGIS.Strategy.Parameters.wtc.query(K.hashCode(),M,T,S)})};this.takeUrlToIndexedDB=function(F,G){var H=new XMLHttpRequest();H.open("GET",F,true);H.responseType="blob";H.addEventListener("load",function(){if(H.status===200){HGIS.Strategy.Parameters.wtc.insert(F.hashCode(),G,H.response)}else{}},false);H.send()};var E=new HGIS.Layer.TMS(B.name,B.url,{serviceVersion:".",layername:B.name,alpha:true,tileOrigin:B.params.tileOrigin,tileOriginCorner:"tl",tileSize:new HGIS.Size(B.params.tileSize*1,B.params.tileSize*1),mapBounds:B.params.extent||B.params.bounds,minLevel:B.params.minLevel,maxLevel:B.params.maxLevel,getURL:function(G){var F=B.getTileUrl(G,B.name,this);return F},createBackBuffer:function(){return null},isBaseLayer:true,displayInLayerSwitcher:true,resolutions:B.params.resolutions,serverResolutions:B.params.resolutions,tileOptions:{blankImageUrl:HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png"),onImageError:function(){this.createBackBuffer=function(){return null};var F=this.imgDiv;if(F.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");F.src=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png");this.onImageLoad()}}}}});return E};HGIS.Layer.VectorEx=HGIS.Class(HGIS.Layer,{isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,ratio:1,tileCount:0,nowTile:0,initialize:function(C,B){HGIS.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new HGIS.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var A=0,D=this.strategies.length;A<D;A++){this.strategies[A].setLayer(this)}}},destroy:function(){if(this.strategies){var C,A,B;for(A=0,B=this.strategies.length;A<B;A++){C=this.strategies[A];if(C.autoDestroy){C.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;HGIS.Layer.prototype.destroy.apply(this,arguments)},clone:function(C){if(C==null){C=new HGIS.Layer.Vector(this.name,this.getOptions())}C=HGIS.Layer.prototype.clone.apply(this,[C]);var A=this.features;var E=A.length;var D=new Array(E);for(var B=0;B<E;++B){D[B]=A[B].clone()}C.features=D;return C},refresh:function(A){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",A)}},assignRenderer:function(){for(var A=0,C=this.renderers.length;A<C;A++){var D=this.renderers[A];var B=(typeof D=="function")?D:HGIS.Renderer[D];if(B&&B.prototype.supported()){this.renderer=new B(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){HGIS.Console.userError(HGIS.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(A){HGIS.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;var B=this.map.getSize();B.w=B.w*this.ratio;B.h=B.h*this.ratio;this.renderer.setSize(B)}},afterAdd:function(){if(this.strategies){var C,A,B;for(A=0,B=this.strategies.length;A<B;A++){C=this.strategies[A];if(C.autoActivate){C.activate()}}}},removeMap:function(B){this.drawn=false;if(this.strategies){var D,A,C;for(A=0,C=this.strategies.length;A<C;A++){D=this.strategies[A];if(D.autoActivate){D.deactivate()}}}},onMapResize:function(){HGIS.Layer.prototype.onMapResize.apply(this,arguments);var A=this.map.getSize();A.w=A.w*this.ratio;A.h=A.h*this.ratio;this.renderer.setSize(A)},moveTo:function(E,K,F){for(var H in this.renderer.features){var L=this.renderer.features[H][0];var R=this.caculateOrigin(L.origin,this.map.resolution);var A=this.calculateDXY(R,this.map.getExtent(),this.map.resolution);var P=L.oldGeometry;var Q=L.geometry;if(L.type==1){Q[0]=P[0]+A.x;Q[1]=P[1]+A.y}else{if(L.type==2){for(var T=0,B=P.length;T<B;T=T+2){if(Q[T]=="|"){continue}Q[T]=P[T]+A.x;Q[T+1]=P[T+1]+A.y}var C=L.attributes["oldTextCoords"];if(C!==undefined&&C!==""){if(L.attributes["textCoords"] instanceof Array){var X=C.split(",");for(var G=0,O=X.length;G<O;G++){var S=X[G].split(" ");L.attributes["textCoords"][G][0]=parseInt(S[0])+A.x;L.attributes["textCoords"][G][1]=parseInt(S[1])+A.y}}}}else{if(L.type==3){for(var T=0,B=P.length;T<B;T=T+2){if(Q[T]=="|"){continue}Q[T]=P[T]+A.x;Q[T+1]=P[T+1]+A.y}}}}}HGIS.Layer.prototype.moveTo.apply(this,arguments);var M=true;if(!F){this.renderer.root.style.visibility="hidden";var W=this.map.getSize(),J=W.w,N=W.h,D=(J/2*this.ratio)-J/2,U=(N/2*this.ratio)-N/2;D+=this.map.layerContainerOriginPx.x;D=-Math.round(D);U+=this.map.layerContainerOriginPx.y;U=-Math.round(U);this.div.style.left=D+"px";this.div.style.top=U+"px";var I=this.map.getExtent().scale(this.ratio);M=this.renderer.setExtent(I,K);this.renderer.root.style.visibility="visible";if(!K&&M){for(var V=this.unrenderedFeatures.length-1;V>=0;V--){this.drawFeature(this.unrenderedFeatures[V])}}}if(!this.drawn||K||!M){this.drawn=true;var Y=this.features.length-1;for(var V=Y;V>=0;V--){this.renderer.locked=(V!==Y);this.drawFeature(this.features[V])}}},display:function(B){HGIS.Layer.prototype.display.apply(this,arguments);var A=this.div.style.display;if(A!=this.renderer.root.style.display){this.renderer.root.style.display=A}},countTime:0,addFeatures:function(A,F){if(!(HGIS.Util.isArray(A))){A=[A]}var B=true;if(B){var C={features:A};var I=this.events.triggerEvent("beforefeaturesadded",C);if(I===false){return}A=C.features}var D=[];for(var E=0,G=A.length;E<G;E++){if(E!=(A.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var H=A[E];if(this.geometryType&&!(H.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}if(F==undefined){H.layer=this}else{H.layer=F.layer}if(!H.style&&this.style){H.style=HGIS.Util.extend({},this.style)}else{H.style=this.styleMap.createSymbolizer(H)}if(B){if(this.events.triggerEvent("beforefeatureadded",{feature:H})===false){continue}this.preFeatureInsert(H)}D.push(H);this.features.push(H);this.drawFeature(H,F);if(B){this.events.triggerEvent("featureadded",{feature:H});this.onFeatureInsert(H)}}if(B){this.events.triggerEvent("featuresadded",{features:D})}},removeFeatures:function(A,C){if(!A||A.length===0){return}if(A===this.features){return this.removeAllFeatures(C)}if(!(HGIS.Util.isArray(A))){A=[A]}if(A===this.selectedFeatures){A=A.slice()}var D=!C||!C.silent;if(D){this.events.triggerEvent("beforefeaturesremoved",{features:A})}for(var B=A.length-1;B>=0;B--){if(B!=0&&A[B-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var E=A[B];delete this.unrenderedFeatures[E.id];if(D){this.events.triggerEvent("beforefeatureremoved",{feature:E})}this.features=HGIS.Util.removeItem(this.features,E);E.layer=null;if(E.geometry){this.renderer.eraseFeatures(E)}if(HGIS.Util.indexOf(this.selectedFeatures,E)!=-1){HGIS.Util.removeItem(this.selectedFeatures,E)}if(D){this.events.triggerEvent("featureremoved",{feature:E})}}if(D){this.events.triggerEvent("featuresremoved",{features:A})}},removeAllFeatures:function(D){var A=!D||!D.silent;var B=this.features;if(A){this.events.triggerEvent("beforefeaturesremoved",{features:B})}var E;for(var C=B.length-1;C>=0;C--){E=B[C];if(A){this.events.triggerEvent("beforefeatureremoved",{feature:E})}E.layer=null;if(A){this.events.triggerEvent("featureremoved",{feature:E})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(A){this.events.triggerEvent("featuresremoved",{features:B})}},destroyFeatures:function(A,C){var D=(A==undefined);if(D){A=this.features}if(A){this.removeFeatures(A,C);for(var B=A.length-1;B>=0;B--){A[B].destroy()}}},drawFeature:function(B,C){if(!this.drawn){return}var D=undefined;if(typeof D!="object"){if(!D&&B.state===HGIS.State.DELETE){D="delete"}var A=D||B.renderIntent;D=B.style||this.style}var E=this.renderer.drawFeature(B,D,C);if(E===false||E===null){this.unrenderedFeatures[B.id]=B}else{delete this.unrenderedFeatures[B.id]}},eraseFeatures:function(A){this.renderer.eraseFeatures(A)},getFeatureFromEvent:function(C){if(!this.renderer){throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var B=null;var A=this.renderer.getFeatureIdFromEvent(C);if(A){if(typeof A==="string"){B=this.getFeatureById(A)}else{B=A}}return B},getFeatureBy:function(C,E){var A=null;for(var B=0,D=this.features.length;B<D;++B){if(this.features[B][C]==E){A=this.features[B];break}}return A},getFeatureById:function(A){return this.getFeatureBy("id",A)},getFeatureByFid:function(A){return this.getFeatureBy("fid",A)},getFeaturesByAttribute:function(A,D){var B,F,E=this.features.length,C=[];for(B=0;B<E;B++){F=this.features[B];if(F&&F.attributes){if(F.attributes[A]===D){C.push(F)}}}return C},onFeatureInsert:function(A){},preFeatureInsert:function(A){},getDataExtent:function(){var C=null;var A=this.features;if(A&&(A.length>0)){var D=null;for(var B=0,E=A.length;B<E;B++){D=A[B].geometry;if(D){if(C===null){C=new HGIS.Bounds()}C.extend(D.getBounds())}}}return C},caculateOrigin:function(D,B){var C=[0,0];var A=D.split("-");C[0]=HGIS.InitParam.tileOrigin.lon+(A[1])*256*B;C[1]=HGIS.InitParam.tileOrigin.lat-(A[0])*256*B;return C},calculateDXY:function(D,A,C){var B=(D[0]-A.left)/C;B=Math.round(B);var E=(A.top-D[1])/C;E=Math.round(E);return{"x":B,"y":E}},CLASS_NAME:"HGIS.Layer.VectorEx"});HGIS.Layer=HGIS.Layer||{};HGIS.Layer.WMTSLayer=function(B,H,G,E,D,F){var C=this;C.name=B;C.url=H.split("^")[0];C.layer=G;C.matrixSet=E;C.style=D;C.params=F;this.getTileUrl=function(S,T){var R="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(S)){var K=S.getCenterLonLat();var Q=T.getTileInfo(K);var L=T.matrix.identifier;var I=T.dimensions,O;if(HGIS.Util.isArray(T.url)){R=T.selectUrl([T.version,T.style,T.matrixSet,T.matrix.identifier,Q.row,Q.col].join(","),T.url)}else{R=T.url}if(T.requestEncoding.toUpperCase()==="REST"){O=T.params;if(R.indexOf("{")!==-1){var J=R.replace(/\{/g,"${");var M={style:T.style,Style:T.style,TileMatrixSet:T.matrixSet,TileMatrix:T.matrix.identifier,TileRow:Q.row,TileCol:Q.col};if(I){var U,N;for(N=I.length-1;N>=0;--N){U=I[N];M[U]=O[U.toUpperCase()]}}R=HGIS.String.format(J,M)}else{var P=T.version+"/"+T.layer+"/"+T.style+"/";if(I){for(var N=0;N<I.length;N++){if(O[I[N]]){P=P+O[I[N]]+"/"}}}P=P+T.matrixSet+"/"+T.matrix.identifier+"/"+Q.row+"/"+Q.col+"."+T.formatSuffix;if(!R.match(/\/$/)){R=R+"/"}R=R+P}}else{if(T.requestEncoding.toUpperCase()==="KVP"){O={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:T.version,LAYER:T.layer,STYLE:T.style,TILEMATRIXSET:T.matrixSet,TILEMATRIX:T.matrix.identifier,TILEROW:Q.row,TILECOL:Q.col,FORMAT:T.format};R=HGIS.Layer.Grid.prototype.getFullRequestString.apply(T,[O])}}return HGIS.Utils.getSafeAddress(R)}else{return HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png")}};var A=new HGIS.Layer.WMTS({name:C.name,layer:C.layer,url:C.url,matrixSet:C.matrixSet,style:C.style,format:C.params.imageFormat,mapBounds:C.params.extent,minLevel:C.params.minLevel,maxLevel:C.params.maxLevel,getURL:function(J){var I=C.getTileUrl(J,this);return I},createBackBuffer:function(){return null},isBaseLayer:true,displayInLayerSwitcher:true,tileOptions:{blankImageUrl:HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png"),onImageError:function(){this.createBackBuffer=function(){return null};var I=this.imgDiv;if(I.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=HGIS.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{this.events.triggerEvent("loaderror");I.src=HGIS.Utils.getSafeAddress(APIAdress+"/gisapi/theme/image/none.png");this.onImageLoad()}}}}});return A};HGIS.MapEx=HGIS.Class(HGIS.Map,{map:null,isLoaded:false,mapLoaded:function(){},usedForStaticMap:false,container:null,drawControls:null,graphicLayer:null,markerLayer:null,isCache:false,initialize:function(C,B){var A=this;if(B&&B.hasOwnProperty("isCache")&&B.isCache==true){HGIS.Strategy.Parameters.isCache=true;HGIS.Strategy.Parameters.initDB()}HGIS.Control.prototype.initialize.apply(this,arguments);this.id=C.toString();this._map=this;this.container=C;if(!B){B={}}this.drawControls={};HGIS.Map.prototype.initialize.apply(this,[C,B]);this.tileManager.destroy();this.Z_INDEX_BASE["Feature"]=this.Z_INDEX_BASE["Overlay"]-5;this.graphicLayer=new HGIS.Layer.Vector("",{displayInLayerSwitcher:false,isBaseLayer:false,renderers:["SVG","Canvas","VML"]});this.markerLayer=new HGIS.Layer.Markers("");this._map.addLayers([this.graphicLayer,this.markerLayer]);A.enableVtMap=false;if(!this.usedForStaticMap){if(!HGIS.InitParam.isFrontConfig){setTimeout(function(){HGIS.InitParam.init(mapServerConfigURL.getMapParams,function(){A._map.maxLevel=HGIS.InitParam.maxLevel;A._map.minLevel=HGIS.InitParam.minLevel;if((B!=undefined&&B.enableVtMap===true)){A.enableVtMap=true}else{if(B!=undefined&&B.enableVtMap===false){A.enableVtMap=false}else{if(B==undefined||B.enableVtMap===undefined){A.enableVtMap=false}}}if(A.enableVtMap&&B.vtStyleName){A._map.vtStyleId=B.vtStyleName;HGIS.utils.MapStyleUtil.ifExitVtStyleByUrl(A._map.vtStyleId)}A._map.loadMap();A._map.isLoaded=true;if(HGIS.InitParam.factor==1&&HGIS.InitParam.reloadFactor){HGIS.tools.getFactor()}})},0)}else{A._map.maxLevel=HGIS.InitParam.maxLevel;A._map.minLevel=HGIS.InitParam.minLevel;if((B!=undefined&&B.enableVtMap===true)){A.enableVtMap=true}else{if(B!=undefined&&B.enableVtMap===false){A.enableVtMap=false}else{if(B!=undefined||B.enableVtMap===undefined){A.enableVtMap=false}}}if(A.enableVtMap){A._map.vtStyleId=B.vtStyleName;A._map.styleJsonUrl=encodeURI(HGIS.utils.MapStyleUtil.getVtStylePath(A._map.vtStyleId))}setTimeout(function(){A._map.loadMap();A._map.isLoaded=true},0)}}else{setTimeout(function(){A._map.initDefaultLayerControl();A.mapLoaded.apply(this,arguments)},0)}},setLayerZIndex:function(){},getUnits:function(){return HGIS.InitParam.mapUnit},removeLayer:function(B,A){if(B.CLASS_NAME=="HGIS.Layer.GraphicLayer"){B.clear();return}if(this.layerRoot){HGIS.Util.removeItem(this.layerRoot.layers,B)}HGIS.Map.prototype.removeLayer.apply(this,arguments)},addLayer:function(A){if(A.CLASS_NAME=="HGIS.Layer.GraphicLayer"){A.setMap(this);return}HGIS.Map.prototype.addLayer.apply(this,arguments);if(A.CLASS_NAME=="HGIS.Layer.Vector"||A.CLASS_NAME=="HgisPlot.Layer.Vector"||"HGIS.Layer.Markers"==A.CLASS_NAME){this.resetVecLayers()}},addLayers:function(A){HGIS.Map.prototype.addLayers.apply(this,arguments);this.resetVecLayers()},resetVecLayers:function(){if(this.layerRoot){this.layerRoot.removeMap(this);this.layerRoot.destroy()}var C=[];for(var A=0;A<this.layers.length;A++){var B=this.layers[A];if(B.CLASS_NAME=="HGIS.Layer.Vector"||B.CLASS_NAME=="HgisPlot.Layer.Vector"){C.push(B);B.setZIndex(this.Z_INDEX_BASE.Feature)}else{if(B.CLASS_NAME=="HGIS.Layer.Markers"){B.setZIndex(this.Z_INDEX_BASE.Popup-1)}}}this.layerRoot=new HGIS.Layer.Vector.RootContainer("root_container",{layers:C});HGIS.Map.prototype.addLayer.apply(this,[this.layerRoot]);this.layerRoot.setZIndex(this.Z_INDEX_BASE.Overlay)},resetLayersZIndex:function(){},loadMap:function(){var W=this;HGIS.InitParam.map=this;this._map.maxExtent=HGIS.InitParam.extent;if(W.enableVtMap){this._map.resolutions=HGIS.InitParam.resolutions;if(HGIS.InitParam.hvtUrl!=undefined&&HGIS.InitParam.hvtUrl!==""){hvtUrl=HGIS.InitParam.hvtUrl;hvtUrl=hvtUrl.replace("{x}","${x}").replace("{y}","${y}").replace("{z}","${z}")}else{hvtUrl=HGIS.utils.MapStyleUtil.hvtUrl}var P=new HGIS.Format.PBF();var L=new HGIS.Strategy.Grid();var M=new HGIS.Protocol.HTTP({url:hvtUrl+".hvt",format:P});var X=HGIS.utils.MapStyleUtil.getMapScales(this._map.resolutions,HGIS.InitParam.srid);if(HGIS.utils.MapStyleUtil.styleJson==null){if(this._map.vtStyleId&&this._map.vtStyleId!=undefined){HGIS.utils.MapStyleUtil.getHvtStyle(W._map.vtStyleId)}else{HGIS.utils.MapStyleUtil.styleJson=HGIS.utils.MapStyleJSON.data}setTimeout(function(){W._map.loadMap()},25);return}else{var Y=HGIS.utils.MapStyleUtil.createStyleMap(HGIS.utils.MapStyleUtil.styleJson,X);var H;if(HGIS.InitParam.srid=="4326"){H=new HGIS.Projection("EPSG:4326")}else{H=new HGIS.Projection("EPSG:900913")}var O=new HGIS.Layer.VectorEx("Vector",{strategies:[L],protocol:M,styleMap:Y,renderers:["VectorTile"],isBaseLayer:W.baseLayer==="vectorEx"?true:false,projection:H});this._map.addLayer(O)}}switch(HGIS.InitParam.mapType.toLowerCase()){case"googlemap":case"gaodemap":case"googlemap_on":case"gaodemap_on":case"baidumap":HGIS.InitParam.mapUnit="m";this._map.units="m";this._map.projection="EPSG:900913";this._map.displayProjection=new HGIS.Projection("EPSG:900913");var B=HGIS.InitParam.vecUrl.split("|");for(var I=0;I<B.length;I++){var J=new HGIS.Layer.TMSLayer("vec",B[I],HGIS.InitParam);if(I>0){J.isBaseLayer=false}this._map.addLayer(J)}if(HGIS.InitParam.imgUrl!=""){B=HGIS.InitParam.imgUrl.split("|");for(var F=0;F<B.length;F++){var T=new HGIS.Layer.TMSLayer("img",B[F],HGIS.InitParam);if(F>0){T.isBaseLayer=false}T.setVisibility(false);this._map.addLayer(T)}}break;case"hikmap":this._map.displayProjection=new HGIS.Projection("EPSG:4326");if(HGIS.InitParam.srid=="900913"){HGIS.InitParam.mapUnit="m";this._map.units="m";this._map.projection="EPSG:900913"}else{HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326")}var B=HGIS.InitParam.vecUrl.split("|");for(var I=0;I<B.length;I++){var J=new HGIS.Layer.TMSLayer("vec",B[I],HGIS.InitParam);if(I>0){J.isBaseLayer=false}this._map.addLayer(J)}if(HGIS.InitParam.imgUrl!=""){B=HGIS.InitParam.imgUrl.split("|");for(var F=0;F<B.length;F++){var T=new HGIS.Layer.TMSLayer("img",B[F],HGIS.InitParam);if(F>0){T.isBaseLayer=false}T.setVisibility(false);this._map.addLayer(T)}}break;case"spiritmap":case"spiritmap_on":HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326");this._map.displayProjection=new HGIS.Projection("EPSG:4326");var B=HGIS.InitParam.vecUrl.split("|");for(var I=0;I<B.length;I++){var J=new HGIS.Layer.TMSLayer("vec",B[I],HGIS.InitParam);if(I>0){J.isBaseLayer=false}if(W.enableVtMap){J.setVisibility(false)}this._map.addLayer(J)}if(HGIS.InitParam.imgUrl!=""){B=HGIS.InitParam.imgUrl.split("|");for(var F=0;F<B.length;F++){var T=new HGIS.Layer.TMSLayer("img",B[F],HGIS.InitParam);if(F>0){T.isBaseLayer=false}T.setVisibility(false);this._map.addLayer(T)}}break;case"tmsmap":this._map.displayProjection=new HGIS.Projection("EPSG:4326");if(HGIS.InitParam.srid=="900913"){HGIS.InitParam.mapUnit="m";this._map.units="m";this._map.projection="EPSG:900913"}else{HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326")}var B=HGIS.InitParam.vecUrl.split("|");for(var I=0;I<B.length;I++){var J=new HGIS.Layer.TMSLayer("vec",B[I],HGIS.InitParam);if(I>0){J.isBaseLayer=false}if(W.enableVtMap){J.setVisibility(false)}this._map.addLayer(J)}if(HGIS.InitParam.imgUrl!=""){B=HGIS.InitParam.imgUrl.split("|");for(var F=0;F<B.length;F++){var T=new HGIS.Layer.TMSLayer("img",B[F],HGIS.InitParam);if(F>0){T.isBaseLayer=false}T.setVisibility(false);this._map.addLayer(T)}}if(HGIS.InitParam.tfwUrl!=""){B=HGIS.InitParam.tfwUrl.split("|");for(var A=0;A<B.length;A++){var G=new HGIS.Layer.TMSLayer("tfw",B[A],HGIS.InitParam);if(A>0){G.isBaseLayer=false}G.setVisibility(false);this._map.addLayer(G)}}if(HGIS.InitParam.mixedUrl!=""){B=HGIS.InitParam.mixedUrl.split("|");for(var E=0;E<B.length;E++){var C=new HGIS.Layer.TMSLayer("mixed",B[E],HGIS.InitParam);if(E>0){C.isBaseLayer=false}C.setVisibility(false);this._map.addLayer(C)}}break;case"arcgismap_on":this._map.displayProjection=new HGIS.Projection("EPSG:4326");if(HGIS.InitParam.srid=="900913"){HGIS.InitParam.mapUnit="m";this._map.units="m";this._map.projection="EPSG:900913"}else{HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326")}var B=HGIS.InitParam.vecUrl.split("|");for(var I=0;I<B.length;I++){var J=new HGIS.Layer.AgsOnLayer(B[I],HGIS.InitParam.extent,HGIS.InitParam.minLevel,HGIS.InitParam.maxLevel,HGIS.InitParam.resolutions,HGIS.InitParam.tileOrigin,"vec");if(I>0){J.isBaseLayer=false}this._map.addLayer(J)}if(HGIS.InitParam.imgUrl!=""){B=HGIS.InitParam.imgUrl.split("|");for(var F=0;F<B.length;F++){var T=new HGIS.Layer.AgsOnLayer(B[F],HGIS.InitParam.extent,HGIS.InitParam.minLevel,HGIS.InitParam.maxLevel,HGIS.InitParam.resolutions,HGIS.InitParam.tileOrigin,"img");if(F>0){T.isBaseLayer=false}T.setVisibility(false);this._map.addLayer(T)}}break;case"arcgismap":this._map.displayProjection=new HGIS.Projection("EPSG:4326");if(HGIS.InitParam.srid=="900913"){HGIS.InitParam.mapUnit="m";this._map.units="m";this._map.projection="EPSG:900913"}else{HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326")}var B=HGIS.InitParam.vecUrl.split("|");for(var I=0;I<B.length;I++){var J=new HGIS.Layer.AgsOffLayer(B[I],HGIS.InitParam.extent,HGIS.InitParam.minLevel,HGIS.InitParam.maxLevel,HGIS.InitParam.resolutions,HGIS.InitParam.tileOrigin,"vec");if(I>0){J.isBaseLayer=false}this._map.addLayer(J)}if(HGIS.InitParam.imgUrl!=""){B=HGIS.InitParam.imgUrl.split("|");for(var F=0;F<B.length;F++){var T=new HGIS.Layer.AgsOffLayer(B[F],HGIS.InitParam.extent,HGIS.InitParam.minLevel,HGIS.InitParam.maxLevel,HGIS.InitParam.resolutions,HGIS.InitParam.tileOrigin,"img");if(F>0){T.isBaseLayer=false}T.setVisibility(false);this._map.addLayer(T)}}break;case"ezmap":HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326");this._map.displayProjection=new HGIS.Projection("EPSG:4326");var D=HGIS.InitParam.resolutions;var N=[];var U=0;var a=parseInt(HGIS.InitParam.maxLevel);var V=parseInt(HGIS.InitParam.zoomOffset);for(var I=0;I<D.length;I++){if(U<V){U++;continue}N.push(Number(D[I]));if(a!=0&&(U-V)>=a){break}U++}var Q=HGIS.InitParam.vecUrl;var Z=HGIS.InitParam.imgUrl;var R={levelSequence:parseInt(HGIS.InitParam.levelSequence),levelMax:a,ezZoomOffset:parseInt(HGIS.InitParam.zoomOffset),minLevel:HGIS.InitParam.minLevel,maxLevel:HGIS.InitParam.maxLevel,resolutions:N,mapBounds:HGIS.InitParam.extent,tileSize:new HGIS.Size(HGIS.InitParam.tileSize*1,HGIS.InitParam.tileSize*1),tileOrigin:HGIS.InitParam.tileOrigin};var K=new HGIS.Layer.EzLayer("vec",Q,R);var S=new HGIS.Layer.EzLayer("img",Z,R);this._map.addLayers([K,S]);break;case"wmtsmap":this._map.displayProjection=new HGIS.Projection("EPSG:4326");if(HGIS.InitParam.srid=="900913"){HGIS.InitParam.mapUnit="m";this._map.units="m";this._map.projection="EPSG:900913"}else{HGIS.InitParam.mapUnit="degrees";this._map.units="degrees";this._map.projection=new HGIS.Projection("EPSG:4326")}var J=new HGIS.Layer.WMTSLayer("vec",HGIS.InitParam.vecUrl,HGIS.InitParam.layer,HGIS.InitParam.matrixSet,HGIS.InitParam.style,HGIS.InitParam);this._map.addLayers([J]);if(HGIS.InitParam.imgUrl!=""){var T=new HGIS.Layer.WMTSLayer("img",HGIS.InitParam.imgUrl,HGIS.InitParam.layer,HGIS.InitParam.matrixSet,HGIS.InitParam.style,HGIS.InitParam);this._map.addLayers([T])}break;default:break}setTimeout(function(){var b=new HGIS.Control.LayerSwitch();b.setMap(W._map);W._map.addControl(b)},0);this._map.initDefaultLayerControl();this._map.setCenter(this._map.center||HGIS.InitParam.center,HGIS.InitParam.initLevel,false,true);this.mapLoaded.apply(this,arguments)},moveTo:function(U,S,T){if(this._map.baseLayer==null){return}if(U!=null&&!(U instanceof HGIS.LonLat)){U=new HGIS.LonLat(U)}if(!T){T={}}if(S!=null){S=parseFloat(S);if(!this.fractionalZoom){S=Math.round(S)}}var I=S;S=this.adjustZoom(S);if(S!==I){U=this.getCenter()}var N=T.dragging||this.dragging;var C=T.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(U)){U=this.maxExtent.getCenterLonLat();this.center=U.clone()}if(this.restrictedExtent!=null){if(U==null){U=this.center}if(S==null){S=this.getZoom()}var P=this.getResolutionForZoom(S);var Q=this.calculateBounds(U,P);if(!this.restrictedExtent.containsBounds(Q)){var R=this.restrictedExtent.getCenterLonLat();if(Q.getWidth()>this.restrictedExtent.getWidth()){U=new HGIS.LonLat(R.lon,U.lat)}else{if(Q.left<this.restrictedExtent.left){U=U.add(this.restrictedExtent.left-Q.left,0)}else{if(Q.right>this.restrictedExtent.right){U=U.add(this.restrictedExtent.right-Q.right,0)}}}if(Q.getHeight()>this.restrictedExtent.getHeight()){U=new HGIS.LonLat(U.lon,R.lat)}else{if(Q.bottom<this.restrictedExtent.bottom){U=U.add(0,this.restrictedExtent.bottom-Q.bottom)}else{if(Q.top>this.restrictedExtent.top){U=U.add(0,this.restrictedExtent.top-Q.top)}}}if(S<=this.getZoomForExtent(this.restrictedExtent)){S=this.getZoomForExtent(this.restrictedExtent)}}}if(S>this._map.maxLevel){S=this._map.maxLevel}if(S<this._map.minLevel){S=this._map.minLevel}var J=C||((this.isValidZoomLevel(S))&&(S!=this.getZoom()));var X=(this.isValidLonLat(U))&&(!U.equals(this.center));if(J||X||N){N||this.events.triggerEvent("movestart",{zoomChanged:J});if(X){if(!J&&this.center){this.centerLayerContainer(U)}this.center=U.clone()}var W=J?this.getResolutionForZoom(S):this.getResolution();if(J||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var O=this.getMaxExtent({restricted:true});var M=O.getCenterLonLat();var Y=this.center.lon-M.lon;var D=M.lat-this.center.lat;var L=Math.round(O.getWidth()/W);var G=Math.round(O.getHeight()/W);this.minPx={x:(this.size.w-L)/2-Y/W,y:(this.size.h-G)/2-D/W};this.maxPx={x:this.minPx.x+Math.round(O.getWidth()/W),y:this.minPx.y+Math.round(O.getHeight()/W)}}if(J){this.zoom=S;this.resolution=W}var E=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(E,J,T.dragging);T.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:J})}E=this.baseLayer.getExtent();for(var V=this.layers.length-1;V>=0;--V){var K=this.layers[V];if(K!==this.baseLayer&&!K.isBaseLayer){var F=K.calculateInRange();if(K.inRange!=F){K.inRange=F;if(!F){K.display(false)}this.events.triggerEvent("changelayer",{layer:K,property:"visibility"})}if(F&&K.visibility){K.moveTo(E,J,T.dragging);T.dragging||K.events.triggerEvent("moveend",{zoomChanged:J})}}}this.events.triggerEvent("move");N||this.events.triggerEvent("moveend");if(J||X){var H=this.getExtent();for(var V=0,B=this.popups.length;V<B;V++){var U=this.popups[V].lonlat;var A=false;if(U.lon<H.right&&U.lon>H.left&&U.lat>H.bottom&&U.lat<H.top){A=true}if(this.popups[V].changeAnchorIfOutOfView==true&&A==true){this.popups[V].draw();this.popups[V].updatePosition()}else{if(this.popups[V].changeAnchorIfOutOfView==true&&A==false){this.popups[V].destroy()}else{if(this.popups[V].changeAnchorIfOutOfView==false){this.popups[V].updatePosition()}else{this.popups[V].updatePosition()}}}}if(J){this.events.triggerEvent("zoomend")}}}},initDefaultLayerControl:function(){this._map.graphicLayer.events.register("beforefeaturemodified",this._map.graphicLayer,function(F){var D=F.feature;if(D.events&&D.events.listeners["beforefeaturemodified"]){var G=D.events.listeners["beforefeaturemodified"];for(var E=0;E<G.length;E++){G[E].func.apply(D,[F])}}});this._map.graphicLayer.events.register("featuremodified",this._map.graphicLayer,function(F){var D=F.feature;if(D.events&&D.events.listeners["featuremodified"]){var G=D.events.listeners["featuremodified"];for(var E=0;E<G.length;E++){G[E].func.apply(D,[F])}}});this._map.graphicLayer.events.register("afterfeaturemodified",this._map.graphicLayer,function(F){var D=F.feature;if(D.events&&D.events.listeners["afterfeaturemodified"]){var G=D.events.listeners["afterfeaturemodified"];for(var E=0;E<G.length;E++){G[E].func.apply(D,[F])}}});this._map.graphicLayer.modify=new HGIS.Control.ModifyFeature(this._map.graphicLayer,{mode:HGIS.Control.ModifyFeature.DRAG|HGIS.Control.ModifyFeature.RESHAPE,toggle:false,clickout:true,standalone:true,autoActivate:true,documentDrag:false,handleMapEvents:function(D){if(D.property=="order"){this.moveLayerToTop()}}});this._map.addControl(this._map.graphicLayer.modify);this._map.graphicLayer.modify.deactivate();var B=false;var C=false;var A=null;this._map.selectFeatureControl=new HGIS.Control.SelectFeature(this._map.graphicLayer,{callbacks:{click:function(D){if(!B){B=true;C=false;A=setTimeout(function(){if(!C){C=false;B=false;if(D.events&&D.events.listeners["click"]!==undefined){var F=D.events.listeners["click"];for(var E=0;E<F.length;E++){F[E].func.apply(D,[D])}}clearTimeout(A)}},200)}},dblclick:function(D){if(A){clearTimeout(A);A=null}C=true;B=false;if(D.events&&D.events.listeners["dblclick"]!==undefined){var F=D.events.listeners["dblclick"];for(var E=0;E<F.length;E++){F[E].func.apply(D,[D])}}},over:function(D){if(D.events&&D.events.listeners["mouseover"]!==undefined){var F=D.events.listeners["mouseover"];for(var E=0;E<F.length;E++){F[E].func.apply(D,[D])}}},out:function(D){if(D.events&&D.events.listeners["mouseout"]!==undefined){var F=D.events.listeners["mouseout"];for(var E=0;E<F.length;E++){F[E].func.apply(D,[D])}}},rightClick:function(D){if(D.events&&D.events.listeners["rightclick"]!==undefined){var F=D.events.listeners["rightclick"];for(var E=0;E<F.length;E++){F[E].func.apply(D,[D])}}}},hover:false});this._map.selectFeatureControl.handlers.feature.stopDown=false;this._map.selectFeatureControl.handlers.feature.handleMapEvents=function(D){if(D.property=="order"){this.moveLayerToTop()}};this._map.addControl(this._map.selectFeatureControl);this._map.selectFeatureControl.activate()},getDefaultRenderer:function(){var A=HGIS.Util.getParameters(window.location.href).renderer;A=(A)?[A]:HGIS.Layer.Vector.prototype.renderers;return A},clear:function(){var C=this._map.layers;for(var A=0;A<C.length;A=A+1){if(C[A].features){C[A].removeAllFeatures()}else{if(C[A].CLASS_NAME=="HGIS.GraphicLayer"){C[A].clear()}else{if(C[A].CLASS_NAME=="HGIS.Layer.Markers"){C[A].clearMarkers()}}}}var B=this._map.popups;for(var A=0;A<B.length;A=A+1){this.removePopup(B[A])}},measureArea:function(A){this.flag=false;for(var B=0;B<this._map.controls.length;B=B+1){if(this._map.controls[B].type==9){C=this._map.controls[B].activate();this.flag=true;break}}if(!this.flag){var C=new HGIS.Control.Measure(HGIS.Handler.Polygon,{persist:true,type:9,eventListeners:{"measure":function(D){A(D);C.deactivate()}},handlerOptions:{layerOptions:{styleMap:new HGIS.StyleMap({strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:0.3})}}});this.addControl(C);C.activate()}},measureDist:function(A){this.flag=false;for(var B=0;B<this._map.controls.length;B=B+1){if(this._map.controls[B].type==10){this._map.controls[B].activate();this.flag=true;break}}if(!this.flag){var C=new HGIS.Control.Measure(HGIS.Handler.Path,{type:10,persist:true,eventListeners:{"measure":function(D){A(D);C.deactivate()}},handlerOptions:{layerOptions:{styleMap:new HGIS.StyleMap({strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"})}}});this._map.addControl(C);C.activate()}},zoomInExt:function(C){var A=this;var D;var B=this._map.getDefaultLayer();if(!this.drawControls["rectangle"]){D=new HGIS.Control.DrawFeature(B,HGIS.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:true}});this.drawControls["rectangle"]=D;this.addControl(D)}else{D=this.drawControls["rectangle"]}D.activate();D.events.remove("featureadded");D.events.on({"featureadded":function(E){var F=E.feature.geometry.bounds.getCenterLonLat();A._map.setCenter(F,A._map.getZoom()+1,false,false);E.object.layer.removeFeatures([E.feature]);if(!C){D.deactivate()}}})},zoomOutExt:function(C){var A=this;var D;var B=this._map.getDefaultLayer();if(!this.drawControls["rectangle"]){D=new HGIS.Control.DrawFeature(B,HGIS.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:true}});this.drawControls["rectangle"]=D;this.addControl(D)}else{D=this.drawControls["rectangle"]}D.activate();D.events.remove("featureadded");D.events.on({"featureadded":function(E){var F=E.feature.geometry.bounds.getCenterLonLat();A._map.setCenter(F,A._map.getZoom()-1,false,false);E.object.layer.removeFeatures([E.feature]);if(!C){D.deactivate()}}})},hisNav:function(){var B="undefind";for(var A=0;A<this._map.controls.length;A=A+1){if(this._map.controls[A].type==6){B=this._map.controls[A];B.activate();break}}if(B=="undefind"){B=new HGIS.Control.NavigationHistory();B.type=6;this._map.addControl(B);B.activate()}return B},stopdraw:function(){for(var A in this.drawControls){this.drawControls[A].deactivate()}this.curDrawControl=null;this.hideTip()},maximizeChanged:false,draw:function(J,G,H,I,E,C,B){this.stopdraw();var F=this;var A=this,K=null;var L="Esc";if(I){L=I;if(L=="default"){L="Esc"}this.showTip(L,B)}if(this.graphicLayer===null){throw HGIS.language[HGIS.InitParam.language]["map_noInit"];return}var D=G?G:this.graphicLayer;if(J==="point"){if(!this.drawControls["point"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.Point);this.drawControls["point"]=K;this.addControl(K)}else{K=this.drawControls["point"]}}else{if(J==="polyline"){if(!this.drawControls["polyline"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.Path);this.drawControls["polyline"]=K;this.addControl(K)}else{K=this.drawControls["polyline"]}}else{if(J==="rectangle"){if(!this.drawControls["rectangle"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:true},callbacks:{"down":function(){}}});this.drawControls["rectangle"]=K;this.addControl(K)}else{K=this.drawControls["rectangle"]}}else{if(J==="polygon"){if(!this.drawControls["polygon"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.Polygon);this.drawControls["polygon"]=K;this.addControl(K)}else{K=this.drawControls["polygon"]}}else{if(J==="circle"){if(!this.drawControls["circle"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.RegularPolygon,{handlerOptions:{sides:100,irregular:false}});this.drawControls["circle"]=K;this.addControl(K)}else{K=this.drawControls["circle"]}}else{if(J=="ellipse"){if(!this.drawControls["ellipse"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.RegularPolygon,{handlerOptions:{sides:100,irregular:true}});this.drawControls["ellipse"]=K;this.addControl(K)}else{K=this.drawControls["ellipse"]}}else{if(J=="freeline"){if(!this.drawControls["freeline"]){K=new HGIS.Control.DrawFeature(D,HGIS.Handler.Path,{handlerOptions:{freehand:true}});this.drawControls["freeline"]=K;this.addControl(K)}else{K=this.drawControls["freeline"]}}else{alert(HGIS.language[HGIS.InitParam.language]["brows_noSupport_AJAX"]);return}}}}}}}K.events.remove("featureadded");K.events.on({"featureadded":function(P){A.hideTip();K.map.removeControl(K);var R=P.feature.geometry;var N=K.layer.getZIndex();if(E){if(!E.keepOn){K.deactivate();K.events.remove("featureadded");document.getElementById(F.container).onmouseover=null;if(A.maximizeChanged){var O=A.getControlsByClass("HGIS.Control.OverviewMapEx");if(O.length>0&&O[0]){O[0].maximizeControl()}A.maximizeChanged=false}}else{if(I){A.showTip(L)}}if(E.ifClear){D.removeFeatures([P.feature]);if(P.feature){P.feature.destroy()}D.redraw()}}else{if(I){A.showTip(L)}}if(C){if(H=="wkt"){var Q=new HGIS.Format.WKT();var M=Q.extractGeometry(R);C(M)}else{C(R)}}K.layer.setZIndex(N)}});K.activate()},showTip:function(C,A){if(!this.mapTip){this.events.register("keydown",this,function(D){if(D.keyCode==27){this.stopdraw();if(A&&typeof A==="function"){A()}}});var B=new HGIS.Control.KeyboardDefaults({autoActivate:true,defaultKeyPress:function(D){if(D.keyCode==27){this.map.stopdraw();if(A&&typeof A==="function"){A()}}}});this.addControl(B);this.mapTip=new HGIS.Control.MouseTipControl({tipContent:C});this.addControl(this.mapTip);this.mapTip.activate()}else{this.mapTip.setTipContent(C);this.mapTip.show()}},hideTip:function(){if(this.mapTip){this.mapTip.hide()}},snapShot:function(C){var A=this._map.getDefaultLayer();var B=new HGIS.Control.DrawFeature(A,HGIS.Handler.RegularPolygon,{"featureAdded":function(D){var F=D.geometry.bounds;var E=new CaptureManager();E.CaptureRect(0,0,300,300)},handlerOptions:{sides:4,irregular:true,angle:0}});this._map.addControl(B);B.activate()},addDefaultLayer:function(){var A=new HGIS.Layer.Vector("",{displayInLayerSwitcher:false,isBaseLayer:false,renderers:["SVG","Canvas","VML"]});this._map.addLayers([A])},getDefaultLayer:function(){return this.graphicLayer},degreeSpanToMeter:function(C,A){var D=(A=="arc")?C:C*Math.PI/180;var B=Math.cos(D)*6371393;var E=Math.abs(Math.PI*B/180);return E},meterToDegree:function(B,A){return 1/this.degreeSpanToMeter(B,A)},getDistance:function(B,D){var A=new HGIS.LonLat(B.x,B.y);var C=new HGIS.LonLat(D.x,D.y);var E=0;if(HGIS.InitParam.geodesic){E=HGIS.Util.distVincenty(A,C)}else{E=B.distanceTo(D)}return E},clearIndexedDB:function(){HGIS.Strategy.Parameters.clearDB()},CLASS_NAME:"HGIS.MapEx"});HGIS.Marker=HGIS.Marker||{};HGIS.Marker.MarkerEx=HGIS.Class({icon:null,started:false,stopDown:true,dragging:false,last:null,mouseIconPx:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:true,documentEvents:null,active:false,initialize:function(A,D){this.lonlat=A;var C=D?D:HGIS.Marker.defaultIcon();if(this.icon==null){this.icon=C}else{this.icon.url=C.url;this.icon.size=C.size;this.icon.offset=C.offset;this.icon.calculateOffset=C.calculateOffset}this.icon.div=this.icon.div||this.icon.imageDiv;this.events=new HGIS.Events(this,this.icon.div,null,true,{includeXY:true});if(this.documentDrag===true){var B=this;this._docMove=function(E){B.mousemove({xy:{x:E.clientX,y:E.clientY},element:document,target:E.target})};this._docUp=function(E){B.mouseup({xy:{x:E.clientX,y:E.clientY},target:E.srcElement})}}},callbacks:null,scope:null,activateEdit:function(B,A){this.scope=A?A:this;this.callbacks=B;if(this.active){return false}this.events.register("mousedown",this,this.dragstart);this.active=true},deactivateEdit:function(A){if(A){if(this.callbacks&&this.callbacks.hasOwnProperty(A)){delete this.callbacks[A]}var C=false;for(var B in this.callbacks){C=true;break}if(C){return}}this.active=false;this.events.unregister("mousedown",this,this.dragstart);delete this.callbacks},dragstart:function(B){var A=true;this.dragging=false;if(this.checkModifiers(B)&&(HGIS.Event.isLeftClick(B))){this.started=true;this.start=this.map.getLayerPxFromLonLat(this.lonlat);this.mouseIconPx=new HGIS.Pixel(B.offsetX,B.offsetY);var C=B.srcElement;while(C!==this.icon.div){this.mouseIconPx=this.mouseIconPx.add(C.offsetLeft,C.offsetTop);C=C.parentNode}HGIS.Event.stop(B);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:HGIS.Function.True}document.onselectstart=HGIS.Function.False;A=!this.stopDown;this.addDocumentEvents();this.down(B,this);this.callback("down",[this])}else{this.started=false;this.start=null}return A},checkModifiers:function(A){if(this.keyMask==null){return true}var B=(A.shiftKey?HGIS.Handler.MOD_SHIFT:0)|(A.ctrlKey?HGIS.Handler.MOD_CTRL:0)|(A.altKey?HGIS.Handler.MOD_ALT:0);return(B==this.keyMask)},addDocumentEvents:function(){this.documentEvents=true;HGIS.Event.observe(document,"mousemove",this._docMove);HGIS.Event.observe(document,"mouseup",this._docUp)},down:function(A,B){},move:function(A,B){},up:function(A,B){},callback:function(A,B){if(A&&this.callbacks[A]){this.callbacks[A].apply(this.scope,B)}},mousemove:function(A){return this.dragmove(A)},dragmove:function(A){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(A)}this.moveThis(A);this.down(A,this);this.callback("move",[this]);return true},moveThis:function(D){var A=D.xy;var B=this.map.getLonLatFromPixel(A);var E=this.map.getLayerPxFromLonLat(B);var C=E.add(-this.mouseIconPx.x,-this.mouseIconPx.y);this.moveTo(C)},adjustXY:function(A){var B=HGIS.Util.pagePosition(this.map.viewPortDiv);A.xy.x-=B[0];A.xy.y-=B[1]},mouseup:function(A){return this.dragend(A)},dragend:function(A){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(A);this.removeDocumentEvents()}var B=(this.start!=this.map.getLayerPxFromLonLat(this.lonlat));this.started=false;this.dragging=false;document.onselectstart=this.oldOnselectstart;this.up(A,this);this.callback("up",[this])}return true},removeDocumentEvents:function(){HGIS.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;HGIS.Event.stopObserving(document,"mousemove",this._docMove);HGIS.Event.stopObserving(document,"mouseup",this._docUp)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(A){return this.icon.draw(A)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveToPosition:function(A){this.lonlat=new HGIS.LonLat(A.x,A.y);this.layer.drawMarker(this)},moveTo:function(A){if((A!=null)&&(this.icon!=null)){A.x=A.x-this.icon.offset.x;A.y=A.y-this.icon.offset.y;this.icon.moveTo(A)}this.lonlat=this.map.getLonLatFromLayerPx(A)},isDrawn:function(){var A=(this.icon&&this.icon.isDrawn());return A},onScreen:function(){var B=false;if(this.map){var A=this.map.getExtent();B=A.containsLonLat(this.lonlat)}return B},inflate:function(A){if(this.icon){this.icon.setSize({w:this.icon.size.w*A,h:this.icon.size.h*A})}},setOpacity:function(A){this.icon.setOpacity(A)},setUrl:function(A){this.icon.setUrl(A)},display:function(A){this.icon.display(A)},CLASS_NAME:"HGIS.Marker.MarkerEx"});HGIS.Plot=HGIS.Plot||{};HGIS.Plot.Dashboard=function(E){var I=this;var C=null,F=null,D=0,B=0,G=0,H=0,O=0,L=0,A=0,P=0,Q=0,R=0,N=0,K=0,S=0,J=null,M=null;I.el=null;I.opt=E;I.settings={el:null,begin:0,end:360,min:0,max:12,hasLast:true,radius:150,longDivide:12,shortDivide:5,longLine:20,shortLine:10,pointerLine:135,start:0,circleBg:"#000",concentricBg:"#222",borderColor:"#fff",longLineColor:"#fff",shortLineColor:"#00F5FF",pointerColor:"#CD3700",textColor:"#fff"};this.show=function(){I.el=I.opt.el;I.extend(I.settings,I.opt);I.init.call(this)};this.extend=function(V,U){for(var T in U){V[T]=U[T]}};this.init=function(){I.initVar.call(this);if(navigator.userAgent.indexOf("MSIE")>=0){I.version="VML";I.bodyInitByIE.call(this);I.pointerInitByIE.call(this)}else{I.version="canvas";I.bodyInitByCanvas.call(this);I.pointerInitByCanvas.call(this)}};this.initVar=function(){D=this.settings.radius,B=this.settings.longDivide,G=this.settings.shortDivide,H=this.settings.min,O=this.settings.max,L=D*2,A=this.settings.begin/180*Math.PI,P=(this.settings.end-this.settings.begin)/180*Math.PI,Q=P/B,R=P/(G*B),N=(D-this.settings.longLine)/D,K=(D-this.settings.shortLine)/D,S=(O-H)/B};this.setValue=function(Y){var U=this.settings.min,V=this.settings.max,Z=this.settings.radius,a=this.settings.begin/180*Math.PI,W=(this.settings.end-this.settings.begin)/180*Math.PI;Y=Math.min(Math.max(U,Y),V);var T=(Y-U)/(V-U),X=T*W+a;if(this.version=="canvas"){M.save();M.clearRect(0,0,L,L);M.beginPath();M.translate(Z,Z);M.rotate(X);M.moveTo(0,0);M.lineTo(0,Z-2);M.lineWidth=2;M.strokeStyle=this.settings.pointerColor;M.stroke();M.restore()}else{var b={x:Z*Math.sin(-X),y:Z*Math.cos(-X)};F.setAttribute("to",b.x+","+b.y)}};this.bodyInitByIE=function(){var b=[];C=document.createElement("<div class='hik_gis_dashboard' style='position: relative;width:"+L+"px;height:"+L+"px;'>");var V=document.createElement("<v:Oval style='position: absolute;z-index: 5;width:"+L+"px; height:"+L+"px; left:0; top:0' fillcolor='"+this.settings.circleBg+"' strokecolor='"+this.settings.borderColor+"' strokeweight='2pt'/>");I.el.appendChild(C).appendChild(V);var X=I.settings.hasLast?B:B-1,a=I.settings.hasLast?B*G:B*G-1;for(var Z=0;Z<=X;Z++){var Y=Q*Z+A;var W={x:D*Math.sin(-Y),y:D*Math.cos(-Y)};var T=document.createElement("v:textbox");T.style.position="absolute";T.style.zIndex="5";T.style.color=this.settings.textColor;T.style.fontWeight="bold";T.innerText=parseInt(H+Z*S).toString();C.appendChild(T);T.style.left=D+W.x*(N*0.96)-(Math.sin(-Y)+1)/2*T.offsetWidth+"px";T.style.top=D+W.y*(N*0.96)-(Math.cos(-Y)+1)/2*T.offsetHeight+"px";b.push("<v:line style='position: absolute;z-index: 5;left:"+D+"px;top:"+D+"px;' from='"+(W.x*N)+","+(W.y*N)+"' to='"+(W.x)+","+(W.y)+"' strokecolor='"+I.settings.longLineColor+"' strokeweight='2pt'/>")}for(var Z=0;Z<=a;Z++){if(Z%G!=0){var Y=R*Z+A;var W={x:D*Math.sin(-Y),y:D*Math.cos(-Y)};b.push("<v:line style='position: absolute;z-index: 5;left:"+D+"px;top:"+D+"px;' from='"+(W.x*K)+","+(W.y*K)+"' to='"+(W.x)+","+(W.y)+"' strokecolor='"+this.settings.shortLineColor+"' strokeweight='1pt'/>")}}C.innerHTML+=b.join("");var d=0.4,U=4;C.appendChild(document.createElement("<v:Oval style='position: absolute;z-index: 5;left:"+(D-D*d/2)+"px;top:"+(D-D*d/2)+"px;width:"+D*d+"px;height:"+D*d+"px' strokecolor='"+this.settings.concentricBg+"' fillcolor='"+this.settings.concentricBg+"'/>"));C.appendChild(document.createElement("<v:Oval style='position: absolute;z-index: 5;left:"+(D-U)+"px;top:"+(D-U)+"px;width:"+U*2+"px;height:"+U*2+"px' strokecolor='"+this.settings.pointerColor+"' fillcolor='"+this.settings.pointerColor+"'/>"))};this.pointerInitByIE=function(){F=document.createElement("<v:line style='position: absolute;z-index: 5;left:"+D+"px;top:"+D+"px;' from='0,0' to='0,"+D+"' strokecolor='"+this.settings.pointerColor+"' strokeweight='2pt'/>");C.appendChild(F);I.setValue(this.settings.start)};this.bodyInitByCanvas=function(){C=document.createElement("div");C.setAttribute("style","position: relative;width:"+L+"px;height:"+L+"px;");I.el.appendChild(C);var a=document.createElement("canvas");a.setAttribute("style","position: absolute; top: 0; left: 0;");a.innerText="canvas";a.width=L;a.height=L;var d=a.cloneNode(true);C.appendChild(a);C.appendChild(d);J=a.getContext("2d"),M=d.getContext("2d");J.save();J.beginPath();J.arc(D,D,D-2,0,Math.PI*2,true);J.closePath();J.fillStyle=this.settings.circleBg;J.fill();J.lineWidth=2;J.strokeStyle=this.settings.borderColor;J.stroke();J.restore();var V=this.settings.hasLast?B:B-1,Y=this.settings.hasLast?B*G:B*G-1;for(var X=0;X<=V;X++){J.beginPath();var W=Q*X+A;J.save();J.translate(D,D);J.rotate(W);J.lineWidth=2;J.strokeStyle=this.settings.longLineColor;J.moveTo(0,D-2);J.lineTo(0,D-this.settings.longLine-2);J.stroke();var b=parseInt(H+X*S).toString();J.fillStyle=this.settings.textColor;J.font="bold 16px serif";var U=J.measureText(b);J.translate(0,D-this.settings.longLine-8);J.rotate(2*Math.PI-W);J.fillText(b,-(Math.sin(-W)+1)/2*(U.width),Math.sin(W/2)*10);J.restore()}for(var X=0;X<=Y;X++){if(X%G!=0){J.beginPath();var W=R*X+A;J.save();J.translate(D,D);J.rotate(W);J.lineWidth=1;J.strokeStyle=this.settings.shortLineColor;J.moveTo(0,D-2);J.lineTo(0,D-this.settings.shortLine-2);J.stroke();J.restore()}}var Z=0.4,T=4;J.save();J.beginPath();J.arc(D,D,D*Z/2,0,Math.PI*2,true);J.fillStyle=this.settings.concentricBg;J.fill();J.beginPath();J.arc(D,D,T,0,Math.PI*2,true);J.fillStyle=this.settings.pointerColor;J.fill();J.restore()};this.pointerInitByCanvas=function(){M.save();M.beginPath();M.moveTo(D,D);M.lineTo(D,D*2-2);M.strokeStyle=this.settings.pointerColor;M.lineWidth=2;M.stroke();M.restore();I.setValue(this.settings.start)}};HGIS.Plot=HGIS.Plot||{};HGIS.Plot.EditSector=HGIS.Class({initialize:function(A,E,D){this.center=E.center;this.radius=E.radius;this.direction=E.direction;this.angle=E.angle;this.sectorFt=null;this.dragPointFeature=null;this.anglePointFeature=null;this.callback=D.callback;var B={strokeColor:"#000000",fillOpacity:0.5,fillColor:"red"};this.sectorStyle=D.sectorStyle?D.sectorStyle:B;var C={graphicName:"square",pointRadius:3,fillColor:"#0000ff",strokeColor:"#0000ff"};this.dragPointStyle=D.dragPointStyle?D.dragPointStyle:C;this.map=A;this.layer=D.layer instanceof HGIS.Layer.Vector?D.layer:null;this.modifyControl=null;this.initLayer();this.initControl();this.map.zoomToExtent(this.sectorFt.geometry.getBounds());this.modifyControl.selectFeature(this.sectorFt)},updateSector:function(D,E,F,C){if(D!="NaN"&&E!="NaN"&&F!="NaN"){this.removeFeatues();this.dragPointFeature=null;this.anglePointFeature=null;var B=C?C:this.center;var A=HGIS.Utils.createSector(B,D,E,F);this.center=B;this.radius=D;this.direction=E;this.angle=F;this.sectorFt=new HGIS.Feature.Vector(A,this,this.sectorStyle);this.layer.addFeatures([this.sectorFt]);this.modifyControl.selectFeature(this.sectorFt);this.map.zoomToExtent(this.sectorFt.geometry.getBounds())}},initLayer:function(){if(this.layer==null){this.layer=new HGIS.Layer.Vector("editSertorLayerName")}var A=HGIS.Utils.createSector(this.center,this.radius,this.direction,this.angle);this.sectorFt=new HGIS.Feature.Vector(A,this,this.sectorStyle);this.map.addLayer(this.layer);this.layer.addFeatures([this.sectorFt])},initControl:function(){this.modifyControl=new HGIS.Control.ModifyFeature(this.layer);this.modifyControl.mode=HGIS.Control.ModifyFeature.ROTATE|HGIS.Control.ModifyFeature.RESIZE;var B=this;var A=this.sectorFt.geometry.getVertices().length;this.modifyControl.selectFeature=function(C){if(!this.standalone||this.beforeSelectFeature(C)!==false){this.feature=C;this.modified=false;this.resetVertices();this.onModificationStart(this.feature)}var D=C.modified;if(C.geometry&&!(D&&D.geometry)){this._originalGeometry=C.geometry.clone()}};this.modifyControl.unselectFeature=function(C){};this.modifyControl.collectRadiusHandle=function(){B.getPointPosition();if(!this.rotateHandle){var G=this.feature.geometry;var C=this.feature.geometry.getVertices()[0];var I=this.feature.geometry.getVertices()[parseInt(A/2)].clone();this.dragPointFeature=new HGIS.Feature.Vector(I,null,B.dragPointStyle);var F=(this.mode&HGIS.Control.ModifyFeature.RESIZE);var H=(this.mode&HGIS.Control.ModifyFeature.RESHAPE);var E=(this.mode&HGIS.Control.ModifyFeature.ROTATE);var D=this;I.move=function(U,V){HGIS.Geometry.Point.prototype.move.call(this,U,V);var R=this.x-C.x;var N=this.y-C.y;var P=R-U;var M=N-V;if(E){var Q=Math.atan2(M,P);var O=Math.atan2(N,R);var T=O-Q;T*=180/Math.PI;G.rotate(T,C)}if(F){var J,K;if(H){J=N/M;K=(R/P)/J}else{var L=Math.sqrt((P*P)+(M*M));var S=Math.sqrt((R*R)+(N*N));J=S/L}G.resize(J,C,K)}D.angleGeometry.x=G.getVertices()[1].x;D.angleGeometry.y=G.getVertices()[1].y;B.calculateRaidus();B.calculateDirection();B.getPointPosition();B.layer.drawFeature(D.angleHandle);if(B.callback){B.callback(B.getJsonObj())}};this.dragPointFeature._sketch=true;this.rotateHandle=this.dragPointFeature;this.layer.addFeatures([this.rotateHandle])}if(!this.angleGeometry){this.angleGeometry=this.feature.geometry.getVertices()[1].clone();this.angleGeometry.angle=1;this.anglePointFeature=new HGIS.Feature.Vector(this.angleGeometry,null,B.dragPointStyle);this.angleGeometry.move=function(M,N){HGIS.Geometry.Point.prototype.move.call(this,M,N);var O=HGIS.Plot.getVectorAngle(C,this,G.getVertices()[A-1]);var L=HGIS.Plot.getPointPositionToLine(this,{x1:B.center.x,y1:B.center.y,x2:G.getVertices()[parseInt(A/2)].x,y2:G.getVertices()[parseInt(A/2)].y});if(B.pointPosition!=L){this.x=G.getVertices()[1].x;this.y=G.getVertices()[1].y;return}var K=HGIS.Utils.createSector(C,B.radius,B.direction,B.angle);B.angle=O;for(var J=0;J<K.getVertices().length;J++){G.getVertices()[J].x=K.getVertices()[J].x;G.getVertices()[J].y=K.getVertices()[J].y}this.x=G.getVertices()[1].x;this.y=G.getVertices()[1].y;D.rotateHandle.geometry.x=D.feature.geometry.getVertices()[parseInt(A/2)].x;D.rotateHandle.geometry.y=D.feature.geometry.getVertices()[parseInt(A/2)].y;D.layer.drawFeature(D.rotateHandle);if(B.callback){B.callback(B.getJsonObj())}};this.anglePointFeature._sketch=true;this.angleHandle=this.anglePointFeature;this.layer.addFeatures([this.angleHandle],{silent:true})}};this.map.addControl(this.modifyControl);this.modifyControl.activate()},getPointPosition:function(){var C=this.sectorFt.geometry;var A=C.getVertices().length;var B=HGIS.Plot.getPointPositionToLine({x:C.getVertices()[1].x,y:C.getVertices()[1].y},{x1:this.center.x,y1:this.center.y,x2:C.getVertices()[parseInt(A/2)].x,y2:C.getVertices()[parseInt(A/2)].y});this.pointPosition=B},getJsonObj:function(){var A={center:this.center,radius:this.radius,direction:this.direction,angle:this.angle};return A},calculateRaidus:function(){var A=new HGIS.LonLat(this.center.x,this.center.y);var B=new HGIS.LonLat(this.sectorFt.geometry.getVertices()[1].x,this.sectorFt.geometry.getVertices()[1].y);this.radius=HGIS.Utils.caculateDistance(A,B)},calculateDirection:function(){var A=this.sectorFt.geometry.getVertices().length;var B=HGIS.Plot.getDirection(this.center,this.sectorFt.geometry.getVertices()[parseInt(A/2)]);if(B<0){B=360+B}this.direction=B},getVectorAngle:function(B,E,G){var F={x:E.x-B.x,y:E.y-B.y};var I={x:G.x-B.x,y:G.y-B.y};var A=F.x*I.x+F.y*I.y;var C=Math.sqrt(F.x*F.x+F.y*F.y);var D=Math.sqrt(I.x*I.x+I.y*I.y);var H=HGIS.Util.deg(Math.acos(A/(C*D)));if(F.x*I.y-F.y*I.x<=0){H=360-H}return H},getPointPositionToLine:function(A,C){var B=(C.y1-C.y2)*A.x+(C.x2-C.x1)*A.y+C.x1*C.y2-C.x2*C.y1;if(B>0){B=1}else{if(B<0){B=2}else{B=0}}return B},getDirection:function(A,B){var C=Math.atan2(B.y-A.y,B.x-A.x);C=HGIS.Util.deg(C);if(C<0){C+=360}return C},removeFeatues:function(){if(this.sectorFt){this.layer.removeFeatures([this.sectorFt,this.modifyControl.dragPointFeature,this.modifyControl.anglePointFeature]);this.modifyControl.rotateHandle=null;this.modifyControl.angleGeometry=null}},destroy:function(){this.removeFeatues();if(this.layer!=null&&this.layer.name=="editSertorLayerName"){this.map.removeLayer(this.layer);this.layer.destroy();this.layer=null}},CLASS_NAME:"HGIS.Plot.EditSector"});HGIS.Plot.getVectorAngle=function(B,E,G){var F={x:E.x-B.x,y:E.y-B.y};var I={x:G.x-B.x,y:G.y-B.y};var A=F.x*I.x+F.y*I.y;var C=Math.sqrt(F.x*F.x+F.y*F.y);var D=Math.sqrt(I.x*I.x+I.y*I.y);var H=HGIS.Util.deg(Math.acos(A/(C*D)));if(F.x*I.y-F.y*I.x<=0){H=360-H}return H};HGIS.Plot.getPointPositionToLine=function(A,C){var B=(C.y1-C.y2)*A.x+(C.x2-C.x1)*A.y+C.x1*C.y2-C.x2*C.y1;if(B>0){B=1}else{if(B<0){B=2}else{B=0}}return B};HGIS.Plot.getDirection=function(A,B){var C=Math.atan2(B.y-A.y,B.x-A.x);C=HGIS.Util.deg(C);if(C<0){C+=360}return C};HGIS.Plot=HGIS.Plot||{};HGIS.Plot.MapOperate=HGIS.Class({map:null,measureControls:null,zoomBox:null,mouseDownLonlat:null,poiMarkers:null,tipMarker:null,drawLayer:null,sketchSymbolizers:null,host:null,initialize:function(E){this.map=E;this.maxZoomLevel=this.map.getNumZoomLevels();this.drawLayer=new HGIS.Layer.Vector("measure_layers",{renderers:["SVG","Canvas","VML"]});E.addLayer(this.drawLayer);this.sketchSymbolizers={"Point":{pointRadius:2,graphicName:"circle",fillColor:"#ffffff",fillOpacity:0.3,strokeWidth:2,strokeOpacity:1,strokeColor:"#DD0000"},"PointDraw":{pointRadius:3,graphicName:"circle",fillColor:"#ffffff",fillOpacity:0.8,strokeWidth:2,strokeOpacity:1,strokeColor:"#DD0000",graphicZIndex:10},"Line":{strokeWidth:2,strokeOpacity:1,strokeColor:"#DD0000",graphicZIndex:5},"Polygon":{strokeWidth:2,strokeOpacity:1,strokeColor:"#DD0000",fillColor:"#DD0000",fillOpacity:0.2},"text":{labelXOffset:5,labelYOffset:0,labelAlign:"cm",labelOutlineWidth:1,labelOutlineColor:"red",fontColor:"#ff0000"},"icon":{graphicTitle:HGIS.language[HGIS.InitParam.language]["close"],backgroundGraphic:HGIS._getScriptLocation()+"skin/images/w_close_red.png",backgroundWidth:12,backgroundHeight:12,backgroundXOffset:5,backgroundYOffset:-20}};var C=new HGIS.Style();C.addRules([new HGIS.Rule({symbolizer:this.sketchSymbolizers})]);var A=new HGIS.StyleMap({"default":C});var D={handlerOptions:{style:"default",layerOptions:{styleMap:A},persist:true},geodesic:true,partialDelay:1};this.measureControls={line:new HGIS.Control.Measure(HGIS.Handler.Path,D),polygon:new HGIS.Control.Measure(HGIS.Handler.Polygon,D)};var H;var G=HGIS.Function.bindAsEventListener(this.handleMeasurements,this);var B=HGIS.Function.bindAsEventListener(this.handleMeasurepartial,this);for(var F in this.measureControls){H=this.measureControls[F];H.events.on({"measure":G,"measurepartial":B});this.map.addControl(H)}this.poiMarkers=new HGIS.Layer.Markers("Markers");this.map.addLayer(this.poiMarkers);this.map.setLayerZIndex(this.poiMarkers,10)},toggleDrawControl:function(A){for(key in drawControls){var B=drawControls[key];if(A==key){B.activate()}else{B.deactivate()}}},disdraw:function(){var A=this.map.controls;if(A==null){return}for(key in A){var B=A[key];B.deactivate()}this.map.curDrawControl=null;this.map.hideTip();this.map.pan()},setMove:function(){this.deactivateContrl()},deactivateContrl:function(){this.map.clickFun=null;if(this.zoomBox!=null){this.zoomBox.deactivate()}if(this.tipMarker){this.poiMarkers.removeMarker(this.tipMarker);this.tipMarker=null}if(this.measureControls!=null){for(var A in this.measureControls){control=this.measureControls[A];control.deactivate()}}},measureDeactivate:function(){var A=this;var B=this.measureControls["line"];B.deactivate();this._onMeasureDistance=false;B=this.measureControls["polygon"];B.deactivate();this.map.hideTip();this.map.div.style.cursor="";if(this.tipMarker){this.poiMarkers.removeMarker(this.tipMarker);this.tipMarker=null}},stopMeasure:function(){var E=this.measureControls["line"];E.deactivate();E=this.measureControls["polygon"];E.deactivate();if(this._measurefeatures&&this._measurefeatures.length>0&&this._onMeasureDistance){var C=this._measureMarkers[this._measureCount][this._measureMarkers[this._measureCount].length-1];if(typeof C!="undefined"&&C.icon.html.indexOf("measure_end")<0){for(var A=0;A<this._measurefeatures[this._measureCount].length;A++){var B=this._measurefeatures[this._measureCount][A];B.destroy()}this._measurefeatures[this._measureCount]=[];for(var A=0;A<this._measureMarkers[this._measureCount].length;A++){var D=this._measureMarkers[this._measureCount][A];this.poiMarkers.removeMarker(D);D.destroy()}this._measureMarkers[this._measureCount]=[]}}if(this.tipMarker){this.poiMarkers.removeMarker(this.tipMarker);this.tipMarker=null}this.map.events.unregister("keydown",this,this.handleEscKeyDown)},measureDistance:function(A){if(typeof A=="function"){this.callback=A}this.map.div.style.cursor="pointer";this.map.showTip(HGIS.language[HGIS.InitParam.language]["escmeasure"]);if(this.measureControls["polygon"].active){this.stopMeasure()}var C=this.measureControls["line"];C.activate();if(this.zoomBox!=null){this.zoomBox.deactivate()}if(this.tipMarker){this.poiMarkers.removeMarker(this.tipMarker);this.tipMarker=null}this.map.setLayerZIndex(this.poiMarkers,10);this._onMeasureDistance=true;this.map.events.register("keydown",this,this.handleEscKeyDown);var B=this;document.onkeydown=function(E){var D=E||window.event;if(D&&D.keyCode==27){B.stopMeasure();B.map.div.style.cursor="default";B.map.hideTip()}}},measureArea:function(A){if(typeof A=="function"){this.callback=A}this.map.div.style.cursor="pointer";this.map.showTip(HGIS.language[HGIS.InitParam.language]["escmeasure"]);if(this.measureControls["line"].active){this.stopMeasure()}var C=this.measureControls["polygon"];C.activate();if(this.zoomBox!=null){this.zoomBox.deactivate()}if(this.tipMarker){this.poiMarkers.removeMarker(this.tipMarker);this.tipMarker=null}this.map.setLayerZIndex(this.poiMarkers,10);this.map.events.register("keydown",this,this.handleEscKeyDown);var B=this;document.onkeydown=function(E){var D=E||window.event||arguments.callee.caller.arguments[0];if(D&&D.keyCode==27){B.stopMeasure();B.map.div.style.cursor="default";B.map.hideTip()}}},handleEscKeyDown:function(A){if(A&&A.keyCode==27){this.stopMeasure();this.map.div.style.cursor="default";this.map.hideTip()}},makerStyle:null,_measurefeatures:[],_measureMarkers:[],_measureAreaFeatures:[],_measureAreaMarkers:[],_measureCount:0,handleMeasurements:function(L){this.measureDeactivate();var N=L.geometry;var G=L.units;var E=L.order;var B=L.measure;var J="";if(E==1){J=B.toFixed(2)+(G=="m"?HGIS.language[HGIS.InitParam.language]["m"]:HGIS.language[HGIS.InitParam.language]["km"])}else{J=B.toFixed(2)+(G=="m"?HGIS.language[HGIS.InitParam.language]["m2"]:HGIS.language[HGIS.InitParam.language]["km2"])}var F=N.getVertices();if(F.length>1){var M=F[F.length-1].x;var D=F[F.length-1].y;var C=new HGIS.Geometry.Point(M,D);var R;if(E==1){if(L.measure==0){return}var K=new HGIS.Feature.Vector(F[F.length-1],{},this.sketchSymbolizers.PointDraw);this.drawLayer.addFeatures([K]);if(this._measurefeatures[this._measureCount]==undefined){this._measurefeatures[this._measureCount]=[]}this._measurefeatures[this._measureCount].push(K);var I="";I+="<DIV class='measure_end'><SPAN style=''>"+HGIS.language[HGIS.InitParam.language]["length"]+"</SPAN><SPAN>"+J+"</SPAN></DIV>";var P=document.createElement("div");P.title=HGIS.language[HGIS.InitParam.language]["clear"];P.className="measure_close";var H=this;P.mCount=this._measureCount;P.onclick=function(U){var T=this.mCount;H.drawLayer.removeFeatures(H._measurefeatures[T]);for(var S=H._measurefeatures[T].length-1;S>=0;S--){var W=H._measurefeatures[T][S];W.destroy()}H._measurefeatures[T]=[];for(var S=H._measureMarkers[T].length-1;S>=0;S--){var V=H._measureMarkers[T][S];H.poiMarkers.removeMarker(V);V.destroy()}H._measureMarkers[T]=[];H._measureCount--};var O=new HGIS.Symbolizer.HtmlIcon(I,{},{x:10,y:-5});var A=new HGIS.Marker(new HGIS.LonLat(M,D),O);this.poiMarkers.addMarker(A);O.div.appendChild(P);R=new HGIS.Feature.Vector(N,{},this.sketchSymbolizers["Line"]);this._measurefeatures[this._measureCount].push(R);if(this._measureMarkers[this._measureCount]==undefined){this._measureMarkers[this._measureCount]=[]}this._measureMarkers[this._measureCount].push(A)}else{R=new HGIS.Feature.Vector(N,{},this.sketchSymbolizers["Polygon"]);var I="";I="<DIV class='measure_end'><SPAN style=''>"+HGIS.language[HGIS.InitParam.language]["area"]+"</SPAN><SPAN>"+J+"</SPAN></DIV>";var P=document.createElement("div");P.title=HGIS.language[HGIS.InitParam.language]["clear"];P.className="measure_close";var H=this;P.mCount=this._measureCount;P.onclick=function(U){var T=this.mCount;H.drawLayer.removeFeatures([H._measureAreaFeatures[T]]);var V=H._measurefeatures[T];H._measurefeatures[T]=null;var S=H._measureAreaMarkers[T];H.poiMarkers.removeMarker(S);S.destroy();H._measureAreaMarkers[T]=null;H._measureCount--};var Q=N.getBounds().getCenterLonLat();var O=new HGIS.Symbolizer.HtmlIcon(I,{},{x:10,y:-5});var A=new HGIS.Marker(Q,O);this.poiMarkers.addMarker(A);O.div.appendChild(P);this._measureAreaFeatures[this._measureCount]=R;this._measureAreaMarkers[this._measureCount]=A}this.drawLayer.addFeatures([R])}else{return}this.map.div.style.cursor="default";if(this.callback){this.callback()}},handleMeasurepartial:function(K){var F=K.geometry;var B=K.units;var I=K.order;var E=K.measure;var L=F.getVertices();if(L.length<3){this._measureCount++;this._measurefeatures[this._measureCount]=[];this._measureMarkers[this._measureCount]=[];this._measureAreaFeatures[this._measureCount]=[];this._measureAreaMarkers[this._measureCount]=[]}var A="";if(I==1){var D=new HGIS.Feature.Vector(L[L.length-1],{},this.sketchSymbolizers.PointDraw);this.drawLayer.addFeatures([D]);if(this._measurefeatures[this._measureCount]==undefined){this._measurefeatures[this._measureCount]=[]}this._measurefeatures[this._measureCount].push(D);var G='<LABEL class="measurelength_lable"><DIV class="measurelength_divleft"><DIV class="measurelength_divright">';var M=L[L.length-1].x;var J=L[L.length-1].y;if(L.length<3){G+=HGIS.language[HGIS.InitParam.language]["start"]+"</DIV></DIV></LABEL>"}else{G+="<DIV id='mesurelength' value='"+E.toFixed(2)+"'>"+E.toFixed(2)+(B=="m"?HGIS.language[HGIS.InitParam.language]["m"]:HGIS.language[HGIS.InitParam.language]["km"])+"</DIV></DIV></DIV></LABEL>"}var H=new HGIS.Symbolizer.HtmlIcon(G,{},{x:10,y:-2});var C=new HGIS.Marker(new HGIS.LonLat(M,J),H);if(this._measureMarkers[this._measureCount]==undefined){this._measureMarkers[this._measureCount]=[]}this._measureMarkers[this._measureCount].push(C);this.poiMarkers.addMarker(C)}else{A=""+E.toFixed(3)+(B=="m"?HGIS.language[HGIS.InitParam.language]["m2"]:HGIS.language[HGIS.InitParam.language]["km2"])}},clear:function(){this.measureDeactivate();this.drawLayer.removeAllFeatures();this.poiMarkers.clearMarkers();for(var B in this._measureMarkers){var E=this._measureMarkers[B];for(var C=0;C<E.length;C++){var A=E[C];if(A){this.poiMarkers.removeMarker(A);A.destroy();delete E[C]}}delete this._measureMarkers[B]}for(var B in this._measurefeatures){this.drawLayer.removeFeatures(this._measurefeatures[B]);delete this._measurefeatures[B]}for(var B in this._measureAreaFeatures){this.drawLayer.removeFeatures(this._measureAreaFeatures[B]);delete this._measureAreaFeatures[B]}for(var B in this._measureAreaMarkers){var D=this._measureAreaMarkers[B];if(D!=null&&D.CLASS_NAME){this.poiMarkers.removeMarker(D);D.destroy()}delete this._measureAreaMarkers[B]}this._measureCount=0;this._measurefeatures=[];this._measureAreaMarkers=[];this._measureAreaFeatures=[];this._measureMarkers=[]},CLASS_NAME:"HGIS.Plot.MapOperate"});HGIS.Plot=HGIS.Plot||{};HGIS.Plot.MovedCircle=HGIS.Class({_self:null,initialize:function(B,A){this._self=this;this.name=name||"MovedCircle";this.map=A.map||HGIS.initParam.map;this.center=A.center;this.radius=A.radius;this.circleStyle=A.circleStyle;this.dragPointStyle=A.dragPointStyle;this.centerStyle=A.centerStyle;this.callback=A.callback;this.isDragCenter=A.isDragCenter;this.createCricleMethod=A.createCricleMethod==="equality"?"equality":"similar";this.layer=B;this.dragCtrl=null;this.circle=null;this.dragPoint=null;this.circleFeature=null;this.dragFeature=null;this.centerFeature=null;this.initLayer();this.initDragControl()},initLayer:function(){var B={strokeColor:"#000000",fillOpacity:0.5,fillColor:"red"};var E=this.circleStyle||B;if(this.radius<=0){return}if(this.createCricleMethod==="equality"){this.circle=HGIS.Utils.createCircleByEquidistance(this.center,this.radius)}else{this.circle=HGIS.Utils.createCircle(this.center,this.radius)}this.circleFeature=new HGIS.Feature.Vector(this.circle,null,E);var H={graphicName:"square",pointRadius:3,fillColor:"#0000ff",strokeColor:"#0000ff"};var A=this.dragPointStyle||H;if(!A.label){A.label=Math.floor(this.radius)+HGIS.language[HGIS.InitParam.language]["m"];A.labelYOffset=15;A.labelXOffset=20}var F=this.circle.getVertices()[0].x;var G=this.circle.getVertices()[0].y;this.dragPoint=new HGIS.Geometry.Point(F,G);this.dragFeature=new HGIS.Feature.Vector(this.dragPoint,null,A);this.dragFeature.fid="candrag";var D={graphicName:"circle",pointRadius:5,fillColor:"#00ff00"};var C=this.centerStyle||D;this.center=new HGIS.Geometry.Point(this.center.x,this.center.y);this.centerFeature=new HGIS.Feature.Vector(this.center,null,C);if(this.isDragCenter){this.layer.addFeatures([this.centerFeature])}this.layer.addFeatures([this.circleFeature,this.dragFeature]);this.layer.redraw()},initDragControl:function(){var C=this;var E=null;var D=0;var A=this.map.getControlsBy("id","id_movedCircleControl");if(A.length>0){for(var B=0;B<A.length;B++){A[B].deactivate();this.map.removeControl(A[B])}}this.dragCtrl=new HGIS.Control.DragFeature(this.layer,{id:"id_movedCircleControl",geometryTypes:["HGIS.Geometry.Point"],onStart:function(F){E={x:F.geometry.x,y:F.geometry.y}},onDrag:function(G){if(G.fid=="candrag"){var F={strokeColor:"#000000",fillOpacity:0.5,fillColor:"red"};var H=C.circleStyle||F;D=HGIS.Utils.caculateDistance(E,G.geometry);if(G.geometry.x<E.x){D=-D}C.radius=parseFloat(C.radius);var I=C.radius+D;C.removeFeatues();C.circle.destroy();if(C.createCricleMethod==="equality"){C.circle=HGIS.Utils.createCircleByEquidistance(C.center,I)}else{C.circle=HGIS.Utils.createCircle(C.center,I)}C.dragPoint.x=C.circle.getVertices()[0].x;C.dragPoint.y=C.circle.getVertices()[0].y;G.style.label=Math.floor(Math.abs(I))+HGIS.language[HGIS.InitParam.language]["m"];G.style.labelYOffset=10;G.style.labelXOffset=20;C.circleFeature=new HGIS.Feature.Vector(C.circle,null,H);if(C.isDragCenter){C.layer.addFeatures([C.centerFeature])}C.layer.addFeatures([C.circleFeature,C.dragFeature]);C.layer.redraw()}else{C.move(G.geometry.x-E.x,G.geometry.y-E.y);E.x=G.geometry.x;E.y=G.geometry.y}},onComplete:function(F){C.radius=C.radius+D;C.callback({center:C.center,radius:C.radius,circle:C.circle})}});this.map.addControl(this.dragCtrl);this.dragCtrl.activate()},moveTo:function(){var A={x:center.x-this.center.x,y:center.y-this.center.y};this.center.move(A.x,A.y);this.dragPoint.move(A.x,A.y);this.circle.move(A.x,A.y);this.layer.redraw()},move:function(A,B){this.dragPoint.move(A,B);this.circle.move(A,B);this.layer.redraw()},removeFeatues:function(){if(this.circleFeature){this.layer.removeFeatures([this.circleFeature,this.dragFeature])}if(this.isDragCenter){this.layer.removeFeatures([this.centerFeature])}},destroy:function(){this.removeFeatues();if(this.dragCtrl){this.dragCtrl.destroy();this.dragCtrl=null}},getLayer:function(){return this.layer},getCtrl:function(){return this.dragCtrl},deactivate:function(){if(this.dragCtrl.active){this.dragCtrl.deactivate()}},activate:function(){if(!this.dragCtrl.active){this.dragCtrl.activate()}},CLASS_NAME:"HGIS.Plot.MovedCircle"});HGIS.Plot=HGIS.Plot||{};HGIS.Plot.Pie=function(B,D,C){var A=this;A.pieStartAngle=0;A.pieRadius=D?D:1000;A.pieAlpha=C?C:1;A.map=B.map;A.sides=360;this.createPie=function(U,O,F,M){var S=M?M:"default";var L=0;for(var H=0;H<U.length;H=H+1){L=L+U[H].num*1}var K=0;for(var G=0;G<U.length;G=G+1){U[G].degree=Math.floor((U[G].num/L)*360);U[G].startAngle=K;K=K+U[G].degree}var K=0,R;for(var G=0;G<U.length;G=G+1){var V=(U[G].num/L)*360;var J=D;var N=new Array();N.push(O);for(var I=0;I<=A.sides;I=I+1){var P=I*((V)/360);R=K+(P*2*Math.PI/A.sides);var X=O.x+(J*Math.cos(R));var Y=O.y+(J*Math.sin(R));var E=new HGIS.Geometry.Point(X,Y);N.push(E)}var Q=new HGIS.Geometry.LinearRing(N);var W={item:U[G].item,num:U[G].num};var Z=U[G].item+"/"+Math.round(U[G].num/L*100)+"%";var a={fillColor:U[G].color,fillOpacity:C,label:Z};var T=new HGIS.Feature.Vector(Q,U[G],a);T.attributes.sectorClass=S;B.addFeatures([T]);K=R}};this.getSectorsByClass=function(F){var E=B.getFeaturesByAttribute("sectorClass",F);return E};this.addMouseEvt=function(M,I,L,F){var E=A.map.getControlsBy("id","pieMounseControl");var J=false;for(var H=0;H<E.length;H=H+1){var K=E[H];if(K.id=="pieMounseControl"){K.activate();J=true;break}}if(!J){var G=new HGIS.Control.SelectFeature(B,{id:"pieMounseControl",clickout:true,multiple:false,hover:M,highlightOnly:I,selectStyle:L,toggleKey:"ctrlKey",box:false,clickFeature:function(N){F(N)}});A.map.addControl(G);G.activate()}}};HGIS.Plot=HGIS.Plot||{};HGIS.Plot.Sector={plotSectorSelf:null,vectors:null,_map:null,controlPoints:[],sectorRadius:0,tempSectorPoints:[],tempSector:null,tempControlVectors:[],setLayer:function(A){this.vectors=A;this._map=this.vectors.map;plotSectorSelf=this},addToControlPoints:function(B){this.controlPoints.push(B);var A=new HGIS.Feature.Vector(B);plotSectorSelf.tempControlVectors.push(A);plotSectorSelf.vectors.addFeatures(plotSectorSelf.tempControlVectors)},caculateSectorRadius:function(){var A=this.controlPoints[0];var B=this.controlPoints[1];plotSectorSelf.sectorRadius=A.distanceTo(B)},caculateArcPoint:function(F,E,B){var A=this.calulateXYAnagle(F,E);var C,D;if(A==0){C=F.x+B;D=F.y}if(A>0&&A<Math.PI/2){C=F.x+B*Math.cos(A);D=F.y+B*Math.sin(A)}else{if(A==Math.PI/2){C=F.x;D=F.y+B}else{if(A>Math.PI/2&&A<Math.PI){C=F.x-B*Math.cos(Math.PI-A);D=F.y+B*Math.sin(Math.PI-A)}else{if(A==Math.PI){C=F.x-B;D=F.y}else{if(A>Math.PI&&A<Math.PI*3/2){C=F.x-B*Math.cos(A-Math.PI);D=F.y-B*Math.sin(A-Math.PI)}else{if(A==Math.PI*3/2){C=F.x;D=F.y-B}else{if(A>Math.PI*3/2&&A<Math.PI*2){C=F.x+B*Math.cos(2*Math.PI-A);D=F.y-B*Math.sin(2*Math.PI-A)}}}}}}}return new HGIS.Geometry.Point(C,D)},calulateXYAnagle:function(G,A){var D=G.x;var F=G.y;var E=A.x;var C=A.y;if(D==E){if(C>F){return Math.PI/2}else{return Math.PI*3/2}}else{if(F==C){if(E>D){return 0}else{return Math.PI}}else{var B=Math.atan(Math.abs((C-F)/(E-D)));if(E>D&&C>F){return B}else{if(E<D&&C>F){return Math.PI-B}else{if(E<D&&C<F){return B+Math.PI}else{return 2*Math.PI-B}}}}}},caculateLength:function(B,A){return B.distanceTo(A)},calulateDirectionAnagle:function(B,A,C){return B+(A-B)/2+C*Math.PI},beginDrawArcLine:function(D){if(plotSectorSelf.tempSector){plotSectorSelf.vectors.removeFeatures([plotSectorSelf.tempSector])}var A=new HGIS.Pixel(D.x,D.y);var B=plotSectorSelf.vectors.map.getLonLatFromPixel(A);var F=new HGIS.Geometry.Point(B.lon,B.lat);newPoint=this.caculateArcPoint(this.controlPoints[0],F,this.sectorRadius);plotSectorSelf.tempSectorPoints.push(newPoint);var E=new HGIS.Geometry.LinearRing(plotSectorSelf.tempSectorPoints);var C=new HGIS.Geometry.Polygon([E]);plotSectorSelf.tempSector=new HGIS.Feature.Vector(C);plotSectorSelf.tempSector.attributes.orignPoint=plotSectorSelf.controlPoints[0];plotSectorSelf.vectors.addFeatures([plotSectorSelf.tempSector])},caculateDirection:function(E,A,D){var C=this.calulateXYAnagle(E,A);var B=this.calulateXYAnagle(E,D);if(B>C&&B<Math.PI+C){return 0}else{return 1}},draw:function(){var A=new HGIS.Control.DragFeature(plotSectorSelf.vectors);HGIS.Util.extend(A,{draw:function(){var B=new HGIS.Handler.Path(A,{maxVertices:3});B.activate();B.down=function(E){var C=new HGIS.Pixel(E.x,E.y);var D=this.layer.map.getLonLatFromPixel(C);var F=new HGIS.Geometry.Point(D.lon,D.lat);if(plotSectorSelf.controlPoints.length==0){plotSectorSelf.addToControlPoints(F)}else{if(plotSectorSelf.controlPoints.length<=1){plotSectorSelf.addToControlPoints(F);this.control.addFirstEdge();plotSectorSelf.caculateSectorRadius();plotSectorSelf.tempSectorPoints=plotSectorSelf.controlPoints;this.move=function(G){plotSectorSelf.beginDrawArcLine(G)}}else{plotSectorSelf.addToControlPoints(F);this.deactivate();plotSectorSelf.vectors.removeFeatures(plotSectorSelf.tempControlVectors);plotSectorSelf.tempSector.attributes.orignPoint=plotSectorSelf.controlPoints[0];plotSectorSelf.vectors.addFeatures([plotSectorSelf.tempSector])}}}},addFirstEdge:function(){var B=new HGIS.Geometry.LineString(this.controlPoints);var C=new HGIS.Feature.Vector(B);plotSectorSelf.vectors.addFeatures([C])}});this._map.addControl(A)},RotateControl:HGIS.Class(HGIS.Control.ModifyFeature,{collectRadiusHandle:function(G){var E=this.feature.geometry;var B=E.getBounds();var C=this.feature.attributes.orignPoint;var D=new HGIS.Geometry.Point(B.right,B.bottom);var F=new HGIS.Feature.Vector(D);var H=(this.mode&HGIS.Control.ModifyFeature.RESIZE);var I=(this.mode&HGIS.Control.ModifyFeature.RESHAPE);var A=(this.mode&HGIS.Control.ModifyFeature.ROTATE);D.move=function(U,V){HGIS.Geometry.Point.prototype.move.call(this,U,V);var R=this.x-C.x;var N=this.y-C.y;var P=R-U;var M=N-V;if(A){var Q=Math.atan2(M,P);var O=Math.atan2(N,R);var T=O-Q;T*=180/Math.PI;E.rotate(T,C)}if(H){var J,K;if(I){J=N/M;K=(R/P)/J}else{var L=Math.sqrt((P*P)+(M*M));var S=Math.sqrt((R*R)+(N*N));J=S/L}E.resize(J,C,K)}};F._sketch=true;this.radiusHandle=F;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:true})}}),modify:function(C,A){this.Sector.setLayer(vectors);var B=new plotSectorSelf.RotateControl(plotSectorSelf.vectors);B.mode=HGIS.Control.ModifyFeature.RESIZE;B.mode|=HGIS.Control.ModifyFeature.ROTATE;plotSectorSelf._map.addControl(B);B.activate()}};HGIS.Plot=HGIS.Plot||{};HGIS.Plot.ViewShed=function(C,B){var A=this;A.dura=(B.dura&&B.dura>0)?B.dura:1;A.defaultStyle=(B.viewShedStyle!=null)?B.viewShedStyle:{fillOpacity:0.5,strokeWidth:0,fillColor:"blue"};A.duraSides=(B.duraSides>0)?B.duraSides:100;A.usingEventCenter=B.usingEventCenter?true:false;this.createBySpecified=function(J,K,I,H){if(H<=0||H>180){return}var E=[];var N=(I-H/2+90)*(Math.PI/180);var F=K;for(var G=A.dura;G>0;G=G-1){F=(K/A.dura)*G;var D=HGIS.Utils.createSector(J,F,I+90,H,A.duraSides);E.push(D)}var L=null;for(var M=0;M<E.length;M++){L=new HGIS.Feature.Vector(E[M]);L.attributes.startAngle=N;L.style=A.defaultStyle;C.addFeatures([L])}return L};this.createByCenter=function(H,G,N){if(N<=0||N>180){return}if(HGIS.InitParam.mapUnit=="degrees"){var M=C.map.degreeSpanToMeter(H.y,"degrees");G=G/M}var P=new Array();var I=Math.PI*(1/A.duraSides);A.eventCenter=A.usingEventCenter?B.eventCenter:H;var R;if(H.x==A.eventCenter.x&&H.y==A.eventCenter.y){R=90}else{R=A.direct(H,A.eventCenter,N)}var J=R;I+=(J/180)*Math.PI;var E,T,U;var O=G/A.dura;for(var D=A.dura;D>=1;D=D-1){var L=[];L.push(H);G=O*D;for(var F=0;F<A.duraSides;F=F+1){var K=F*((N)/360);E=I+(K*2*Math.PI/A.duraSides);T=H.x+(G*Math.cos(E));U=H.y+(G*Math.sin(E));L.push(new HGIS.Geometry.Point(T,U))}var Q=new HGIS.Geometry.LinearRing(L);P.push(Q)}var S=null;for(var F=0;F<P.length;F++){S=new HGIS.Feature.Vector(P[F]);S.style=A.defaultStyle;C.addFeatures([S])}return S};this.direct=function(J,H,E){var D=H.y-J.y;var G=H.x-J.x;var F=Math.atan2(D,G);var I=180*F/Math.PI;var K=I-E/2;return K};this.highLightEffect=function(G,E,D){if(G){var F=C.map.getControl("highlightCtrlId");if(F==null){var F=new HGIS.Control.SelectFeature(C,{id:"highlightCtrlId",clickout:true,multiple:true,hover:true,highlightOnly:false,selectStyle:{fillColor:"#FF0000",fillOpacity:0.5},clickFeature:function(H){D(H)}});F.events.register("featurehighlighted",C,function(H){H.feature.layer.drawFeature(H.feature,E)});C.map.addControl(F);F.activate()}}else{return}}};HGIS.Popup=HGIS.Popup||{};HGIS.Popup.InfoWindow=HGIS.Class(HGIS.Popup.FramedCloud,{titleDisplayClass:"titleDisplayClass",titleHTML:"00",subContentHTML:"00",positionOffSet:null,positionBlocks:{"tr":{"offset":new HGIS.Pixel(-45,-30),"padding":new HGIS.Bounds(8,0,8,9),"blocks":[{size:new HGIS.Size("auto","auto"),anchor:new HGIS.Bounds(0,19,22,0),position:new HGIS.Pixel(0,0)},{size:new HGIS.Size(22,"auto"),anchor:new HGIS.Bounds(null,19,0,0),position:new HGIS.Pixel(-1238,0)},{size:new HGIS.Size("auto",19),anchor:new HGIS.Bounds(0,0,22,null),position:new HGIS.Pixel(0,-631)},{size:new HGIS.Size(22,19),anchor:new HGIS.Bounds(null,0,0,null),position:new HGIS.Pixel(-1238,-631)},{size:new HGIS.Size(81,35),anchor:new HGIS.Bounds(0,-32,null,null),position:new HGIS.Pixel(-215,-687)}]}},initialize:function(E,F,B,G,D,A,I,C){if(A.offset){this.positionOffSet=A.offset}else{this.positionOffSet=new HGIS.Pixel(0,0)}this.imageSrc=HGIS.Util.getImageLocation("cloud-popup-relative.png");this.autoSize=false;var H=[E,F,B,D,A,I,C];HGIS.Popup.Framed.prototype.initialize.apply(this,H);this.contentDisplayClass="hgis_FramedCloudPopupContent";this.contentDiv.className=this.contentDisplayClass;this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%";this.groupDiv.style.overflow="visible";this.titleHTML=(G!=null)?G:"";this.subContentHTML=(D!=null)?D:"";this.contentHTML=this.titleContent()},titleContent:function(){var A="<div class='"+this.titleDisplayClass+"'>"+this.titleHTML+"</div><div>"+this.subContentHTML+"</div>";return A},setTitle:function(A){this.titleHTML=A;this.contentHTML=this.titleContent();this.setContentHTML(this.contentHTML)},setContent:function(A){this.subContentHTML=A;this.contentHTML=this.titleContent();this.setContentHTML(this.contentHTML)},getSafeContentSize:function(C){var D=C.clone();var G=this.getContentDivPadding();var K=G.left+G.right;var B=G.top+G.bottom;this.fixPadding();K+=this.padding.left+this.padding.right;B+=this.padding.top+this.padding.bottom;if(this.closeDiv){var A=parseInt(this.closeDiv.style.width);K+=A+G.right}if(this.minSize){D.w=Math.max(D.w,(this.minSize.w-K));D.h=Math.max(D.h,(this.minSize.h-B))}if(this.maxSize){D.w=Math.min(D.w,(this.maxSize.w-K));D.h=Math.min(D.h,(this.maxSize.h-B))}if(this.map&&this.map.size){var I=0,H=0;if(this.keepInMap&&!this.panMapIfOutOfView){var J=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":I=J.x;H=this.map.size.h-J.y;break;case"tl":I=this.map.size.w-J.x;H=this.map.size.h-J.y;break;case"bl":I=this.map.size.w-J.x;H=J.y;break;case"br":I=J.x;H=J.y;break;default:I=J.x;H=this.map.size.h-J.y;break}}var F=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-B-H;var E=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-K-I;D.w=Math.min(D.w,E);D.h=Math.min(D.h,F)}return D},updateSize:function(){var I="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var H=(this.map)?this.map.div:document.body;var F=HGIS.Util.getRenderedDimensions(I,null,{displayClass:this.displayClass,containerElement:H});var B=this.getSafeContentSize(F);var C=null;if(B.equals(F)){C=F}else{var D={w:(B.w<F.w)?B.w:null,h:(B.h<F.h)?B.h:null};if(D.w&&D.h){C=B}else{var A=HGIS.Util.getRenderedDimensions(I,D,{displayClass:this.contentDisplayClass,containerElement:H});var E=HGIS.Element.getStyle(this.contentDiv,"overflow");if((E!="hidden")&&(A.equals(B))){var G=HGIS.Util.getScrollbarWidth();if(D.w){A.h+=G}else{A.w+=G}}C=this.getSafeContentSize(A)}}if(this.autoSize){if(C.w<120){C.w=120}if(C.h<30){C.h=30}}this.setSize(C)},setSize:function(F){this.size=F.clone();var A=this.getContentDivPadding();var D=A.left+A.right;var B=A.top+A.bottom;this.fixPadding();D+=this.padding.left+this.padding.right;B+=this.padding.top+this.padding.bottom;if(this.closeDiv){var E=parseInt(this.closeDiv.style.width);D+=E+A.right}this.size.w+=D;if(HGIS.BROWSER_NAME=="msie"){this.contentSize.w+=A.left+A.right;this.contentSize.h+=A.bottom+A.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px";this.div.style.overflow="visible"}if(this.contentDiv!=null){this.contentDiv.style.width=F.w+"px";this.contentDiv.style.height=F.h+"px"}if((this.lonlat)&&(this.map)){var C=this.map.getLayerPxFromLonLat(this.lonlat);if(this.positionOffSet!=null){C=C.offset(this.positionOffSet)}this.moveTo(C)}this.updateBlocks()},calculateRelativePosition:function(A){return"tr"},createBlocks:function(){this.blocks=[];var G=null;for(var A in this.positionBlocks){G=A;break}var E=this.positionBlocks[G];for(var H=0;H<E.blocks.length;H++){var F={};this.blocks.push(F);var C=this.id+"_FrameDecorationDiv_"+H;F.div=HGIS.Util.createDiv(C,null,null,null,"absolute",null,"hidden",null);var B=this.id+"_FrameDecorationImg_"+H;var D=(this.isAlphaImage)?HGIS.Util.createAlphaImageDiv:HGIS.Util.createImage;F.image=D(B,null,this.imageSize,this.imageSrc,"absolute",null,null,null);F.div.appendChild(F.image);this.groupDiv.appendChild(F.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var H=this.positionBlocks[this.relativePosition];for(var E=0;E<H.blocks.length;E++){var G=H.blocks[E];var F=this.blocks[E];var J=G.anchor.left;var I=G.anchor.bottom;var A=G.anchor.right;var C=G.anchor.top;var B=(isNaN(G.size.w))?this.size.w-(A+J):G.size.w;var D=(isNaN(G.size.h))?this.size.h-(I+C):G.size.h;F.div.style.width=(B<0?0:B)+"px";F.div.style.height=(D<0?0:D)+"px";F.div.style.left=(J!=null)?J+"px":"";F.div.style.bottom=(I!=null)?I+"px":"";F.div.style.right=(A!=null)?A+"px":"";F.div.style.top=(C!=null)?C+"px":"";F.image.style.left=G.position.x+"px";F.image.style.top=G.position.y+"px"}this.contentDiv.style.left=this.padding.left-8+"px";this.contentDiv.style.top=this.padding.top-9+"px";this.contentDiv.style.width="100%"}},updatePosition:function(){if((this.lonlat)&&(this.map)){var A=this.map.getLayerPxFromLonLat(this.lonlat);if(A&&this.positionOffSet){A=A.offset(this.positionOffSet);this.moveTo(A)}}},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var A=this.getContentDivPadding();this.closeDiv.style.right=A.right+this.padding.right+"px";this.closeDiv.style.top=this.padding.top+"px"}this.updateBlocks()},CLASS_NAME:"HGIS.Popup.InfoWindow"});function drawTextByPath_new(B,F,K){var I={label:"",textCoords:"",textReverse:"",charSpace:4};for(var G in F){I[G]=F[G]}if(I.textCoords==undefined||I.textCoords==""||I.textCoords.length==0){return}var C=new Array();var D=0,E=0;var J=I.textCoords.split(",");var H;for(D=0,E=J.length;D<E;D++){H=J[D].split(" ");C.push([parseInt(H[0])+K.x,parseInt(H[1])+K.y,H[2]])}var A=(B.measureText(I.label).width/I.label.length)+I.charSpace;for(D=0,E=C.length;D<E;D++){H=B.getImageData(C[D][0]-A/2,C[D][1]-A/2,A,A);if(_collisionAnalysis(H,A,A)){return}}for(D=0,E=C.length;D<E;D++){B.translate(C[D][0],C[D][1]);B.rotate(C[D][2]);if(I.textReverse==0){B.fillText(I.label[D],0,0)}else{if(I.textReverse==1){B.fillText(I.label[E-1-D],0,0)}}B.rotate(-C[D][2]);B.translate(-C[D][0],-C[D][1])}B.restore()}function drawTextByPath(B,G){var J={label:"",font:"12px 'Microsoft YaHei'",fillStyle:"black",charSpace:6,textAlign:"center",textBaseline:"middle",textCoords:"",textReverse:""};for(var H in G){J[H]=G[H]}if(J.textCoords==undefined||J.textCoords==""||J.textCoords.length==0){return}var C=J.textCoords;B.font=J.font;B.textAlign=J.textAlign;B.textBaseline=J.textBaseline;B.fillStyle=J.fontColor;var A=(B.measureText(J.label).width/J.label.length)+J.charSpace;var I=A/2;for(var E=0,K=C.length;E<K;E=E+1){var D=B.getImageData(C[E][0]-I,C[E][1]-I,A,A);if(_collisionAnalysis(D,A,A)){return}}B.save();for(var F=0,L=C.length;F<L;F++){B.translate(C[F][0],C[F][1]);B.rotate(C[F][2]);B.fillStyle=G.fillStyle;if(J.textReverse==0){B.fillText(J.label[F],0,0)}else{if(J.textReverse==1){B.fillText(J.label[L-1-F],0,0)}}B.rotate(-C[F][2]);B.translate(-C[F][0],-C[F][1])}B.restore()}function drawTextByPath_bk(B,L,A){var O={label:"",font:"12px 'Microsoft YaHei'",fillStyle:"black",charSpace:6,textAlign:"center",textBaseline:"middle",textCoords:"",textReverse:""};var I=[];for(var G in L){O[G]=L[G]}if(O.textCoords==undefined||O.textCoords==""||O.textCoords.length==0){return}var M=O.textCoords.split(",");var K;var J=A.x;var Q=A.y;for(var C=0,R=M.length;C<R;C++){K=M[C].split(" ");I.push([parseInt(K[0])+J,parseInt(K[1])+Q,K[2]])}B.font=O.font;B.textAlign=O.textAlign;B.textBaseline=O.textBaseline;B.fillStyle=O.fontColor;var S=(B.measureText(O.label).width/O.label.length)+O.charSpace;var P=S/2;for(var E=0,H=I.length;E<H;E=E+1){var D=B.getImageData(I[E][0]-P,I[E][1]-P,S,S);if(_collisionAnalysis(D,S,S)){return}}B.save();for(var F=0,N=I.length;F<N;F++){B.translate(I[F][0],I[F][1]);B.rotate(I[F][2]);B.fillStyle=L.fillStyle;if(O.textReverse==0){B.fillText(O.label[F],0,0)}else{if(O.textReverse==1){B.fillText(O.label[N-1-F],0,0)}}B.rotate(-I[F][2]);B.translate(-I[F][0],-I[F][1])}B.restore()}function _collisionAnalysis(A,E,C){for(var B=0,F=0;B<E&&F<C;B++,F++){var D=A.data[((B*(A.width*4))+(F*4))+3];if(typeof(D)=="undefined"){D=0}if(D!=0){return true}}return false}HGIS.Renderer.VectorTile=HGIS.Class(HGIS.Renderer,{hitContext:null,hitOverflow:0,canvas:null,lineCanvas:null,lineContext:null,tempCanvas:null,features:null,pendingRedraw:false,resolution:null,cachedSymbolBounds:{},curExtent:null,curLevel:-1,lineHeight:0,poiArray:[],time:null,rectOpacity:1,bgH2:null,frH2:null,initialize:function(A,C){HGIS.Renderer.prototype.initialize.apply(this,arguments);this.features={};this.root=document.createElement("canvas");this.root.style.zIndex=0;var B="#F9F9F9";if(HGIS.utils.MapStyleUtil.styleJson.rules){B=HGIS.utils.MapStyleUtil.getLandColor()}this.root.style.background=B;this.root.style.position="absolute";this.root.style.left="0px";this.root.style.top="0px";this.root.style.margin="5px";this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.lineCanvas=document.createElement("canvas");this.lineCanvas.style.background="transparent";this.lineCanvas.style.position="absolute";this.lineCanvas.style.left="0px";this.lineCanvas.style.top="0px";this.lineCanvas.style.margin="5px";this.lineContext=this.lineCanvas.getContext("2d");this.lineContext.lineCap="round";this.lineContext.lineJoin="bevel";this.container.appendChild(this.lineCanvas);this.hitCanvas=document.createElement("canvas");this.hitCanvas.style.background="transparent";this.hitCanvas.style.position="absolute";this.hitCanvas.style.left="0px";this.hitCanvas.style.top="0px";this.hitCanvas.style.margin="5px";this.hitContext=this.hitCanvas.getContext("2d");this.hitContext.font="7px Arial";this.hitContext.textAlign="center";this.hitContext.textBaseline="middle";this.hitContext.lineWidth=1;this.container.appendChild(this.hitCanvas);this.bgH2=document.createElement("h2");this.frH2=document.createElement("h2");this.bgH2.className="iconfont";this.frH2.className="iconfont";this.bgH2.innerHTML="&#57345;";this.lineHeight=this.hitContext.measureText("").height||this.hitContext.measureText("").width},setExtent:function(){HGIS.Renderer.prototype.setExtent.apply(this,arguments);return false},eraseGeometry:function(B,A){this.eraseFeatures(this.features[A][0])},supported:function(){return HGIS.CANVAS_SUPPORTED},setSize:function(A){this.size=A.clone();var B=this.root;B.style.width=A.w+"px";B.style.height=A.h+"px";B.width=A.w;B.height=A.h;this.resolution=this.map.resolution;var D=this.lineCanvas;D.style.width=A.w+"px";D.style.height=A.h+"px";D.width=A.w;D.height=A.h;var C=this.hitCanvas;C.style.width=A.w+"px";C.style.height=A.h+"px";C.width=A.w;C.height=A.h},drawFeature:function(J,H){var A=true;if(J.geometry){H=H||J.style;var E=this.map.getMaxExtent();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){E=this.map.getMaxExtent()}var I=this.caculateOrigin(J.origin);var B=this.map.resolution*256;var G=Number(I[0]-B*2),K=Number(I[0])+B*2,L=Number(I[1]-B*2),F=Number(I[1])+B*2;var C=new HGIS.Bounds(G,L,K,F);var D=C.intersectsBounds(this.extent,{worldBounds:E});A=(H.display!=="none")&&!!C&&(D);if(A){this.features[J.id]=[J,H]}else{delete (this.features[J.id])}this.pendingRedraw=true}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=false}return A},redraw:function(){if(!this.locked&&Object.keys(this.features).length>0){var F=this.root.width;var B=this.root.height;var E=Object.keys(this.features);E=E.sort();var H=E[0].substr(0,3);var C=[];var A=this.features[E[0]][1];this.canvas.clearRect(0,0,F,B);this.lineContext.clearRect(0,0,F,B);this.hitContext.clearRect(0,0,F,B);for(var D=0,G=E.length;D<G;D++){var I=this.features[E[D]][0];if(E[D].substr(0,3)!==H){this.drawFeatures(C,A);H=E[D].substr(0,3);A=this.features[E[D]][1];C=[]}C.push(this.features[E[D]][0])}this.drawFeatures(C,A)}},drawFeatures:function(C,G,E){if(C.length>0){var H=null;switch(C[0].type){case 1:H=E?E:this.hitContext;this.setCanvasContextStyleState("point",G,H,true);for(var F=C.length-1;F>=0;F--){var M=C[F];G=M.style;this.drawPoint(M.geometry,G,H)}this.setCanvasContextStyleState("text",G,H);for(var F=C.length-1;F>=0;F--){var M=C[F];G=M.style;if(G.label&&G.label!="undefined"){this.drawPointText([M.geometry[0],M.geometry[1]],G,H)}}break;case 2:H=E?E:this.lineContext;if(G.outlineWidth){var A=new HGIS.Style();A.strokeColor=G.outlineColor;A.strokeWidth=G.outlineWidth;A.strokeLinecap=G.outLinecap;A.strokeDashstyle=G.outlineDashstyle;this.setCanvasContextStyleState("polyline",A,H);H.globalCompositeOperation="destination-over";H.beginPath();for(var F=C.length-1;F>=0;F--){var M=C[F];this.drawSimpleLine(M.geometry,A,H)}H.stroke();H.globalCompositeOperation="source-over"}this.setCanvasContextStyleState("polyline",G,H);H.beginPath();for(var F=C.length-1;F>=0;F--){var M=C[F];this.drawSimpleLine(M.geometry,M.style,H)}H.stroke();this.setCanvasContextStyleState("text",G,H);for(var F=C.length-1;F>=0;F--){var M=C[F];if(M.style.label&&M.attributes["textCoords"]!==""){G={};G.fontColor=M.style.fontColor;G.textCoords=M.attributes["textCoords"];G.textReverse=M.attributes["textReverse"];G.label=M.style.label;this.drawLineText(G,this.hitContext)}}break;case 3:H=E?E:this.canvas;this.setCanvasContextStyleState("polygon",G,H);this.canvas.beginPath();var I=[];for(var F=0,K=C.length;F<K;F++){var M=C[F];var D=this.drawPolygon(M.geometry,G,H);I.push(D)}H.closePath();H.fill();this.setCanvasContextStyleState("text",G,this.hitContext);var L="";for(var F=0,K=C.length;F<K;F++){var M=C[F];G=M.style;if(G.label&&G.label!=L){var J=this.textInPolygon(M.geometry,G.label,M.attributes.hashcode);if(J){var B=this.getCenterByPointArr(I[F]);this.drawPolygonText(B,G,this.hitContext);L=G.label}}}break;default:break}}},setCanvasContextStyleState:function(A,C,B){if(A==="polygon"){if(C["fillOpacity"]!=B.globalAlpha){B.globalAlpha=C["fillOpacity"]}if(C["fillColor"]!=B.fillStyle){B.fillStyle=C["fillColor"]}}else{if(A==="polyline"){B.globalAlpha=C["strokeOpacity"];B.strokeStyle=C["strokeColor"];B.lineWidth=C["strokeWidth"];B.strokeDashstyle=C["strokeDashstyle"];if(B.strokeDashstyle==="dash"){B.setLineDash([15,15])}else{B.setLineDash([0,0])}B.lineCap=C["strokeLinecap"]}else{if(A==="point"){B.fillStyle=C.backgroundFillColor;B.strokeStyle=C.strokeColor;B.font=C.iconFont+" iconfont";B.lineWidth=1;this.bgH2.innerHTML=C.backgroundGraphic;this.frH2.innerHTML=C.externalGraphic}else{if(A==="text"){var D=[C.fontStyle?C.fontStyle:"normal","normal",C.fontWeight?C.fontWeight:"normal",C.fontSize?C.fontSize:"1em",C.fontFamily?C.fontFamily:"sans-serif"].join(" ");if(B.font!=D){B.font=D}B.textAlign="center";B.textBaseline="middle";B.fillStyle=C.fontColor;if(C.labelOutlineWidth){B.globalAlpha=C.labelOutlineOpacity||C.fontOpacity||1;if(B.strokeStyle!=C.labelOutlineColor){B.strokeStyle=C.labelOutlineColor}if(B.lineWidth!=C.labelOutlineWidth){B.lineWidth=C.labelOutlineWidth}}}else{B.globalAlpha=1;B.lineWidth=1}}}}},drawPolygon:function(E,D,A,F){var G=[];var C=E.length;A.moveTo(E[0],E[1]);G.push([E[0],E[1]]);for(var B=2;B<C;B=B+2){if(E[B]=="|"){A.moveTo(E[B+2],E[B+3]);B=B+2;continue}A.lineTo(E[B],E[B+1]);G.push([E[B],E[B+1]])}return G},textInPolygon:function(E,F,I){var C=true;var G=[];for(var D=0,H=E.length-1;D<H;D=D+2){G.push(E[D])}G.sort(function(K,J){return K-J});var B=G[G.length-1]-G[0];var A=this.hitContext.measureText(F).width;if(A>B){C=false}return C},drawPoint:function(F,G,E,K){var H=20,A=20;var I=0;var L=-(0.5*A);var J=F.length;if(J>1){var C=F[0]+I;var D=F[1]+L;if(K){var B=E.getImageData(C,D,20,20);if(this.collisionAnalysisDiagonal(B,20,20)){return}}E.fillText(this.bgH2.textContent,C,D);E.strokeText(this.bgH2.textContent,C,D);E.save();E.fillStyle=G.strokeColor;E.fillText(this.frH2.textContent,C,D);E.restore()}},previousPOI:null,previousStrokeColor:"",previousOuterStrokeColor:"",redrawIcon:function(G,H,E){this.previousPOI={};this.previousPOI.geometry=G;this.previousPOI.origin=H;this.previousPOI.style=E;var F=this.hitContext;var I=20,B=30;var K=0;var N=-(0.5*B);var J=this.caculateOrigin(H);var M=this.calculateDXY(J,this.extent);var L=G.length;if(L>1){coordX=G[0]+M.x;coordY=G[1]+M.y;var D=coordX+K;var A=coordY+N;var C=this.hitContext.getImageData(D,A,20,20);if(this.collisionAnalysisDiagonal(C,20,20)){return}F.globalAlpha=1;F.save();this.bgH2.innerHTML=E.backgroundGraphic;this.frH2.innerHTML=E.externalGraphic;this.setCanvasContextStyleState("point",E,this.hitContext);F.strokeText(this.bgH2.textContent,D,A);F.fillStyle=E.strokeColor;F.fillText(this.frH2.textContent,D,A)}},resetPreviousPOI:function(){if(this.previousPOI!=null){var E=this.previousPOI;var F=E.style;var I=E.origin;var H=E.geometry;var G=this.hitContext;var J=20,C=30;var L=0;var O=-(0.5*C);var K=this.caculateOrigin(I);var N=this.calculateDXY(K,this.extent);var M=H.length;if(M>1){coordX=H[0]+N.x;coordY=H[1]+N.y;var A=coordX+L;var B=coordY+O;var D=this.hitContext.getImageData(A,B,20,20);if(this.collisionAnalysisDiagonal(D,20,20)){return}G.globalAlpha=1;G.save();this.bgH2.innerHTML=F.backgroundGraphic;this.frH2.innerHTML=F.externalGraphic;F.strokeColor=this.previousStrokeColor;F.outerStrokeColor=this.previousOuterStrokeColor;this.setCanvasContextStyleState("point",F,this.hitContext);G.strokeText(this.bgH2.textContent,A,B);G.fillStyle=this.previousStrokeColor;G.fillText(this.frH2.textContent,A,B)}}this.previousPOI=null;this.previousStrokeColor="";this.previousOuterStrokeColor=""},drawIconAndText:function(H,I,F,G,N){var J=20,B=20;var L=0;var O=-(0.75*B);var K=this.caculateOrigin(I);var A=this.calculateDXY(K,this.extent);var M=H.length;if(M>1){coordX=H[0]+A.x;coordY=H[1]+A.y;var E=coordX+L;var C=coordY+O;if(N){var D=G.getImageData(E,C,20,20);if(this.collisionAnalysisDiagonal(D,20,20)){return}}this.bgH2.innerHTML=F.backgroundGraphic;this.frH2.innerHTML=F.externalGraphic;G.fillText(this.bgH2.textContent,E,C);G.strokeText(this.bgH2.textContent,E,C);G.fillStyle=F.strokeColor;G.fillText(this.frH2.textContent,E,C);if(F.label&&F.label!="undefined"&&F.label!=""){this.drawPointText([coordX,coordY],F,G);this.addToPOIArray(E,C,I,H,F)}}},drawIconFontLabelByPt:function(A,E,D){var C=this.hitContext;if(D){C=D}var F=A[0];var G=A[1];var B=this.hitContext.getImageData(F,G,40,20);if(this.collisionAnalysisDiagonal(B,40,20)){return}C.globalAlpha=1;C.save();var I=document.createElement("h2");I.className="iconfont";I.innerHTML=E.labelGraphic;var H=I.textContent;C.fillStyle=E.labelGraphicColor;C.strokeStyle=E.labelGraphicColor;C.font=E.iconFont+" iconfont";C.fillText(H,F,G);C.save()},decodeLine:function(C,D){var E=[];var B=C.length;for(var A=0;A<B;A=A+2){if(C[A]=="|"){E.push(C[A])}E.push(C[A]+D.x);E.push(C[A+1]+D.y)}return E},drawSimpleLine:function(E,D,A){var C=E.length;A.moveTo(E[0],E[1]);for(var B=2;B<C;B=B+2){if(E[B]=="|"){A.moveTo(E[B+2],E[B+3]);continue}A.lineTo(E[B],E[B+1])}},drawLineText:function(B,A){A=A?A:this.hitContext;drawTextByPath(A,B)},calculateDXY:function(D,A){var C=this.map.resolution;var B=(D[0]-A.left)/C;B=Math.round(B);var E=(A.top-D[1])/C;E=Math.round(E);return{"x":B,"y":E}},getCenterByPointArr:function(B){var D=[];var J=[];for(var G=0,I=B.length;G<I;G++){D.push(B[G][0]);J.push(B[G][1])}var A=Math.min.apply(Math,D);var F=Math.min.apply(Math,J);var C=Math.max.apply(Math,D);var H=Math.max.apply(Math,J);var E=(A+C)/2;var K=(F+H)/2;return[E,K]},drawPolygonText:function(D,E,B){var F=E.label.split("\n");var C=F.length;if(C===1){if(E.labelBackgroundColor){B.save();B.fillStyle=E.labelBackgroundColor;var A=B.measureText(F[0]).width;B.fillRect(D[0]-A/2-4,D[1]-this.lineHeight,A+8,this.lineHeight+12);B.restore()}if(E.labelOutlineWidth){B.strokeText(F[0],D[0],D[1]+1)}B.fillStyle=E.fontColor;B.fillText(F[0],D[0],D[1]+this.lineHeight)}else{if(C===2){B.fillText(F[0],D[0],D[1]+this.lineHeight);B.fillText(F[1],D[0],D[1]+this.lineHeight+this.lineHeight)}}},drawPointText:function(A,G,F){F.save();var O=G.label.split("\n");var K=O.length;if(F.fillText){var C=HGIS.Renderer.Canvas.LABEL_FACTOR[G.labelAlign[1]];if(C==null){C=-0.5}var H=this.lineHeight;A[1]+=H*C*(K-1);if(K==1){var E=F.getImageData(A[0],A[1],H,H);if(this.collisionAnalysis2(E,H,H)){return}var L=F.getImageData(A[0]+H*O[0].length,A[1],H,H);if(this.collisionAnalysis2(L,H,H)){return}if(O[0].length>3){var I=Math.floor(O[0].length/2);var N=F.getImageData(A[0]+H*I,A[1],H,H);if(this.collisionAnalysis2(N,H,H)){return}}}else{if(K==2){var B=F.getImageData(A[0],A[1],H,H);if(this.collisionAnalysis2(B,H,H)){return}var J=F.getImageData(A[0]+H*O[0].length,A[1],H,H);if(O[0].length>3){var I=Math.floor(O[0].length/2);var N=F.getImageData(A[0]+H*I,A[1],H,H);if(this.collisionAnalysis2(N,H,H)){return}}if(this.collisionAnalysis2(J,H,H)){return}var M=F.getImageData(A[0],A[1]+H,H,H);if(this.collisionAnalysis2(M,H,H)){return}var D=F.getImageData(A[0]+H*O[1].length,A[1]+H,H,H);if(this.collisionAnalysis2(D,H,H)){return}if(O[1].length>3){var I=Math.floor(O[1].length/2);var N=F.getImageData(A[0]+H*I,A[1]+H,H,H);if(this.collisionAnalysis2(N,H,H)){return}}}}F.fillStyle=G.fontColor;if(K===1){F.fillText(O[0],A[0],A[1]+H)}else{if(K===2){F.fillText(O[0],A[0],A[1]+H);F.fillText(O[1],A[0],A[1]+H+H)}}}F.restore()},collisionAnalysis2:function(A,H,B){for(var F=0,D=0;F<H&&D<B;F++,D++){var C=A.data[((F*(A.width*4))+(D*4))];var I=A.data[((F*(A.width*4))+(D*4))+1];var G=A.data[((F*(A.width*4))+(D*4))+2];var E=A.data[((F*(A.width*4))+(D*4))+3];if(typeof(E)=="undefined"){E=0}if(E!=0){return true}}return false},collisionAnalysisDiagonal:function(A,J,B){var D=false,F=false;for(var G=0,E=0;G<J&&E<B;G++,E++){var I=G*(A.width*4)+(E*4);var C=A.data[I];var L=A.data[I+1];var H=A.data[I+2];var K=A.data[I+3];if(typeof(K)=="undefined"){K=0}if(K!=0){D=true}}for(var G=J-1,E=0;G>=0&&E<B;G--,E++){var I=G*(A.width*4)+(E*4);var C=A.data[I];var L=A.data[I+1];var H=A.data[I+2];var K=A.data[I+3];if(typeof(K)=="undefined"){K=0}if(K!=0){F=true}}return D||F},collisionAnalysisLeftConrner:function(A,H,B){for(var F=0;F<H/2;F++){for(var D=0;D<B/2;D++){var C=A.data[((F*(A.width*4))+(D*4))];var I=A.data[((F*(A.width*4))+(D*4))+1];var G=A.data[((F*(A.width*4))+(D*4))+2];var E=A.data[((F*(A.width*4))+(D*4))+3];if(((C!=0||I!=0||G!=0)&&E!=0)||(C==0&&I==0&&G==0&&E!=0)){return true}}}return false},featureIdToHex:function(A){var D=Number(A.split("_").pop())+1;if(D>=16777216){this.hitOverflow=D-16777215;D=D%16777216+1}var C="000000"+D.toString(16);var B=C.length;C="#"+C.substring(B-6,B);return C},changeMapStyle:function(H,E,G){var B=[];var C=this.map.baseLayer.styleMap.styles["default"].rules;for(var D=C.length-1;D>=0;D--){if(C[D].featureType==H){if(G>=C[D].minLevel&&G<=C[D].maxLevel){this.map.baseLayer.styleMap.styles["default"].rules[D].symbolizer=E}}}var F=Object.keys(this.features);for(var D=0,A=F.length;D<A;D++){var I=this.features[F[D]][0];I.style=I.layer.styleMap.createSymbolizer(I)}this.redraw()},caculateOrigin:function(C){var B=[0,0];var A=C.split("-");B[0]=HGIS.InitParam.tileOrigin.lon+(A[1])*256*this.map.resolution;B[1]=HGIS.InitParam.tileOrigin.lat-(A[0])*256*this.map.resolution;return B},decodeCommandType:function(A){return A&7},decodeCount:function(A){return A>>3},decodeParameterInteger:function(A){return((A>>1)^(-(A&1)))},drawFeaturesSameType:function(A,B){if(this.tempCanvas==null){this.tempCanvas=document.createElement("canvas");this.tempCanvas.style.background="transparent";this.tempCanvas.style.position="absolute";this.tempCanvas.style.left="0px";this.tempCanvas.style.top="0px";this.tempCanvas.style.margin="5px";this.tempCanvas.style.opacity=0.5;this.tempCanvas.style.width=this.size.w+"px";this.tempCanvas.style.height=this.size.h+"px";this.tempCanvas.width=this.size.w;this.tempCanvas.height=this.size.h;this.container.appendChild(this.tempCanvas)}var C=this.tempCanvas.getContext("2d");this.drawFeatures(A,B,C)},startLoop:function(){if(this.tempCanvas==null){return}var A=this.tempCanvas.style.opacity;if(A>0){this.hidden(this.tempCanvas,0.8,-0.005)}else{this.hidden(this.tempCanvas,0,0.005)}},hidden:function(D,B,C){var A=this;A.time=setInterval(function(){B+=C;D.style.opacity=B;if(B<0){window.clearInterval(A.time);A.startLoop()}else{if(B>0.8){window.clearInterval(A.time);A.startLoop()}}},1)},stopLoop:function(A){if(A==undefined){A=true}if(this.tempCanvas==null){return}this.tempCanvas.style.opacity="0";if(this.time){window.clearInterval(this.time)}if(A){this.container.removeChild(this.tempCanvas);this.tempCanvas=null}},addToPOIArray:function(D,E,F,C,A){var B={};B.x=D;B.y=E;B.origin=F;B.geometry=C;B.style=A;this.poiArray.push(B)},getLocalXY:function(A){var D=this.getResolution();var B=this.extent;var C=((A.x-this.featureDx)/D+(-B.left/D));var E=((B.top/D)-A.y/D);return[C,E]},clear:function(){this.features={};var B=this.root.width;var A=this.root.height;this.canvas.clearRect(0,0,B,A);this.lineContext.clearRect(0,0,B,A);this.hitContext.clearRect(0,0,B,A)},getFeatureIdFromEvent:function(A){var B,I;if(this.root.style.display!=="none"){if(!this.map.dragging){var D=A.xy;var G=D.x|0;var H=D.y|0;var C=this.hitContext.getImageData(G,H,1,1).data;if(C[3]===255){var F=C[2]+(256*(C[1]+(256*C[0])));if(F){B="HGIS_Feature_Vector_"+(F-1+this.hitOverflow);try{I=this.features[B][0]}catch(E){}}}}}return I},eraseFeatures:function(A){if(!(HGIS.Util.isArray(A))){A=[A]}var C=A.length;for(var B=0;B<C;++B){delete this.features[A[B].id]}this.redraw()},CLASS_NAME:"HGIS.Renderer.VectorTile"});HGIS.Renderer.VectorTile.LABEL_ALIGN={"l":"left","r":"right","t":"top","b":"bottom"};HGIS.Renderer.VectorTile.LABEL_FACTOR={"l":0,"r":-1,"t":0,"b":-1};HGIS.Renderer.VectorTile.drawImageScaleFactor=null;HGIS.Services=HGIS.Services||{};HGIS.Services.GeoSearcher=function(){this.search=function(E,J,I,A,L,G){var B={};var K={};if(!E&&!J.geometry&&E==""){alert(HGIS.language[HGIS.InitParam.language]["HGIS_noKnow"]);return}if(E!=null&&E!="undefined"&&E!=""){K.keyword=E}if(J.geometry){var F=new HGIS.Format.WKT();var C=new HGIS.Feature.Vector(J.geometry);K.geometry=F.write(C);K.spatialOperation=J.spatialOperation?J.spatialOperation:"Intersects";K.distSort=J.distSort!=true?false:true;K.distInRes=J.distInRes!=true?false:true}if(J.buffer){K.buffer=J.buffer}K.featureType=I?I:"all";if(A){K.geomInRes=A.geomInRes!=true?false:true;K.isPaged=A.isPaged!=true?false:true;if(K.isPaged){K.pageSize=A.pageSize?A.pageSize:10;K.pageNum=A.pageNum?A.pageNum:1;K.isPageSum=A.isPageSum!=true?false:true;K.isTotal=A.isTotal?A.isTotal:true}K.isTotal=A.isTotal!=false?true:false;if(!isNaN(A.topN)){K.topN=A.topN}else{if(A.topN=="unlimit"){K.topN="unlimit"}else{K.topN=1000}}K.isGrouped=A.isGrouped!=true?false:true;if(K.isGrouped){K.maxItemsPerGroup=A.maxItemsPerGroup&&!isNaN(A.maxItemsPerGroup)?A.maxItemsPerGroup:10}else{}K.isSortByName=A.isSortByName!=true?false:true}else{K.geomInRes=false;K.isPaged=false;K.isGrouped=true;K.isTotal=true;K.topN=1000;A.isSortByName=false}var D={"params":JSON.stringify(K)};var H=geoSearchUrl.fullTextSearch;HGIS.Utils.send(H,D,"POST","json",L,G)};this.queryFeatureById=function(B,C,D,E){var F={"userId":B,"featureType":C};var A="";if(HGIS.ProxyUrl){A=HGIS.ProxyUrl;F.url=geoSearchUrl.queryFeatureById}else{A=geoSearchUrl.queryFeatureById}HGIS.Utils.send(A,JSON.stringify(F),"POST","json",D,E)};this.secondQuery=function(D,E,B,C){var F={"subtype":E,"fid":D};var A="";if(HGIS.ProxyUrl){A=HGIS.ProxyUrl;F.url=geoSearchUrl.secondQuery}else{A=geoSearchUrl.secondQuery}HGIS.Utils.send(A,JSON.stringify(F),"POST","json",B,C)};this.trimComma=function(C){var D=C.length;for(var B=0;B<D;B++){var A=C.lastIndexOf(",");if(C.length==A+1){C=C.substring(0,A)}}for(var B=0;B<D;B++){var E=C.indexOf(",");if(E==0){C=C.substring(1)}}C=C.replace(","," or ");return C};this.trimLRBlank=function(B){if(B==null){return""}var C=new String(" \t\n\r");var D=new String(B);if(C.indexOf(D.charAt(D.length-1))!=-1){var A=D.length-1;while(A>=0&&C.indexOf(D.charAt(A))!=-1){A--}D=D.substring(0,A+1)}if(C.indexOf(D.charAt(0))!=-1){var E=0,A=D.length;while(E<A&&C.indexOf(D.charAt(E))!=-1){E++}D=D.substring(E,A)}D=D.replace(/\s/g," and ");return D};this.getCrossRoad=function(C,A,B,D,G,H){var E={};E.road1=C;E.road2=A;E.tolerance=B;if(parseInt(B)===NaN||parseInt(B)<0){throw HGIS.language[HGIS.InitParam.language]["Tolerance_val_noReasonable"];return}E.geometry=D;var F=geoSearchUrl.queryCrossRoads;HGIS.Utils.send(F,E,"post","json",G,H)}};HGIS.Services=HGIS.Services||{};HGIS.Services.RouteNetAnlyse=function(){var A=this;A.anlyseRes;A.stopNodes=new Array();A.stopXYs=new Array();this.clearAllStopNodes=function(){A.stopNodes=new Array()};this.clearAllStopXYs=function(){A.stopXYs=new Array()};this.setStopNodes=function(C,B){var E={"x":C.x,"y":C.y};var D={"data":JSON.stringify(E)};HGIS.Utils.send(routeNetAnlyseURL.nearlyRoadNode,D,"post","json",function(F){B(F);A.stopNodes.push(F.nodeId)},function(F){alert(HGIS.language[HGIS.InitParam.language]["err_msg"]+":"+F)},false)};this.setStopXY=function(C,D){var B={"x":C,"y":D};this.stopXYs.push(B)};this.shortestPath=function(B){if(A.stopNodes.length<2){throw HGIS.language[HGIS.InitParam.language]["least_twoPoint"];return}else{var D={"stopsNodes":A.stopNodes};var C={"data":JSON.stringify(A.stopNodes)};HGIS.Utils.send(routeNetAnlyseURL.shortestPath,C,"post","json",B,this.anlyseError)}};this.AStarShortestPathByNodeId=function(B){if(A.stopNodes.length<2){throw HGIS.language[HGIS.InitParam.language]["least_twoPoint"];return}else{var D={"stopsNodes":A.stopNodes};var C={"data":JSON.stringify(A.stopNodes)};HGIS.Utils.send(routeNetAnlyseURL.AStarShortestPathByNodeId,C,"post","json",B,this.anlyseError)}};this.AStarShortestPathByXY=function(B){if(A.stopXYs.length<2){throw HGIS.language[HGIS.InitParam.language]["least_twoPoint"];return}else{var D={"stopsXYs":A.stopXYs};var C={"data":JSON.stringify(A.stopXYs)};HGIS.Utils.send(routeNetAnlyseURL.AStarShortestPathByXY,C,"post","json",B,this.anlyseError)}};this.analysisReport=function(){};this.unThroughSeg=function(){};this.anlyseSuccess=function(B){alert(B)};this.anlyseError=function(B){alert(B)}};HGIS.Strategy=HGIS.Strategy||{};HGIS.Strategy.Parameters={isCache:false,isConnected:false,wtc:null,initDB:function(){String.prototype.hashCode=function(){var E=0,D,F;if(this.length===0){return E}for(D=0;D<this.length;D++){F=this.charCodeAt(D);E=((E<<5)-E)+F;E|=0}return E.toString()};this.wtc=new HGIS.Strategy.WebTileCache();if((typeof(Promise)!=="function")||(!this.wtc.isSupported())){this.wtc=null;HGIS.Strategy.Parameters.isCache=false;alert(HGIS.language[HGIS.InitParam.language]["noSupport_idxDB"])}else{var A=function(D){HGIS.Strategy.Parameters.isConnected=true;HGIS.Strategy.Parameters.isCache=true};var C=function(D){alert(HGIS.language[HGIS.InitParam.language]["DB_fail"]);HGIS.Strategy.Parameters.isConnected=false};var B=HGIS.InitParam.maxLevel;this.wtc.createTileDB({totalLevels:B},A,C)}},clearDB:function(){if(this.wtc==null){var B=new HGIS.Strategy.WebTileCache();if(!B.isSupported()){B=null}else{var A=function(D){B.clearTileDB()};var C=function(D){B=null};B.createTileDB({version:1,totalLevels:this.options.maxZoom,dbname:"HGIS_Cache"},A,C)}}else{this.wtc.clearTileDB()}}};HGIS.Strategy.WebTileCache=function(){var D=this;var E=window.indexedDB||window.msIndexedDB||window.mozIndexedDB||window.webkitIndexedDB;var G=window.IDBTransaction||window.webkitIDBTransaction;var F;var B,A,C;D.options={version:1,totalLevels:20,dbname:"HGIS_Cache"};this.isSupported=function(){return E?true:false};this.exsits=function(H){};this.createTileDB=function(H,I,J){if(F){J("")}else{D._initTable(H,I,J)}};this._initTable=function(H,I,J){D.extend(D.options,H);B=E.open(D.options.dbname,D.options.version);B.onsuccess=function(K){F=K.target.result;I(F)};B.onerror=function(){J("")};B.onupgradeneeded=function(K){F=K.target.result;D._createTables(F)}};this.extend=function(J,I){for(var H in I){J[H]=I[H]}};this._createTables=function(J){var I;for(var H=0;H<=D.options.totalLevels;H++){if(H<=15){if(!J.objectStoreNames.contains("0-15")){I=J.createObjectStore("0-15",{keyPath:"tileId"});I.createIndex("tileId","tileId",{unique:true})}}else{if(!J.objectStoreNames.contains(String(H))){I=J.createObjectStore(String(H),{keyPath:"tileId"});I.createIndex("tileId","tileId",{unique:true})}}}};this.deleteTileDB=function(){F.close();B=E.deleteDatabase(F.name);B.onsuccess=function(H){alert(HGIS.language[HGIS.InitParam.language]["del_DB_success"])};B.onerror=function(){alert(HGIS.language[HGIS.InitParam.language]["del_DB_err"])}};this.clearTileDB=function(){var I="";for(var H=15;H<D.options.totalLevels;H++){if(H==15){I="0-15"}else{I=H}if(F.objectStoreNames.contains(String(I))){F.transaction(I,"readwrite").objectStore(I).clear().onsuccess=function(J){}}}return 1};this.query=function(I,H,J,K){var L=H>15?String(H):"0-15";C=F.transaction(L).objectStore(L).index("tileId");B=C.get(I);B.onerror=function(M){K("[WebTileCache]-query")};B.onsuccess=function(M){if(typeof(M.target.result)!="undefined"){J(M.target.result.tile)}else{K("[WebTileCache]-query")}}};this.insert=function(I,H,J){var L=H>15?String(H):"0-15";if((typeof(F))=="undefined"){alert(HGIS.language[HGIS.InitParam.language]["no_instant"])}A=F.transaction(L,"readwrite");var K={"tileId":I,"tile":J};B=A.objectStore(L).add(K);B.onsuccess=function(M){};B.onerror=function(){}}};HGIS.Symbolizer.CompositeSymbol=HGIS.Class({symbols:[],div:null,type:"compositesymbol",textPosition:"bottom-center",borderLineColor:null,borderLineStyle:"solid",borderLineWidth:0,cursor:"pointer",selected:false,initialize:function(A){this.symbols=A},draw:function(){if(!this.pictureSymbol||!this.textSymbol){for(var G=0;G<this.symbols.length;G++){var I=this.symbols[G];if(I.type==="picturemarkersymbol"&&!this.pictureSymbol){this.pictureSymbol=I}if(I.type==="textsymbol"&&!this.textSymbol){this.textSymbol=I}}}var N=[],L=[],B=[],F=[];N.push('<div style="position:absolute;cursor:'+this.cursor+";");B.push('<img src="'+this.pictureSymbol.url+'" style="position:absolute;');F.push('<div style="position:absolute;');F.push("white-space:nowrap;text-overflow:ellipsis;overflow:hidden;");var M=parseInt(this.pictureSymbol.width),D=parseInt(this.pictureSymbol.height);B.push("width:"+M+"px;height:"+D+"px;");var K=this.textSymbol.text||"";var A=HGIS.Util.getTextSize(K,this.textSymbol.fontSize,this.textSymbol.fontFamily);var J=100;if(this.textSymbol.fontSize*6>J){J=this.textSymbol.fontSize*6}var O=parseInt(this.textSymbol.width||(((A.width+4)>J)?J:A.width+4));var E=parseInt(this.textSymbol.height||(A.height));F.push("width:"+O+"px;height:"+E+"px;");F.push("font-size:"+this.textSymbol.fontSize+"px;font-family:'"+this.textSymbol.fontFamily+"';");var H=0,C=0;this.width=M;this.height=D;if(this.textPosition.indexOf("bottom-")>-1){this.width=O>this.width?O:this.width;this.height+=(E+2);C=-D/2;B.push("top:0px;");F.push("bottom:0px;")}else{if(this.textPosition.indexOf("top-")>-1){this.width=O>this.width?O:this.width;this.height+=(E+2);C=-this.height+(D/2);B.push("bottom:0px;");F.push("top:0px;")}else{if(this.textPosition.indexOf("left-")>-1){this.width+=(O+2);this.height=E>this.height?E:this.height;H=-this.width+(M/2);B.push("right:0px;");F.push("left:0px;text-align:center;")}else{if(this.textPosition.indexOf("right-")>-1){this.width+=(O+2);this.height=E>this.height?E:this.height;H=-M/2;B.push("left:0px;");F.push("right:0px;text-align:center;")}}}}N.push("width:"+this.width+"px;height:"+this.height+"px;");if(this.textPosition.indexOf("-left")>-1){H=-M/2;B.push("left:0px;");F.push("left:0px;text-align:left;line-height:"+E+"px;")}else{if(this.textPosition.indexOf("-center")>-1){H=-this.width/2;B.push("left:"+(this.width-parseInt(this.pictureSymbol.width))/2+"px;");F.push("left:"+(this.width-O)/2+"px;text-align:center;line-height:"+E+"px;")}else{if(this.textPosition.indexOf("-right")>-1){H=-this.width+(M/2);B.push("right:0px;");F.push("right:0px;text-align:right;line-height:"+E+"px;")}else{if(this.textPosition.indexOf("-top")>-1){C=-D/2;B.push("top:0px;");F.push("top:0px;")}else{if(this.textPosition.indexOf("-bottom")>-1){C=-this.height+(D/2);B.push("bottom:0px;");F.push("bottom:0px;")}else{if(this.textPosition.indexOf("-middle")>-1){C=-this.height/2;B.push("top:"+(this.height-parseInt(this.pictureSymbol.height))/2+"px;");F.push("top:"+(this.height-E)/2+"px;line-height:"+E+"px;")}}}}}}if(this.xoffset){H=H+this.xoffset}if(this.yoffset){C=C+this.yoffset}N.push("left:"+H+"px;top:"+C+'px;" ');N.push('title="'+K+'">');B.push('"/>');if(this.textSymbol.color){F.push("color:"+this.textSymbol.color.to0x()+";")}F.push('">'+K+"</div>");N=N.concat(B);N=N.concat(F);if(this.borderLineColor&&this.borderLineStyle&&this.borderLineWidth){L.push('<div style="position:absolute;');L.push("width:"+this.width+"px;height:"+this.height+"px;");L.push("border:"+this.borderLineWidth+"px "+this.borderLineStyle+" "+this.borderLineColor.to0x()+";top:-"+this.borderLineWidth+"px;left:-"+this.borderLineWidth+"px;");L.push("filter:alpha(opacity="+(this.borderLineColor.a*100)+");opacity:"+this.borderLineColor.a+";");L.push('"></div>');N=N.concat(L)}if(this.selected){N.push('<div style="position:absolute;height:100%;width:100%;');N.push('border: 2px solid #FF64FF;padding:2px;top:-4px;left:-4px;"></div>')}N.push("</div>");this.div=N.join("");return this.div},toJson:function(){var A=[];var B=this.symbols.length;for(var C=0;C<B;C++){var E=this.symbols[C];A.push(E.toJson())}var D={type:"hikCS",symbols:A};return D}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.CreateHtmlIcon=function(A){var C=document.createElement("div");C.style.width=A.width+"px";C.style.height=A.height+"px";C.style["text-align"]="center";C.style.backgroundImage="url("+A.img+")";C.style.backgroundRepeat="no-repeat";var B=document.createElement("span");B.style.position="relative";B.style.top="-20px";B.style.color="#fff";B.style["font-size"]="18px";B.style.left="18px";B.innerText=A.info;B.style.backgroundColor="blue";B.style.width="20px";B.style.height="22px";C.appendChild(B);var D=new HGIS.HtmlIcon(C.outerHTML,null,A.offset);return D};HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.FillSymbol=HGIS.Class(HGIS.Symbolizer.Symbol,{outline:null,initialize:function(A){HGIS.Symbolizer.Symbol.prototype.initialize.apply(this,[A]);if(A&&typeof(A)==="object"&&A.outline){this.outline=new HGIS.Symbolizer.SimpleLineSymbol(A.outline)}},setOutline:function(A){this.outline=A;return this},toJson:function(){var A={};if(this.outline!==null){A.outline=this.outline.toJson()}if(this.color!==null){A.color=this.color.toJson()}return A}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.Font=HGIS.Class({initialize:function(A,C,D,B,E){if(A){if(typeof(A)==="object"){HGIS.Util.extend(this,A)}else{this.size=A;if(C!==undefined){this.style=C}if(D!==undefined){this.variant=D}if(B!==undefined){this.weight=B}if(E!==undefined){this.family=E}}}},setSize:function(A){this.size=A;return this},setStyle:function(A){this.style=A;return this},setVariant:function(A){this.variant=A;return this},setWeight:function(A){this.weight=A;return this},setFamily:function(A){this.family=A;return this},toJson:function(){return{size:this.size,style:this.style,variant:this.variant,decoration:this.decoration,weight:this.weight,family:this.family}}});HGIS.Util.extend(HGIS.Symbolizer.Font,{STYLE_NORMAL:"normal",STYLE_ITALIC:"italic",STYLE_OBLIQUE:"oblique",VARIANT_NORMAL:"normal",VARIANT_SMALLCAPS:"small-caps",WEIGHT_NORMAL:"normal",WEIGHT_BOLD:"bold",WEIGHT_BOLDER:"bolder",WEIGHT_LIGHTER:"lighter"});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.HtmlIcon=HGIS.Class(HGIS.Icon,{html:null,size:null,offset:null,calculateOffset:null,div:null,px:null,initialize:function(A,C,B,D){this.html=A;this.size=C;this.offset=B||{x:0,y:0};this.calculateOffset=D;var E=HGIS.Util.createUniqueID("HGIS_Icon_");this.div=document.createElement("div");this.div.id=E},destroy:function(){this.erase();this.div.innerHTML="";this.div=null},clone:function(){return new HikGIS.HtmlIcon(this.html,this.size,this.offset,this.calculateOffset)},setHtml:function(A){if(A!=null){this.html=A}this.draw()},draw:function(A){if(this.size&&this.size.width){this.div.style.width=this.size.width+"px"}if(this.size&&this.size.height){this.div.style.height=this.size.height+"px"}this.div.style.position="absolute";this.div.style.cursor="pointer";this.div.innerHTML=this.html;this.moveTo(A);return this.div},erase:function(){if(this.div!=null&&this.div.parentNode!=null){HGIS.Element.remove(this.div)}},setOpacity:function(A){var B=this.div;if(parseFloat(A)>=0&&parseFloat(A)<1){B.style.filter="alpha(opacity="+(A*100)+")";B.style.opacity=A}else{if(parseFloat(A)==1){B.style.filter="";B.style.opacity=""}}},moveTo:function(A){if(A!=null){this.px=A}if(this.div!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}HGIS.Util.modifyDOMElement(this.div,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}}},display:function(A){this.div.style.display=(A)?"":"none"},isDrawn:function(){var A=(this.div&&this.div.parentNode&&(this.div.parentNode.nodeType!=11));return A},CLASS_NAME:"HGIS.Symbolizer.HtmlIcon"});HGIS.Symbolizer.HtmlSymbol=HGIS.Class(HGIS.Symbolizer.Symbol,{type:"htmlsymbol",size:null,initialize:function(A,C,B){this.html=A;this.size=C?C:null;this.offset=B?B:{x:0,y:0};HGIS.Symbolizer.Symbol.prototype.initialize.apply(this,[A,C,B])},setHtml:function(A){this.html=A},setOffset:function(A){this.offset=A}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.ImageTextIcon=HGIS.Class(HGIS.Icon,{html:null,symbols:[],div:null,type:"ImageTextIcon",textPosition:"top-center",textBorder:"none",cursor:"pointer",textBackgroundColor:"#7d48c8",gap:2,selected:false,showTitle:false,showText:true,initialize:function(A){this.options=A;this.imgUrl=A.imgUrl;this.imgWidth=A.imgWidth;this.imgHeight=A.imgHeight;this.selImgUrl=A.selImgUrl;this.text=A.text;this.textBackgroundColor=A.textBackgroundColor?A.textBackgroundColor:"#7d48c8";this.textPosition=A.textPosition?A.textPosition:this.textPosition;this.textBorderRadius=A.borderRadius?A.borderRadius:"1px";this.textBgPadding=A.textBgPadding?A.textBgPadding:"1px";this.fontSize=A.fontSize?A.fontSize:"13";this.fontFamily=A.fontFamily?A.fontFamily:"''";this.textColor=A.textColor?A.textColor:"#ccc";this.textBorder=A.textBorder?A.textBorder:"none";this.gap=A.gap?A.gap:2;this.showTitle=A.showTitle||false;this.showText=typeof A.showText==="boolean"?A.showText:true;this.maxWidth=A.maxWidth?A.maxWidth:10000;var B=HGIS.Util.createUniqueID("HGIS_Icon_");this.div=document.createElement("div");this.div.id=B;if(this.showTitle){this.div.title=this.text}this.offset=A.offset||{x:0,y:0};this.html=this.getHtml()},erase:function(){if(this.div!=null&&this.div.parentNode!=null){HGIS.Element.remove(this.div)}},display:function(A){this.div.style.display=(A)?"":"none"},isDrawn:function(){var A=(this.div&&this.div.parentNode&&(this.div.parentNode.nodeType!=11));return A},setImage:function(A){this.div.getElementsByTagName("img")[0].src=A},select:function(){this.selected=true;if(this.selImgUrl){this.div.getElementsByTagName("img")[0].src=this.selImgUrl}},unselect:function(){this.selected=false;this.div.getElementsByTagName("img")[0].src=this.imgUrl},getHtml:function(){var B=document.createElement("img");var J=document.createElement("span");if(!this.selected){B.src=this.imgUrl;B.style.position="absolute"}else{if(typeof this.selImgUrl=="undefined"){B.src=this.imgUrl;B.sytle.position="absolute"}else{B.src=this.selImgUrl;B.sytle.position="absolute"}}J.style.position="absolute";J.style.whiteSpace="nowrap";J.style.textOverflow="ellipsis";J.style.overflow="hidden";J.style.background=this.textBackgroundColor;J.style.border=this.textBorder;J.style.borderRadius=this.textBorderRadius;J.style.padding=this.textBgPadding;J.style.color="#fff";var H=parseInt(this.imgWidth),C=parseInt(this.imgHeight);B.style.width=H+"px";B.style.height=C+"px";var F=this.text||"";J.innerText=this.text;var A=this.getTextSize(F,this.fontSize,this.fontFamily);var G=this.maxWidth;if(this.fontSize*6>G){G=this.fontSize*6}var I=parseInt(this.textWidth||(((A.width+4)>G)?G:A.width+4));var E=parseInt((A.height));var D=15;I=I<D?D:I;J.style.width=I+"px";J.style.height=E+"px";J.style.fontSize=this.fontSize+"px";J.style.fontFamily=this.fontFamily;this.width=H;this.height=C;if(this.textPosition.indexOf("bottom")>-1){this.height+=(E+this.gap);J.style.top=parseInt(this.imgHeight/2+this.gap)+"px"}else{if(this.textPosition.indexOf("middle")>-1){this.height=E>this.height?E:this.height;J.style.top=-parseInt(E/2)+"px"}else{if(this.textPosition.indexOf("top")>-1){this.height+=(E+this.gap);J.style.top=-parseInt(this.imgHeight/2+E+this.gap)+"px"}}}if(this.textPosition.indexOf("left")>-1){this.width+=(I+this.gap);J.style.left=-parseInt(I+this.imgWidth/2+this.gap)+"px"}else{if(this.textPosition.indexOf("center")>-1){this.width=I>this.width?I:this.width;J.style.left=-parseInt(I/2)+"px"}else{if(this.textPosition.indexOf("right")>-1){this.width+=(I+this.gap);J.style.left=parseInt(this.imgWidth/2+this.gap)+"px"}}}J.style.textAlign="center";J.style.lineHeight=E+"px";B.style.left=-(parseInt(this.imgWidth/2))+"px";B.style.top=-(parseInt(this.imgHeight/2))+"px";if(this.textColor){J.style.color=this.textColor}this.div.appendChild(B);if(this.text&&this.showText){this.div.appendChild(J)}},draw:function(A){if(this.size&&this.size.width){this.div.style.width=this.size.width+"px"}if(this.size&&this.size.height){this.div.style.height=this.size.height+"px"}this.div.style.position="absolute";this.div.style.cursor="pointer";this.moveTo(A);return this.div},moveTo:function(A){if(A!=null){this.px=A}if(this.div!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}HGIS.Util.modifyDOMElement(this.div,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}}},getTextSize:function(D,B,E){var G=document.getElementById("text_width_span");if(!G){G=document.createElement("span");document.body.appendChild(G);G.setAttribute("id","text_width_span");G.style.position="absolute";G.style.top="-10000px";G.style.left="-10000px"}G.style.fontSize="14px";G.style.fontFamily="''";if(B){G.style.fontSize=B+"px"}if(E){G.style.fontFamily="'"+E+"'"}G.innerText=D;var F=navigator.appName;if(F=="Microsoft Internet Explorer"){var H=navigator.appVersion;var C=H.split(";");var A=C[1].replace(/[ ]/g,"");if(A=="MSIE9.0"){return{width:G.offsetWidth+13,height:G.offsetHeight}}}return{width:G.offsetWidth+4,height:G.offsetHeight}},CLASS_NAME:"HGIS.Symbolizer.ImageTextIcon"});HGIS.Symbolizer.LineSymbol=HGIS.Class(HGIS.Symbolizer.Symbol,{width:1,initialize:function(A){HGIS.Symbolizer.Symbol.prototype.initialize.apply(this,[A]);if(typeof(A)==="object"){this.width=A.width}else{this.width=1}},setWidth:function(A){this.width=A;return this},toJson:function(){return{width:this.width,color:this.color.toJson()}}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.MapLabel=function(){this.queryLabel=function(B,A){HGIS.Utils.send(mapLabelURL.queryLabelURL,JSON.stringify(params),"POST","json",function(C){if(A){A(C)}})};this.addLabel=function(B,E,G,C,D,A){var F={labelName:B,creater:E,params:C,instruction:G,bounds:D};HGIS.Utils.send(mapLabelURL.addLabelURL,JSON.stringify(F),"POST","json",function(H){if(H.ReturnInfo=="sorry"){alert(HGIS.language[HGIS.InitParam.language]["insert_err"])}else{if(A){A(H)}}})};this.updateLabel=function(B,A,E,C){var D={labelID:B,labelName:A,instruction:E};HGIS.Utils.send(mapLabelURL.updateLabelURL,JSON.stringify(D),"POST","json",function(F){C(F)})};this.delLabel=function(B,A){var C={labelID:B};HGIS.Utils.send(mapLabelURL.delLabelURL,JSON.stringify(C),"POST","json",function(D){A(D)})}};HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.MarkerSymbol=HGIS.Class(HGIS.Symbolizer.Symbol,{angle:0,xoffset:0,yoffset:0,size:12,initialize:function(A){HGIS.Symbolizer.Symbol.prototype.initialize.apply(this,[A])},setAngle:function(A){this.angle=A;return this},setSize:function(A){this.size=A;return this},setOffset:function(A,B){this.xoffset=A;this.yoffset=B;return this},toJson:function(){return{size:this.size,angle:this.angle,xoffset:this.xoffset,yoffset:this.yoffset,color:this.color.toJson()}},angle:0,xoffset:0,yoffset:0,size:12});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.PictureFillSymbol=HGIS.Class(HGIS.Symbolizer.SimpleFillSymbol,{initialize:function(B,C,D,A){HGIS.Symbolizer.SimpleFillSymbol.prototype.initialize.apply(this,[B,C,D,A]);if(B){if(typeof(B)==="string"){this.url=B;if(C!==undefined){this.outline=C}if(D!==undefined){this.width=D}if(A!==undefined){this.height=A}}else{this.xoffset=B.xoffset;this.yoffset=B.yoffset;this.width=B.width;this.height=B.height}}},type:"picturefillsymbol",xscale:1,yscale:1,xoffset:0,yoffset:0,width:20,height:20,setWidth:function(A){this.width=A;return this},setHeight:function(A){this.height=A;return this},setOffset:function(A,B){this.xoffset=A;this.yoffset=B;return this},setUrl:function(A){if(A!==this.url){delete this.imageData;delete this.contentType}this.url=A;return this},setXScale:function(A){this.xscale=A;return this},setYScale:function(A){this.yscale=A;return this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){return{src:this.url,width:(this.width*this.xscale),height:(this.height*this.yscale),x:this.xoffset,y:this.yoffset}},toJson:function(){var A={type:"hikPFS",url:url,contentType:this.contentType,width:this.width,height:this.height,xoffset:this.xoffset,yoffset:this.yoffset,xscale:this.xscale,yscale:this.yscale};if(this.outline){A.outline=this.outline.toJson()}return A}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.PictureMarkerSymbol=HGIS.Class(HGIS.Symbolizer.MarkerSymbol,{url:null,scalable:false,standardResolution:0.0001,cursor:"",source:null,title:"",initialize:function(B,C,A){HGIS.Symbolizer.Symbol.prototype.initialize.apply(this,[B,C,A]);if(B){if(typeof(B)=="string"){this.url=B;this.source=this.url;if(C){this.width=C}if(A){this.height=A}}else{this.width=B.width;this.height=B.height;this.source=B.url;this.url=B.url;this.scalable=B.scalable||false;this.standardResolution=B.standardResolution;this.cursor=B.cursor;this.resizable=B.resizable||false;this.title=B.title}}},type:"picturemarkersymbol",getStroke:function(){return null},getFill:function(){return null},setWidth:function(A){this.width=A;return this},setHeight:function(A){this.height=A;return this},setUrl:function(A){if(A!==this.url){delete this.imageData;delete this.contentType}this.url=A;this.source=this.url;return this},toJson:function(){return this}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.SimpleFillSymbol=HGIS.Class(HGIS.Symbolizer.FillSymbol,{style:"solid",initialize:function(A,B,C){HGIS.Symbolizer.FillSymbol.prototype.initialize.apply(this,[A,B,C]);if(A){if(typeof(A)==="string"){this.style=A;if(B!==undefined){this.outline=B}if(C!==undefined){this.color=C}}}},type:"simplefillsymbol",setStyle:function(A){this.style=A;return this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){return this.color},toJson:function(){var A={type:"hikSFS",style:this.style};if(this.outline!==null){A.outline=this.outline.toJson()}if(this.color!==null){A.color=this.color.toJson()}return A}});HGIS.Util.extend(HGIS.Symbolizer.SimpleFillSymbol,{STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forwarddiagonal",STYLE_BACKWARD_DIAGONAL:"backwarddiagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonalcross",STYLE_FORWARDDIAGONAL:"forwarddiagonal",STYLE_BACKWARDDIAGONAL:"backwarddiagonal",STYLE_DIAGONALCROSS:"diagonalcross"});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.SimpleLineSymbol=HGIS.Class(HGIS.Symbolizer.LineSymbol,{initialize:function(A,C,B){HGIS.Symbolizer.LineSymbol.prototype.initialize.apply(this,[A,C,B]);if(A){if(typeof(A)==="string"){this.style=A;if(C){this.color=C}if(B){this.width=B}}}},type:"simplelinesymbol",style:"solid",setStyle:function(A){this.style=A;return this},getStroke:function(){return{color:this.color,style:this.style,width:this.width}},getFill:function(){return null},toJson:function(){return{type:"hikSLS",style:this.style,width:this.width,color:this.color.toJson()}}});HGIS.Util.extend(HGIS.Symbolizer.SimpleLineSymbol,{STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dashdot",STYLE_DASHDOTDOT:"longdashdotdot",STYLE_NULL:"none"});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.SimpleMarkerSymbol=HGIS.Class(HGIS.Symbolizer.MarkerSymbol,{initialize:function(B,A,C,D){HGIS.Symbolizer.MarkerSymbol.prototype.initialize.apply(this,[B,A,C,D]);if(B){if(typeof(B)==="string"){this.style=B;if(A){this.size=A}if(C){this.outline=C}if(D){this.color=D}}}},type:"simplemarkersymbol",style:"circle",outline:null,setStyle:function(A){this.style=A;return this},setOutline:function(A){this.outline=A;return this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){return this.color},toJson:function(){var A={type:"hikSMS",angle:this.angle,xoffset:this.xoffset,yoffset:this.yoffset,size:this.size,style:this.style,color:this.color.toJson()};if(this.outline!=null){A.outline=this.outline.toJson()}return A}});HGIS.Util.extend(HGIS.Symbolizer.SimpleMarkerSymbol,{STYLE_CIRCLE:"circle",STYLE_SQUARE:"square",STYLE_CROSS:"cross",STYLE_X:"x",STYLE_DIAMOND:"diamond",STYLE_TARGET:"target"});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.RGBColor=HGIS.Class({r:0,g:0,b:0,a:0,initialize:function(B,A,C,D){if(B){this.r=B}if(A){this.g=A}if(C){this.b=C}if(D!=0){this.a=D}},toJson:function(){return[this.r,this.g,this.b,Math.round(this.a*255)]},toNumberTo0x:function(A){if(A>255){return"FF"}var C=Math.floor(A/16);var B=A%16;return""+this.paserNum(C)+this.paserNum(B)},paserNum:function(A){switch(A){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F";default:return A+""}},to0x:function(){return"#"+this.toNumberTo0x(this.r)+this.toNumberTo0x(this.g)+this.toNumberTo0x(this.b)},fromHex:function(C){if(C.indexOf("#")!==0){return}while(C.length<7){C=C+"0"}var A=C.substring(1,3);this.r=parseInt(A,16);var D=C.substring(3,5);this.g=parseInt(D,16);var B=C.substring(5,7);this.b=parseInt(B,16)},clone:function(){return new HGIS.Symbolizer.RGBColor(parseInt(this.r+""),parseInt(this.g+""),parseInt(this.b+""),parseFloat(this.a+""))}});HGIS.Symbolizer.Symbol=HGIS.Class({color:new HGIS.Symbolizer.RGBColor(0,0,0,1),type:null,_stroke:null,_fill:null,initialize:function(A){if(A&&typeof(A)=="object"){HGIS.Util.extend(this,A)}},setColor:function(A){this.color=A;return this},toJson:function(){return{color:this.color.toJson()}}});HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.TextSymbol=HGIS.Class(HGIS.Symbolizer.Symbol,{initialize:function(B,A,C){HGIS.Symbolizer.Symbol.prototype.initialize.apply(this,[B,A,C]);if(B){if(typeof(B)==="object"){HGIS.Util.extend(this,B);this.color=new HGIS.Symbolizer.RGBColor(this.color);this.type="textsymbol";this.font=new HGIS.Symbolizer.Font(this.font)}else{this.text=B;if(A){this.font=A}if(C){this.color=C}}}},angle:0,xoffset:0,yoffset:0,div:"",type:"textsymbol",text:null,fontSize:13,fontFamily:"",color:null,placement:"middle",backgroundColor:null,backgroundStyle:"solid",borderLineColor:null,borderLineStyle:"solid",borderLineWidth:0,cursor:"",selected:false,draw:function(){this.text=this.text||"";this.fontSize=parseInt(this.fontSize);this.textSize=HGIS.Util.getTextSize(this.text,this.fontSize,this.fontFamily);var E=100;if(this.fontSize*6>E){E=this.fontSize*6}var F=this.width||((this.textSize.width+6>E)?E:(this.textSize.width+6));var A=this.height||(this.textSize.height+6);var C=-F/2,B=-A/2;if(this.xoffset){C=C+this.xoffset}if(this.yoffset){B=B-this.yoffset}var H=[];H.push('<div style="position:absolute;cursor:'+this.cursor+";");H.push("height:"+A+"px;width:"+F+"px;");H.push("left:"+C+"px;top:"+B+'px;" title="'+this.text+'">');var G=2;H.push('<div style="position:absolute;height:100%;width:100%;');if(this.borderLineWidth&&this.borderLineStyle&&this.borderLineColor){H.push("border:"+this.borderLineWidth+"px "+this.borderLineStyle+" "+this.borderLineColor.to0x()+";top:-"+this.borderLineWidth+"px;left:-"+this.borderLineWidth+"px;");H.push("filter:alpha(opacity="+(this.borderLineColor.a*100)+");opacity:"+this.borderLineColor.a+";");G+=this.borderLineWidth}H.push('"></div>');if(this.selected){H.push('<div style="position:absolute;height:100%;width:100%;');H.push("border: 2px solid #FF64FF;padding:"+G+"px;");var D=G*2-2;H.push("top:-"+D+"px;left:-"+D+'px;"></div>')}H.push('<div style="position:absolute;height:100%;width:100%;');if(this.backgroundColor){H.push("background-color:"+this.backgroundColor.to0x()+";");H.push("filter:alpha(opacity="+(this.backgroundColor.a*100)+");opacity:"+this.backgroundColor.a+";")}H.push('"></div><div style="position:absolute;height:100%;width:100%;');H.push("white-space:nowrap;text-overflow:ellipsis;overflow:hidden;");if(this.color){H.push("color:"+this.color.to0x()+";");H.push("filter:alpha(opacity="+(this.color.a*100)+");opacity:"+this.color.a+";")}if(this.fontFamily){H.push("font-family:'"+this.fontFamily+"';")}if(this.fontSize){H.push("font-size:"+this.fontSize+"px;")}switch(this.placement){case"start":H.push("text-align:left;line-height:"+A+"px;");break;case"end":H.push("text-align:right;line-height:"+A+"px;");break;case"above":H.push("text-align:center;");break;case"below":H.push("text-align:center;bottom:0;");break;default:H.push("text-align:center;line-height:"+A+"px;");break}H.push('">'+this.text+"</div></div>");this.div=H.join("");return this.div},setFont:function(A){this.font=A;return this},setAngle:function(A){this.angle=A;return this},setOffset:function(A,B){this.xoffset=A;this.yoffset=B;return this},setText:function(A){this.text=A;return this},toJson:function(){return{type:"hikTS",backgroundColor:this.backgroundColor!==null?this.backgroundColor.toJson():null,borderLineColor:this.borderLineColor!==null?this.borderLineColor.toJson():null,angle:this.angle,xoffset:this.xoffset,yoffset:this.yoffset,text:this.text,placement:this.placement=="middle"||this.placement=="start"||this.placement=="above"||this.placement=="below"||this.placement=="end"?this.placement:"middle",font:this.font!==null?this.font.toJson():null,color:this.color!==null?this.color.toJson():null}}});HGIS.Util.extend(HGIS.Symbolizer.TextSymbol,{ALIGN_START:"start",ALIGN_MIDDLE:"middle",ALIGN_END:"end",DECORATION_NONE:"none",DECORATION_UNDERLINE:"underline",DECORATION_OVERLINE:"overline",DECORATION_LINETHROUGH:"line-through"});HGIS.Util.getTextSize=function(C,D,B){var A=document.getElementById("text_width_span");if(!A){A=document.createElement("span");document.body.appendChild(A);A.setAttribute("id","text_width_span");A.style.position="absolute";A.style.top="-10000px";A.style.left="-10000px"}A.style.fontSize="13px";A.style.fontFamily="''";if(D){A.style.fontSize=D+"px"}if(B){A.style.fontFamily="'"+B+"'"}A.innerText=C;return{width:A.offsetWidth,height:A.offsetHeight}};HGIS.Symbolizer=HGIS.Symbolizer||{};HGIS.Symbolizer.TextTag=function(A){var B=this;B.poueSuffix="hgis_textTag";B.curtag=null;B.style={fontColor:"#003366",textAlign:"center",fontFamily:"",textDecoration:"none",textDecoration:"normal",fontStyle:"italic"};this.create=function(K,L,J,C,I){if(!I){I=B.style}var E=K+B.poueSuffix;if(this.getTagById(K)){this.remove(this.getTagById(K))}var M=document.createElement("div");var D=document.createElement("textarea");D.id=E+"_text";var F=HGIS.Utils.getExploreType();if(F=="MSIE"){D.value=J}else{D.textContent=J}D.readOnly=C?C:false;var H=I.fontSize?I.fontSize.replace("px","")*1:10;D.cols=Math.min(J.length*1,40)+2;D.rows=Math.floor(J.length/40)+2;D.style.textAlign=I.textAlign?I.textAlign:B.style.textAlign;if(I.height){D.style.height=I.height}if(I.width){D.style.width=I.width}D.style.color=I.fontColor?I.fontColor:B.style.fontColor;D.style.fontSize=H+"px";D.style.fontFamily=I.fontFamily?I.fontFamily:B.style.fontFamily;D.style.textDecoration=I.textDecoration?I.textDecoration:B.style.textDecoration;D.style.fontWeight=I.fontWeight?I.fontWeight:B.style.textDecoration;D.style.fontStyle=I.fontStyle?I.fontStyle:B.style.fontStyle;M.appendChild(D);var G=new HGIS.Popup(E,L,null,M.innerHTML,null,false,null);G.autoSize=true;G.padding=1;G.style=I?I:null;G.tagId=K;B.curtag=G;A.addPopup(G);return G};this.getSelectTag=function(){return B.curtag};B.addTagEvent=function(D,C,E){C.events.register(D,null,function(){E(this)})};B.removeTagListener=function(D,C){C.events.remove(D)};B.removeAllTagsListener=function(D){var E=B.getAllTags();for(var C=0;C<E.length;C=C+1){E[C].events.remove(D)}};this.getTagById=function(F){var C=null;var E=F+B.poueSuffix;for(var D=0;D<A.popups.length;D=D+1){if(A.popups[D].id==E){C=A.popups[D];break}}return C};this.remove=function(C){if(C==B.curtag){C.destroy();B.curtag=null}else{if(C){C.destroy()}}};this.getTagVal=function(C){var D=C.id+"_text";var E=document.getElementById(D);var F=E.value.replace(/[ ]/g,"");return F};this.changeStyleById=function(E,G){var D=E+B.poueSuffix+"_text";var F=document.getElementById(D);if(G&&F){F.style.textAlign=G.textAlign?G.textAlign:"center";F.style.height=G.height?G.height:"30px";F.style.width=G.width?G.width:"80px";F.style.color=G.fontColor?G.fontColor:"#003366";F.style.fontSize=G.fontSize?G.fontSize:"10px";F.style.fontFamily=G.fontFamily?G.fontFamily:"";F.style.textDecoration=G.textDecoration?G.textDecoration:"none ";F.style.fontWeight=G.fontWeight?G.fontWeight:"normal";F.style.fontStyle=G.fontStyle?G.fontStyle:"italic"}var C=this.getTagById(E);C.style=G};this.removeAll=function(){var G=new Array();for(var D=0;D<A.popups.length;D=D+1){var E=new String(A.popups[D].id);var F=E.indexOf(B.poueSuffix);if(F!=-1){var H=E.substr(0,F);G.push(H)}}for(var I=0;I<G.length;I=I+1){var C=this.getTagById(G[I]);this.remove(C)}B.curtag=null};this.setReadOnly=function(H,C){if(!C){for(var D=0;D<A.popups.length;D=D+1){var E=new String(A.popups[D].id);var G=E+"_text";var F=document.getElementById(G);F.readOnly=H}}else{var E=new String(C.id);var G=E+"_text";var F=document.getElementById(G);F.readOnly=H}};this.getStyleByTag=function(C){return C.style};this.getAllTags=function(){var G=new Array();for(var D=0;D<A.popups.length;D=D+1){var E=new String(A.popups[D].id);var F=E.indexOf(B.poueSuffix);if(F!=-1){var C=A.popups[D];G.push(C)}}return G}};var hostUrl=APIAdress.replace("hgis-web","hgis-services");hostUrl=hostUrl.replace("hgis-services/hgisFrontLib","hgis-services");var geomTopologyURL={intersect:hostUrl+"rest/services/geomRelation/intersect",union:hostUrl+"rest/services/geomRelation/union",difference:hostUrl+"rest/services/geomRelation/difference",convexHull:hostUrl+"rest/services/geomRelation/convexHull",buffer:hostUrl+"rest/services/geomRelation/buffer",isContain:hostUrl+"rest/services/geomRelation/isContain",reverseGeometry:hostUrl+"rest/services/geomRelation/reverseGeometry",getArea:hostUrl+"rest/services/geomRelation/getArea"};var geoSearchUrl={fullTextSearch:hostUrl+"rest/services/geoSearch/fullTextSearch",queryFeatureById:hostUrl+"rest/services/fullMapSearch/queryFeatureById",queryCrossRoads:hostUrl+"rest/services/crossRoads/queryCrossRoads"};var mapServerConfigURL={getMapParams:hostUrl+"rest/services/sysConf/getMapParams",saveMapParams:hostUrl+"rest/services/sysConf/saveMapParams",getAgsParams:hostUrl+"rest/services/sysConf/getAgsParams",getOffAgsParams:hostUrl+"rest/services/sysConf/getOffAgsParams",getDefaultMapParams:hostUrl+"rest/services/sysConf/getDefaultMapParams",switchMapParams:hostUrl+"rest/services/sysConf/switchMapParams",initEngine:hostUrl+"rest/services/sysConf/initEngine",getFactorConfig:hostUrl+"rest/services/posCorrect/getFactorConfig",ifExitVtStyleByUrl:hostUrl+"rest/services/VectorTileConf/ifExitVtStyleByUrl",getVTConfigDetailById:hostUrl+"rest/services/VectorTileConf/getVTConfigDetailById"};var routeNetAnlyseURL={shortestPath:hostUrl+"rest/services/RoadPathAnalysis/shortestPath",AStarShortestPathByNodeId:hostUrl+"rest/services/AStarAnalysis/AStarAnalysisByNodeId",AStarShortestPathByXY:hostUrl+"rest/services/AStarAnalysis/AStarAnalysisByXY",nearlyRoadNode:hostUrl+"rest/services/RoadPathAnalysis/nearlyRoadNode"};var roadSignsUrl=hostUrl+"rest/services/roadSigns/queryRoadSigns";var safeProxyURL="/ngx/proxy?i=";var tileCacheProxyURL=hostUrl+"/tileCache/getTile";var IndividualTestURL={cluster1:hostUrl+"rest/services/cluster/testCluster1",cluster2:hostUrl+"rest/services/cluster/testCluster2",heatLayer:hostUrl+"/individual/heatLayer"};function HgisAjax(E){E=E||{};E.data=E.data||{};var A=E.jsonp?B(E):A(E);function B(I){var F=I.jsonp;var G=document.getElementsByTagName("head")[0];I.data["callback"]=F;var J=D(I.data);var H=document.createElement("script");H.type="text/javascript";G.appendChild(H);window[F]=function(K){clearTimeout(H.timer);window[F]=null;I.success&&I.success(K)};H.src=I.url+"?"+J}function D(H){var G=[];for(var F in H){G.push(encodeURIComponent(F)+"="+encodeURIComponent(H[F]))}G.push("v="+C());return G.join("&")}function C(){return Math.floor(Math.random()*10000+500)}}(function(C){var K=C.HGISBase64;var W="2.1.9";var U;if(typeof module!=="undefined"&&module.exports){try{U=require("buffer").Buffer}catch(E){}}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var X=function(d){var b={};for(var Z=0,a=d.length;Z<a;Z++){b[d.charAt(Z)]=Z}return b}(J);var Q=String.fromCharCode;var M=function(a){if(a.length<2){var Z=a.charCodeAt(0);return Z<128?a:Z<2048?(Q(192|(Z>>>6))+Q(128|(Z&63))):(Q(224|((Z>>>12)&15))+Q(128|((Z>>>6)&63))+Q(128|(Z&63)))}else{var Z=65536+(a.charCodeAt(0)-55296)*1024+(a.charCodeAt(1)-56320);return(Q(240|((Z>>>18)&7))+Q(128|((Z>>>12)&63))+Q(128|((Z>>>6)&63))+Q(128|(Z&63)))}};var R=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var A=function(Z){return Z.replace(R,M)};var I=function(a){var d=[0,2,1][a.length%3],Z=a.charCodeAt(0)<<16|((a.length>1?a.charCodeAt(1):0)<<8)|((a.length>2?a.charCodeAt(2):0)),b=[J.charAt(Z>>>18),J.charAt((Z>>>12)&63),d>=2?"=":J.charAt((Z>>>6)&63),d>=1?"=":J.charAt(Z&63)];return b.join("")};var D=C.btoa?function(Z){return C.btoa(Z)}:function(Z){return Z.replace(/[\s\S]{1,3}/g,I)};var N=U?function(Z){return(Z.constructor===U.constructor?Z:new U(Z)).toString("base64")}:function(Z){return D(A(Z))};var Y=function(Z,a){return !a?N(String(Z)):N(String(Z)).replace(/[+\/]/g,function(b){return b=="+"?"-":"_"}).replace(/=/g,"")};var P=function(Z){return Y(Z,true)};var V=new RegExp(["[\xC0-\xDF][\x80-\xBF]","[\xE0-\xEF][\x80-\xBF]{2}","[\xF0-\xF7][\x80-\xBF]{3}"].join("|"),"g");var S=function(Z){switch(Z.length){case 4:var b=((7&Z.charCodeAt(0))<<18)|((63&Z.charCodeAt(1))<<12)|((63&Z.charCodeAt(2))<<6)|(63&Z.charCodeAt(3)),a=b-65536;return(Q((a>>>10)+55296)+Q((a&1023)+56320));case 3:return Q(((15&Z.charCodeAt(0))<<12)|((63&Z.charCodeAt(1))<<6)|(63&Z.charCodeAt(2)));default:return Q(((31&Z.charCodeAt(0))<<6)|(63&Z.charCodeAt(1)))}};var H=function(Z){return Z.replace(V,S)};var B=function(Z){var b=Z.length,e=b%4,a=(b>0?X[Z.charAt(0)]<<18:0)|(b>1?X[Z.charAt(1)]<<12:0)|(b>2?X[Z.charAt(2)]<<6:0)|(b>3?X[Z.charAt(3)]:0),d=[Q(a>>>16),Q((a>>>8)&255),Q(a&255)];d.length-=[0,0,2,1][e];return d.join("")};var O=C.atob?function(Z){return C.atob(Z)}:function(Z){return Z.replace(/[\s\S]{1,4}/g,B)};var T=U?function(Z){return(Z.constructor===U.constructor?Z:new U(Z,"base64")).toString()}:function(Z){return H(O(Z))};var G=function(Z){return T(String(Z).replace(/[-_]/g,function(a){return a=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};var F=function(){var Z=C.HGISBase64;C.HGISBase64=K;return Z};C.HGISBase64={VERSION:W,atob:O,btoa:D,fromBase64:G,toBase64:Y,utob:A,encode:Y,encodeURI:P,btou:H,decode:G,noConflict:F};if(typeof Object.defineProperty==="function"){var L=function(Z){return{value:Z,enumerable:false,writable:true,configurable:true}};C.HGISBase64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",L(function(){return G(this)}));Object.defineProperty(String.prototype,"toBase64",L(function(Z){return Y(this,Z)}));Object.defineProperty(String.prototype,"toBase64URI",L(function(){return Y(this,true)}))}}if(C["Meteor"]){HGISBase64=C.HGISBase64}})(this);HGIS.utils=HGIS.utils||{};HGIS.utils.FeatureUtil=HGIS.utils.FeatureUtil||{};HGIS.utils.FeatureUtil.data=[{"layerType":"line","type":"DISTRICT_LN","label":"","featureTypes":[{"label":"","name":"CITY_LN","minLevel":9,"maxLevel":19},{"label":"","name":"COUNTY_LN","minLevel":10,"maxLevel":19},{"label":"","name":"TOWN_LN","minLevel":12,"maxLevel":19}]},{"layerType":"polygon","type":"WATER","label":"","featureTypes":[{"label":"","name":"WATER","minLevel":0,"maxLevel":20,"featureList":["HYDSIDE_AREA_PG","LAKES_PG","HYDSIDE_A_PG","HYDSIDE_B_PG","HYDSIDE_C_PG","HYDSIDE_D_PG","HYDSIDE_E_PG"]}]},{"layerType":"polygon","type":"VEGETATION","label":"","featureTypes":[{"label":"","name":"VEGETATION","minLevel":7,"maxLevel":20,"featureList":["VEGETATION_A_PG","VEGETATION_B_PG"]}]},{"layerType":"polygon","type":"AREA","label":"","featureTypes":[{"label":"","name":"RESAREA_PG","minLevel":15,"maxLevel":19},{"label":"","name":"SIGHT_PG","minLevel":14,"maxLevel":19},{"label":"","name":"HOSPITAL_PG","minLevel":15,"maxLevel":19},{"label":"","name":"METROSTATION_PG","minLevel":15,"maxLevel":19},{"label":"","name":"TRAFFIC_HUB_PG","minLevel":15,"maxLevel":19},{"label":"","name":"SCHOOL_UNIVERSITY_PG","minLevel":15,"maxLevel":19}]},{"layerType":"line","type":"ROAD","label":"","featureTypes":[{"label":"","name":"QITADAOLU","minLevel":16,"maxLevel":20},{"label":"","name":"XIANGZHENCUNDAO","minLevel":11,"maxLevel":20},{"label":"","name":"XIANDAO","minLevel":10,"maxLevel":20},{"label":"","name":"SUBWAY_LN","minLevel":13,"maxLevel":20},{"label":"","name":"RAILWAY_LN","minLevel":9,"maxLevel":20,"featureList":["RAILWAY_A_LN","RAILWAY_B_LN"]},{"label":"","name":"SHENGDAO","minLevel":11,"maxLevel":20},{"label":"","name":"GUODAO","minLevel":13,"maxLevel":20},{"label":"","name":"GAOSU","minLevel":5,"maxLevel":20}]},{"layerType":"point","type":"KEYPOI","label":"","featureTypes":[{"label":"","name":"INDUSTRIAL_PT","minLevel":19,"maxLevel":20},{"label":"","name":"SECURITIES_PT","minLevel":19,"maxLevel":20},{"label":"","name":"WHARF_PT","minLevel":14,"maxLevel":20,"featureList":["WHARF_A_PT","WHARF_B_PT","WHARF_C_PT"]},{"label":"","name":"FARMERS_PT","minLevel":17,"maxLevel":20},{"label":"","name":"CAR_MAINTENANCE_PT","minLevel":17,"maxLevel":20},{"label":"","name":"CAR_SECONDE_PT","minLevel":17,"maxLevel":20},{"label":"","name":"ENTRANCE_PT","minLevel":15,"maxLevel":20},{"label":"","name":"CARSERVICE_PT","minLevel":15,"maxLevel":20},{"label":"","name":"SUPERMARKET_PT","minLevel":15,"maxLevel":20},{"label":"","name":"PARK_PT","minLevel":11,"maxLevel":20,"featureList":["PARK_A_PT","PARK_B_PT","PARK_C_PT"]},{"label":"","name":"MUSEUM_A_PT","minLevel":15,"maxLevel":20},{"label":"","name":"MOUNTAIN_PT","minLevel":13,"maxLevel":20},{"label":"B","name":"SIGHT_B_PT","minLevel":14,"maxLevel":20},{"label":"A","name":"SIGHT_A_PT","minLevel":12,"maxLevel":20},{"label":"","name":"HOTEL_A_PT","minLevel":13,"maxLevel":20},{"label":"","name":"HOTEL_B_PT","minLevel":17,"maxLevel":20},{"label":"","name":"HOTEL_C_PT","minLevel":17,"maxLevel":20},{"label":"","name":"BANK_PT","minLevel":15,"maxLevel":20},{"label":"","name":"HOSPITAL_B_PT","minLevel":17,"maxLevel":20},{"label":"","name":"HOSPITAL_A_PT","minLevel":13,"maxLevel":20},{"label":"","name":"SCHOOL_UNIVERSITY_A_PT","minLevel":11,"maxLevel":20},{"label":"","name":"EXHCENTER_PT","minLevel":14,"maxLevel":20},{"label":"","name":"OIL_PT","minLevel":15,"maxLevel":20},{"label":"","name":"CARSTATION_PT","minLevel":12,"maxLevel":20},{"label":"","name":"BUSINESS_PT","minLevel":15,"maxLevel":20},{"label":"","name":"TOLL_PT","minLevel":15,"maxLevel":20},{"label":"","name":"GARDEN_PT","minLevel":15,"maxLevel":20},{"label":"","name":"LIBRARY_PT","minLevel":15,"maxLevel":20},{"label":"","name":"POST_PT","minLevel":15,"maxLevel":20},{"label":"","name":"STORES_A_PT","minLevel":13,"maxLevel":20},{"label":"","name":"SQUARE_PT","minLevel":14,"maxLevel":20},{"label":"","name":"BRIDGE_B_PT","minLevel":17,"maxLevel":20},{"label":"","name":"BRIDGE_A_PT","minLevel":17,"maxLevel":20},{"label":"","name":"BUILDING_PT","minLevel":13,"maxLevel":20},{"label":"","name":"HIGH_SPEED_PT","minLevel":15,"maxLevel":20},{"label":"","name":"POLICE_PT","minLevel":14,"maxLevel":20},{"label":"","name":"TRASTATION_PT","minLevel":11,"maxLevel":20,"featureList":["TRASTATION_A_PT","TRASTATION_B_PT"]},{"label":"","name":"AIRPORT_PT","minLevel":10,"maxLevel":20},{"label":"","name":"TOWN_PT","minLevel":10,"maxLevel":20,"featureList":["TOWN_A_PT","TOWN_B_PT","TOWN_C_PT"]},{"label":"","name":"DISTRICT_A_PT","minLevel":9,"maxLevel":20}]},{"layerType":"point","type":"OTHERPOI","label":"","featureTypes":[{"label":"","name":"SECURITIES_PT","minLevel":19,"maxLevel":20},{"label":"","name":"OTHER_PT","minLevel":19,"maxLevel":20},{"label":"","name":"TEA_PT","minLevel":19,"maxLevel":20},{"label":"","name":"HOME_IMPROVEMENT_PT","minLevel":17,"maxLevel":20},{"label":"","name":"HANDICRAFT_PT","minLevel":19,"maxLevel":20},{"label":"","name":"INSURANCE_PT","minLevel":19,"maxLevel":20},{"label":"","name":"MOTORWAY_SERVICE_PT","minLevel":19,"maxLevel":20},{"label":"","name":"LOGISTICS_PT","minLevel":17,"maxLevel":20,"featureList":["LOGISTICS_A_PT","LOGISTICS_B_PT","LOGISTICS_C_PT"]},{"label":"","name":"BICYCLE_PT","minLevel":17,"maxLevel":20},{"label":"","name":"SPORTS_PT","minLevel":17,"maxLevel":20},{"label":"","name":"TV_STATION_PT","minLevel":17,"maxLevel":20},{"label":"","name":"TRAVEL_PT","minLevel":19,"maxLevel":20},{"label":"","name":"TRAINING_PT","minLevel":17,"maxLevel":20},{"label":"","name":"TICKET_PT","minLevel":19,"maxLevel":20},{"label":"","name":"VIDEO_PT","minLevel":17,"maxLevel":20},{"label":"","name":"VEHICLE_DETECTION_PT","minLevel":17,"maxLevel":20},{"label":"","name":"CULTURAL_PT","minLevel":17,"maxLevel":20},{"label":"","name":"COSMETICS_PT","minLevel":17,"maxLevel":20},{"label":"","name":"FLOWERS_PT","minLevel":17,"maxLevel":20},{"label":"","name":"CLOTHING_PT","minLevel":17,"maxLevel":20},{"label":"","name":"COMPUTER_PT","minLevel":17,"maxLevel":20},{"label":"","name":"LOTTERYSTATION_PT","minLevel":17,"maxLevel":20},{"label":"","name":"ASSOCIATION_PT","minLevel":17,"maxLevel":20},{"label":"","name":"BABY_PT","minLevel":17,"maxLevel":20},{"label":"","name":"ANTIQUE_PT","minLevel":17,"maxLevel":20},{"label":"","name":"BARBER_PT","minLevel":17,"maxLevel":20},{"label":"","name":"COMPANY_PT","minLevel":16,"maxLevel":20},{"label":"","name":"WC_PT","minLevel":18,"maxLevel":20},{"label":"","name":"CARPARK_PT","minLevel":18,"maxLevel":20},{"label":"","name":"CONVENIENCE_PT","minLevel":18,"maxLevel":20},{"label":"ATM","name":"ATM_PT","minLevel":17,"maxLevel":20},{"label":"","name":"COMMUNITY_HOSPITAL_PT","minLevel":17,"maxLevel":20},{"label":"","name":"DENTAL_PT","minLevel":17,"maxLevel":20},{"label":"","name":"EPIDEMIC_PT","minLevel":17,"maxLevel":20},{"label":"","name":"PILL_PT","minLevel":17,"maxLevel":20},{"label":"","name":"LIGHT_PT","minLevel":17,"maxLevel":20},{"label":"","name":"PET_HOSPITAL_PT","minLevel":17,"maxLevel":20},{"label":"","name":"PET_PT","minLevel":17,"maxLevel":20},{"label":"","name":"PAPER_PT","minLevel":17,"maxLevel":20},{"label":"","name":"CAR_RENTAL_PT","minLevel":17,"maxLevel":20},{"label":"","name":"SCIENTIFIC_PT","minLevel":17,"maxLevel":20},{"label":"","name":"COMMODITY_PT","minLevel":17,"maxLevel":20},{"label":"KTV","name":"KTV_PT","minLevel":15,"maxLevel":20},{"label":"","name":"FOOD_FAST_PT","minLevel":18,"maxLevel":20},{"label":"","name":"COFFEE_PT","minLevel":15,"maxLevel":20},{"label":"","name":"FOOD_WEST_PT","minLevel":15,"maxLevel":20},{"label":"","name":"FOOD_BAR_PT","minLevel":15,"maxLevel":20},{"label":"","name":"FOOD_CHINA_PT","minLevel":15,"maxLevel":20},{"label":"","name":"MOBILE_PT","minLevel":15,"maxLevel":20},{"label":"","name":"VILLAGE_COMMITTEE_PT","minLevel":19,"maxLevel":20},{"label":"","name":"COUNTY_PT","minLevel":14,"maxLevel":20},{"label":"","name":"ZOO_PT","minLevel":12,"maxLevel":20},{"label":"","name":"MUSEUM_B_PT","minLevel":15,"maxLevel":20},{"label":"","name":"MUSEUM_A_PT","minLevel":15,"maxLevel":20},{"label":"","name":"MALL_PT","minLevel":15,"maxLevel":20,"featureList":["Mall_A_pt","Mall_B_pt"]}]}];HGIS.utils.FeatureUtil.options={};HGIS.utils.FeatureUtil.Types=null;HGIS.utils.FeatureUtil.getFeatureType=function(B){if(HGIS.utils.FeatureUtil.Types==null){HGIS.utils.FeatureUtil.Types={};var A=HGIS.utils.FeatureUtil.data.length;for(var F=0;F<A;F++){var H=HGIS.utils.FeatureUtil.data[F].featureTypes.length;for(var C=0;C<H;C++){var E=HGIS.utils.FeatureUtil.data[F].featureTypes[C];var G="";if(HGIS.utils.FeatureUtil.data[F].featureTypes[C].hasOwnProperty("featureList")){var I=HGIS.utils.FeatureUtil.data[F].featureTypes[C]["featureList"].length;for(var D=0;D<I;D++){G=HGIS.utils.FeatureUtil.data[F].featureTypes[C]["featureList"][D];HGIS.utils.FeatureUtil.Types[G]=E}}else{G=HGIS.utils.FeatureUtil.data[F].featureTypes[C]["name"];HGIS.utils.FeatureUtil.Types[G]=E}}}}return HGIS.utils.FeatureUtil.Types[B]};HGIS.utils.FeatureUtil.getsubTypes=function(G){var A=[];var F=HGIS.utils.FeatureUtil.data.length;for(var D=0;D<F;D++){if(HGIS.utils.FeatureUtil.data[D].type==G){var H=HGIS.utils.FeatureUtil.data[D].featureTypes.length;for(var B=0;B<H;B++){var C=HGIS.utils.FeatureUtil.data[D].featureTypes[B];var E="";if(HGIS.utils.FeatureUtil.data[D].featureTypes[B].hasOwnProperty("featureList")){A=HGIS.utils.FeatureUtil.data[D].featureTypes[B]["featureList"];return A}}}else{var H=HGIS.utils.FeatureUtil.data[D].featureTypes.length;for(var B=0;B<H;B++){var C=HGIS.utils.FeatureUtil.data[D].featureTypes[B];var E="";if(C.name==G&&C.hasOwnProperty("featureList")){A=HGIS.utils.FeatureUtil.data[D].featureTypes[B]["featureList"];return A}}}}return A};HGIS.utils.FeatureUtil.getLayerTypeByFeatureType=function(B){var C="polygon";var D=HGIS.utils.FeatureUtil.data.length;for(var A=0;A<D;A++){var F=HGIS.utils.FeatureUtil.data[A].featureTypes.length;for(var G=0;G<F;G++){var E=HGIS.utils.FeatureUtil.data[A].featureTypes[G];if(HGIS.utils.FeatureUtil.data[A].featureTypes[G]["name"]==B){C=HGIS.utils.FeatureUtil.data[A].layerType;break}}}return C};HGIS.utils.FeatureUtil.pickFeatureType=function(L,M,G,F){var C=[];var H=[];var B=HGIS.utils.FeatureUtil.pickFeatures(L,M,G,F);for(var I=0;I<B.length;I++){var A=B[I][0].attributes.subType;var D=false;for(var J in C){if(C[J]==A){D=true}}if(!D){C.push(A)}}for(var E=0;E<C.length;E++){var K=HGIS.utils.FeatureUtil.getFeatureType(C[E]);if(K==undefined){continue}H.push(K)}return H};HGIS.utils.FeatureUtil.pickFeatures=function(R,L,Y,N){var C=new Array();var H=new Array();var Q=R.getLonLatFromViewPortPx({"x":L,"y":Y});var J=Math.floor((Q.lon-HGIS.InitParam.tileOrigin.lon)/(R.resolution*256));var A=Math.floor((HGIS.InitParam.tileOrigin.lat-Q.lat)/(R.resolution*256));var B=A+"-"+J;var T=J*(R.resolution*256)+HGIS.InitParam.tileOrigin.lon;var K=HGIS.InitParam.tileOrigin.lat-A*(R.resolution*256);var U=Math.floor((Q.lon-T)/(R.resolution*HGIS.Matrix.cellSize));var E=Math.floor((K-Q.lat)/(R.resolution*HGIS.Matrix.cellSize));var W=HGIS.utils.FeatureUtil.options.layer.renderer.features;var O=Object.keys(W);O=O.sort();for(var F=O.length-1;F>=0;F--){if(typeof(W[O[F]][0].attributes.hashcode)!="undefined"){if(W[O[F]][0].origin==B){if(N.indexOf(W[O[F]][0].type)>=0){if(W[O[F]][0].attributes.hashcode[E][U]==1){C.push(W[O[F]])}var I,M,X,D,P,V,G,S;if(E>0&&U>0){I=W[O[F]][0].attributes.hashcode[E-1][U-1]}if(E>0){M=W[O[F]][0].attributes.hashcode[E-1][U]}if(E>0&&U<HGIS.Matrix.size){X=W[O[F]][0].attributes.hashcode[E-1][U+1]}if(U>0){D=W[O[F]][0].attributes.hashcode[E][U-1]}if(U<HGIS.Matrix.size){P=W[O[F]][0].attributes.hashcode[E][U+1]}if(E<HGIS.Matrix.size&&U>0){V=W[O[F]][0].attributes.hashcode[E+1][U-1]}G=W[O[F]][0].attributes.hashcode[E+1][U];if(E<HGIS.Matrix.size&&U<HGIS.Matrix.size){S=W[O[F]][0].attributes.hashcode[E+1][U+1]}if(I==1||M==1||X==1||D==1||P==1||V==1||G==1||S==1){H.push(W[O[F]])}}}}}return C.length<1?H:C};HGIS.utils.FeatureUtil.pickPOIs=function(P,K,V){var C=new Array();var G=new Array();var O=P.getLonLatFromViewPortPx({"x":K,"y":V});var I=Math.floor((O.lon-HGIS.InitParam.tileOrigin.lon)/(P.resolution*256));var A=Math.floor((HGIS.InitParam.tileOrigin.lat-O.lat)/(P.resolution*256));var B=A+"-"+I;var R=I*(P.resolution*256)+HGIS.InitParam.tileOrigin.lon;var J=HGIS.InitParam.tileOrigin.lat-A*(P.resolution*256);var S=Math.floor((O.lon-R)/(P.resolution*HGIS.Matrix.cellSize));var E=Math.floor((J-O.lat)/(P.resolution*HGIS.Matrix.cellSize));var T=HGIS.utils.FeatureUtil.options.layer.renderer.features;for(item in T){if(typeof(T[item][0].attributes.hashcode)!="undefined"){if(T[item][0].origin==B){if(T[item][0].attributes.superType=="POI"){if(T[item][0].attributes.hashcode[E][S]==1){C.push(T[item])}var H,L,U,D,N,M,F,Q;if(E>0&&S>0){H=T[item][0].attributes.hashcode[E-1][S-1]}if(E>0){L=T[item][0].attributes.hashcode[E-1][S]}if(E>0&&S<HGIS.Matrix.size){U=T[item][0].attributes.hashcode[E-1][S+1]}if(S>0){D=T[item][0].attributes.hashcode[E][S-1]}if(S<HGIS.Matrix.size){N=T[item][0].attributes.hashcode[E][S+1]}if(E<HGIS.Matrix.size&&S>0){M=T[item][0].attributes.hashcode[E+1][S-1]}F=T[item][0].attributes.hashcode[E+1][S];if(E<HGIS.Matrix.size&&S<HGIS.Matrix.size){Q=T[item][0].attributes.hashcode[E+1][S+1]}if(H==1||L==1||U==1||D==1||N==1||M==1||F==1||Q==1){G.push(T[item])}}}}}return C.length<1?G:C};HGIS.utils.FeatureUtil.loadLayerTreeData=function(B,A){if(!B){B=APIAdress+"../../hgis-services/WEB-INF/classes/vtconfigs/LayerTree.json"}var C=new XMLHttpRequest();if(C==null){alert(HGIS.language[HGIS.InitParam.language]["brows_noSupport_AJAX"])}C.open("GET",B);C.setRequestHeader("Content-type","application/json; charset=utf-8");C.send();C.onreadystatechange=function(){if(C.readyState==1||C.readyState==2||C.readyState==3){HGIS.utils.FeatureUtil.data=null}if(C.readyState==4&&C.status==200){var E=C.responseText;var D=JSON.parse(E);HGIS.utils.FeatureUtil.data=D.data.configDetail;A(HGIS.utils.FeatureUtil.data)}}};HGIS.utils=HGIS.utils||{};HGIS.utils.MapStyleJSON=HGIS.utils.MapStyleJSON||{};HGIS.utils.MapStyleJSON.data={"rules":[{"featureType":"LAND","filter":{"type":"==","property":"subType","value":"LAND"},"styles":[{"minLevel":0,"maxLevel":20,"symbolizer":{"fillColor":"#F9F9F9","fillOpacity":1,"display":"block"}}]},{"featureType":"CITY_PG","filter":{"type":"==","property":"subType","value":"CITY_PG"},"styles":[{"minLevel":9,"maxLevel":18,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(252,245,223)","fillColor":"#F9F9F9","label":"${name}","fontColor":"#FEFEFE","labelOutlineWidth":0,"labelBackgroundColor":"rgb(140,188,240)","display":"block"}}]},{"featureType":"COUNTY_PG","filter":{"type":"==","property":"subType","value":"COUNTY_PG"},"styles":[{"minLevel":0,"maxLevel":0,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(252,245,223)","fillColor":"#F9F9F9","label":"${name}","fontColor":"#FEFEFE","labelOutlineWidth":0,"labelBackgroundColor":"rgb(140,188,240)","display":"block"}}]},{"featureType":"TOWN_PG","filter":{"type":"==","property":"subType","value":"TOWN_PG"},"styles":[{"minLevel":0,"maxLevel":0,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(252,245,223)","fillColor":"#F9F9F9","label":"${name}","display":"block"}}]},{"featureType":"VEGETATION","filter":{"type":"~","property":"subType","value":"VEGETATION"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"name":"vegetation","strokeWidth":0,"strokeColor":"rgb(198,222,191)","fillColor":"rgb(198,222,191)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"WATER","filter":{"type":"~","property":"subType","value":"HYDSIDE"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"strokeWidth":0,"fillColor":"rgb(168,206,228)","fillOpacity":1,"label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"WATER","filter":{"type":"==","property":"subType","value":"LAKES_PG"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"strokeWidth":0,"fillColor":"rgb(168,206,228)","fillOpacity":1,"label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"RESAREA_PG","filter":{"type":"==","property":"subType","value":"RESAREA_PG"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(252,245,223)","fillColor":"#ECEAE4","label":"${name}","fontSize":"7px","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"SIGHT_PG","filter":{"type":"==","property":"subType","value":"SIGHT_PG"},"styles":[{"minLevel":14,"maxLevel":20,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(198,222,191)","fillColor":"rgb(198,222,191)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"HOSPITAL_PG","filter":{"type":"==","property":"subType","value":"HOSPITAL_PG"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(198,222,191)","fillColor":"rgb(225,22,11)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"METROSTATION_PG","filter":{"type":"==","property":"subType","value":"MATROSTATION_PG"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(240,176,168)","fillColor":"rgb(240,176,168)","fillOpacity":0.4,"label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"TRAFFIC_HUB_PG","filter":{"type":"==","property":"subType","value":"TRAFFIC_HUB_PG"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(198,222,191)","fillColor":"rgb(225,22,11)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":0,"display":"block"}}]},{"featureType":"SCHOOL_UNIVERSITY_PG","filter":{"type":"==","property":"subType","value":"SCHOOL_UNIVERSITY_PG"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"strokeWidth":0,"strokeColor":"rgb(198,222,191)","fillColor":"rgb(225,22,11)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"CITY_LN","filter":{"type":"==","property":"subType","value":"CITY_LN"},"styles":[{"minLevel":9,"maxLevel":18,"symbolizer":{"strokeWidth":1,"strokeColor":"#8C8C8A","strokeDashstyle":"dash","display":"block"}}]},{"featureType":"COUNTY_LN","filter":{"type":"==","property":"subType","value":"COUNTY_LN"},"styles":[{"minLevel":9,"maxLevel":13,"symbolizer":{"strokeWidth":2,"strokeColor":"#8C8C8A","strokeDashstyle":"dash","display":"block"}}]},{"featureType":"TOWN_LN","filter":{"type":"==","property":"subType","value":"TOWN_ln"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"strokeWidth":1,"strokeColor":"rgb(255,0,0)","strokeDashstyle":"dash","display":"block"}}]},{"featureType":"RAILWAY_LN","filter":{"type":"~","property":"subType","value":"RAILWAY"},"styles":[{"minLevel":9,"maxLevel":20,"symbolizer":{"strokeWidth":2,"strokeColor":"rgb(252,249,249)","strokeDashstyle":"dash","outlineWidth":3,"outlineColor":"rgb(220,220,220)","outlineDashstyle":"solid","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"QITADAOLU","filter":{"type":"==","property":"subType","value":"QITADAOLU"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"name":"kind08-0b","strokeWidth":2,"strokeColor":"rgb(252,249,249)","outlineWidth":3,"outlineColor":"rgb(220,220,220)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"XIANGZHENCUNDAO","filter":{"type":"==","property":"subType","value":"XIANGZHENCUNDAO"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"name":"kind06","strokeWidth":3,"strokeColor":"rgb(252,249,249)","outlineWidth":5,"outlineColor":"rgb(200,200,200)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"XIANDAO","filter":{"type":"==","property":"subType","value":"XIANDAO"},"styles":[{"minLevel":14,"maxLevel":20,"symbolizer":{"name":"kind04","strokeWidth":3,"strokeColor":"rgb(252,245,223)","outlineWidth":5,"outlineColor":"rgb(249,216,174)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"SHENGDAO","filter":{"type":"==","property":"subType","value":"SHENGDAO"},"styles":[{"minLevel":11,"maxLevel":20,"symbolizer":{"name":"kind03","strokeWidth":4,"strokeColor":"rgb(252,245,223)","outlineWidth":6,"outlineColor":"rgb(250,228,181)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"GUODAO","filter":{"type":"==","property":"subType","value":"GUODAO"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"strokeWidth":4,"strokeColor":"rgb(252,245,223)","outlineWidth":6,"outlineColor":"rgb(249,223,169)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"GAOSU","filter":{"type":"==","property":"subType","value":"GAOSU"},"styles":[{"minLevel":6,"maxLevel":20,"symbolizer":{"strokeWidth":2,"strokeColor":"rgb(252,224,156)","outlineWidth":4,"outlineColor":"rgb(239,197,117)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}},{"minLevel":11,"maxLevel":20,"symbolizer":{"strokeWidth":5,"strokeColor":"rgb(252,224,156)","outlineWidth":7,"outlineColor":"rgb(239,197,117)","label":"${name}","fontColor":"#737063","labelOutlineColor":"#FDFCF6","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"SUBWAY_LN","filter":{"type":"==","property":"subType","value":"SUBWAY_LN"},"styles":[{"minLevel":6,"maxLevel":20,"symbolizer":{"strokeWidth":1,"strokeColor":"rgb(255,130,117)","outlineWidth":2,"outlineColor":"rgb(249,249,249)","label":"${name}","fontColor":"rgb(255,130,117)","labelOutlineColor":"rgb(249,249,249)","labelOutlineWidth":1,"display":"block"}}]},{"featureType":"BANK_PT","filter":{"type":"==","property":"subType","value":"BANK_PT"},"styles":[{"minLevel":14,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61464;","strokeColor":"rgb(162,143,141)","backgroundGraphic":"&#57346","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(129,104,104)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CARPARK_PT","filter":{"type":"==","property":"subType","value":"CARPARK_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61456;","strokeColor":"rgb(154,177,198)","backgroundGraphic":"&#57346","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(35,117,209)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"bold","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(35,117,209)","labelAlign":"cb","display":"block"}}]},{"featureType":"DISTRICT_A_PT","filter":{"type":"==","property":"subType","value":"DISTRICT_A_PT"},"styles":[{"minLevel":8,"maxLevel":20,"symbolizer":{"externalGraphic":"","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","fillColor":"rgb(241,235,235)","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontColor":"#FFFFFF","labelOutlineWidth":1,"labelBackgroundColor":"#8CBCF0","labelAlign":"cb","display":"block"}}]},{"featureType":"CHINA_PROCENCITY_PT","filter":{"type":"==","property":"subType","value":"CHINA_PROCENCITY_PT"},"styles":[{"minLevel":7,"maxLevel":12,"symbolizer":{"externalGraphic":"&#39","strokeColor":"rgb(224,0,0)","backgroundGraphic":"&#39","backgroundFillColor":"rgb(229,219,217)","outerStrokeColor":"rgb(224,0,0)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CHINA_PRECENCITY_A_PT","filter":{"type":"==","property":"subType","value":"CHINA_PRECENCITY_A_PT"},"styles":[{"minLevel":8,"maxLevel":12,"symbolizer":{"externalGraphic":"&#77","strokeColor":"rgb(149,92,26)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CHINA_PRECENCITY_B_PT","filter":{"type":"==","property":"subType","value":"CHINA_PRECENCITY_B_PT"},"styles":[{"minLevel":10,"maxLevel":12,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","fillColor":"rgb(241,235,235)","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CHINA_PRECENCITY_C_PT","filter":{"type":"==","property":"subType","value":"CHINA_PRECENCITY_C_PT"},"styles":[{"minLevel":11,"maxLevel":12,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","fillColor":"rgb(241,235,235)","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SUBSTATION_PT","filter":{"type":"==","property":"subType","value":"SUBSTATION_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61493","strokeColor":"rgb(255,0,0)","backgroundGraphic":"&#57353","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(255,0,0)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"METROSTATION_PT","filter":{"type":"==","property":"subType","value":"METROSTATION_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#198","strokeColor":"rgb(254,233,121)","backgroundGraphic":"&#198","backgroundFillColor":"rgb(254,233,121)","outerStrokeColor":"rgb(0,0,0)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CHANGESTATION_PT","filter":{"type":"==","property":"subType","value":"CHANGESTATION_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61492","strokeColor":"rgb(255,255,255)","backgroundGraphic":"&#57352","backgroundFillColor":"rgb(255,0,0)","outerStrokeColor":"rgb(255,0,0)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"OTHER_PT","filter":{"type":"==","property":"subType","value":"OTHER_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SECURITIES_PT","filter":{"type":"==","property":"subType","value":"SECURITIES_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TEA_PT","filter":{"type":"==","property":"subType","value":"TEA_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HOME_IMPROVEMENT_PT","filter":{"type":"==","property":"subType","value":"HOME_IMPROVEMENT_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HANDICRAFT_PT","filter":{"type":"==","property":"subType","value":"HANDICRAFT_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"INSURANCE_PT","filter":{"type":"==","property":"subType","value":"INSURANCE_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"INDUSTRIAL_PT","filter":{"type":"==","property":"subType","value":"INDUSTRIAL_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MOTORWAY_SERVICE_PT","filter":{"type":"==","property":"subType","value":"MOTORWAY_SERVICE_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"LOGISTICS_PT","filter":{"type":"==","property":"subType","value":"LOGISTICS_C_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"LOGISTICS_PT","filter":{"type":"==","property":"subType","value":"LOGISTICS_B_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"LOGISTICS_PT","filter":{"type":"==","property":"subType","value":"LOGISTICS_A_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BICYCLE_PT","filter":{"type":"==","property":"subType","value":"BICYCLE_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"VILLAGE_COMMITTEE_PT","filter":{"type":"==","property":"subType","value":"VILLAGE_COMMITTEE_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SPORTS_PT","filter":{"type":"==","property":"subType","value":"SPORTS_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TV_STATION_PT","filter":{"type":"==","property":"subType","value":"TV_STATION_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TRAVEL_PT","filter":{"type":"==","property":"subType","value":"TRAVEL_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TRAINING_PT","filter":{"type":"==","property":"subType","value":"TRAINING_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TICKET_PT","filter":{"type":"==","property":"subType","value":"TICKET_PT"},"styles":[{"minLevel":19,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"VIDEO_PT","filter":{"type":"==","property":"subType","value":"VIDEO_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"VEHICLE_DETECTION_PT","filter":{"type":"==","property":"subType","value":"VEHICLE_DETECTION_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CULTURAL_PT","filter":{"type":"==","property":"subType","value":"CULTURAL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COSMETICS_PT","filter":{"type":"==","property":"subType","value":"COSMETICS_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CLOTHING_PT","filter":{"type":"==","property":"subType","value":"CLOTHING_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"OTHER_RENTAL_PT","filter":{"type":"==","property":"subType","value":"OTHER_RENTAL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COMPUTER_PT","filter":{"type":"==","property":"subType","value":"COMPUTER_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"FLOWERS_PT","filter":{"type":"==","property":"subType","value":"FLOWERS_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"FARMERS_PT","filter":{"type":"==","property":"subType","value":"FARMERS_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"LOTTERYSTATION_PT","filter":{"type":"==","property":"subType","value":"LOTTERYSTATION_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"ASSOCIATION_PT","filter":{"type":"==","property":"subType","value":"ASSOCIATION_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BABY_PT","filter":{"type":"==","property":"subType","value":"BABY_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"ANTIQUE_PT","filter":{"type":"==","property":"subType","value":"ANTIQUE_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BARBER_PT","filter":{"type":"==","property":"subType","value":"BARBER_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COMPANY_PT","filter":{"type":"==","property":"subType","value":"COMPANY_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"FOOD_FAST_PT","filter":{"type":"==","property":"subType","value":"FOOD_FAST_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","fillColor":"rgb(241,235,235)","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"WC_PT","filter":{"type":"==","property":"subType","value":"WC_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61489","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CONVENIENCE_PT","filter":{"type":"==","property":"subType","value":"CONVENIENCE_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61442","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(164,151,193)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"RETAIL_PT","filter":{"type":"==","property":"subType","value":"RETAIL_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61442","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(164,151,193)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"ATM_PT","filter":{"type":"==","property":"subType","value":"ATM_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61463","strokeColor":"rgb(129,104,104)","backgroundGraphic":"&#57350","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CAR_MAINTENANCE_PT","filter":{"type":"==","property":"subType","value":"CAR_MAINTENANCE_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61448","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COMMUNITY_HOSPITAL_PT","filter":{"type":"==","property":"subType","value":"COMMUNITY_HOSPITAL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61472","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"DENTAL_PT","filter":{"type":"==","property":"subType","value":"DENTAL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61472","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"EPIDEMIC_PT","filter":{"type":"==","property":"subType","value":"EPIDEMIC_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61472","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PET_HOSPITAL_PT","filter":{"type":"==","property":"subType","value":"PET_HOSPITAL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61478","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"LIGHT_PT","filter":{"type":"==","property":"subType","value":"LIGHT_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","fillColor":"rgb(241,235,235)","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PILL_PT","filter":{"type":"==","property":"subType","value":"PILL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61479","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PET_PT","filter":{"type":"==","property":"subType","value":"PET_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61478","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PAPER_PT","filter":{"type":"==","property":"subType","value":"PAPER_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61525","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CAR_SECONDE_PT","filter":{"type":"==","property":"subType","value":"CAR_SECONDE_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61449","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CAR_RENTAL_PT","filter":{"type":"==","property":"subType","value":"CAR_RENTAL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61449","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BRIDGE_B_PT","filter":{"type":"==","property":"subType","value":"BRIDGE_B_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"WHARF_PT","filter":{"type":"==","property":"subType","value":"WHARF_C_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61491","strokeColor":"rgb(168,188,216)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(142,169,192)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"WHARF_PT","filter":{"type":"==","property":"subType","value":"WHARF_B_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61491","strokeColor":"rgb(168,188,216)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(142,169,192)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"WHARF_PT","filter":{"type":"==","property":"subType","value":"WHARF_A_PT"},"styles":[{"minLevel":14,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61491","strokeColor":"rgb(168,188,216)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(142,169,192)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SCHOOL_PT","filter":{"type":"==","property":"subType","value":"SCHOOL_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61481","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"FOOD_WEST_PT","filter":{"type":"==","property":"subType","value":"FOOD_WEST_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61441","strokeColor":"rgb(215,135,82)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,160,133)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SCIENTIFIC_PT","filter":{"type":"==","property":"subType","value":"SCIENTIFIC_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61527","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COMMODITY_PT","filter":{"type":"==","property":"subType","value":"COMMODITY_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61459","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(177,157,203)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"KTV_PT","filter":{"type":"==","property":"subType","value":"KTV_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61474","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(171,159,196)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COFFEE_PT","filter":{"type":"==","property":"subType","value":"COFFEE_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61465","strokeColor":"rgb(215,135,82)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,160,133)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"FOOD_BAR_PT","filter":{"type":"==","property":"subType","value":"FOOD_BAR_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61458","strokeColor":"rgb(215,135,82)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,160,133)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"FOOD_CHINA_PT","filter":{"type":"==","property":"subType","value":"FOOD_CHINA_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61473","strokeColor":"rgb(215,135,82)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,160,133)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"ENTRANCE_PT","filter":{"type":"==","property":"subType","value":"ENTRANCE_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#57351","strokeColor":"rgb(102,171,127)","backgroundGraphic":"&#61523","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(255,255,255)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MOBILE_PT","filter":{"type":"==","property":"subType","value":"MOBILE_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61524","strokeColor":"rgb(87,112,157)","backgroundGraphic":"&#61523","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(255,255,255)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"COUNTY_PT","filter":{"type":"==","property":"subType","value":"COUNTY_PT"},"styles":[{"minLevel":8,"maxLevel":12,"symbolizer":{"externalGraphic":"","strokeColor":"rgb(193,115,98)","backgroundGraphic":"","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CARSERVICE_PT","filter":{"type":"==","property":"subType","value":"CARSERVICE_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61449","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SUPERMARKET_PT","filter":{"type":"==","property":"subType","value":"SUPERMARKET_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61442","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(164,151,193)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"STADIUM_B_PT","filter":{"type":"==","property":"subType","value":"STADIUM_B_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61488","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"STADIUM_A_PT","filter":{"type":"==","property":"subType","value":"STADIUM_A_PT"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61488","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"ZOO_PT","filter":{"type":"==","property":"subType","value":"ZOO_PT"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61490","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SIGHT_B_PT","filter":{"type":"==","property":"subType","value":"SIGHT_B_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61528","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SIGHT_A_PT","filter":{"type":"==","property":"subType","value":"SIGHT_A_PT"},"styles":[{"minLevel":11,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61528","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PARK_PT","filter":{"type":"==","property":"subType","value":"PARK_C_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61512","strokeColor":"rgb(138,162,99)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(148,168,139)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PARK_PT","filter":{"type":"==","property":"subType","value":"PARK_B_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61512","strokeColor":"rgb(138,162,99)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(148,168,139)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PARK_PT","filter":{"type":"==","property":"subType","value":"PARK_A_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61512","strokeColor":"rgb(138,162,99)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(148,168,139)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MUSEUM_B_PT","filter":{"type":"==","property":"subType","value":"MUSEUM_B_PT"},"styles":[{"minLevel":18,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61508","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MUSEUM_A_PT","filter":{"type":"==","property":"subType","value":"MUSEUM_A_PT"},"styles":[{"minLevel":16,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61508","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MOUNTAIN_PT","filter":{"type":"==","property":"subType","value":"MOUNTAIN_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61477","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MALL_PT","filter":{"type":"==","property":"subType","value":"MALL_B_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61459","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(177,157,203)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"MALL_PT","filter":{"type":"==","property":"subType","value":"MALL_A_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61459","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(177,157,203)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HOTEL_C_PT","filter":{"type":"==","property":"subType","value":"HOTEL_C_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61510","strokeColor":"rgb(150,130,130)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,191,184)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HOTEL_B_PT","filter":{"type":"==","property":"subType","value":"HOTEL_B_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61510","strokeColor":"rgb(150,130,130)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,191,184)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HOTEL_A_PT","filter":{"type":"==","property":"subType","value":"HOTEL_A_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61510","strokeColor":"rgb(150,130,130)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(197,191,184)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HOSPITAL_B_PT","filter":{"type":"==","property":"subType","value":"HOSPITAL_B_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61472","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HOSPITAL_A_PT","filter":{"type":"==","property":"subType","value":"HOSPITAL_A_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61472","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SCHOOL_UNIVERSITY_A_PT","filter":{"type":"==","property":"subType","value":"SCHOOL_UNIVERSITY_A_PT"},"styles":[{"minLevel":11,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61522","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"EXHCENTER_PT","filter":{"type":"==","property":"subType","value":"EXHCENTER_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61508","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"OIL_PT","filter":{"type":"==","property":"subType","value":"OIL_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61511","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"PLACE_PT","filter":{"type":"==","property":"subType","value":"PLACE_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"CARSTATION_PT","filter":{"type":"==","property":"subType","value":"CARSTATION_PT"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61494","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BUSINESS_PT","filter":{"type":"==","property":"subType","value":"BUSINESS_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TOLL_PT","filter":{"type":"==","property":"subType","value":"TOLL_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61460","strokeColor":"rgb(255,229,221)","backgroundGraphic":"&#57349","backgroundFillColor":"rgb(245,156,138)","outerStrokeColor":"rgb(245,156,138)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"GARDEN_PT","filter":{"type":"==","property":"subType","value":"GARDEN_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61512","strokeColor":"rgb(138,162,99)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(148,168,139)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"LIBRARY_PT","filter":{"type":"==","property":"subType","value":"LIBRARY_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61476","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"POST_PT","filter":{"type":"==","property":"subType","value":"POST_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61520","strokeColor":"rgb(107,143,77)","backgroundGraphic":"&#61523","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(255,255,255)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"STORES_A_PT","filter":{"type":"==","property":"subType","value":"STORES_A_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61459","strokeColor":"rgb(177,157,203)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(177,157,203)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"SQUARE_PT","filter":{"type":"==","property":"subType","value":"SQUARE_PT"},"styles":[{"minLevel":14,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BRIDGE_A_PT","filter":{"type":"==","property":"subType","value":"BRIDGE_A_PT"},"styles":[{"minLevel":17,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"BUILDING_PT","filter":{"type":"==","property":"subType","value":"BUILDING_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61447","strokeColor":"rgb(156,150,150)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(156,150,150)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"HIGH_SPEED_PT","filter":{"type":"==","property":"subType","value":"HIGH_SPEED_PT"},"styles":[{"minLevel":15,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61509","strokeColor":"rgb(168,188,216)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(154,177,198)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"POLICE_PT","filter":{"type":"==","property":"subType","value":"POLICE_PT"},"styles":[{"minLevel":14,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61461","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"GOVERNMENT_PT","filter":{"type":"==","property":"subType","value":"GOVERNMENT_PT"},"styles":[{"minLevel":11,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61461","strokeColor":"rgb(193,115,98)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(208,127,112)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TOWN_PT","filter":{"type":"==","property":"subType","value":"TOWN_C_PT"},"styles":[{"minLevel":13,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TOWN_PT","filter":{"type":"==","property":"subType","value":"TOWN_B_PT"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TOWN_PT","filter":{"type":"==","property":"subType","value":"TOWN_A_PT"},"styles":[{"minLevel":11,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61446","strokeColor":"rgb(128,103,103)","backgroundGraphic":"&#57347","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(162,143,141)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TRASTATION_PT","filter":{"type":"==","property":"subType","value":"TRASTATION_B_PT"},"styles":[{"minLevel":12,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61462","strokeColor":"rgb(168,188,216)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(168,188,216)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"TRASTATION_PT","filter":{"type":"==","property":"subType","value":"TRASTATION_A_PT"},"styles":[{"minLevel":11,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61462","strokeColor":"rgb(168,188,216)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(168,188,216)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]},{"featureType":"AIRPORT_PT","filter":{"type":"==","property":"subType","value":"AIRPORT_PT"},"styles":[{"minLevel":10,"maxLevel":20,"symbolizer":{"externalGraphic":"&#61445","strokeColor":"rgb(35,117,209)","backgroundGraphic":"&#57345","backgroundFillColor":"rgb(255,255,255)","outerStrokeColor":"rgb(154,177,198)","iconFont":"16px","label":"${name}","labelOutlineColor":"rgb(255,255,255)","labelOutlineWidth":1,"fontFamily":"Arial","fontWeight":"normal","fontStyle":"normal","fontSize":"7px","fontColor":"rgb(162,143,141)","labelAlign":"cb","display":"block"}}]}]};HGIS.utils=HGIS.utils||{};HGIS.utils.MapStyleUtil=HGIS.utils.MapStyleUtil||{};HGIS.utils.MapStyleUtil.styleJson=null;HGIS.utils.MapStyleUtil.styleMap=null;HGIS.utils.MapStyleUtil.hvtUrl=APIAdress.replace("hgis-web","hgis-services").replace("hgis-services/hgisFrontLib","hgis-services")+"/tileCache/HvtTileCacheServlet?mapType=hvt&tileType=vec&level=${z}&col=${x}&row=${y}";HGIS.utils.MapStyleUtil.scales=null;HGIS.utils.MapStyleUtil.loadStyleJson=function(C,A){if(!C){C=APIAdress+"gisapi/theme/MapStyle.json"}var B=new XMLHttpRequest();if(B==null){alert(HGIS.language[HGIS.InitParam.language]["DB_fail"])}B.open("GET",C);B.setRequestHeader("Content-type","application/json; charset=utf-8");B.send();B.onreadystatechange=function(){if(B.readyState==1||B.readyState==2||B.readyState==3){HGIS.utils.MapStyleUtil.styleJson=null}if(B.readyState==4&&B.status==200){var E=B.responseText;var D=JSON.parse(E);if(D.data){HGIS.utils.MapStyleUtil.styleJson=D.data.configDetail}else{HGIS.utils.MapStyleUtil.styleJson=D}A(HGIS.utils.MapStyleUtil.styleJson)}}};HGIS.utils.MapStyleUtil.createStyleMap=function(M,C){if(M==null){return}var H=new HGIS.Style();var D=null;if(M.rules==undefined||M.rules==null){D=M}else{D=M.rules}for(var G=0,L=D.length;G<L;G++){var E=D[G];var I=null;if(E.logicalFilter){I=new HGIS.Filter.Logical({type:E.logicalFilter.type});var B=E.logicalFilter.filters;for(var J=0;J<B.length;J++){var K=new HGIS.Filter.Comparison();K.type=B[J].type;K.prototype=B[J].property;K.value=B[J].value;I.filters.push(K)}}else{if(E.filter){I=new HGIS.Filter.Comparison();I.type=E.filter.type;I.property=E.filter.property;I.value=E.filter.value}}for(var F=0;F<E.styles.length;F++){var A=new HGIS.Rule(E.styles[F]);A.featureType=E.featureType;A.filter=I;A.elseFilter=true;A.maxScaleDenominator=C[E.styles[F].minLevel];A.minScaleDenominator=C[E.styles[F].maxLevel];A.symbolizer=E.styles[F].symbolizer;H.addRules([A])}}HGIS.utils.MapStyleUtil.styleMap=new HGIS.StyleMap({"default":H,"select":new HGIS.Style(M.select)});return HGIS.utils.MapStyleUtil.styleMap};HGIS.utils.MapStyleUtil.updateStyleMap=function(D,A,C,B){D.renderer.changeMapStyle(A,C,B);D.refresh()};HGIS.utils.MapStyleUtil.updateMapByRules=function(B,C){if(HGIS.utils.MapStyleUtil.scales==null){HGIS.utils.MapStyleUtil.getMapScales(B.map.resolutions,HGIS.InitParam.srid)}var A=HGIS.utils.MapStyleUtil.createStyleMap(C,HGIS.utils.MapStyleUtil.scales);B.styleMap=A;B.refresh()};HGIS.utils.MapStyleUtil.getMapScales=function(H,C){var D=[];var A=96,F=0.0254;var E=A/F;var I=Math.PI*6378137/180;for(var G=0,B=H.length;G<B;G++){var J=H[G]*E;if(C=="4326"){J=H[G]*I*E}D.push(J)}HGIS.utils.MapStyleUtil.scales=D;return D};HGIS.utils.MapStyleUtil.getMapImage=function(J,B,A,C){var E=J.renderer;var H=E.root.width;var L=E.root.height;var G=document.createElement("canvas");G.width=B;G.height=A;var M=(H-B)/2;var K=(L-A)/2;var F=G.getContext("2d");var I=E.root;var D=new Image();D.onload=function(){F.drawImage(D,M,K,B,A,0,0,B,A);var O=E.lineCanvas;var N=new Image();N.onload=function(){F.drawImage(N,M,K,B,A,0,0,B,A);var Q=E.hitCanvas;var P=new Image();P.onload=function(){F.drawImage(P,M,K,B,A,0,0,B,A);var R=G.toDataURL("image/jpeg",1);if(C){C(R)}};P.src=Q.toDataURL()};N.src=O.toDataURL()};D.src=I.toDataURL()};HGIS.utils.MapStyleUtil.flickerByFeatureType=function(F,H,B){var I=new Array();var A={};var C=HGIS.utils.FeatureUtil.getsubTypes(H);if(C.length==0){for(var E=0,G=F.features.length;E<G;E++){if(F.features[E].attributes.subType.toUpperCase()==H){I.push(F.features[E])}}}else{if(C.length>0){for(var E=0,G=F.features.length;E<G;E++){if(C.indexOf(F.features[E].attributes.subType)>-1){I.push(F.features[E])}}}}if(I.length>1){for(var J in I[0].style){A[J]=I[0].style[J];if(J=="label"){A[J]=""}}var D="rgb(255,0,0)";if(B){D=B}switch(I[0].type){case 3:A.fillColor=D;break;case 2:A.strokeColor=D;break;case 1:A.strokeColor=D;break;default:A.fillColor="rgb(255,0,0)";break}F.renderer.drawFeaturesSameType(I,A);F.renderer.stopLoop(false);F.renderer.startLoop()}};HGIS.utils.MapStyleUtil.flickerByFeatureType.contains=function(C,B){var A=C.length;while(A--){if(C[A]===B){return true}}return false};HGIS.utils.MapStyleUtil.changeBgColor=function(D,C){if(C){D.renderer.root.style.background=C}else{var B=HGIS.utils.MapStyleUtil.styleJson.rules;for(var A=0;A<B.length;A++){if(B[A].featureType=="LAND"){D.renderer.root.style.background=B[A].styles[0].symbolizer.fillColor;return}}}};HGIS.utils.MapStyleUtil.getLandColor=function(D){var C=null;var B=null;if(D){B=D.rules}else{B=HGIS.utils.MapStyleUtil.styleJson.rules}for(var A=0;A<B.length;A++){if(B[A].featureType==="LAND"){C=B[A].styles[0].symbolizer.fillColor;return C}}};HGIS.utils.MapStyleUtil.getVtStylePath=function(D){var B=APIAdress.split("/");var C=B[0]+"//"+B[2]+"/";var A=C+"GeoData/hvtstyles/"+D+"/MapStyle.json";return A};HGIS.utils.MapStyleUtil.ifExitVtStyleByUrl=function(F){var C=mapServerConfigURL.ifExitVtStyleByUrl;var E={vtStylepath:F};var A=0;var D=HGIS.Utils;D._asynchronous=false;D.send(C,E,"POST","json",function(G){if(G.data){A=1}},function(){});D._asynchronous=true;if(A===0){var B=encodeURI(HGIS.utils.MapStyleUtil.getVtStylePath(F));throw B+" not find in the services,please check the vtStyleName"}};HGIS.utils.MapStyleUtil.getHvtStyle=function(D){var C=0;var B=HGIS.Utils;B._asynchronous=false;var A=mapServerConfigURL.getVTConfigDetailById+"?vtid="+D;B.send(A,"","get","json",function(E){if(E.data){HGIS.utils.MapStyleUtil.styleJson=E.data.configDetail}else{HGIS.utils.MapStyleUtil.styleJson=E}},function(){});B._asynchronous=true};HGIS=HGIS||{};HGIS.Matrix={m:null,cellSize:16,size:16,init:function(){this.m=[];for(var A=0;A<this.size;A++){this.m[A]=[];for(var B=0;B<this.size;B++){this.m[A][B]=0}}},toHash:function(){var C="";var A=this.m.length;for(var B=0;B<A;B++){for(var D=0;D<A;D++){C+=this.m[B][D]}}return C},move:function(A,B){c=Math.round(A/this.cellSize);r=Math.round(B/this.cellSize);this.setValue(r,c,B,A)},line:function(D,E,B,C){c0=Math.round(D/this.cellSize);c1=Math.round(B/this.cellSize);r0=Math.round(E/this.cellSize);r1=Math.round(C/this.cellSize);var F=0;if(B==D){F=10000}else{F=Math.abs((C-E)/(B-D))}if(F==10000){if(r0>r1){for(var A=r0;A>=r1;A--){this.setValue(A,c0,A*this.cellSize+E%this.cellSize,D)}}else{for(var A=r0;A<=r1;A++){this.setValue(A,c0,A*this.cellSize+E%this.cellSize,D)}}}else{if(Math.abs(F)<=1){if(D<B){for(var G=D;G<=B;G=G+this.cellSize){var H=(G-D)*F+E;H=Math.round(H);this.setValue(Math.floor(H/this.cellSize),Math.floor(G/this.cellSize),H,G)}}else{for(var G=D;G>=B;G=G-this.cellSize){var H=(G-D)*F+E;H=Math.round(H);this.setValue(Math.floor(H/this.cellSize),Math.floor(G/this.cellSize),H,G)}}}else{if(E<C){for(var H=E;H<=C;H=H+this.cellSize){var G=(H-E)/F+D;G=Math.round(G);this.setValue(Math.floor(H/this.cellSize),Math.floor(G/this.cellSize),H,G)}}else{for(var H=E;H>=C;H=H-this.cellSize){var G=(H-E)/F+D;G=Math.round(G);this.setValue(Math.floor(H/this.cellSize),Math.floor(G/this.cellSize),H,G)}}}}},setValue:function(A,C,D,B){if(A<0){A=0}if(A>this.size-1){A=this.size-1}if(C<0){C=0}if(C>this.size-1){C=this.size-1}this.m[A][C]=1;if(D%this.cellSize<=this.cellSize/2&&B%this.cellSize<=this.cellSize/2){if(A>0){this.m[A-1][C]=1}if(A>0&&C>0){this.m[A-1][C-1]=1}if(C>0){this.m[A][C-1]=1}}else{if(D%this.cellSize>this.cellSize/2&&B%this.cellSize<=this.cellSize/2){if(C>0){this.m[A][C-1]=1}if(A<this.size-1&&C>0){this.m[A+1][C-1]=1}if(A<this.size-1){this.m[A+1][C]=1}}else{if(D%this.cellSize<=this.cellSize/2&&B%this.cellSize>this.cellSize/2){if(A>0){this.m[A-1][C]=1}if(A>0&&C<this.size-1){this.m[A-1][C+1]=1}if(C<31){this.m[A][C+1]=1}}else{if(D%this.cellSize>this.cellSize/2&&B%this.cellSize>this.cellSize/2){if(C<this.size-1){this.m[A][C+1]=1}if(A<this.size-1){this.m[A+1][C]=1}if(A<this.size-1&&C<this.size-1){this.m[A+1][C+1]=1}}}}}},fill:function(){for(var A=0;A<this.size;A++){var C=0;for(var B=0;B<this.size;B++){if(this.m[A][B]==0&&C==0){continue}if(this.m[A][B]==1){C=1;continue}for(var D=B;D<this.size;D++){if(this.m[A][D]==1&&this.m[A][D]^this.m[A][D+1]==1){this.m[A][B]=this.m[A][B]^1}}}}}};HGIS.tools={getFactor:function(){var A=HGIS.Utils.getUrlByExpolreType(mapServerConfigURL.getFactorConfig);if(A.indexOf("jsonp")!=-1){HgisAjax({url:A,jsonp:"jsonp",data:{},success:function(B){if(B.code=="0"){HGIS.Converter.minLon=B.data.minLon;HGIS.Converter.minLat=B.data.minLat;HGIS.Converter.maxLon=B.data.maxLon;HGIS.Converter.maxLat=B.data.maxLat;HGIS.Converter.per=B.data.per;HGIS.Converter.Factor=JSON.parse(B.data.factor)}},error:function(B){}})}else{HGIS.Utils.send(mapServerConfigURL.getFactorConfig,"","get","json",function(B){if(B.code=="0"){HGIS.Converter.minLon=B.data.minLon;HGIS.Converter.minLat=B.data.minLat;HGIS.Converter.maxLon=B.data.maxLon;HGIS.Converter.maxLat=B.data.maxLat;HGIS.Converter.per=B.data.per;HGIS.Converter.Factor=JSON.parse(B.data.factor)}},function(B){})}}};HGIS.Utils=HGIS.Utils||{};HGIS.Utils={_map:null,getContextRoot:function(){var E=window.document.location.href;var A=window.document.location.pathname;var B=E.indexOf(A);var D=E.substring(0,B);var C=A.substring(0,A.substr(1).indexOf("/")+1);return(D+C)},geom2Wkt:function(C){var A=new HGIS.Format.WKT();var B=A.extractGeometry(C);return B},isWithinMap:function(B){var A=null;if(HGIS.Utils._map!==null&&HGIS.Utils._map!==""&&HGIS.Utils._map!==undefined){A=HGIS.Utils._map.maxExtent}else{A=HGIS.InitParam.extent}if(B instanceof HGIS.LonLat){var C=true;if((B.lon<A.left)||(B.lon>A.right)){C=false}else{if((B.lat>A.top)||(B.lat<A.bottom)){C=false}}return C}else{if(B instanceof HGIS.Geometry){var E=B.bounds;var D=true;if(E.left<A.left){D=false}else{if(E.right>A.right){D=false}else{if(E.top>A.top){inIn2=false}else{if(E.bottom<A.bottom){D=false}}}}return D}else{throw new Error("notSupport!")}}},screenShot:function(F,G,B,D,E,I){var A=document.getElementsByTagName("html")[0].innerHTML;A="<!DOCTYPE html><html>"+A+"</html>";var H=APIAdress.substr(0,APIAdress.length-5)+"/";A=A.replace("</title>","</title><base href="+H+"/>").replace('smControlDrawFeatureActive" style="position: relative;','smControlDrawFeatureActive" style="position: absolute;');A=encodeURIComponent(A);var C={"dom":A,"x":F,"y":G,"w":B,"h":D,"width":document.body.clientWidth,"height":document.body.clientHeight};HGIS.Utils.send(screenShotUrl,C,"POST","text",E,I)},wkb2geom:function(D){var C="";for(var B=0;B<D.length;B++){var A=D[B].toString(16);if(A.length==1){A="0"+A}C+=A}return C},getTextSize:function(C,D,B){var A=document.getElementById("text_width_span");if(!A){A=document.createElement("span");document.body.appendChild(A);A.setAttribute("id","text_width_span");A.style.position="absolute";A.style.top="-10000px";A.style.left="-10000px"}A.style.fontSize="13px";A.style.fontFamily="''";if(D){A.style.fontSize=D+"px"}if(B){A.style.fontFamily="'"+B+"'"}A.innerText=C;return{width:A.offsetWidth,height:A.offsetHeight}},wkt2Geom:function(C){var A=new HGIS.Format.WKT();var B=A.read(C);return B.geometry},isSupportCanvas:function(){var A=document.createElement("canvas");return !!(A.getContext&&A.getContext("2d"))},createSector:function(M,I,B,J,E){if(I<=0){return null}if(HGIS.InitParam.mapUnit=="degrees"){var N=HGIS.MapEx.prototype.degreeSpanToMeter.apply(this,[M.y,"degrees"]);I=I/N}var O=E?E:100;var G=(B-J/2)*(Math.PI/180);var J=(J/O)*(Math.PI/180);var K=[];K.push(M);for(var A=0;A<=O;A=A+1){var D=G+A*J;var C=M.x+(I*Math.cos(D));var L=M.y+(I*Math.sin(D));K.push(new HGIS.Geometry.Point(C,L))}var H=new HGIS.Geometry.LinearRing(K);var F=new HGIS.Geometry.Polygon([H]);return F},createSectorByEquidistance:function(M,I,B,J,E){if(I<=0){return null}var O=E?E:100;var G=(B-J/2)*(Math.PI/180);var J=(J/O)*(Math.PI/180);var K=[];K.push(M);if(HGIS.InitParam.geodesic){var C=new HGIS.LonLat(M.x,M.y);for(var N=0;N<=O;N=N+1){rotatedAngle=(G+N*J)*180/Math.PI;plonlat=HGIS.Util.destinationVincenty(C,rotatedAngle,I);K.push(new HGIS.Geometry.Point(plonlat.lon,plonlat.lat))}}else{for(var N=0;N<=O;N=N+1){var D=G+N*J;var A=M.x+(I*Math.cos(D));var L=M.y+(I*Math.sin(D));K.push(new HGIS.Geometry.Point(A,L))}}var H=new HGIS.Geometry.LinearRing(K);var F=new HGIS.Geometry.Polygon([H]);return F},createCircle:function(A,J,F){if(J<=0){return null}if(HGIS.InitParam.mapUnit=="degrees"){var N=HGIS.MapEx.prototype.degreeSpanToMeter.apply(this,[A.y,"degrees"]);J=J/N}var L=F?F:100;var I=new Array();var K=Math.PI*(1/L);var E=0;if(E){K+=(E/180)*Math.PI}var O,C,M;var D=[];for(var H=0;H<=L;H=H+1){O=K+(H*2*Math.PI/L);C=Number(A.x)+(J*Math.cos(O));M=Number(A.y)+(J*Math.sin(O));D.push(new HGIS.Geometry.Point(C,M))}var G=new HGIS.Geometry.LinearRing(D);var B=new HGIS.Geometry.Polygon([G]);return B},createCircleByEquidistance:function(A,G,E){if(G<=0){return null}var H=E?E:100;var C=new Array();var D=this.getCruvePoint(A,G,0,H);var F=new HGIS.Geometry.LinearRing(D);var B=new HGIS.Geometry.Polygon([F]);return B},getCruvePoint:function(A,F,K,H){var G=Math.PI*(1/H);var J,I,K,C;var B=[];if(HGIS.InitParam.geodesic){var E=new HGIS.LonLat(A.x,A.y);for(var D=0;D<=H;D=D+1){K=(G+D*G*2)*180/Math.PI;C=HGIS.Util.destinationVincenty(E,K,F);B.push(new HGIS.Geometry.Point(C.lon,C.lat))}}else{for(var D=0;D<=H;D=D+1){K=G+(D*G*2);J=Number(A.x)+(F*Math.cos(K));I=Number(A.y)+(F*Math.sin(K));B.push(new HGIS.Geometry.Point(J,I))}}return B},caculateDistance:function(C,G){if(HGIS.InitParam.mapUnit=="degrees"){if(typeof(C.lon)=="undefined"){var E=C.x;var F=C.y;var A=G.x;var B=G.y;C=new HGIS.LonLat();G=new HGIS.LonLat();C.lon=E;C.lat=F;G.lon=A;G.lat=B}return HGIS.Util.distVincenty(C,G)*1000}else{var D=0;if(typeof(C.x)=="undefined"){D=Math.sqrt((C.lon-G.lon)*(C.lon-G.lon)+(C.lat-G.lat)*(C.lat-G.lat))}else{D=Math.sqrt((C.x-G.x)*(C.x-G.x)+(C.y-G.y)*(C.y-G.y))}return parseFloat(D.toFixed(1))}},createCircleRing:function(P,A,M,H){if(A<=0||M<=0){return null}if(HGIS.InitParam.mapUnit=="degrees"){var J=HGIS.MapEx.prototype.degreeSpanToMeter.apply(this,[P.y,"degrees"]);A=A/J;M=M/J}var K=new Array();var F=Math.PI*(1/50);var G=0;if(G){F+=(G/180)*Math.PI}var C,N,O;var Q=[];var L=[];for(var D=0;D<=50;D=D+1){C=F+(D*2*Math.PI/50);N=Number(P.x)+(M*Math.cos(C));O=Number(P.y)+(M*Math.sin(C));Q.push(new HGIS.Geometry.Point(N,O))}var B=new HGIS.Geometry.LinearRing(Q);for(var D=0;D<=50;D=D+1){C=F+(D*2*Math.PI/50);N=P.x+(A*Math.cos(C));O=P.y+(A*Math.sin(C));L.push(new HGIS.Geometry.Point(N,O))}var I=new HGIS.Geometry.LinearRing(L);var E=new HGIS.Geometry.Polygon([B,I]);return E},createCircleRingByEquidistance:function(A,J,G,F){if(J<=0||G<=0){return null}var I=new Array();var K=F?F:100;var C=[];var H=[];var C=this.getCruvePoint(A,G,0,K);var H=this.getCruvePoint(A,J,0,K);var D=new HGIS.Geometry.LinearRing(C);var B=new HGIS.Geometry.LinearRing(H);var E=new HGIS.Geometry.Polygon([B,D]);return E},tranferDegree:function(C){var A=C.toString().split(".");var I=A[0]*1;var H=60*A[1]/Math.pow(10,A[1].length);var G=H.toString().split(".");var B=G[0]*1;var E=G[1]*1/Math.pow(10,G[1].length)*60;var F=(I*3600+B*60+E)*100;var D={"d":I,"mi":B,"s":E};return D},getExendByDiv:function(N,C,L){var O=document.getElementById(C);var M=O.offset().top;var A=O.offset().left;var J=O.width(),I=O.height();var H=A-L,K=M+I+L,F=A+J+L,G=M-L;var D=new HGIS.Bounds();var E=N.getLonLatFromPixel(new HGIS.Pixel(H,K));D.extend(E);var B=N.getLonLatFromPixel(new HGIS.Pixel(F,G));D.extend(B);return D},getExploreType:function(){if(navigator.userAgent.indexOf("MSIE")>0){return"MSIE"}else{if(isFirefox=navigator.userAgent.indexOf("Firefox")>0){return"Firefox"}else{if(isSafari=navigator.userAgent.indexOf("Safari")>0){return"Safari"}else{if(isCamino=navigator.userAgent.indexOf("Camino")>0){return"Camino"}else{if(isMozilla=navigator.userAgent.indexOf("Gecko/")>0){return"Gecko"}else{return"unkownExplore"}}}}}},getUrlByExpolreType:function(A){if("MSIE"===HGIS.Utils.getExploreType()){A=A+"?f=jsonp";return A}else{return A}},_asynchronous:true,send:function(L,G,F,J,N,K){var H=document.domain;var E=window.location.port;var M=false;if(L.indexOf("http")>=0&&L.indexOf(H+":"+E)<=0){M=true}var C=new XMLHttpRequest();C.onreadystatechange=function(){if(C.readyState==4){var R=C.status;if(R>=200&&R<300||R===304||R===1223){var O=C.responseText;var Q=null;if(J=="text"){Q=O}else{if(J=="json"){if(O==""){Q={"message":"success"}}else{Q=JSON.parse(O)}}else{if(J=="xml"){Q=C.responseXML}else{alert(HGIS.language[HGIS.InitParam.language]["only_supportType"])}}}N(Q)}else{var P="error:"+R;K(P)}}};if((navigator.appName=="Microsoft Internet Explorer"&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE6.0"&&M)||(navigator.appName=="Microsoft Internet Explorer"&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE7.0"&&M)||(navigator.appName=="Microsoft Internet Explorer"&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE8.0"&&M)||(navigator.appName=="Microsoft Internet Explorer"&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE9.0")&&M){G=G||{};G.url=L;G.requestType=F;var D="";for(var A in G){D+=A+"="+G[A]+"&"}D=D.substring(0,D.length-1);if(HGIS.ProxyUrl){L=HGIS.ProxyUrl+"?"+D}C.open("GET",L,this._asynchronous);C.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");C.send(D)}else{C.open(F,L,this._asynchronous);if(F.toLowerCase()=="get"){C.setRequestHeader("Content-Type","text/html;charset=UTF-8")}else{if(F.toLowerCase()=="post"){var B=G;G="";var I=0;for(A in B){if(I==0){G+=A+"="+B[A]}else{G+="&"+A+"="+B[A]}I++}C.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}}C.send(G)}},unionJson:function(C){var B={};for(var A=0;A<C.length;A=A+1){for(var D in C[A]){B[D]=C[A][D]}}return B},randomColor:function(){var A="0123456789abcdef";var B="#";for(var C=0;C<6;C=C+1){B=B+A.charAt(Math.random()*A.length)}return B},json2str:function(C){if(C==undefined){return""}var A=[];if(typeof C=="string"){return'"'+C.replace(/([\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"'}if(typeof C=="object"){if(!C.sort){for(var B in C){A.push('"'+B+'":'+json2str(C[B]))}if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(C.toString)){A.push("toString:"+C.toString.toString())}A="{"+A.join()+"}"}else{for(var B=0;B<C.length;B++){A.push(json2str(C[B]))}A="["+A.join()+"]"}return A}return C.toString().replace(/\"\:/g,'":""')},objArr2Json:function(C){var B="[";for(var A=0;A<C.length;A++){if(A==C.length-1){B=B+this.json2str(C[A])+"]"}else{B=B+this.json2str(C[A])+","}}return B},checkChinese:function(B){var A=new RegExp("[\\u4E00-\\u9FFF]+","g");var C=A.test(B);return C},JSONResultData:function(A){var C=-1;var B="";var D;var G;if(A==null||A==""){C=-1;B="";return}try{var F=typeof(A);if(F=="string"){G=JSONUtil["parseJSON"](A)}else{G=A}if(G!=null){C=G["ReturnFlag"];B=G["ReturnInfo"];D=G["Data"]}}catch(E){C=-1;B="JSon"}this["getData"]=function(){try{if(D==null||D==""){return null}if(D instanceof String){var I=JSONUtil["parseJSON"](D);D=I;return I}else{return D}}catch(H){return null}return null};this["getReturnFlag"]=function(){return C};this["getReturnInfo"]=function(){return B};this["getResult"]=function(){return G}},getSafeAddress:function(A){var B=A;if(window.location.protocol=="https:"&&(A.indexOf("https:")<0)){B=safeProxyURL+HGISBase64.encode(A)}return B}};Array.max=function(A){return Math.max.apply(Math,A)};Array.min=function(A){return Math.min.apply(Math,A)};Array.existValue=function(C,A){var D={arrObj:"undefind",flag:false};for(var B=0;B<C.length;B=B+1){if(C[B]==A){D.arrObj=C[B];D.flag=true;return arrObj;break}}return D};Array.prototype.in_array=function(B){var C="undefind";for(var A=0;A<this.length;A=A+1){if(this[A]==B){C=A;break}}return C};if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var xml2Json={parser:function(A,D,C){if(!D){D=""}A=A.replace(/\s*\/>/g,"/>");A=A.replace(/<\?[^>]*>/g,"").replace(/<\![^>]*>/g,"");if(!D.sort){D=D.split(",")}var E=this.no_fast_endings(A);E=this.attris_to_tags(E);E=escape(E);E=E.split("%3C").join("<").split("%3E").join(">").split("%3D").join("=").split("%22").join('"');for(var B=0;B<D.length;B++){E=E.replace(new RegExp("<"+D[B]+">","g"),"*$**"+D[B]+"**$*");E=E.replace(new RegExp("</"+D[B]+">","g"),"*$***"+D[B]+"**$*")}E="<JSONTAGWRAPPER>"+E+"</JSONTAGWRAPPER>";this.xmlobject={};var F=this.xml_to_object(E).jsontagwrapper;if(C){F=this.show_json_structure(F,C)}return F},xml_to_object:function(xmlcode){var x=xmlcode.replace(/<\//g,"?");x=x.split("<");var y=[];var level=0;var opentags=[];for(var i=1;i<x.length;i++){var tagname=x[i].split(">")[0];opentags.push(tagname);level++;y.push(level+"<"+x[i].split("?")[0]);while(x[i].indexOf("?"+opentags[opentags.length-1]+">")>=0){level--;opentags.pop()}}var oldniva=-1;var objname="this.xmlobject";for(var i=0;i<y.length;i++){var preeval="";var niva=y[i].split("<")[0];var tagnamn=y[i].split("<")[1].split(">")[0];tagnamn=tagnamn.toLowerCase();var rest=y[i].split(">")[1];if(niva<=oldniva){var tabort=oldniva-niva+1;for(var j=0;j<tabort;j++){objname=objname.substring(0,objname.lastIndexOf("."))}}objname+="."+tagnamn;var pobject=objname.substring(0,objname.lastIndexOf("."));if(eval("typeof "+pobject)!="object"){preeval+=pobject+"={value:"+pobject+"};\n"}var objlast=objname.substring(objname.lastIndexOf(".")+1);var already=false;var temp=eval(pobject);for(var k in temp){if(k==objlast){already=true}}var onlywhites=true;for(var s=0;s<rest.length;s+=3){if(rest.charAt(s)!="%"){onlywhites=false}}if(rest!=""&&!onlywhites){if(rest/1!=rest){rest="'"+rest.replace(/\'/g,"\\'")+"'";rest=rest.replace(/\*\$\*\*\*/g,"</");rest=rest.replace(/\*\$\*\*/g,"<");rest=rest.replace(/\*\*\$\*/g,">")}}else{rest="{}"}if(rest.charAt(0)=="'"){rest="unescape("+rest+")"}if(already&&!eval(objname+".sort")){preeval+=objname+"=["+objname+"];\n"}var before="=";after="";if(already){before=".push(";after=")"}var toeval=preeval+objname+before+rest+after;eval(toeval);if(eval(objname+".sort")){objname+="["+eval(objname+".length-1")+"]"}oldniva=niva}return this.xmlobject},show_json_structure:function(I,F,E){var G="";if(I.sort){G+="[\n"}else{G+="{\n"}for(var D in I){if(!I.sort){G+=D+":"}if(typeof I[D]=="object"){G+=this.show_json_structure(I[D],false,1)}else{if(typeof I[D]=="function"){var B=I[D]+"";G+=B}else{if(typeof I[D]!="string"){G+=I[D]+",\n"}else{G+="'"+I[D].replace(/\'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")+"',\n"}}}}if(I.sort){G+="],\n"}else{G+="},\n"}if(!E){G=G.substring(0,G.lastIndexOf(","));G=G.replace(new RegExp(",\n}","g"),"\n}");G=G.replace(new RegExp(",\n]","g"),"\n]");var H=G.split("\n");G="";var A=0;for(var D=0;D<H.length;D++){if(H[D].indexOf("}")>=0||H[D].indexOf("]")>=0){A--}tabs="";for(var C=0;C<A;C++){tabs+="\t"}G+=tabs+H[D]+"\n";if(H[D].indexOf("{")>=0||H[D].indexOf("[")>=0){A++}}if(F=="html"){G=G.replace(/</g,"&lt;").replace(/>/g,"&gt;");G=G.replace(/\n/g,"<BR>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}if(F=="compact"){G=G.replace(/\n/g,"").replace(/\t/g,"")}}return G},no_fast_endings:function(B){B=B.split("/>");for(var A=1;A<B.length;A++){var C=B[A-1].substring(B[A-1].lastIndexOf("<")+1).split(" ")[0];B[A]="></"+C+">"+B[A]}B=B.join("");return B},attris_to_tags:function(D){var A=" =\"'".split("");D=D.split(">");for(var B=0;B<D.length;B++){var E=D[B].split("<");for(var C=0;C<4;C++){E[0]=E[0].replace(new RegExp(A[C],"g"),"_jsonconvtemp"+C+"_")}if(E[1]){E[1]=E[1].replace(/'/g,'"');E[1]=E[1].split('"');for(var F=1;F<E[1].length;F+=2){for(var C=0;C<4;C++){E[1][F]=E[1][F].replace(new RegExp(A[C],"g"),"_jsonconvtemp"+C+"_")}}E[1]=E[1].join('"')}D[B]=E.join("<")}D=D.join(">");D=D.replace(/ ([^=]*)=([^ |>]*)/g,"><$1>$2</$1");D=D.replace(/>"/g,">").replace(/"</g,"<");for(var C=0;C<4;C++){D=D.replace(new RegExp("_jsonconvtemp"+C+"_","g"),A[C])}return D}};if(!Array.prototype.push){Array.prototype.push=function(A){this[this.length]=A;return true}}if(!Array.prototype.pop){Array.prototype.pop=function(){var A=this[this.length-1];this.length--;return A}};